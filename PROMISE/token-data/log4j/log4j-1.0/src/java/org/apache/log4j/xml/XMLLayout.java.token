package
org
.
apache
.
log4j
.
xml
;
import
org
.
apache
.
log4j
.
Layout
;
import
org
.
apache
.
log4j
.
spi
.
LoggingEvent
;
import
org
.
apache
.
log4j
.
helpers
.
OptionConverter
;
import
org
.
apache
.
log4j
.
helpers
.
DateLayout
;
public
class
XMLLayout
extends
Layout
{
private
final
int
DEFAULT_SIZE
=
256
;
private
final
int
UPPER_LIMIT
=
2048
;
private
StringBuffer
buf
=
new
StringBuffer
(
DEFAULT_SIZE
)
;
private
boolean
locationInfo
=
false
;
public
static
final
String
LOCATION_INFO_OPTION
=
"LocationInfo"
;
public
void
activateOptions
(
)
{
}
public
String
format
(
LoggingEvent
event
)
{
if
(
buf
.
capacity
(
)
>
UPPER_LIMIT
)
{
buf
=
new
StringBuffer
(
DEFAULT_SIZE
)
;
}
else
{
buf
.
setLength
(
0
)
;
}
buf
.
append
(
"<log4j:event category=\""
)
;
buf
.
append
(
event
.
categoryName
)
;
buf
.
append
(
"\" timestamp=\""
)
;
buf
.
append
(
event
.
timeStamp
)
;
buf
.
append
(
"\" priority=\""
)
;
buf
.
append
(
event
.
priority
)
;
buf
.
append
(
"\" thread=\""
)
;
buf
.
append
(
event
.
getThreadName
(
)
)
;
buf
.
append
(
"\">\r\n"
)
;
buf
.
append
(
"<log4j:message>"
)
;
buf
.
append
(
event
.
message
)
;
buf
.
append
(
"</log4j:message>\r\n"
)
;
String
ndc
=
event
.
getNDC
(
)
;
if
(
ndc
!=
null
)
{
buf
.
append
(
"<log4j:NDC>"
)
;
buf
.
append
(
ndc
)
;
buf
.
append
(
"</log4j:NDC>\r\n"
)
;
}
String
t
=
event
.
getThrowableInformation
(
)
;
if
(
t
!=
null
)
{
buf
.
append
(
"<log4j:throwable>"
)
;
buf
.
append
(
t
)
;
buf
.
append
(
"</log4j:throwable>\r\n"
)
;
}
if
(
locationInfo
)
{
event
.
setLocationInformation
(
)
;
buf
.
append
(
"<log4j:locationInfo class=\""
)
;
buf
.
append
(
event
.
locationInfo
.
getClassName
(
)
)
;
buf
.
append
(
"\" method=\""
)
;
buf
.
append
(
event
.
locationInfo
.
getMethodName
(
)
)
;
buf
.
append
(
"\" file=\""
)
;
buf
.
append
(
event
.
locationInfo
.
getFileName
(
)
)
;
buf
.
append
(
"\" line=\""
)
;
buf
.
append
(
event
.
locationInfo
.
getLineNumber
(
)
)
;
buf
.
append
(
"\"/>\r\n"
)
;
}
buf
.
append
(
"</log4j:event>\r\n\r\n"
)
;
return
buf
.
toString
(
)
;
}
public
String
[
]
getOptionStrings
(
)
{
return
new
String
[
]
{
LOCATION_INFO_OPTION
}
;
}
public
boolean
ignoresThrowable
(
)
{
return
false
;
}
public
void
setOption
(
String
key
,
String
value
)
{
if
(
value
==
null
)
return
;
if
(
key
.
equals
(
LOCATION_INFO_OPTION
)
)
{
locationInfo
=
OptionConverter
.
toBoolean
(
value
,
locationInfo
)
;
}
}
}
