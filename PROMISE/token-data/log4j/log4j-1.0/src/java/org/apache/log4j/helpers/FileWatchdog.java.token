package
org
.
apache
.
log4j
.
helpers
;
import
java
.
io
.
File
;
import
org
.
apache
.
log4j
.
helpers
.
LogLog
;
public
abstract
class
FileWatchdog
extends
Thread
{
static
final
public
long
DEFAULT_DELAY
=
60000
;
protected
String
filename
;
protected
long
delay
=
DEFAULT_DELAY
;
File
file
;
long
lastModif
=
0
;
boolean
warnedAlready
=
false
;
protected
FileWatchdog
(
String
filename
)
{
this
.
filename
=
filename
;
file
=
new
File
(
filename
)
;
setDaemon
(
true
)
;
checkAndConfigure
(
)
;
}
public
void
setDelay
(
long
delay
)
{
this
.
delay
=
delay
;
}
abstract
protected
void
doOnChange
(
)
;
protected
void
checkAndConfigure
(
)
{
if
(
file
.
exists
(
)
)
{
long
l
=
file
.
lastModified
(
)
;
if
(
l
>
lastModif
)
{
lastModif
=
l
;
doOnChange
(
)
;
warnedAlready
=
false
;
}
}
else
{
if
(
!
warnedAlready
)
{
LogLog
.
debug
(
"["
+
filename
+
"] does not exist."
)
;
warnedAlready
=
true
;
}
}
}
public
void
run
(
)
{
while
(
!
interrupted
(
)
)
{
try
{
Thread
.
currentThread
(
)
.
sleep
(
delay
)
;
}
catch
(
InterruptedException
e
)
{
}
checkAndConfigure
(
)
;
}
}
}
