package
org
.
apache
.
xpath
.
functions
;
import
org
.
apache
.
xml
.
dtm
.
DTM
;
import
org
.
apache
.
xml
.
dtm
.
DTMIterator
;
import
org
.
apache
.
xpath
.
XPathContext
;
import
org
.
apache
.
xpath
.
axes
.
LocPathIterator
;
import
org
.
apache
.
xpath
.
axes
.
PredicatedNodeTest
;
import
org
.
apache
.
xpath
.
objects
.
XNodeSet
;
import
org
.
apache
.
xpath
.
objects
.
XObject
;
public
class
FuncCurrent
extends
Function
{
public
XObject
execute
(
XPathContext
xctxt
)
throws
javax
.
xml
.
transform
.
TransformerException
{
Object
subContextList
=
xctxt
.
getSubContextList
(
)
;
int
currentNode
;
if
(
null
!=
subContextList
&&
subContextList
instanceof
PredicatedNodeTest
)
{
LocPathIterator
lpi
=
xctxt
.
getCurrentNodeList
(
)
;
currentNode
=
lpi
.
getCurrentContextNode
(
)
;
}
else
if
(
xctxt
.
getIteratorRoot
(
)
!=
DTM
.
NULL
)
{
currentNode
=
xctxt
.
getIteratorRoot
(
)
;
}
else
{
DTMIterator
cnl
=
xctxt
.
getContextNodeList
(
)
;
if
(
null
!=
cnl
)
{
currentNode
=
cnl
.
getCurrentNode
(
)
;
}
else
currentNode
=
DTM
.
NULL
;
}
return
new
XNodeSet
(
currentNode
,
xctxt
.
getDTMManager
(
)
)
;
}
public
void
fixupVariables
(
java
.
util
.
Vector
vars
,
int
globalsSize
)
{
}
}
