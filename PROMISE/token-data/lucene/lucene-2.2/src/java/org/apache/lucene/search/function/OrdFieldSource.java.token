package
org
.
apache
.
lucene
.
search
.
function
;
import
org
.
apache
.
lucene
.
index
.
IndexReader
;
import
org
.
apache
.
lucene
.
search
.
FieldCache
;
import
java
.
io
.
IOException
;
public
class
OrdFieldSource
extends
ValueSource
{
protected
String
field
;
public
OrdFieldSource
(
String
field
)
{
this
.
field
=
field
;
}
public
String
description
(
)
{
return
"ord("
+
field
+
')'
;
}
public
DocValues
getValues
(
IndexReader
reader
)
throws
IOException
{
final
int
[
]
arr
=
FieldCache
.
DEFAULT
.
getStringIndex
(
reader
,
field
)
.
order
;
return
new
DocValues
(
arr
.
length
)
{
public
float
floatVal
(
int
doc
)
{
return
(
float
)
arr
[
doc
]
;
}
public
String
strVal
(
int
doc
)
{
return
Integer
.
toString
(
arr
[
doc
]
)
;
}
public
String
toString
(
int
doc
)
{
return
description
(
)
+
'='
+
intVal
(
doc
)
;
}
Object
getInnerArray
(
)
{
return
arr
;
}
}
;
}
public
boolean
equals
(
Object
o
)
{
if
(
o
.
getClass
(
)
!=
OrdFieldSource
.
class
)
return
false
;
OrdFieldSource
other
=
(
OrdFieldSource
)
o
;
return
this
.
field
.
equals
(
other
.
field
)
;
}
private
static
final
int
hcode
=
OrdFieldSource
.
class
.
hashCode
(
)
;
public
int
hashCode
(
)
{
return
hcode
+
field
.
hashCode
(
)
;
}
}
