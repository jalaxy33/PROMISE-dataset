package
org
.
apache
.
lucene
.
util
;
import
java
.
io
.
IOException
;
import
org
.
apache
.
lucene
.
search
.
DocIdSetIterator
;
public
class
OpenBitSetDISI
extends
OpenBitSet
{
public
OpenBitSetDISI
(
DocIdSetIterator
disi
,
int
maxSize
)
throws
IOException
{
super
(
maxSize
)
;
inPlaceOr
(
disi
)
;
}
public
OpenBitSetDISI
(
int
maxSize
)
{
super
(
maxSize
)
;
}
public
void
inPlaceOr
(
DocIdSetIterator
disi
)
throws
IOException
{
while
(
disi
.
next
(
)
&&
(
disi
.
doc
(
)
<
size
(
)
)
)
{
fastSet
(
disi
.
doc
(
)
)
;
}
}
public
void
inPlaceAnd
(
DocIdSetIterator
disi
)
throws
IOException
{
int
index
=
nextSetBit
(
0
)
;
int
lastNotCleared
=
-
1
;
while
(
(
index
!=
-
1
)
&&
disi
.
skipTo
(
index
)
)
{
while
(
(
index
!=
-
1
)
&&
(
index
<
disi
.
doc
(
)
)
)
{
fastClear
(
index
)
;
index
=
nextSetBit
(
index
+
1
)
;
}
if
(
index
==
disi
.
doc
(
)
)
{
lastNotCleared
=
index
;
index
++
;
}
assert
(
index
==
-
1
)
||
(
index
>
disi
.
doc
(
)
)
;
}
clear
(
lastNotCleared
+
1
,
size
(
)
)
;
}
public
void
inPlaceNot
(
DocIdSetIterator
disi
)
throws
IOException
{
while
(
disi
.
next
(
)
&&
(
disi
.
doc
(
)
<
size
(
)
)
)
{
fastClear
(
disi
.
doc
(
)
)
;
}
}
public
void
inPlaceXor
(
DocIdSetIterator
disi
)
throws
IOException
{
while
(
disi
.
next
(
)
&&
(
disi
.
doc
(
)
<
size
(
)
)
)
{
fastFlip
(
disi
.
doc
(
)
)
;
}
}
}
