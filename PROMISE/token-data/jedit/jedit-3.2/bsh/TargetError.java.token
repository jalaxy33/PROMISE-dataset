package
bsh
;
import
java
.
lang
.
reflect
.
InvocationTargetException
;
public
class
TargetError
extends
EvalError
{
Throwable
target
;
public
TargetError
(
String
msg
,
Throwable
t
,
SimpleNode
node
)
{
super
(
msg
,
node
)
;
target
=
t
;
}
public
TargetError
(
Throwable
t
,
SimpleNode
node
)
{
this
(
"TargetError"
,
t
,
node
)
;
}
public
TargetError
(
String
s
,
Throwable
t
)
{
this
(
s
,
t
,
null
)
;
}
public
Throwable
getTarget
(
)
{
if
(
target
instanceof
InvocationTargetException
)
return
(
(
InvocationTargetException
)
target
)
.
getTargetException
(
)
;
else
return
target
;
}
public
String
toString
(
)
{
return
super
.
toString
(
)
+
"\nTarget exception: "
+
printTargetError
(
target
)
;
}
public
void
printStackTrace
(
)
{
super
.
printStackTrace
(
)
;
System
.
out
.
println
(
"--- Target Stack Trace ---"
)
;
target
.
printStackTrace
(
)
;
}
public
void
reThrow
(
String
msg
)
throws
TargetError
{
throw
new
TargetError
(
msg
+
":"
+
getMessage
(
)
,
target
,
node
)
;
}
public
void
reThrow
(
String
msg
,
SimpleNode
node
)
throws
TargetError
{
String
m
=
(
msg
==
null
)
?
""
:
(
msg
+
" : "
)
;
throw
new
TargetError
(
m
+
getMessage
(
)
,
target
,
node
)
;
}
public
void
reThrow
(
SimpleNode
node
)
throws
TargetError
{
reThrow
(
null
,
node
)
;
}
public
String
printTargetError
(
Throwable
t
)
{
String
s
=
target
.
toString
(
)
;
if
(
Capabilities
.
canGenerateInterfaces
(
)
)
s
+=
"\n"
+
xPrintTargetError
(
t
)
;
return
s
;
}
public
String
xPrintTargetError
(
Throwable
t
)
{
String
getTarget
=
"import java.lang.reflect.UndeclaredThrowableException;"
+
"if ( target instanceof UndeclaredThrowableException )"
+
"	return target.getUndeclaredThrowable().toString();"
+
"else return \"\""
;
Interpreter
i
=
new
Interpreter
(
)
;
try
{
i
.
set
(
"target"
,
t
)
;
return
(
String
)
i
.
eval
(
getTarget
)
;
}
catch
(
EvalError
e
)
{
throw
new
InterpreterError
(
"xprintarget: "
+
e
.
toString
(
)
)
;
}
}
}
