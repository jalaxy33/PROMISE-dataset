package
org
.
apache
.
poi
.
hssf
.
usermodel
;
import
org
.
apache
.
poi
.
hssf
.
model
.
Sheet
;
import
org
.
apache
.
poi
.
hssf
.
model
.
Workbook
;
import
org
.
apache
.
poi
.
hssf
.
record
.
CellValueRecordInterface
;
import
org
.
apache
.
poi
.
hssf
.
record
.
RowRecord
;
import
java
.
util
.
HashMap
;
import
java
.
util
.
Iterator
;
public
class
HSSFRow
implements
Comparable
{
public
final
static
int
INITIAL_CAPACITY
=
5
;
private
short
rowNum
;
private
HashMap
cells
;
private
RowRecord
row
;
private
Workbook
book
;
private
Sheet
sheet
;
protected
HSSFRow
(
)
{
}
protected
HSSFRow
(
Workbook
book
,
Sheet
sheet
,
short
rowNum
)
{
this
.
rowNum
=
rowNum
;
cells
=
new
HashMap
(
10
)
;
this
.
book
=
book
;
this
.
sheet
=
sheet
;
row
=
new
RowRecord
(
)
;
row
.
setHeight
(
(
short
)
0xff
)
;
row
.
setLastCol
(
(
short
)
-
1
)
;
row
.
setFirstCol
(
(
short
)
-
1
)
;
setRowNum
(
rowNum
)
;
}
protected
HSSFRow
(
Workbook
book
,
Sheet
sheet
,
RowRecord
record
)
{
this
.
rowNum
=
rowNum
;
cells
=
new
HashMap
(
)
;
this
.
book
=
book
;
this
.
sheet
=
sheet
;
row
=
record
;
setRowNum
(
record
.
getRowNumber
(
)
)
;
}
public
HSSFCell
createCell
(
short
column
)
{
HSSFCell
cell
=
new
HSSFCell
(
book
,
sheet
,
getRowNum
(
)
,
column
)
;
addCell
(
cell
)
;
sheet
.
addValueRecord
(
getRowNum
(
)
,
cell
.
getCellValueRecord
(
)
)
;
return
cell
;
}
public
HSSFCell
createCell
(
short
column
,
int
type
)
{
HSSFCell
cell
=
new
HSSFCell
(
book
,
sheet
,
getRowNum
(
)
,
column
,
type
)
;
addCell
(
cell
)
;
sheet
.
addValueRecord
(
getRowNum
(
)
,
cell
.
getCellValueRecord
(
)
)
;
return
cell
;
}
public
void
removeCell
(
HSSFCell
cell
)
{
CellValueRecordInterface
cval
=
cell
.
getCellValueRecord
(
)
;
sheet
.
removeValueRecord
(
getRowNum
(
)
,
cval
)
;
cells
.
remove
(
new
Integer
(
cell
.
getCellNum
(
)
)
)
;
if
(
cell
.
getCellNum
(
)
==
row
.
getLastCol
(
)
)
{
row
.
setLastCol
(
findLastCell
(
row
.
getLastCol
(
)
)
)
;
}
if
(
cell
.
getCellNum
(
)
==
row
.
getFirstCol
(
)
)
{
row
.
setFirstCol
(
findFirstCell
(
row
.
getFirstCol
(
)
)
)
;
}
}
protected
HSSFCell
createCellFromRecord
(
CellValueRecordInterface
cell
)
{
HSSFCell
hcell
=
new
HSSFCell
(
book
,
sheet
,
getRowNum
(
)
,
cell
)
;
addCell
(
hcell
)
;
return
hcell
;
}
public
void
setRowNum
(
short
rowNum
)
{
this
.
rowNum
=
rowNum
;
if
(
row
!=
null
)
{
row
.
setRowNumber
(
rowNum
)
;
}
}
public
short
getRowNum
(
)
{
return
rowNum
;
}
private
void
addCell
(
HSSFCell
cell
)
{
if
(
row
.
getFirstCol
(
)
==
-
1
)
{
row
.
setFirstCol
(
cell
.
getCellNum
(
)
)
;
}
if
(
row
.
getLastCol
(
)
==
-
1
)
{
row
.
setLastCol
(
cell
.
getCellNum
(
)
)
;
}
cells
.
put
(
new
Integer
(
cell
.
getCellNum
(
)
)
,
cell
)
;
if
(
cell
.
getCellNum
(
)
<
row
.
getFirstCol
(
)
)
{
row
.
setFirstCol
(
cell
.
getCellNum
(
)
)
;
}
if
(
cell
.
getCellNum
(
)
>
row
.
getLastCol
(
)
)
{
row
.
setLastCol
(
cell
.
getCellNum
(
)
)
;
}
}
public
HSSFCell
getCell
(
short
cellnum
)
{
return
(
HSSFCell
)
cells
.
get
(
new
Integer
(
cellnum
)
)
;
}
public
short
getFirstCellNum
(
)
{
if
(
getPhysicalNumberOfCells
(
)
==
0
)
return
-
1
;
else
return
row
.
getFirstCol
(
)
;
}
public
short
getLastCellNum
(
)
{
if
(
getPhysicalNumberOfCells
(
)
==
0
)
return
-
1
;
else
return
row
.
getLastCol
(
)
;
}
public
int
getPhysicalNumberOfCells
(
)
{
if
(
cells
==
null
)
{
return
0
;
}
return
cells
.
size
(
)
;
}
public
void
setHeight
(
short
height
)
{
row
.
setBadFontHeight
(
true
)
;
row
.
setHeight
(
height
)
;
}
public
void
setHeightInPoints
(
float
height
)
{
row
.
setBadFontHeight
(
true
)
;
row
.
setHeight
(
(
short
)
(
height
*
20
)
)
;
}
public
short
getHeight
(
)
{
return
row
.
getHeight
(
)
;
}
public
float
getHeightInPoints
(
)
{
return
(
row
.
getHeight
(
)
/
20
)
;
}
protected
RowRecord
getRowRecord
(
)
{
return
row
;
}
private
short
findLastCell
(
short
lastcell
)
{
short
cellnum
=
(
short
)
(
lastcell
-
1
)
;
HSSFCell
r
=
getCell
(
cellnum
)
;
while
(
r
==
null
&&
cellnum
>=
0
)
{
r
=
getCell
(
--
cellnum
)
;
}
return
cellnum
;
}
private
short
findFirstCell
(
short
firstcell
)
{
short
cellnum
=
(
short
)
(
firstcell
+
1
)
;
HSSFCell
r
=
getCell
(
cellnum
)
;
while
(
r
==
null
&&
cellnum
<=
getLastCellNum
(
)
)
{
r
=
getCell
(
++
cellnum
)
;
}
if
(
cellnum
>
getLastCellNum
(
)
)
return
-
1
;
return
cellnum
;
}
public
Iterator
cellIterator
(
)
{
return
cells
.
values
(
)
.
iterator
(
)
;
}
public
int
compareTo
(
Object
obj
)
{
HSSFRow
loc
=
(
HSSFRow
)
obj
;
if
(
this
.
getRowNum
(
)
==
loc
.
getRowNum
(
)
)
{
return
0
;
}
if
(
this
.
getRowNum
(
)
<
loc
.
getRowNum
(
)
)
{
return
-
1
;
}
if
(
this
.
getRowNum
(
)
>
loc
.
getRowNum
(
)
)
{
return
1
;
}
return
-
1
;
}
public
boolean
equals
(
Object
obj
)
{
if
(
!
(
obj
instanceof
HSSFRow
)
)
{
return
false
;
}
HSSFRow
loc
=
(
HSSFRow
)
obj
;
if
(
this
.
getRowNum
(
)
==
loc
.
getRowNum
(
)
)
{
return
true
;
}
return
false
;
}
}
