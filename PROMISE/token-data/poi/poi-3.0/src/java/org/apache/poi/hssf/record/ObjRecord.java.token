package
org
.
apache
.
poi
.
hssf
.
record
;
import
org
.
apache
.
poi
.
util
.
*
;
import
java
.
io
.
ByteArrayInputStream
;
import
java
.
util
.
List
;
import
java
.
util
.
Iterator
;
import
java
.
util
.
ArrayList
;
public
class
ObjRecord
extends
Record
{
public
final
static
short
sid
=
0x5D
;
private
List
subrecords
;
public
ObjRecord
(
)
{
subrecords
=
new
ArrayList
(
2
)
;
}
public
ObjRecord
(
RecordInputStream
in
)
{
super
(
in
)
;
}
protected
void
validateSid
(
short
id
)
{
if
(
id
!=
sid
)
{
throw
new
RecordFormatException
(
"Not an OBJ record"
)
;
}
}
protected
void
fillFields
(
RecordInputStream
in
)
{
subrecords
=
new
ArrayList
(
)
;
int
subSize
=
0
;
byte
[
]
subRecordData
=
in
.
readRemainder
(
)
;
RecordInputStream
subRecStream
=
new
RecordInputStream
(
new
ByteArrayInputStream
(
subRecordData
)
)
;
while
(
subRecStream
.
hasNextRecord
(
)
)
{
subRecStream
.
nextRecord
(
)
;
Record
subRecord
=
SubRecord
.
createSubRecord
(
subRecStream
)
;
subSize
+=
subRecord
.
getRecordSize
(
)
;
subrecords
.
add
(
subRecord
)
;
}
if
(
subRecordData
.
length
-
subSize
==
4
)
{
subrecords
.
add
(
new
EndSubRecord
(
)
)
;
}
}
public
String
toString
(
)
{
StringBuffer
buffer
=
new
StringBuffer
(
)
;
buffer
.
append
(
"[OBJ]\n"
)
;
for
(
Iterator
iterator
=
subrecords
.
iterator
(
)
;
iterator
.
hasNext
(
)
;
)
{
Record
record
=
(
Record
)
iterator
.
next
(
)
;
buffer
.
append
(
"SUBRECORD: "
+
record
.
toString
(
)
)
;
}
buffer
.
append
(
"[/OBJ]\n"
)
;
return
buffer
.
toString
(
)
;
}
public
int
serialize
(
int
offset
,
byte
[
]
data
)
{
int
pos
=
0
;
LittleEndian
.
putShort
(
data
,
0
+
offset
,
sid
)
;
LittleEndian
.
putShort
(
data
,
2
+
offset
,
(
short
)
(
getRecordSize
(
)
-
4
)
)
;
pos
=
offset
+
4
;
for
(
Iterator
iterator
=
subrecords
.
iterator
(
)
;
iterator
.
hasNext
(
)
;
)
{
Record
record
=
(
Record
)
iterator
.
next
(
)
;
pos
+=
record
.
serialize
(
pos
,
data
)
;
}
return
getRecordSize
(
)
;
}
public
int
getRecordSize
(
)
{
int
size
=
0
;
for
(
Iterator
iterator
=
subrecords
.
iterator
(
)
;
iterator
.
hasNext
(
)
;
)
{
Record
record
=
(
Record
)
iterator
.
next
(
)
;
size
+=
record
.
getRecordSize
(
)
;
}
return
4
+
size
;
}
public
short
getSid
(
)
{
return
sid
;
}
public
List
getSubRecords
(
)
{
return
subrecords
;
}
public
void
clearSubRecords
(
)
{
subrecords
.
clear
(
)
;
}
public
void
addSubRecord
(
int
index
,
Object
element
)
{
subrecords
.
add
(
index
,
element
)
;
}
public
boolean
addSubRecord
(
Object
o
)
{
return
subrecords
.
add
(
o
)
;
}
public
Object
clone
(
)
{
ObjRecord
rec
=
new
ObjRecord
(
)
;
for
(
Iterator
iterator
=
subrecords
.
iterator
(
)
;
iterator
.
hasNext
(
)
;
)
rec
.
addSubRecord
(
(
(
Record
)
iterator
.
next
(
)
)
.
clone
(
)
)
;
return
rec
;
}
}
