package
org
.
apache
.
synapse
.
endpoints
.
dispatch
;
import
org
.
apache
.
synapse
.
endpoints
.
Endpoint
;
import
org
.
apache
.
synapse
.
MessageContext
;
import
org
.
apache
.
axiom
.
soap
.
SOAPHeader
;
import
org
.
apache
.
axiom
.
om
.
OMElement
;
import
javax
.
xml
.
namespace
.
QName
;
import
java
.
util
.
Map
;
import
java
.
util
.
HashMap
;
import
java
.
util
.
Collections
;
public
class
SimpleClientSessionDispatcher
implements
Dispatcher
{
private
Map
sessionMap
=
Collections
.
synchronizedMap
(
new
HashMap
(
)
)
;
public
Endpoint
getEndpoint
(
MessageContext
synCtx
)
{
SOAPHeader
header
=
synCtx
.
getEnvelope
(
)
.
getHeader
(
)
;
if
(
header
!=
null
)
{
OMElement
csID
=
header
.
getFirstChildWithName
(
new
QName
(
"http://ws.apache.org/namespaces/synapse"
,
"ClientID"
,
"syn"
)
)
;
if
(
csID
!=
null
&&
csID
.
getText
(
)
!=
null
)
{
Object
o
=
sessionMap
.
get
(
csID
.
getText
(
)
)
;
if
(
o
!=
null
)
{
return
(
Endpoint
)
o
;
}
}
}
return
null
;
}
public
void
updateSession
(
MessageContext
synCtx
,
Endpoint
endpoint
)
{
SOAPHeader
header
=
synCtx
.
getEnvelope
(
)
.
getHeader
(
)
;
if
(
header
!=
null
)
{
OMElement
csID
=
header
.
getFirstChildWithName
(
new
QName
(
"http://ws.apache.org/namespaces/synapse"
,
"ClientID"
,
"syn"
)
)
;
if
(
csID
!=
null
&&
csID
.
getText
(
)
!=
null
)
{
synchronized
(
sessionMap
)
{
if
(
!
sessionMap
.
containsKey
(
csID
.
getText
(
)
)
)
{
sessionMap
.
put
(
csID
.
getText
(
)
,
endpoint
)
;
}
}
}
}
}
public
void
unbind
(
MessageContext
synCtx
)
{
SOAPHeader
header
=
synCtx
.
getEnvelope
(
)
.
getHeader
(
)
;
if
(
header
!=
null
)
{
OMElement
csID
=
header
.
getFirstChildWithName
(
new
QName
(
"http://ws.apache.org/namespaces/synapse"
,
"ClientID"
,
"syn"
)
)
;
if
(
csID
!=
null
&&
csID
.
getText
(
)
!=
null
)
{
sessionMap
.
remove
(
csID
.
getText
(
)
)
;
}
}
}
public
boolean
isServerInitiatedSession
(
)
{
return
false
;
}
}
