package
org
.
apache
.
synapse
;
import
java
.
util
.
Stack
;
import
java
.
io
.
StringWriter
;
import
java
.
io
.
Writer
;
import
java
.
io
.
PrintWriter
;
public
abstract
class
FaultHandler
{
public
void
handleFault
(
MessageContext
synCtx
)
{
try
{
onFault
(
synCtx
)
;
}
catch
(
SynapseException
e
)
{
Stack
faultStack
=
synCtx
.
getFaultStack
(
)
;
if
(
faultStack
!=
null
&&
!
faultStack
.
isEmpty
(
)
)
{
(
(
FaultHandler
)
faultStack
.
pop
(
)
)
.
handleFault
(
synCtx
)
;
}
}
}
public
void
handleFault
(
MessageContext
synCtx
,
Exception
e
)
{
if
(
synCtx
.
getProperty
(
Constants
.
ERROR_CODE
)
==
null
)
{
synCtx
.
setProperty
(
Constants
.
ERROR_CODE
,
"00000"
)
;
}
if
(
synCtx
.
getProperty
(
Constants
.
ERROR_MESSAGE
)
==
null
)
{
synCtx
.
setProperty
(
Constants
.
ERROR_MESSAGE
,
e
.
getMessage
(
)
.
split
(
"\n"
)
[
0
]
)
;
}
synCtx
.
setProperty
(
Constants
.
ERROR_DETAIL
,
getStackTrace
(
e
)
)
;
try
{
onFault
(
synCtx
)
;
}
catch
(
SynapseException
se
)
{
Stack
faultStack
=
synCtx
.
getFaultStack
(
)
;
if
(
faultStack
!=
null
&&
!
faultStack
.
isEmpty
(
)
)
{
(
(
FaultHandler
)
faultStack
.
pop
(
)
)
.
handleFault
(
synCtx
,
se
)
;
}
}
}
public
abstract
void
onFault
(
MessageContext
synCtx
)
;
private
static
String
getStackTrace
(
Throwable
aThrowable
)
{
final
Writer
result
=
new
StringWriter
(
)
;
final
PrintWriter
printWriter
=
new
PrintWriter
(
result
)
;
aThrowable
.
printStackTrace
(
printWriter
)
;
return
result
.
toString
(
)
;
}
}
