package
org
.
apache
.
synapse
.
mediators
.
filters
;
import
org
.
apache
.
synapse
.
MessageContext
;
import
org
.
apache
.
synapse
.
config
.
xml
.
SwitchCase
;
import
org
.
apache
.
synapse
.
mediators
.
AbstractMediator
;
import
org
.
apache
.
synapse
.
util
.
xpath
.
SynapseXPath
;
import
java
.
util
.
ArrayList
;
import
java
.
util
.
Iterator
;
import
java
.
util
.
List
;
public
class
SwitchMediator
extends
AbstractMediator
{
private
SynapseXPath
source
=
null
;
private
List
cases
=
new
ArrayList
(
)
;
private
SwitchCase
defaultCase
=
null
;
public
boolean
mediate
(
MessageContext
synCtx
)
{
boolean
traceOn
=
isTraceOn
(
synCtx
)
;
boolean
traceOrDebugOn
=
isTraceOrDebugOn
(
traceOn
)
;
if
(
traceOrDebugOn
)
{
traceOrDebug
(
traceOn
,
"Start : Switch mediator"
)
;
if
(
traceOn
&&
trace
.
isTraceEnabled
(
)
)
{
trace
.
trace
(
"Message : "
+
synCtx
.
getEnvelope
(
)
)
;
}
}
int
parentsEffectiveTraceState
=
synCtx
.
getTracingState
(
)
;
setEffectiveTraceState
(
synCtx
)
;
int
myEffectiveTraceState
=
synCtx
.
getTracingState
(
)
;
String
sourceText
=
source
.
stringValueOf
(
synCtx
)
;
if
(
traceOrDebugOn
)
{
traceOrDebug
(
traceOn
,
"XPath : "
+
source
+
" evaluates to : "
+
sourceText
)
;
}
try
{
if
(
(
sourceText
==
null
||
cases
.
isEmpty
(
)
)
&&
defaultCase
!=
null
)
{
if
(
traceOrDebugOn
)
{
traceOrDebug
(
traceOn
,
"Source XPath evaluated to : null or no switch "
+
"cases found. Executing the default case"
)
;
}
return
defaultCase
.
mediate
(
synCtx
)
;
}
else
{
for
(
Iterator
iter
=
cases
.
iterator
(
)
;
iter
.
hasNext
(
)
;
)
{
SwitchCase
swCase
=
(
SwitchCase
)
iter
.
next
(
)
;
if
(
swCase
!=
null
)
{
if
(
swCase
.
matches
(
sourceText
)
)
{
if
(
traceOrDebugOn
)
{
traceOrDebug
(
traceOn
,
"Matching case found : "
+
swCase
.
getRegex
(
)
)
;
}
return
swCase
.
mediate
(
synCtx
)
;
}
}
}
if
(
defaultCase
!=
null
)
{
if
(
traceOrDebugOn
)
{
traceOrDebug
(
traceOn
,
"None of the switch cases matched - executing default"
)
;
}
return
defaultCase
.
mediate
(
synCtx
)
;
}
else
{
if
(
traceOrDebugOn
)
{
traceOrDebug
(
traceOn
,
"None of the switch cases matched - no default case"
)
;
}
}
}
}
finally
{
synCtx
.
setTracingState
(
parentsEffectiveTraceState
)
;
}
if
(
traceOrDebugOn
)
{
traceOrDebug
(
traceOn
,
"End : Switch mediator"
)
;
}
return
true
;
}
public
void
addCase
(
SwitchCase
m
)
{
cases
.
add
(
m
)
;
}
public
List
getCases
(
)
{
return
cases
;
}
public
SynapseXPath
getSource
(
)
{
return
source
;
}
public
void
setSource
(
SynapseXPath
source
)
{
this
.
source
=
source
;
}
public
SwitchCase
getDefaultCase
(
)
{
return
defaultCase
;
}
public
void
setDefaultCase
(
SwitchCase
defaultCase
)
{
this
.
defaultCase
=
defaultCase
;
}
}
