package
org
.
apache
.
synapse
.
core
.
axis2
;
import
org
.
apache
.
axiom
.
soap
.
SOAPEnvelope
;
import
org
.
apache
.
axiom
.
soap
.
SOAPHeaderBlock
;
import
org
.
apache
.
axis2
.
AxisFault
;
import
org
.
apache
.
axis2
.
context
.
MessageContext
;
import
org
.
apache
.
axis2
.
handlers
.
AbstractHandler
;
import
java
.
util
.
ArrayList
;
import
java
.
util
.
Iterator
;
public
class
SynapseMustUnderstandHandler
extends
AbstractHandler
{
public
static
final
String
NAME
=
"SynapseMustUnderstandHandler"
;
public
InvocationResponse
invoke
(
MessageContext
messageContext
)
throws
AxisFault
{
SOAPEnvelope
envelope
=
messageContext
.
getEnvelope
(
)
;
if
(
envelope
.
getHeader
(
)
!=
null
)
{
Iterator
headerBlocks
=
envelope
.
getHeader
(
)
.
getHeadersToProcess
(
null
)
;
ArrayList
<
SOAPHeaderBlock
>
markedHeaderBlocks
=
new
ArrayList
<
SOAPHeaderBlock
>
(
)
;
while
(
headerBlocks
.
hasNext
(
)
)
{
SOAPHeaderBlock
headerBlock
=
(
SOAPHeaderBlock
)
headerBlocks
.
next
(
)
;
if
(
!
headerBlock
.
isProcessed
(
)
&&
headerBlock
.
getMustUnderstand
(
)
)
{
markedHeaderBlocks
.
add
(
headerBlock
)
;
headerBlock
.
setProcessed
(
)
;
}
}
messageContext
.
setProperty
(
"headersMarkedAsProcessedBySynapse"
,
markedHeaderBlocks
)
;
}
return
InvocationResponse
.
CONTINUE
;
}
}
