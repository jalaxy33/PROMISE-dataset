package
org
.
apache
.
camel
.
processor
;
import
org
.
apache
.
camel
.
Endpoint
;
import
org
.
apache
.
camel
.
Exchange
;
import
org
.
apache
.
camel
.
Processor
;
import
org
.
apache
.
camel
.
Producer
;
import
org
.
apache
.
camel
.
impl
.
ServiceSupport
;
import
java
.
util
.
ArrayList
;
import
java
.
util
.
Collection
;
public
class
MulticastProcessor
extends
ServiceSupport
implements
Processor
{
private
Collection
<
Producer
>
producers
;
public
static
<
E
extends
Exchange
>
Collection
<
Producer
>
toProducers
(
Collection
<
Endpoint
>
endpoints
)
throws
Exception
{
Collection
<
Producer
>
answer
=
new
ArrayList
<
Producer
>
(
)
;
for
(
Endpoint
endpoint
:
endpoints
)
{
answer
.
add
(
endpoint
.
createProducer
(
)
)
;
}
return
answer
;
}
public
MulticastProcessor
(
Collection
<
Endpoint
>
endpoints
)
throws
Exception
{
this
.
producers
=
toProducers
(
endpoints
)
;
}
@
Override
public
String
toString
(
)
{
return
"Multicast"
+
getEndpoints
(
)
;
}
public
void
process
(
Exchange
exchange
)
throws
Exception
{
for
(
Producer
producer
:
producers
)
{
Exchange
copy
=
copyExchangeStrategy
(
producer
,
exchange
)
;
producer
.
process
(
copy
)
;
}
}
protected
void
doStop
(
)
throws
Exception
{
for
(
Producer
producer
:
producers
)
{
producer
.
stop
(
)
;
}
}
protected
void
doStart
(
)
throws
Exception
{
for
(
Producer
producer
:
producers
)
{
producer
.
start
(
)
;
}
}
public
Collection
<
Producer
>
getProducers
(
)
{
return
producers
;
}
public
Collection
<
Endpoint
>
getEndpoints
(
)
{
Collection
<
Endpoint
>
answer
=
new
ArrayList
<
Endpoint
>
(
)
;
for
(
Producer
producer
:
producers
)
{
answer
.
add
(
producer
.
getEndpoint
(
)
)
;
}
return
answer
;
}
protected
Exchange
copyExchangeStrategy
(
Producer
producer
,
Exchange
exchange
)
{
return
producer
.
createExchange
(
exchange
)
;
}
}
