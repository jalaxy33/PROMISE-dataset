<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Record Generator HOWTO</title>
<link type="text/css" href="../skin/page.css" rel="stylesheet">
</head>
<body text="#000000" bgcolor="#FFFFFF">
<!--================= start Navigation Path ==================-->
<table summary="navigation path" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td nowrap="nowrap" valign="middle" bgcolor="#CFDCED" height="20"><img height="1" width="5" alt="" src="../skin/images/spacer.gif" class="spacer"><!--===== breadcrumb trail (javascript-generated) ====--><font size="2" face="Arial, Helvetica, Sans-serif"><script src="../skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script></font></td>
</tr>
<tr>
<td bgcolor="#4C6C8F" height="2"><img height="2" width="2" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
</table>
<!--================= end Navigation Path ==================-->
<!--================= start Banner ==================-->
<table summary="header with logos" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<!--================= start Group Logo ==================-->
<td bgcolor="#294563"><a href="http://jakarta.apache.org"><img border="0" class="logoImage" alt="Jakarta" src="../resources/images/group-logo.gif"></a></td>
<!--================= end Group Logo ==================-->
<!--================= start Project Logo ==================--><td width="100%" align="center" bgcolor="#294563"><a href="http://jakarta.apache.org/poi/"><img border="0" class="logoImage" alt="POI" src="../resources/images/project-logo.gif"></a></td>
<!--================= end Project Logo ==================-->
<!--================= start Search ==================--><td valign="top" rowspan="2" bgcolor="#294563">
<form target="_blank" action="http://www.google.com/search" method="get">
<table summary="search" border="0" cellspacing="0" cellpadding="0" bgcolor="#4C6C8F">
<tr>
<td colspan="3"><img height="10" width="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td><img height="1" width="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td nowrap="nowrap"><input value="jakarta.apache.org" name="sitesearch" type="hidden"><input size="15" name="q" id="query" type="text"><img height="1" width="5" alt="" src="../skin/images/spacer.gif" class="spacer"><input name="Search" value="Search" type="submit">
<br>
<font face="Arial, Helvetica, Sans-serif" size="2" color="white">
                      the jakarta site
                      
                      
                    </font></td><td><img height="1" width="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td><img alt="" border="0" height="10" width="9" src="../skin/images/search-left.gif"></td><td><img height="1" width="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td><img alt="" border="0" height="10" width="9" src="../skin/images/search-right.gif"></td>
</tr>
</table>
</form>
</td>
<!--================= start Search ==================--><td bgcolor="#294563"><img height="10" width="10" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td valign="bottom" bgcolor="#294563" colspan="2">
<!--================= start Tabs ==================-->
<div class="tab">
<table summary="tab bar" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="6"><img alt="" height="8" width="6" src="../skin/images/spacer.gif"></td><td valign="bottom">
<table summary="selected tab" style="height: 1.8em" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top" width="5" bgcolor="#4C6C8F"><img height="5" width="5" alt="" src="../skin/images/tabSel-left.gif"></td><td valign="middle" bgcolor="#4C6C8F"><font color="#ffffff" size="2" face="Arial, Helvetica, Sans-serif"><b><a class="base-selected" href="../index.html">Home</a></b></font></td><td valign="top" width="5" bgcolor="#4C6C8F"><img height="5" width="5" alt="" src="../skin/images/tabSel-right.gif"></td>
</tr>
</table>
</td>
</tr>
</table>
</div>
<!--================= end Tabs ==================-->
</td><td bgcolor="#294563"><img alt="" width="1" height="1" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td bgcolor="#4C6C8F" colspan="4"><img width="1" height="10" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
</table>
<!--================= end Banner ==================-->
<!--================= start Menu, NavBar, Content ==================-->
<table summary="page content" bgcolor="#ffffff" width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td valign="top">
<table summary="menu" border="0" cellspacing="0" cellpadding="0">
<tr>
<!--================= start left top NavBar ==================-->
<td rowspan="3" valign="top">
<table summary="blue line" border="0" cellpadding="0" cellspacing="0">
<tr>
<td bgcolor="#294563"><img width="10" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td bgcolor="#CFDCED"><font color="#4C6C8F" size="4" face="Arial, Helvetica, Sans-serif">&nbsp;</font></td>
</tr>
<tr>
<td bgcolor="#294563"><img width="10" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
</table>
</td>
<!--================= end left top NavBar ==================--><td bgcolor="#294563"><img width="1" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td valign="bottom" bgcolor="#4C6C8F"><img width="10" height="10" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td nowrap="nowrap" valign="top" bgcolor="#4C6C8F">
<!--================= start Menu items ==================-->
<div class="menu">
<ul>
<li>
<font color="#CFDCED">Navigation</font>
<ul>
        
<li>
<a href="../index.html">Main</a>
</li>
    
</ul>
</li>
<li>
<font color="#CFDCED">HSSF</font>
<ul>
        
<li>
<a href="quick-guide.html">Quick Guide</a>
</li>
        
<li>
<a href="how-to.html">HOWTO</a>
</li>
        
<li>
<a href="formula.html">Formula Support</a>
</li>
        
<li>
<a href="use-case.html">Use Case</a>
</li>
        
<li>
<a href="diagrams.html">Pictorial Docs</a>
</li>
        
<li>
<a href="alternatives.html">Alternatives</a>
</li>
        
<li>
<a href="limitations.html">Limitations</a>
</li>
    
</ul>
</li>
<li>
<font color="#CFDCED">Contributer's Guide</font>
<ul>
        
<li>
<a href="hacking-hssf.html">Hacking HSSF</a>
</li>
        
<li>
<span class="sel"><font color="#ffcc00">Record Generator</font></span>
</li>
        
<li>
<a href="chart.html">Charts</a>
</li>
    
</ul>
</li>
</ul>
</div>
<!--================= end Menu items ==================-->
</td><td valign="bottom" bgcolor="#4C6C8F"><img width="10" height="10" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td bgcolor="#294563"><img width="1" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td valign="bottom" align="left" colspan="2" rowspan="2" bgcolor="#4C6C8F"><img height="10" width="10" border="0" alt="" src="../skin/images/menu-left.gif"></td><td bgcolor="#4C6C8F"><img height="10" width="10" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td valign="bottom" align="right" colspan="2" rowspan="2" bgcolor="#4C6C8F"><img height="10" width="10" border="0" alt="" src="../skin/images/menu-right.gif"></td>
</tr>
<tr>
<td height="1" bgcolor="#294563"><img width="1" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
</table>
</td><td valign="top" width="100%">
<table summary="content" width="100%" border="0" cellpadding="0" cellspacing="0">
<!--================= start middle NavBar ==================-->
<tr>
<td colspan="4" bgcolor="#294563"><img width="10" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td align="left" width="10" bgcolor="#CFDCED"><img width="10" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td align="left" width="50%" bgcolor="#CFDCED"><font color="#4C6C8F" size="3" face="Arial, Helvetica, Sans-serif">
                &nbsp;
                
                </font><img width="10" height="8" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td align="right" width="50%" bgcolor="#CFDCED"><font color="#4C6C8F" size="3" face="Arial, Helvetica, Sans-serif">
                &nbsp;
                
                </font><img width="10" height="8" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td width="10" bgcolor="#CFDCED"><img width="10" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<tr>
<td colspan="4" bgcolor="#294563"><img width="10" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<!--================= end middle NavBar ==================-->
<!--================= start Content==================-->
<tr>
<td align="left" width="10"><img width="10" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td><td colspan="2" align="left" width="100%">
<div class="content">
<table class="title" summary="">
<tr>
<td valign="middle">
<h1>Record Generator HOWTO</h1>
</td><td nowrap="nowrap" width="40" align="center"><a class="dida" href="record-generator.pdf"><img alt="PDF" src="../skin/images/pdfdoc.gif" class="skin"><br>
          PDF</a></td>
</tr>
</table>
<ul class="minitoc">
<li>
<a href="#How+to+Use+the+Record+Generator">How to Use the Record Generator</a>
<ul class="minitoc">
<li>
<a href="#History">History</a>
</li>
<li>
<a href="#Capabilities">Capabilities</a>
</li>
<li>
<a href="#Usage">Usage</a>
</li>
<li>
<a href="#Custom+Field+Types">Custom Field Types</a>
</li>
<li>
<a href="#How+it+Works">How it Works</a>
</li>
<li>
<a href="#Limitations">Limitations</a>
</li>
</ul>
</li>
</ul>
    
<a name="N10019"></a><a name="How+to+Use+the+Record+Generator"></a>
<h3>How to Use the Record Generator</h3>
<div style="margin-left: 0 ; border: 2px">
<a name="N1001E"></a><a name="History"></a>
<h4>History</h4>
<div style="margin-left: 0 ; border: 2px">
<p>
        The record generator was born from frustration with translating
        the Excel records to Java classes.  Doing this manually is a time
        consuming process.  It's also very easy to make mistakes.
        </p>
<p>
        A utility was needed to take the defintition of what a
        record looked like and do all the boring and repetitive work.
        </p>
</div>
<a name="N1002A"></a><a name="Capabilities"></a>
<h4>Capabilities</h4>
<div style="margin-left: 0 ; border: 2px">
<p>
        The record generator takes XML as input and produces the following
        output:
    </p>
<ul>
        
<li>A Java file capabile of decoding and encoding the record.</li>
        
<li>A test class that provides a fill-in-the-blanks implementation
            of a test case for ensuring the record operates as
            designed.</li>
    
</ul>
</div>
<a name="N1003C"></a><a name="Usage"></a>
<h4>Usage</h4>
<div style="margin-left: 0 ; border: 2px">
<p>
            The record generator is invoked as an Ant target
            (generate-records).  It goes through looking for all files in
            <span class="codefrag">src/records/defintitions</span> ending with _record.xml.
            It then creates two files; the Java record definition and the
            Java test case template.
        </p>
<p>
            The records themselves have the following general layout:
        </p>
<pre class="code">
&lt;record id="0x1032" name="Frame" package="org.apache.poi.hssf.record"
        excel-record-id="FRAME"&gt;
    &lt;description&gt;The frame record indicates whether there is a border
                 around the displayed text of a chart.&lt;/description&gt;
    &lt;author&gt;Glen Stampoultzis (glens at apache.org)&lt;/author&gt;
    &lt;fields&gt;
        &lt;field type="int" size="2" name="border type"&gt;
            &lt;const name="regular" value="0" description="regular rectangle or no border"/&gt;
            &lt;const name="shadow" value="1" description="rectangle with shadow"/&gt;
        &lt;/field&gt;
        &lt;field type="int" size="2" name="options"&gt;
            &lt;bit number="0" name="auto size"
               description="excel calculates the size automatically if true"/&gt;
            &lt;bit number="1" name="auto position"
               description="excel calculates the position automatically"/&gt;
        &lt;/field&gt;
    &lt;/fields&gt;
&lt;/record&gt;
        </pre>
<p>
            The following table details the allowable types and sizes for
            the fields.
        </p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
            
<tr>
                
<th colspan="1" rowspan="1">Type</th>
                <th colspan="1" rowspan="1">Size</th>
                <th colspan="1" rowspan="1">Java Type</th>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">int</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">byte</td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">int</td>
                <td colspan="1" rowspan="1">2</td>
                <td colspan="1" rowspan="1">short</td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">int</td>
                <td colspan="1" rowspan="1">4</td>
                <td colspan="1" rowspan="1">int</td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">int</td>
                <td colspan="1" rowspan="1">8</td>
                <td colspan="1" rowspan="1">long</td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">int</td>
                <td colspan="1" rowspan="1">varword</td>
                <td colspan="1" rowspan="1">array of shorts</td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">bits</td>
                <td colspan="1" rowspan="1">1</td>
                <td colspan="1" rowspan="1">A byte comprising of a bits (defined by the bit element)
                    </td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">bits</td>
                <td colspan="1" rowspan="1">2</td>
                <td colspan="1" rowspan="1">An short comprising of a bits</td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">bits</td>
                <td colspan="1" rowspan="1">4</td>
                <td colspan="1" rowspan="1">A int comprising of a bits</td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">float</td>
                <td colspan="1" rowspan="1">8</td>
                <td colspan="1" rowspan="1">double</td>
            
</tr>
            
<tr>
                
<td colspan="1" rowspan="1">hbstring</td>
                <td colspan="1" rowspan="1">java expression</td>
                <td colspan="1" rowspan="1">String</td>
            
</tr>
        
</table>
<p>
            The Java records are regenerated each time the record generator is 
            run, however the test stubs are only created if the test stub does 
            not already exist.  What this means is that you may change test 
            stubs but not the generated records.
        </p>
</div>
<a name="N1011F"></a><a name="Custom+Field+Types"></a>
<h4>Custom Field Types</h4>
<div style="margin-left: 0 ; border: 2px">
<p>
            Occationally the builtin types are not enough.  More control
            over the encoding and decoding of the streams is required.  This
            can be achieved using a custom type.
        </p>
<p>
            A custom type lets you escape to java to define the way in which
            the field encodes and decodes.  To code a custom type you
            declare your field like this:
        </p>
<pre class="code">
    &lt;field type="custom:org.apache.poi.hssf.record.LinkedDataFormulaField"
        size="var" name="formula of link" description="formula"/&gt;
        </pre>
<p>
            Where the class name specified after <span class="codefrag">custom:</span> is a
            class implementing the interface <span class="codefrag">CustomField</span>.
        </p>
<p>
            You can then implement the encoding yourself.
        </p>
</div>
<a name="N1013C"></a><a name="How+it+Works"></a>
<h4>How it Works</h4>
<div style="margin-left: 0 ; border: 2px">
<p>
            The record generation works by taking an XML file and styling it 
            using XLST.  Given that XSLT is a little limited in some ways it was 
            necessary to add a little Java code to the mix.   
        </p>
<p>
            See record.xsl, record_test.xsl, FieldIterator.java, 
            RecordUtil.java, RecordGenerator.java
        </p>
<p>
            There is a corresponding "type" generator for HDF.
            See the HDF documentation for details.
        </p>
</div>
<a name="N1014B"></a><a name="Limitations"></a>
<h4>Limitations</h4>
<div style="margin-left: 0 ; border: 2px">
<p>
            The record generator does not handle all possible record types and
            goes not intend to perform this function.  When dealing with a
            non-standard record sometimes the cost-benifit of coding the
            record by hand will be greater than attempting modify the
            generator.  The main point of the record generator is to save
            time, so keep that in mind.
        </p>
<p>
            Currently the the XSL file that generates the record calls out to 
            Java objects.  The Java code for the record generation is
            currently quite messy with minimal comments.  
        </p>
</div>
</div>

<div class="attribution">by&nbsp;Glen Stampoultzis,&nbsp;Andrew C. Oliver</div>
</div>
</td><td width="10"><img width="10" height="1" alt="" src="../skin/images/spacer.gif" class="spacer"></td>
</tr>
<!--================= end Content==================-->
</table>
</td>
</tr>
</table>
<!--================= end Menu, NavBar, Content ==================-->
<!--================= start Footer ==================-->
<table summary="footer" cellspacing="0" cellpadding="0" width="100%" border="0">
<tr>
<td colspan="2" height="1" bgcolor="#4C6C8F"><img height="1" width="1" alt="" src="../skin/images/spacer.gif" class="spacer"><a href="../skin/images/label.gif"></a><a href="../skin/images/page.gif"></a><a href="../skin/images/chapter.gif"></a><a href="../skin/images/chapter_open.gif"></a><a href="../skin/images/current.gif"></a><a href="/favicon.ico"></a></td>
</tr>
<tr>
<td colspan="2" bgcolor="#CFDCED" class="copyright" align="center"><font size="2" face="Arial, Helvetica, Sans-Serif">Copyright &copy;
          2003&nbsp;The Apache Software Foundation. All rights reserved.<script type="text/javascript" language="JavaScript"><!--
              document.write(" - "+"Last Published: " + document.lastModified);
            //  --></script></font></td>
</tr>
<tr>
<td colspan="2" align="left" bgcolor="#CFDCED" class="logos"></td>
</tr>
</table>
<!--================= end Footer ==================-->
</body>
</html>
