BufferingHttpServiceHandler
BufferingHttpServiceHandler
httpProcessor
HttpProcessor
responseFactory
HttpResponseFactory
connStrategy
ConnectionReuseStrategy
allocator
ByteBufferAllocator
params
HttpParams
httpProcessor
responseFactory
connStrategy
allocator
params
BufferingHttpServiceHandler
httpProcessor
HttpProcessor
responseFactory
HttpResponseFactory
connStrategy
ConnectionReuseStrategy
params
HttpParams
httpProcessor
responseFactory
connStrategy
HeapByteBufferAllocator
params
connected
conn
NHttpServerConnection
HttpContext
context
getContext
ServerConnState
connState
ServerConnState
allocator
setAttribute
CONN_STATE
connState
if
eventListener
block
eventListener
connectionOpen
conn
requestReceived
conn
NHttpServerConnection
HttpContext
context
getContext
HttpRequest
request
getHttpRequest
setParams
params
ServerConnState
connState
ServerConnState
getAttribute
CONN_STATE
resetInput
setRequest
request
setInputState
REQUEST_RECEIVED
ProtocolVersion
ver
getRequestLine
getProtocolVersion
if
lessEquals
HTTP_1_1
block
ver
HTTP_1_1
HttpResponse
response
try
if
request
HttpEntityEnclosingRequest
block
if
HttpEntityEnclosingRequest
request
block
response
responseFactory
newHttpResponse
ver
SC_CONTINUE
context
setParams
params
if
expectationVerifier
block
try
expectationVerifier
verify
request
response
context
catchClause
ex
response
responseFactory
newHttpResponse
HTTP_1_0
SC_INTERNAL_SERVER_ERROR
context
setParams
params
handleException
ex
response
if
getStatusLine
getStatusCode
block
submitResponse
response
block
resetInput
resetInput
sendResponse
conn
response
block
suspendInput
processRequest
conn
request
catchClause
ex
shutdownConnection
conn
ex
if
eventListener
block
eventListener
fatalIOException
ex
conn
catchClause
ex
closeConnection
conn
ex
if
eventListener
block
eventListener
fatalProtocolException
ex
conn
closed
conn
NHttpServerConnection
if
eventListener
block
eventListener
connectionClosed
conn
exception
conn
NHttpServerConnection
httpex
HttpException
HttpContext
context
getContext
try
HttpResponse
response
responseFactory
newHttpResponse
HTTP_1_0
SC_INTERNAL_SERVER_ERROR
context
setParams
params
handleException
httpex
response
setEntity
sendResponse
conn
response
catchClause
ex
shutdownConnection
conn
ex
if
eventListener
block
eventListener
fatalIOException
ex
conn
catchClause
ex
closeConnection
conn
ex
if
eventListener
block
eventListener
fatalProtocolException
ex
conn
inputReady
conn
NHttpServerConnection
decoder
ContentDecoder
HttpContext
context
getContext
HttpRequest
request
getHttpRequest
ServerConnState
connState
ServerConnState
getAttribute
CONN_STATE
ContentInputBuffer
buffer
getInbuffer
setInputState
REQUEST_BODY_STREAM
try
consumeContent
decoder
if
isCompleted
block
setInputState
REQUEST_BODY_DONE
HttpEntityEnclosingRequest
entityReq
HttpEntityEnclosingRequest
request
if
getEntity
block
setEntity
ContentBufferEntity
getEntity
getInbuffer
suspendInput
processRequest
conn
request
catchClause
ex
shutdownConnection
conn
ex
if
eventListener
block
eventListener
fatalIOException
ex
conn
catchClause
ex
closeConnection
conn
ex
if
eventListener
block
eventListener
fatalProtocolException
ex
conn
responseReady
conn
NHttpServerConnection
outputReady
conn
NHttpServerConnection
encoder
ContentEncoder
HttpContext
context
getContext
HttpResponse
response
getHttpResponse
ServerConnState
connState
ServerConnState
getAttribute
CONN_STATE
ContentOutputBuffer
buffer
getOutbuffer
setOutputState
RESPONSE_BODY_STREAM
try
produceContent
encoder
if
isCompleted
block
setOutputState
RESPONSE_BODY_DONE
resetOutput
if
connStrategy
keepAlive
response
context
block
close
block
requestInput
catchClause
ex
shutdownConnection
conn
ex
if
eventListener
block
eventListener
fatalIOException
ex
conn
handleException
ex
HttpException
response
HttpResponse
int
code
SC_INTERNAL_SERVER_ERROR
if
ex
MethodNotSupportedException
block
code
SC_NOT_IMPLEMENTED
if
ex
UnsupportedHttpVersionException
block
code
SC_HTTP_VERSION_NOT_SUPPORTED
if
ex
ProtocolException
block
code
SC_BAD_REQUEST
setStatusCode
code
byte
msg
getAsciiBytes
getMessage
ByteArrayEntity
entity
ByteArrayEntity
msg
setContentType
setEntity
entity
processRequest
conn
NHttpServerConnection
request
HttpRequest
HttpContext
context
getContext
ProtocolVersion
ver
getRequestLine
getProtocolVersion
if
lessEquals
HTTP_1_1
block
ver
HTTP_1_1
HttpResponse
response
responseFactory
newHttpResponse
ver
SC_OK
getContext
setParams
params
setAttribute
HTTP_REQUEST
request
setAttribute
HTTP_CONNECTION
conn
setAttribute
HTTP_RESPONSE
response
try
httpProcessor
process
request
context
HttpRequestHandler
handler
if
handlerResolver
block
String
requestURI
getRequestLine
getUri
handler
handlerResolver
lookup
requestURI
if
handler
block
handle
request
response
context
block
setStatusCode
SC_NOT_IMPLEMENTED
catchClause
ex
response
responseFactory
newHttpResponse
HTTP_1_0
SC_INTERNAL_SERVER_ERROR
context
setParams
params
handleException
ex
response
sendResponse
conn
response
sendResponse
conn
NHttpServerConnection
response
HttpResponse
HttpContext
context
getContext
ServerConnState
connState
ServerConnState
getAttribute
CONN_STATE
ContentOutputBuffer
buffer
getOutbuffer
httpProcessor
process
response
context
if
canResponseHaveBody
getRequest
response
block
setEntity
submitResponse
response
setOutputState
RESPONSE_SENT
HttpEntity
entity
getEntity
if
entity
block
OutputStream
outstream
ContentOutputStream
buffer
writeTo
outstream
flush
close
block
resetOutput
if
connStrategy
keepAlive
response
context
block
close
block
requestInput
ServerConnState
int
READY
int
REQUEST_RECEIVED
int
REQUEST_BODY_STREAM
int
REQUEST_BODY_DONE
int
RESPONSE_SENT
int
RESPONSE_BODY_STREAM
int
RESPONSE_BODY_DONE
SimpleInputBuffer
inbuffer
ContentOutputBuffer
outbuffer
int
inputState
int
outputState
HttpRequest
request
ByteBufferAllocator
allocator
ServerConnState
allocator
ByteBufferAllocator
inputState
READY
outputState
READY
allocator
allocator
getInbuffer
ContentInputBuffer
if
inbuffer
block
inbuffer
SimpleInputBuffer
allocator
return
inbuffer
getOutbuffer
ContentOutputBuffer
if
outbuffer
block
outbuffer
SimpleOutputBuffer
allocator
return
outbuffer
getInputState
int
return
inputState
setInputState
inputState
int
inputState
inputState
getOutputState
int
return
outputState
setOutputState
outputState
int
outputState
outputState
getRequest
HttpRequest
return
request
setRequest
request
HttpRequest
request
request
resetInput
inbuffer
request
inputState
READY
resetOutput
outbuffer
outputState
READY
NHttpServiceHandlerBase
NHttpServiceHandler
