OffsetManager
OffsetManager
buffer
Buffer
buffer
buffer
lineInfo
long
lineInfo
VISIBLE_SHIFT
lineContext
TokenMarker
LineContext
lineCount
positions
PosBottomHalf
virtualLineCounts
int
for
forControl
int
i
i
i
virtualLineCounts
i
getLineCount
int
return
lineCount
getVirtualLineCount
int
index
int
return
virtualLineCounts
index
setVirtualLineCount
index
int
lineCount
int
virtualLineCounts
index
lineCount
getLineOfOffset
int
offset
int
int
start
int
end
lineCount
for
forControl
block
switch
end
start
case
if
getLineEndOffset
start
offset
return
start
return
start
case
if
getLineEndOffset
start
offset
block
if
getLineEndOffset
end
offset
return
end
return
end
return
start
case
int
pivot
end
start
int
value
getLineEndOffset
pivot
if
value
offset
return
pivot
if
value
offset
start
pivot
end
pivot
break
getLineEndOffset
int
line
int
return
int
lineInfo
line
END_MASK
isFoldLevelValid
boolean
line
int
return
lineInfo
line
FOLD_LEVEL_VALID_MASK
getFoldLevel
int
line
int
return
int
lineInfo
line
FOLD_LEVEL_MASK
FOLD_LEVEL_SHIFT
setFoldLevel
line
int
level
int
lineInfo
line
lineInfo
line
FOLD_LEVEL_MASK
long
level
FOLD_LEVEL_SHIFT
FOLD_LEVEL_VALID_MASK
isLineVisible
boolean
line
int
index
int
long
mask
index
VISIBLE_SHIFT
return
lineInfo
line
mask
setLineVisible
line
int
index
int
visible
boolean
long
mask
index
VISIBLE_SHIFT
if
visible
lineInfo
line
lineInfo
line
mask
lineInfo
line
lineInfo
line
mask
getScreenLineCount
int
line
int
return
int
lineInfo
line
SCREEN_LINES_MASK
SCREEN_LINES_SHIFT
setScreenLineCount
line
int
count
int
lineInfo
line
lineInfo
line
SCREEN_LINES_MASK
long
count
SCREEN_LINES_SHIFT
isLineContextValid
boolean
line
int
return
lineInfo
line
CONTEXT_VALID_MASK
getLineContext
TokenMarker
LineContext
line
int
return
lineContext
line
setLineContext
line
int
context
TokenMarker
LineContext
lineContext
line
context
lineInfo
line
CONTEXT_VALID_MASK
createPosition
Position
offset
int
PosBottomHalf
bh
for
forControl
int
i
i
positionCount
i
block
PosBottomHalf
_bh
positions
i
if
offset
offset
block
bh
_bh
break
if
offset
offset
block
bh
PosBottomHalf
offset
growPositionArray
arraycopy
positions
i
positions
i
positionCount
i
positionCount
positions
i
bh
break
if
bh
block
bh
PosBottomHalf
offset
growPositionArray
positions
positionCount
bh
return
PosTopHalf
bh
expandFolds
foldLevel
int
int
newVirtualLineCount
if
foldLevel
block
newVirtualLineCount
lineCount
block
foldLevel
foldLevel
getIndentSize
boolean
seenVisibleLine
for
forControl
int
i
i
lineCount
i
block
if
seenVisibleLine
getFoldLevel
i
foldLevel
block
seenVisibleLine
lineInfo
i
VISIBLE_MASK
newVirtualLineCount
lineInfo
i
VISIBLE_MASK
for
forControl
int
i
i
length
i
block
virtualLineCounts
i
newVirtualLineCount
contentInserted
startLine
int
offset
int
numLines
int
length
int
endOffsets
IntegerArray
int
endLine
startLine
numLines
if
numLines
block
lineCount
numLines
if
length
lineCount
block
long
lineInfoN
long
lineCount
arraycopy
lineInfo
lineInfoN
length
lineInfo
lineInfoN
TokenMarker
LineContext
lineContextN
TokenMarker
LineContext
lineCount
arraycopy
lineContext
lineContextN
length
lineContext
lineContextN
arraycopy
lineInfo
startLine
lineInfo
endLine
lineCount
endLine
arraycopy
lineContext
startLine
lineContext
endLine
lineCount
endLine
int
foldLevel
getFoldLevel
startLine
long
visible
VISIBLE_SHIFT
if
startLine
block
for
forControl
int
i
startLine
i
i
block
if
getFoldLevel
i
foldLevel
block
visible
lineInfo
i
VISIBLE_MASK
break
for
forControl
int
i
i
numLines
i
block
lineInfo
startLine
i
offset
get
i
FOLD_LEVEL_VALID_MASK
CONTEXT_VALID_MASK
visible
if
visible
VISIBLE_SHIFT
virtualLineCounts
numLines
if
visible
VISIBLE_SHIFT
virtualLineCounts
numLines
if
visible
VISIBLE_SHIFT
virtualLineCounts
numLines
if
visible
VISIBLE_SHIFT
virtualLineCounts
numLines
if
visible
VISIBLE_SHIFT
virtualLineCounts
numLines
if
visible
VISIBLE_SHIFT
virtualLineCounts
numLines
if
visible
VISIBLE_SHIFT
virtualLineCounts
numLines
if
visible
VISIBLE_SHIFT
virtualLineCounts
numLines
for
forControl
int
i
endLine
i
lineCount
i
block
setLineEndOffset
i
getLineEndOffset
i
length
updatePositionsForInsert
offset
length
contentRemoved
startLine
int
offset
int
numLines
int
length
int
for
forControl
int
i
i
numLines
i
block
long
info
lineInfo
startLine
i
if
info
VISIBLE_SHIFT
virtualLineCounts
if
info
VISIBLE_SHIFT
virtualLineCounts
if
info
VISIBLE_SHIFT
virtualLineCounts
if
info
VISIBLE_SHIFT
virtualLineCounts
if
info
VISIBLE_SHIFT
virtualLineCounts
if
info
VISIBLE_SHIFT
virtualLineCounts
if
info
VISIBLE_SHIFT
virtualLineCounts
if
info
VISIBLE_SHIFT
virtualLineCounts
if
numLines
block
lineCount
numLines
arraycopy
lineInfo
startLine
numLines
lineInfo
startLine
lineCount
startLine
arraycopy
lineContext
startLine
numLines
lineContext
startLine
lineCount
startLine
for
forControl
int
i
startLine
i
lineCount
i
block
setLineEndOffset
i
getLineEndOffset
i
length
updatePositionsForRemove
offset
length
lineInfoChangedFrom
startLine
int
for
forControl
int
i
startLine
i
lineCount
i
block
lineInfo
i
FOLD_LEVEL_VALID_MASK
CONTEXT_VALID_MASK
lineContext
i
long
END_MASK
long
FOLD_LEVEL_MASK
int
FOLD_LEVEL_SHIFT
long
VISIBLE_MASK
int
VISIBLE_SHIFT
long
FOLD_LEVEL_VALID_MASK
long
CONTEXT_VALID_MASK
long
SCREEN_LINES_MASK
long
SCREEN_LINES_SHIFT
Buffer
buffer
long
lineInfo
TokenMarker
LineContext
lineContext
int
lineCount
PosBottomHalf
positions
int
positionCount
int
virtualLineCounts
setLineEndOffset
line
int
end
int
lineInfo
line
lineInfo
line
END_MASK
FOLD_LEVEL_VALID_MASK
CONTEXT_VALID_MASK
end
growPositionArray
if
length
positionCount
block
PosBottomHalf
newPositions
PosBottomHalf
positionCount
arraycopy
positions
newPositions
positionCount
positions
newPositions
removePosition
bh
PosBottomHalf
int
index
for
forControl
int
i
i
positionCount
i
block
if
positions
i
bh
block
index
i
break
arraycopy
positions
index
positions
index
positionCount
index
positions
positionCount
updatePositionsForInsert
offset
int
length
int
if
positionCount
return
int
start
getPositionAtOffset
offset
for
forControl
int
i
start
i
positionCount
i
block
PosBottomHalf
bh
positions
i
if
offset
offset
log
ERROR
offset
offset
length
updatePositionsForRemove
offset
int
length
int
if
positionCount
return
int
start
getPositionAtOffset
offset
for
forControl
int
i
start
i
positionCount
i
block
PosBottomHalf
bh
positions
i
if
offset
offset
log
ERROR
offset
if
offset
offset
length
offset
offset
offset
length
getPositionAtOffset
int
offset
int
int
start
int
end
positionCount
PosBottomHalf
bh
for
forControl
block
switch
end
start
case
bh
positions
start
if
offset
offset
start
break
case
bh
positions
end
if
offset
offset
block
start
end
block
bh
positions
start
if
offset
offset
block
start
break
case
int
pivot
start
end
bh
positions
pivot
if
offset
offset
end
pivot
start
pivot
break
return
start
PosTopHalf
PosBottomHalf
bh
PosTopHalf
bh
PosBottomHalf
bh
bh
ref
getOffset
int
return
offset
finalize
unref
Position
PosBottomHalf
int
offset
int
ref
PosBottomHalf
offset
int
offset
offset
ref
ref
unref
if
ref
removePosition
