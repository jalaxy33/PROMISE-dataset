ChunkCache
ChunkCache
textArea
JEditTextArea
textArea
textArea
out
ArrayList
tokenHandler
DisplayTokenHandler
getMaxHorizontalScrollWidth
int
int
max
for
forControl
int
i
i
firstInvalidLine
i
block
LineInfo
info
lineInfo
i
if
width
max
max
width
return
max
getScreenLineOfOffset
int
line
int
offset
int
if
length
return
if
line
getFirstPhysicalLine
return
if
line
getFirstPhysicalLine
offset
getLineInfo
offset
return
if
line
getLastPhysicalLine
return
block
int
screenLine
if
line
lastScreenLineP
block
LineInfo
last
getLineInfo
lastScreenLine
if
offset
offset
offset
offset
length
block
return
lastScreenLine
screenLine
for
forControl
int
i
i
getVisibleLines
i
block
LineInfo
info
getLineInfo
i
if
physicalLine
line
block
return
i
if
physicalLine
line
block
if
offset
offset
offset
offset
length
block
screenLine
i
break
if
screenLine
return
block
lastScreenLineP
line
lastScreenLine
screenLine
return
screenLine
recalculateVisibleLines
LineInfo
newLineInfo
LineInfo
getVisibleLines
int
start
if
lineInfo
start
block
start
min
length
length
arraycopy
lineInfo
newLineInfo
start
for
forControl
int
i
start
i
length
i
newLineInfo
i
LineInfo
lineInfo
newLineInfo
lastScreenLine
lastScreenLineP
setBuffer
buffer
Buffer
buffer
buffer
lastScreenLine
lastScreenLineP
scrollDown
amount
int
int
visibleLines
getVisibleLines
arraycopy
lineInfo
amount
lineInfo
visibleLines
amount
for
forControl
int
i
visibleLines
amount
i
visibleLines
i
block
lineInfo
i
LineInfo
firstInvalidLine
amount
if
firstInvalidLine
firstInvalidLine
if
CHUNK_CACHE_DEBUG
block
println
amount
lastScreenLine
lastScreenLineP
scrollUp
amount
int
arraycopy
lineInfo
lineInfo
amount
getVisibleLines
amount
for
forControl
int
i
i
amount
i
block
lineInfo
i
LineInfo
int
oldFirstInvalidLine
firstInvalidLine
firstInvalidLine
updateChunksUpTo
amount
firstInvalidLine
oldFirstInvalidLine
amount
if
firstInvalidLine
getVisibleLines
firstInvalidLine
getVisibleLines
if
CHUNK_CACHE_DEBUG
block
log
DEBUG
amount
lastScreenLine
lastScreenLineP
invalidateAll
firstInvalidLine
lastScreenLine
lastScreenLineP
invalidateChunksFrom
screenLine
int
if
CHUNK_CACHE_DEBUG
log
DEBUG
screenLine
firstInvalidLine
min
screenLine
firstInvalidLine
if
screenLine
lastScreenLine
lastScreenLine
lastScreenLineP
invalidateChunksFromPhys
physicalLine
int
for
forControl
int
i
i
firstInvalidLine
i
block
LineInfo
info
lineInfo
i
if
physicalLine
physicalLine
physicalLine
block
firstInvalidLine
i
if
i
lastScreenLine
lastScreenLine
lastScreenLineP
break
getLineInfo
LineInfo
screenLine
int
updateChunksUpTo
screenLine
return
lineInfo
screenLine
getLineSubregionCount
int
physicalLine
int
if
softWrap
return
clear
lineToChunkList
physicalLine
out
int
size
size
if
size
return
return
size
getSubregionOfOffset
int
offset
int
lineInfos
LineInfo
for
forControl
int
i
i
length
i
block
LineInfo
info
lineInfos
i
if
offset
offset
offset
offset
length
return
i
return
xToSubregionOffset
int
physicalLine
int
subregion
int
x
int
round
boolean
LineInfo
infos
getLineInfosForPhysicalLine
physicalLine
if
subregion
subregion
length
return
xToSubregionOffset
infos
subregion
x
round
xToSubregionOffset
int
info
LineInfo
x
int
round
boolean
int
offset
xToOffset
chunks
x
round
if
offset
offset
offset
length
offset
offset
length
return
offset
subregionOffsetToX
int
physicalLine
int
offset
int
LineInfo
infos
getLineInfosForPhysicalLine
physicalLine
LineInfo
info
infos
getSubregionOfOffset
offset
infos
return
subregionOffsetToX
info
offset
subregionOffsetToX
int
info
LineInfo
offset
int
return
int
offsetToX
chunks
offset
getSubregionStartOffset
int
line
int
offset
int
LineInfo
lineInfos
getLineInfosForPhysicalLine
line
LineInfo
info
lineInfos
getSubregionOfOffset
offset
lineInfos
return
getLineStartOffset
physicalLine
offset
getSubregionEndOffset
int
line
int
offset
int
LineInfo
lineInfos
getLineInfosForPhysicalLine
line
LineInfo
info
lineInfos
getSubregionOfOffset
offset
lineInfos
return
getLineStartOffset
physicalLine
offset
length
getBelowPosition
int
physicalLine
int
offset
int
x
int
ignoreWrap
boolean
LineInfo
lineInfos
getLineInfosForPhysicalLine
physicalLine
int
subregion
getSubregionOfOffset
offset
lineInfos
if
subregion
length
ignoreWrap
block
return
getLineStartOffset
physicalLine
xToSubregionOffset
lineInfos
subregion
x
block
int
nextLine
getNextVisibleLine
physicalLine
if
nextLine
return
block
return
getLineStartOffset
nextLine
xToSubregionOffset
nextLine
x
getAbovePosition
int
physicalLine
int
offset
int
x
int
ignoreWrap
boolean
LineInfo
lineInfos
getLineInfosForPhysicalLine
physicalLine
int
subregion
getSubregionOfOffset
offset
lineInfos
if
subregion
ignoreWrap
block
return
getLineStartOffset
physicalLine
xToSubregionOffset
lineInfos
subregion
x
block
int
prevLine
getPrevVisibleLine
physicalLine
if
prevLine
return
block
return
getLineStartOffset
prevLine
xToSubregionOffset
prevLine
x
needFullRepaint
boolean
boolean
retVal
needFullRepaint
needFullRepaint
return
retVal
getLineInfosForPhysicalLine
LineInfo
physicalLine
int
clear
if
isLoaded
lineToChunkList
physicalLine
out
if
size
add
ArrayList
returnValue
ArrayList
size
getLineInfosForPhysicalLine
physicalLine
returnValue
return
LineInfo
toArray
LineInfo
size
JEditTextArea
textArea
Buffer
buffer
LineInfo
lineInfo
ArrayList
out
int
firstInvalidLine
int
lastScreenLineP
int
lastScreenLine
boolean
needFullRepaint
DisplayTokenHandler
tokenHandler
getLineInfosForPhysicalLine
physicalLine
int
list
List
for
forControl
int
i
i
size
i
block
Chunk
chunks
Chunk
get
i
LineInfo
info
LineInfo
physicalLine
physicalLine
if
i
block
firstSubregion
offset
offset
offset
if
i
size
block
lastSubregion
length
getLineLength
physicalLine
offset
block
length
Chunk
get
i
offset
chunks
chunks
add
info
updateChunksUpTo
lastScreenLine
int
if
lastScreenLine
length
block
throw
ArrayIndexOutOfBoundsException
lastScreenLine
if
lastScreenLine
firstInvalidLine
return
int
firstScreenLine
for
forControl
int
i
firstInvalidLine
i
i
block
if
lineInfo
i
lastSubregion
block
firstScreenLine
i
break
int
physicalLine
if
firstScreenLine
block
physicalLine
getFirstPhysicalLine
block
int
prevPhysLine
lineInfo
firstScreenLine
physicalLine
if
prevPhysLine
physicalLine
block
physicalLine
getNextVisibleLine
prevPhysLine
if
CHUNK_CACHE_DEBUG
block
log
DEBUG
firstScreenLine
lastScreenLine
clear
int
offset
int
length
for
forControl
int
i
firstScreenLine
i
lastScreenLine
i
block
LineInfo
info
lineInfo
i
Chunk
chunks
if
size
block
if
physicalLine
i
firstScreenLine
block
physicalLine
getNextVisibleLine
physicalLine
if
physicalLine
block
chunks
physicalLine
width
continue
lineToChunkList
physicalLine
out
firstSubregion
if
size
block
setScreenLineCount
physicalLine
if
i
block
if
skew
block
log
ERROR
skew
size
skew
needFullRepaint
lastScreenLine
length
chunks
offset
length
block
setScreenLineCount
physicalLine
size
if
i
block
int
skew
skew
if
skew
size
block
log
ERROR
skew
size
skew
needFullRepaint
lastScreenLine
length
if
skew
block
firstSubregion
for
forControl
int
j
j
skew
j
remove
chunks
Chunk
get
remove
offset
offset
if
size
length
Chunk
get
offset
length
getLineLength
physicalLine
offset
block
firstSubregion
chunks
Chunk
get
remove
offset
offset
if
size
length
Chunk
get
offset
length
getLineLength
physicalLine
offset
boolean
lastSubregion
size
if
i
lastScreenLine
lastScreenLine
length
block
if
getLineContext
lineContext
block
lastScreenLine
needFullRepaint
if
physicalLine
physicalLine
lastSubregion
lastSubregion
block
lastScreenLine
needFullRepaint
if
size
lastScreenLine
physicalLine
physicalLine
lastSubregion
lastSubregion
offset
offset
length
length
chunks
chunks
lineContext
getLineContext
firstInvalidLine
max
lastScreenLine
firstInvalidLine
lineToChunkList
physicalLine
int
out
List
TextAreaPainter
painter
getPainter
init
getStyles
getFontRenderContext
painter
out
softWrap
wrapMargin
markTokens
physicalLine
tokenHandler
LineInfo
int
physicalLine
int
offset
int
length
boolean
firstSubregion
boolean
lastSubregion
Chunk
chunks
int
width
TokenMarker
LineContext
lineContext
