SegmentMerger
Directory
directory
String
segment
int
termIndexInterval
DEFAULT_TERM_INDEX_INTERVAL
Vector
readers
Vector
FieldInfos
fieldInfos
SegmentMerger
dir
Directory
name
String
directory
dir
segment
name
SegmentMerger
writer
IndexWriter
name
String
directory
getDirectory
segment
name
termIndexInterval
getTermIndexInterval
add
reader
IndexReader
addElement
reader
segmentReader
IndexReader
i
int
return
IndexReader
elementAt
i
merge
int
int
value
value
mergeFields
mergeTerms
mergeNorms
if
hasVectors
mergeVectors
return
value
closeReaders
for
forControl
int
i
i
size
i
block
IndexReader
reader
IndexReader
elementAt
i
close
createCompoundFile
Vector
fileName
String
CompoundFileWriter
cfsWriter
CompoundFileWriter
directory
fileName
Vector
files
Vector
length
size
for
forControl
int
i
i
length
i
block
add
segment
COMPOUND_EXTENSIONS
i
for
forControl
int
i
i
size
i
block
FieldInfo
fi
fieldInfo
i
if
isIndexed
omitNorms
block
add
segment
i
if
hasVectors
block
for
forControl
int
i
i
length
i
block
add
segment
VECTOR_EXTENSIONS
i
Iterator
it
iterator
while
hasNext
block
addFile
String
next
close
return
files
addIndexed
reader
IndexReader
fieldInfos
FieldInfos
names
Collection
storeTermVectors
boolean
storePositionWithTermVector
boolean
storeOffsetWithTermVector
boolean
Iterator
i
iterator
while
hasNext
block
String
field
String
next
add
field
storeTermVectors
storePositionWithTermVector
storeOffsetWithTermVector
hasNorms
field
mergeFields
int
fieldInfos
FieldInfos
int
docCount
for
forControl
int
i
i
size
i
block
IndexReader
reader
IndexReader
elementAt
i
addIndexed
reader
fieldInfos
getFieldNames
TERMVECTOR_WITH_POSITION_OFFSET
addIndexed
reader
fieldInfos
getFieldNames
TERMVECTOR_WITH_POSITION
addIndexed
reader
fieldInfos
getFieldNames
TERMVECTOR_WITH_OFFSET
addIndexed
reader
fieldInfos
getFieldNames
TERMVECTOR
addIndexed
reader
fieldInfos
getFieldNames
INDEXED
add
getFieldNames
UNINDEXED
write
directory
segment
FieldsWriter
fieldsWriter
FieldsWriter
directory
segment
fieldInfos
try
for
forControl
int
i
i
size
i
block
IndexReader
reader
IndexReader
elementAt
i
int
maxDoc
maxDoc
for
forControl
int
j
j
maxDoc
j
if
isDeleted
j
block
addDocument
document
j
docCount
close
return
docCount
mergeVectors
TermVectorsWriter
termVectorsWriter
TermVectorsWriter
directory
segment
fieldInfos
try
for
forControl
int
r
r
size
r
block
IndexReader
reader
IndexReader
elementAt
r
int
maxDoc
maxDoc
for
forControl
int
docNum
docNum
maxDoc
docNum
block
if
isDeleted
docNum
continue
addAllDocVectors
getTermFreqVectors
docNum
close
IndexOutput
freqOutput
IndexOutput
proxOutput
TermInfosWriter
termInfosWriter
int
skipInterval
SegmentMergeQueue
queue
mergeTerms
try
freqOutput
createOutput
segment
proxOutput
createOutput
segment
termInfosWriter
TermInfosWriter
directory
segment
fieldInfos
termIndexInterval
skipInterval
skipInterval
queue
SegmentMergeQueue
size
mergeTermInfos
if
freqOutput
close
if
proxOutput
close
if
termInfosWriter
close
if
queue
close
mergeTermInfos
int
base
for
forControl
int
i
i
size
i
block
IndexReader
reader
IndexReader
elementAt
i
TermEnum
termEnum
terms
SegmentMergeInfo
smi
SegmentMergeInfo
base
termEnum
reader
base
numDocs
if
next
put
smi
close
SegmentMergeInfo
match
SegmentMergeInfo
size
while
size
block
int
matchSize
match
matchSize
SegmentMergeInfo
pop
Term
term
match
term
SegmentMergeInfo
top
SegmentMergeInfo
top
while
top
compareTo
term
block
match
matchSize
SegmentMergeInfo
pop
top
SegmentMergeInfo
top
mergeTermInfo
match
matchSize
while
matchSize
block
SegmentMergeInfo
smi
match
matchSize
if
next
put
smi
close
TermInfo
termInfo
TermInfo
mergeTermInfo
smis
SegmentMergeInfo
n
int
long
freqPointer
getFilePointer
long
proxPointer
getFilePointer
int
df
appendPostings
smis
n
long
skipPointer
writeSkip
if
df
block
set
df
freqPointer
proxPointer
int
skipPointer
freqPointer
add
smis
term
termInfo
appendPostings
int
smis
SegmentMergeInfo
n
int
int
lastDoc
int
df
resetSkip
for
forControl
int
i
i
n
i
block
SegmentMergeInfo
smi
smis
i
TermPositions
postings
getPositions
int
base
base
int
docMap
getDocMap
seek
termEnum
while
next
block
int
doc
doc
if
docMap
doc
docMap
doc
doc
base
if
doc
lastDoc
throw
IllegalStateException
doc
lastDoc
df
if
df
skipInterval
block
bufferSkip
lastDoc
int
docCode
doc
lastDoc
lastDoc
doc
int
freq
freq
if
freq
block
writeVInt
docCode
block
writeVInt
docCode
writeVInt
freq
int
lastPosition
for
forControl
int
j
j
freq
j
block
int
position
nextPosition
writeVInt
position
lastPosition
lastPosition
position
return
df
RAMOutputStream
skipBuffer
RAMOutputStream
int
lastSkipDoc
long
lastSkipFreqPointer
long
lastSkipProxPointer
resetSkip
reset
lastSkipDoc
lastSkipFreqPointer
getFilePointer
lastSkipProxPointer
getFilePointer
bufferSkip
doc
int
long
freqPointer
getFilePointer
long
proxPointer
getFilePointer
writeVInt
doc
lastSkipDoc
writeVInt
int
freqPointer
lastSkipFreqPointer
writeVInt
int
proxPointer
lastSkipProxPointer
lastSkipDoc
doc
lastSkipFreqPointer
freqPointer
lastSkipProxPointer
proxPointer
writeSkip
long
long
skipPointer
getFilePointer
writeTo
freqOutput
return
skipPointer
mergeNorms
for
forControl
int
i
i
size
i
block
FieldInfo
fi
fieldInfo
i
if
isIndexed
omitNorms
block
IndexOutput
output
createOutput
segment
i
try
for
forControl
int
j
j
size
j
block
IndexReader
reader
IndexReader
elementAt
j
int
maxDoc
maxDoc
byte
input
byte
maxDoc
norms
name
input
for
forControl
int
k
k
maxDoc
k
block
if
isDeleted
k
block
writeByte
input
k
close
