CompoundFileWriter
FileEntry
String
file
long
directoryOffset
long
dataOffset
Directory
directory
String
fileName
HashSet
ids
LinkedList
entries
boolean
merged
SegmentMerger
CheckAbort
checkAbort
CompoundFileWriter
dir
Directory
name
String
dir
name
CompoundFileWriter
dir
Directory
name
String
checkAbort
SegmentMerger
CheckAbort
if
dir
throw
NullPointerException
if
name
throw
NullPointerException
checkAbort
checkAbort
directory
dir
fileName
name
ids
HashSet
entries
LinkedList
getDirectory
Directory
return
directory
getName
String
return
fileName
addFile
file
String
if
merged
throw
IllegalStateException
if
file
throw
NullPointerException
if
add
file
throw
IllegalArgumentException
file
FileEntry
entry
FileEntry
file
file
add
entry
close
if
merged
throw
IllegalStateException
if
isEmpty
throw
IllegalStateException
merged
IndexOutput
os
try
os
createOutput
fileName
writeVInt
size
Iterator
it
iterator
long
totalSize
while
hasNext
block
FileEntry
fe
FileEntry
next
directoryOffset
getFilePointer
writeLong
writeString
file
totalSize
fileLength
file
long
finalLength
totalSize
getFilePointer
setLength
finalLength
byte
buffer
byte
it
iterator
while
hasNext
block
FileEntry
fe
FileEntry
next
dataOffset
getFilePointer
copyFile
fe
os
buffer
it
iterator
while
hasNext
block
FileEntry
fe
FileEntry
next
seek
directoryOffset
writeLong
dataOffset
assert
finalLength
length
IndexOutput
tmp
os
os
close
if
os
try
close
catchClause
e
copyFile
source
FileEntry
os
IndexOutput
buffer
byte
IndexInput
is
try
long
startPtr
getFilePointer
is
openInput
file
long
length
length
long
remainder
length
int
chunk
length
while
remainder
block
int
len
int
min
chunk
remainder
readBytes
buffer
len
writeBytes
buffer
len
remainder
len
if
checkAbort
work
if
remainder
throw
IOException
remainder
file
length
chunk
long
endPtr
getFilePointer
long
diff
endPtr
startPtr
if
diff
length
throw
IOException
diff
length
if
is
close
