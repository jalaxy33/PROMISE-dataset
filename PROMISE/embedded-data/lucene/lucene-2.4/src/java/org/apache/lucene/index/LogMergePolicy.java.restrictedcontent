LogMergePolicy
double
LEVEL_LOG_SPAN
int
DEFAULT_MERGE_FACTOR
int
DEFAULT_MAX_MERGE_DOCS
MAX_VALUE
int
mergeFactor
DEFAULT_MERGE_FACTOR
long
minMergeSize
long
maxMergeSize
int
maxMergeDocs
DEFAULT_MAX_MERGE_DOCS
boolean
useCompoundFile
boolean
useCompoundDocStore
IndexWriter
writer
message
message
String
if
writer
message
message
getMergeFactor
int
return
mergeFactor
setMergeFactor
mergeFactor
int
if
mergeFactor
throw
IllegalArgumentException
mergeFactor
mergeFactor
useCompoundFile
boolean
infos
SegmentInfos
info
SegmentInfo
return
useCompoundFile
setUseCompoundFile
useCompoundFile
boolean
useCompoundFile
useCompoundFile
getUseCompoundFile
boolean
return
useCompoundFile
useCompoundDocStore
boolean
infos
SegmentInfos
return
useCompoundDocStore
setUseCompoundDocStore
useCompoundDocStore
boolean
useCompoundDocStore
useCompoundDocStore
getUseCompoundDocStore
boolean
return
useCompoundDocStore
close
size
long
info
SegmentInfo
isOptimized
boolean
infos
SegmentInfos
writer
IndexWriter
maxNumSegments
int
segmentsToOptimize
Set
int
numSegments
size
int
numToOptimize
SegmentInfo
optimizeInfo
for
forControl
int
i
i
numSegments
numToOptimize
maxNumSegments
i
block
SegmentInfo
info
info
i
if
contains
info
block
numToOptimize
optimizeInfo
info
return
numToOptimize
maxNumSegments
numToOptimize
isOptimized
writer
optimizeInfo
isOptimized
boolean
writer
IndexWriter
info
SegmentInfo
return
hasDeletions
hasSeparateNorms
dir
getDirectory
getUseCompoundFile
useCompoundFile
findMergesForOptimize
MergeSpecification
infos
SegmentInfos
writer
IndexWriter
maxNumSegments
int
segmentsToOptimize
Set
MergeSpecification
spec
assert
maxNumSegments
if
isOptimized
infos
writer
maxNumSegments
segmentsToOptimize
block
int
last
size
while
last
block
SegmentInfo
info
info
last
if
contains
info
block
last
break
if
last
block
spec
MergeSpecification
while
last
maxNumSegments
mergeFactor
block
add
OneMerge
range
last
mergeFactor
last
useCompoundFile
last
mergeFactor
if
size
block
if
maxNumSegments
block
if
last
isOptimized
writer
info
add
OneMerge
range
last
useCompoundFile
if
last
maxNumSegments
block
int
finalMergeSize
last
maxNumSegments
long
bestSize
int
bestStart
for
forControl
int
i
i
last
finalMergeSize
i
block
long
sumSize
for
forControl
int
j
j
finalMergeSize
j
sumSize
size
info
j
i
if
i
sumSize
size
info
i
sumSize
bestSize
block
bestStart
i
bestSize
sumSize
add
OneMerge
range
bestStart
bestStart
finalMergeSize
useCompoundFile
spec
spec
return
spec
findMergesToExpungeDeletes
MergeSpecification
segmentInfos
SegmentInfos
writer
IndexWriter
writer
writer
int
numSegments
size
message
numSegments
MergeSpecification
spec
MergeSpecification
int
firstSegmentWithDeletions
for
forControl
int
i
i
numSegments
i
block
SegmentInfo
info
info
i
if
hasDeletions
block
message
name
if
firstSegmentWithDeletions
firstSegmentWithDeletions
i
if
i
firstSegmentWithDeletions
mergeFactor
block
message
firstSegmentWithDeletions
i
add
OneMerge
range
firstSegmentWithDeletions
i
useCompoundFile
firstSegmentWithDeletions
i
if
firstSegmentWithDeletions
block
message
firstSegmentWithDeletions
i
add
OneMerge
range
firstSegmentWithDeletions
i
useCompoundFile
firstSegmentWithDeletions
if
firstSegmentWithDeletions
block
message
firstSegmentWithDeletions
numSegments
add
OneMerge
range
firstSegmentWithDeletions
numSegments
useCompoundFile
return
spec
findMerges
MergeSpecification
infos
SegmentInfos
writer
IndexWriter
int
numSegments
size
writer
writer
message
numSegments
float
levels
float
numSegments
float
norm
float
log
mergeFactor
Directory
directory
getDirectory
for
forControl
int
i
i
numSegments
i
block
SegmentInfo
info
info
i
long
size
size
info
if
size
size
levels
i
float
log
size
norm
float
levelFloor
if
minMergeSize
levelFloor
float
levelFloor
float
log
minMergeSize
norm
MergeSpecification
spec
int
start
while
start
numSegments
block
float
maxLevel
levels
start
for
forControl
int
i
start
i
numSegments
i
block
float
level
levels
i
if
level
maxLevel
maxLevel
level
float
levelBottom
if
maxLevel
levelFloor
levelBottom
block
levelBottom
float
maxLevel
LEVEL_LOG_SPAN
if
levelBottom
levelFloor
maxLevel
levelFloor
levelBottom
levelFloor
int
upto
numSegments
while
upto
start
block
if
levels
upto
levelBottom
block
break
upto
message
levelBottom
maxLevel
upto
start
int
end
start
mergeFactor
while
end
upto
block
boolean
anyTooLarge
for
forControl
int
i
start
i
end
i
block
SegmentInfo
info
info
i
anyTooLarge
size
info
maxMergeSize
docCount
maxMergeDocs
if
anyTooLarge
block
if
spec
spec
MergeSpecification
message
start
end
add
OneMerge
range
start
end
useCompoundFile
message
start
end
start
end
end
start
mergeFactor
start
upto
return
spec
setMaxMergeDocs
maxMergeDocs
int
maxMergeDocs
maxMergeDocs
getMaxMergeDocs
int
return
maxMergeDocs
MergePolicy
