IndexFileDeleter
List
deletable
Map
refCounts
HashMap
List
commits
ArrayList
List
lastFiles
ArrayList
List
commitsToDelete
ArrayList
PrintStream
infoStream
Directory
directory
IndexDeletionPolicy
policy
DocumentsWriter
docWriter
boolean
VERBOSE_REF_COUNTS
setInfoStream
infoStream
PrintStream
infoStream
infoStream
if
infoStream
message
policy
message
message
String
println
currentThread
getName
message
IndexFileDeleter
directory
Directory
policy
IndexDeletionPolicy
segmentInfos
SegmentInfos
infoStream
PrintStream
docWriter
DocumentsWriter
docWriter
docWriter
infoStream
infoStream
if
infoStream
message
getCurrentSegmentFileName
policy
policy
policy
directory
directory
long
currentGen
getGeneration
IndexFileNameFilter
filter
getFilter
String
files
list
if
files
throw
IOException
directory
CommitPoint
currentCommitPoint
for
forControl
int
i
i
length
i
block
String
fileName
files
i
if
accept
fileName
equals
SEGMENTS_GEN
block
getRefCount
fileName
if
startsWith
SEGMENTS
block
if
generationFromSegmentsFileName
fileName
currentGen
block
if
infoStream
block
message
fileName
SegmentInfos
sis
SegmentInfos
try
read
directory
fileName
catchClause
e
if
infoStream
block
message
fileName
sis
if
sis
block
CommitPoint
commitPoint
CommitPoint
commitsToDelete
directory
sis
if
getGeneration
getGeneration
block
currentCommitPoint
commitPoint
add
commitPoint
incRef
sis
if
currentCommitPoint
block
SegmentInfos
sis
SegmentInfos
try
read
directory
getCurrentSegmentFileName
catchClause
e
throw
CorruptIndexException
if
infoStream
message
getCurrentSegmentFileName
currentCommitPoint
CommitPoint
commitsToDelete
directory
sis
add
currentCommitPoint
incRef
sis
sort
commits
Iterator
it
keySet
iterator
while
hasNext
block
String
fileName
String
next
RefCount
rc
RefCount
get
fileName
if
count
block
if
infoStream
block
message
fileName
deleteFile
fileName
onInit
commits
if
deleted
block
checkpoint
segmentInfos
deleteCommits
deleteCommits
int
size
size
if
size
block
for
forControl
int
i
i
size
i
block
CommitPoint
commit
CommitPoint
get
i
if
infoStream
block
message
getSegmentsFileName
int
size2
size
for
forControl
int
j
j
size2
j
block
decRef
String
get
j
clear
size
size
int
readFrom
int
writeTo
while
readFrom
size
block
CommitPoint
commit
CommitPoint
get
readFrom
if
deleted
block
if
writeTo
readFrom
block
set
writeTo
get
readFrom
writeTo
readFrom
while
size
writeTo
block
remove
size
size
refresh
segmentName
String
String
files
list
if
files
throw
IOException
directory
IndexFileNameFilter
filter
getFilter
String
segmentPrefix1
String
segmentPrefix2
if
segmentName
block
segmentPrefix1
segmentName
segmentPrefix2
segmentName
block
segmentPrefix1
segmentPrefix2
for
forControl
int
i
i
length
i
block
String
fileName
files
i
if
accept
fileName
segmentName
startsWith
segmentPrefix1
startsWith
segmentPrefix2
containsKey
fileName
equals
SEGMENTS_GEN
block
if
infoStream
block
message
segmentName
fileName
deleteFile
fileName
refresh
refresh
close
deletePendingFiles
deletePendingFiles
if
deletable
block
List
oldDeletable
deletable
deletable
int
size
size
for
forControl
int
i
i
size
i
block
if
infoStream
message
get
i
deleteFile
String
get
i
checkpoint
segmentInfos
SegmentInfos
isCommit
boolean
if
infoStream
block
message
getCurrentSegmentFileName
size
isCommit
deletePendingFiles
incRef
segmentInfos
isCommit
if
isCommit
block
add
CommitPoint
commitsToDelete
directory
segmentInfos
onCommit
commits
deleteCommits
block
List
docWriterFiles
if
docWriter
block
docWriterFiles
openFiles
if
docWriterFiles
incRef
docWriterFiles
docWriterFiles
int
size
size
if
size
block
for
forControl
int
i
i
size
i
decRef
List
get
i
clear
size
size
for
forControl
int
i
i
size
i
block
SegmentInfo
segmentInfo
info
i
if
dir
directory
block
add
files
if
docWriterFiles
add
docWriterFiles
incRef
segmentInfos
SegmentInfos
isCommit
boolean
int
size
size
for
forControl
int
i
i
size
i
block
SegmentInfo
segmentInfo
info
i
if
dir
directory
block
incRef
files
if
isCommit
block
getRefCount
IncRef
getCurrentSegmentFileName
incRef
files
List
int
size
size
for
forControl
int
i
i
size
i
block
String
fileName
String
get
i
RefCount
rc
getRefCount
fileName
if
infoStream
VERBOSE_REF_COUNTS
block
message
fileName
count
IncRef
decRef
files
List
int
size
size
for
forControl
int
i
i
size
i
block
decRef
String
get
i
decRef
fileName
String
RefCount
rc
getRefCount
fileName
if
infoStream
VERBOSE_REF_COUNTS
block
message
fileName
count
if
DecRef
block
deleteFile
fileName
remove
fileName
decRef
segmentInfos
SegmentInfos
int
size
size
for
forControl
int
i
i
size
i
block
SegmentInfo
segmentInfo
info
i
if
dir
directory
block
decRef
files
getRefCount
RefCount
fileName
String
RefCount
rc
if
containsKey
fileName
block
rc
RefCount
put
fileName
rc
block
rc
RefCount
get
fileName
return
rc
deleteFiles
files
List
int
size
size
for
forControl
int
i
i
size
i
deleteFile
String
get
i
deleteNewFiles
files
Collection
Iterator
it
iterator
while
hasNext
block
String
fileName
String
next
if
containsKey
fileName
deleteFile
fileName
deleteFile
fileName
String
try
if
infoStream
block
message
fileName
deleteFile
fileName
catchClause
e
if
fileExists
fileName
block
if
infoStream
block
message
fileName
toString
if
deletable
block
deletable
ArrayList
add
fileName
RefCount
int
count
IncRef
int
return
count
DecRef
int
assert
count
return
count
CommitPoint
long
gen
List
files
String
segmentsFileName
boolean
deleted
Directory
directory
Collection
commitsToDelete
long
version
long
generation
boolean
isOptimized
CommitPoint
commitsToDelete
Collection
directory
Directory
segmentInfos
SegmentInfos
directory
directory
commitsToDelete
commitsToDelete
segmentsFileName
getCurrentSegmentFileName
version
getVersion
generation
getGeneration
int
size
size
files
ArrayList
size
add
segmentsFileName
gen
getGeneration
for
forControl
int
i
i
size
i
block
SegmentInfo
segmentInfo
info
i
if
dir
directory
block
addAll
files
isOptimized
size
info
hasDeletions
isOptimized
boolean
return
isOptimized
getSegmentsFileName
String
return
segmentsFileName
getFileNames
Collection
return
unmodifiableCollection
files
getDirectory
Directory
return
directory
getVersion
long
return
version
getGeneration
long
return
generation
delete
if
deleted
block
deleted
add
isDeleted
boolean
return
deleted
compareTo
int
obj
Object
CommitPoint
commit
CommitPoint
obj
if
gen
gen
block
return
if
gen
gen
block
return
block
return
IndexCommit
Comparable
