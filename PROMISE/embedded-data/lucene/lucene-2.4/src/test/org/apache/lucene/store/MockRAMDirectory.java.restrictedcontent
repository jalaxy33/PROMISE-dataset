MockRAMDirectory
long
maxSize
long
maxUsedSize
double
randomIOExceptionRate
Random
randomState
boolean
noDeleteOpenFile
boolean
preventDoubleWrite
Set
unSyncedFiles
Set
createdFiles
boolean
crashed
Map
openFiles
init
if
openFiles
openFiles
HashMap
if
createdFiles
createdFiles
HashSet
if
unSyncedFiles
unSyncedFiles
HashSet
MockRAMDirectory
init
MockRAMDirectory
dir
String
dir
init
MockRAMDirectory
dir
Directory
dir
init
MockRAMDirectory
dir
File
dir
init
setPreventDoubleWrite
value
boolean
preventDoubleWrite
value
sync
name
String
maybeThrowDeterministicException
if
crashed
throw
IOException
if
contains
name
remove
name
crash
synchronized
crashed
openFiles
HashMap
Iterator
it
iterator
unSyncedFiles
HashSet
int
count
while
hasNext
block
String
name
String
next
RAMFile
file
RAMFile
get
name
if
count
block
deleteFile
name
if
count
block
int
numBuffers
numBuffers
for
forControl
int
i
i
numBuffers
i
block
byte
buffer
getBuffer
i
fill
buffer
byte
if
count
block
setLength
getLength
count
clearCrash
crashed
setMaxSizeInBytes
maxSize
long
maxSize
maxSize
getMaxSizeInBytes
long
return
maxSize
getMaxUsedSizeInBytes
long
return
maxUsedSize
resetMaxUsedSizeInBytes
maxUsedSize
getRecomputedActualSizeInBytes
setNoDeleteOpenFile
value
boolean
noDeleteOpenFile
value
getNoDeleteOpenFile
boolean
return
noDeleteOpenFile
setRandomIOExceptionRate
rate
double
seed
long
randomIOExceptionRate
rate
randomState
Random
seed
getRandomIOExceptionRate
double
return
randomIOExceptionRate
maybeThrowIOException
if
randomIOExceptionRate
block
int
number
abs
nextInt
if
number
randomIOExceptionRate
block
throw
IOException
deleteFile
name
String
deleteFile
name
deleteFile
name
String
forced
boolean
maybeThrowDeterministicException
if
crashed
forced
throw
IOException
if
contains
name
remove
name
if
forced
block
synchronized
openFiles
if
noDeleteOpenFile
containsKey
name
block
throw
IOException
name
deleteFile
name
createOutput
IndexOutput
name
String
if
crashed
throw
IOException
init
synchronized
openFiles
if
preventDoubleWrite
contains
name
equals
throw
IOException
name
if
noDeleteOpenFile
containsKey
name
throw
IOException
name
RAMFile
file
RAMFile
synchronized
if
crashed
throw
IOException
add
name
add
name
RAMFile
existing
RAMFile
get
name
if
existing
equals
throw
IOException
name
block
if
existing
block
sizeInBytes
sizeInBytes
directory
put
name
file
return
MockRAMOutputStream
file
openInput
IndexInput
name
String
RAMFile
file
synchronized
file
RAMFile
get
name
if
file
throw
FileNotFoundException
name
block
synchronized
openFiles
if
containsKey
name
block
Integer
v
Integer
get
name
v
Integer
intValue
put
name
v
block
put
name
Integer
return
MockRAMInputStream
name
file
getRecomputedSizeInBytes
long
long
size
Iterator
it
values
iterator
while
hasNext
size
RAMFile
next
return
size
getRecomputedActualSizeInBytes
long
long
size
Iterator
it
values
iterator
while
hasNext
size
RAMFile
next
return
size
close
if
openFiles
block
openFiles
HashMap
synchronized
openFiles
if
noDeleteOpenFile
size
block
throw
RuntimeException
openFiles
Failure
eval
dir
MockRAMDirectory
reset
Failure
return
boolean
doFail
setDoFail
doFail
clearDoFail
doFail
ArrayList
failures
failOn
fail
Failure
if
failures
block
failures
ArrayList
add
fail
maybeThrowDeterministicException
if
failures
block
for
forControl
int
i
i
size
i
block
Failure
get
i
RAMDirectory
