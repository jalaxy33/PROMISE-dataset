TestIndexWriter
testDocCount
Directory
dir
RAMDirectory
IndexWriter
writer
IndexReader
reader
int
i
setDefaultWriteLockTimeout
assertEquals
getDefaultWriteLockTimeout
writer
IndexWriter
dir
WhitespaceAnalyzer
setDefaultWriteLockTimeout
for
forControl
i
i
i
block
addDoc
writer
assertEquals
docCount
close
reader
open
dir
for
forControl
i
i
i
block
deleteDocument
i
close
writer
IndexWriter
dir
WhitespaceAnalyzer
assertEquals
docCount
close
reader
open
dir
assertEquals
maxDoc
assertEquals
numDocs
close
writer
IndexWriter
dir
WhitespaceAnalyzer
optimize
assertEquals
docCount
close
reader
open
dir
assertEquals
maxDoc
assertEquals
numDocs
close
writer
IndexWriter
dir
WhitespaceAnalyzer
assertEquals
docCount
close
addDoc
writer
IndexWriter
Document
doc
Document
add
Field
NO
TOKENIZED
addDocument
doc
addDocWithIndex
writer
IndexWriter
index
int
Document
doc
Document
add
Field
index
YES
TOKENIZED
add
Field
index
YES
TOKENIZED
addDocument
doc
testAddIndexOnDiskFull
int
START_COUNT
int
NUM_DIR
int
END_COUNT
START_COUNT
NUM_DIR
boolean
debug
Directory
dirs
Directory
NUM_DIR
long
inputDiskUsage
for
forControl
int
i
i
NUM_DIR
i
block
dirs
i
RAMDirectory
IndexWriter
writer
IndexWriter
dirs
i
WhitespaceAnalyzer
for
forControl
int
j
j
j
block
addDocWithIndex
writer
i
j
close
String
files
dirs
i
list
for
forControl
int
j
j
length
j
block
inputDiskUsage
dirs
i
fileLength
files
j
RAMDirectory
startDir
RAMDirectory
IndexWriter
writer
IndexWriter
startDir
WhitespaceAnalyzer
for
forControl
int
j
j
START_COUNT
j
block
addDocWithIndex
writer
j
close
Term
searchTerm
Term
IndexReader
reader
open
startDir
assertEquals
docFreq
searchTerm
IndexSearcher
searcher
IndexSearcher
reader
Hits
hits
search
TermQuery
searchTerm
assertEquals
length
close
close
long
diskUsage
sizeInBytes
long
startDiskUsage
String
files
list
for
forControl
int
i
i
length
i
block
startDiskUsage
fileLength
files
i
for
forControl
int
iter
iter
iter
block
long
diskFree
diskUsage
boolean
autoCommit
iter
int
method
iter
boolean
success
boolean
done
String
methodName
if
method
block
methodName
if
method
block
methodName
block
methodName
int
cycleCount
while
done
block
cycleCount
MockRAMDirectory
dir
MockRAMDirectory
startDir
writer
IndexWriter
dir
autoCommit
WhitespaceAnalyzer
IOException
err
for
forControl
int
x
x
x
block
double
rate
double
diskRatio
double
diskFree
diskUsage
long
thisDiskFree
String
testName
if
x
block
thisDiskFree
diskFree
if
diskRatio
block
rate
if
diskRatio
block
rate
if
diskRatio
block
rate
if
debug
testName
methodName
diskFree
autoCommit
block
thisDiskFree
rate
if
debug
testName
methodName
autoCommit
if
debug
println
testName
setMaxSizeInBytes
thisDiskFree
setRandomIOExceptionRate
rate
diskFree
try
if
method
block
addIndexes
dirs
if
method
block
IndexReader
readers
IndexReader
length
for
forControl
int
i
i
length
i
block
readers
i
open
dirs
i
try
addIndexes
readers
for
forControl
int
i
i
length
i
block
readers
i
close
block
addIndexesNoOptimize
dirs
success
if
debug
block
println
if
x
block
done
catchClause
e
success
err
e
if
debug
block
println
e
if
x
block
printStackTrace
out
fail
methodName
if
autoCommit
block
String
successStr
if
success
block
successStr
block
successStr
String
message
methodName
successStr
diskFree
assertNoUnreferencedFiles
dir
message
if
debug
block
println
try
reader
open
dir
catchClause
e
printStackTrace
out
fail
testName
e
int
result
docFreq
searchTerm
if
success
block
if
autoCommit
result
END_COUNT
block
fail
testName
result
END_COUNT
if
autoCommit
result
START_COUNT
block
fail
testName
result
START_COUNT
block
if
result
START_COUNT
result
END_COUNT
block
printStackTrace
out
fail
testName
result
START_COUNT
END_COUNT
searcher
IndexSearcher
reader
try
hits
search
TermQuery
searchTerm
catchClause
e
printStackTrace
out
fail
testName
e
int
result2
length
if
success
block
if
result2
result
block
fail
testName
result2
result
block
if
result2
result
block
printStackTrace
out
fail
testName
result2
result
close
close
if
debug
block
println
result
if
done
result
END_COUNT
block
break
if
debug
block
println
startDiskUsage
inputDiskUsage
getMaxUsedSizeInBytes
if
done
block
assertTrue
methodName
getMaxUsedSizeInBytes
startDiskUsage
startDiskUsage
inputDiskUsage
getMaxUsedSizeInBytes
startDiskUsage
startDiskUsage
inputDiskUsage
close
close
diskFree
close
testAddDocumentOnDiskFull
for
forControl
int
pass
pass
pass
block
boolean
autoCommit
pass
boolean
doAbort
pass
long
diskFree
while
block
MockRAMDirectory
dir
MockRAMDirectory
setMaxSizeInBytes
diskFree
IndexWriter
writer
IndexWriter
dir
autoCommit
WhitespaceAnalyzer
boolean
hitError
try
for
forControl
int
i
i
i
block
addDoc
writer
catchClause
e
hitError
if
hitError
block
if
doAbort
block
abort
block
try
close
catchClause
e
setMaxSizeInBytes
close
assertNoUnreferencedFiles
dir
autoCommit
open
close
dir
close
diskFree
block
close
break
assertNoUnreferencedFiles
dir
Directory
message
String
String
startFiles
list
SegmentInfos
infos
SegmentInfos
read
dir
IndexFileDeleter
d
IndexFileDeleter
dir
KeepOnlyLastCommitDeletionPolicy
infos
String
endFiles
list
sort
startFiles
sort
endFiles
if
equals
startFiles
endFiles
block
fail
message
arrayToString
startFiles
arrayToString
endFiles
testOptimizeTempSpaceUsage
MockRAMDirectory
dir
MockRAMDirectory
IndexWriter
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
j
j
j
block
addDocWithIndex
writer
j
close
long
startDiskUsage
String
files
list
for
forControl
int
i
i
length
i
block
startDiskUsage
fileLength
files
i
resetMaxUsedSizeInBytes
writer
IndexWriter
dir
WhitespaceAnalyzer
optimize
close
long
maxDiskUsage
getMaxUsedSizeInBytes
assertTrue
startDiskUsage
maxDiskUsage
startDiskUsage
maxDiskUsage
startDiskUsage
close
arrayToString
String
l
String
String
s
for
forControl
int
i
i
length
i
block
if
i
block
s
s
l
i
return
s
testCreateWithReader
String
tempDir
getProperty
if
tempDir
throw
IOException
File
indexDir
File
tempDir
try
Directory
dir
getDirectory
indexDir
IndexWriter
writer
IndexWriter
dir
WhitespaceAnalyzer
addDoc
writer
close
IndexReader
reader
open
dir
assertEquals
numDocs
writer
IndexWriter
dir
WhitespaceAnalyzer
assertEquals
docCount
addDoc
writer
close
assertEquals
numDocs
IndexReader
reader2
open
dir
assertEquals
numDocs
close
close
rmDir
indexDir
testCreateWithReader2
String
tempDir
getProperty
if
tempDir
throw
IOException
File
indexDir
File
tempDir
try
IndexWriter
writer
IndexWriter
indexDir
WhitespaceAnalyzer
addDoc
writer
close
IndexReader
reader
open
indexDir
assertEquals
numDocs
writer
IndexWriter
indexDir
WhitespaceAnalyzer
assertEquals
docCount
addDoc
writer
close
assertEquals
numDocs
IndexReader
reader2
open
indexDir
assertEquals
numDocs
close
close
rmDir
indexDir
testCreateWithReader3
String
tempDir
getProperty
if
tempDir
throw
IOException
String
dirName
tempDir
try
IndexWriter
writer
IndexWriter
dirName
WhitespaceAnalyzer
addDoc
writer
close
IndexReader
reader
open
dirName
assertEquals
numDocs
writer
IndexWriter
dirName
WhitespaceAnalyzer
assertEquals
docCount
addDoc
writer
close
assertEquals
numDocs
IndexReader
reader2
open
dirName
assertEquals
numDocs
close
close
rmDir
File
dirName
testSimulatedCrashedWriter
Directory
dir
RAMDirectory
IndexWriter
writer
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
i
i
i
block
addDoc
writer
close
long
gen
getCurrentSegmentGeneration
dir
assertTrue
gen
gen
String
fileNameIn
getCurrentSegmentFileName
dir
String
fileNameOut
fileNameFromGeneration
SEGMENTS
gen
IndexInput
in
openInput
fileNameIn
IndexOutput
out
createOutput
fileNameOut
long
length
length
for
forControl
int
i
i
length
i
block
writeByte
readByte
close
close
IndexReader
reader
try
reader
open
dir
catchClause
e
fail
close
try
writer
IndexWriter
dir
WhitespaceAnalyzer
catchClause
e
fail
for
forControl
int
i
i
i
block
addDoc
writer
close
testSimulatedCorruptIndex1
Directory
dir
RAMDirectory
IndexWriter
writer
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
i
i
i
block
addDoc
writer
close
long
gen
getCurrentSegmentGeneration
dir
assertTrue
gen
gen
String
fileNameIn
getCurrentSegmentFileName
dir
String
fileNameOut
fileNameFromGeneration
SEGMENTS
gen
IndexInput
in
openInput
fileNameIn
IndexOutput
out
createOutput
fileNameOut
long
length
length
for
forControl
int
i
i
length
i
block
writeByte
readByte
close
close
deleteFile
fileNameIn
IndexReader
reader
try
reader
open
dir
fail
catchClause
e
if
reader
block
close
testChangesAfterClose
Directory
dir
RAMDirectory
IndexWriter
writer
writer
IndexWriter
dir
WhitespaceAnalyzer
addDoc
writer
close
try
addDoc
writer
fail
catchClause
e
testSimulatedCorruptIndex2
Directory
dir
RAMDirectory
IndexWriter
writer
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
i
i
i
block
addDoc
writer
close
long
gen
getCurrentSegmentGeneration
dir
assertTrue
gen
gen
String
files
list
for
forControl
int
i
i
length
i
block
if
files
i
endsWith
block
deleteFile
files
i
break
IndexReader
reader
try
reader
open
dir
fail
catchClause
e
if
reader
block
close
testCommitOnClose
Directory
dir
RAMDirectory
IndexWriter
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
i
i
i
block
addDoc
writer
close
Term
searchTerm
Term
IndexSearcher
searcher
IndexSearcher
dir
Hits
hits
search
TermQuery
searchTerm
assertEquals
length
close
IndexReader
reader
open
dir
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
i
i
i
block
for
forControl
int
j
j
j
block
addDoc
writer
searcher
IndexSearcher
dir
hits
search
TermQuery
searchTerm
assertEquals
length
close
assertTrue
isCurrent
close
assertFalse
isCurrent
searcher
IndexSearcher
dir
hits
search
TermQuery
searchTerm
assertEquals
length
close
testCommitOnCloseAbort
Directory
dir
RAMDirectory
IndexWriter
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
i
i
i
block
addDoc
writer
close
Term
searchTerm
Term
IndexSearcher
searcher
IndexSearcher
dir
Hits
hits
search
TermQuery
searchTerm
assertEquals
length
close
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
j
j
j
block
addDoc
writer
deleteDocuments
searchTerm
searcher
IndexSearcher
dir
hits
search
TermQuery
searchTerm
assertEquals
length
close
abort
assertNoUnreferencedFiles
dir
searcher
IndexSearcher
dir
hits
search
TermQuery
searchTerm
assertEquals
length
close
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
i
i
i
block
for
forControl
int
j
j
j
block
addDoc
writer
searcher
IndexSearcher
dir
hits
search
TermQuery
searchTerm
assertEquals
length
close
close
searcher
IndexSearcher
dir
hits
search
TermQuery
searchTerm
assertEquals
length
close
close
testCommitOnCloseDiskUsage
MockRAMDirectory
dir
MockRAMDirectory
IndexWriter
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
j
j
j
block
addDocWithIndex
writer
j
close
resetMaxUsedSizeInBytes
long
startDiskUsage
getMaxUsedSizeInBytes
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
j
j
j
block
addDocWithIndex
writer
j
long
midDiskUsage
getMaxUsedSizeInBytes
resetMaxUsedSizeInBytes
optimize
close
long
endDiskUsage
getMaxUsedSizeInBytes
assertTrue
midDiskUsage
startDiskUsage
assertTrue
endDiskUsage
startDiskUsage
testCommitOnCloseOptimize
RAMDirectory
dir
RAMDirectory
IndexWriter
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
j
j
j
block
addDocWithIndex
writer
j
close
writer
IndexWriter
dir
WhitespaceAnalyzer
optimize
IndexReader
reader
open
dir
assertFalse
isOptimized
close
abort
assertNoUnreferencedFiles
dir
reader
open
dir
assertFalse
isOptimized
close
writer
IndexWriter
dir
WhitespaceAnalyzer
optimize
close
assertNoUnreferencedFiles
dir
reader
open
dir
assertTrue
isOptimized
close
testNullLockFactory
MyRAMDirectory
LockFactory
myLockFactory
MyRAMDirectory
lockFactory
myLockFactory
SingleInstanceLockFactory
makeLock
Lock
name
String
return
makeLock
name
RAMDirectory
Directory
dir
MyRAMDirectory
IndexWriter
writer
IndexWriter
dir
WhitespaceAnalyzer
for
forControl
int
i
i
i
block
addDoc
writer
close
IndexReader
reader
open
dir
Term
searchTerm
Term
IndexSearcher
searcher
IndexSearcher
dir
Hits
hits
search
TermQuery
searchTerm
assertEquals
length
close
writer
IndexWriter
dir
WhitespaceAnalyzer
close
close
rmDir
dir
File
File
files
listFiles
if
files
block
for
forControl
int
i
i
length
i
block
files
i
delete
delete
TestCase
