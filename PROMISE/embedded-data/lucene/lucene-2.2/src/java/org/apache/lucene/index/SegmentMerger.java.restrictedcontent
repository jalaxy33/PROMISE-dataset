SegmentMerger
byte
NORMS_HEADER
byte
Directory
directory
String
segment
int
termIndexInterval
DEFAULT_TERM_INDEX_INTERVAL
Vector
readers
Vector
FieldInfos
fieldInfos
int
mergedDocs
SegmentMerger
dir
Directory
name
String
directory
dir
segment
name
SegmentMerger
writer
IndexWriter
name
String
directory
getDirectory
segment
name
termIndexInterval
getTermIndexInterval
add
reader
IndexReader
addElement
reader
segmentReader
IndexReader
i
int
return
IndexReader
elementAt
i
merge
int
int
value
mergedDocs
mergeFields
mergeTerms
mergeNorms
if
hasVectors
mergeVectors
return
mergedDocs
closeReaders
for
forControl
int
i
i
size
i
block
IndexReader
reader
IndexReader
elementAt
i
close
createCompoundFile
Vector
fileName
String
CompoundFileWriter
cfsWriter
CompoundFileWriter
directory
fileName
Vector
files
Vector
length
for
forControl
int
i
i
length
i
block
add
segment
COMPOUND_EXTENSIONS
i
for
forControl
int
i
i
size
i
block
FieldInfo
fi
fieldInfo
i
if
isIndexed
omitNorms
block
add
segment
NORMS_EXTENSION
break
if
hasVectors
block
for
forControl
int
i
i
length
i
block
add
segment
VECTOR_EXTENSIONS
i
Iterator
it
iterator
while
hasNext
block
addFile
String
next
close
return
files
addIndexed
reader
IndexReader
fieldInfos
FieldInfos
names
Collection
storeTermVectors
boolean
storePositionWithTermVector
boolean
storeOffsetWithTermVector
boolean
storePayloads
boolean
Iterator
i
iterator
while
hasNext
block
String
field
String
next
add
field
storeTermVectors
storePositionWithTermVector
storeOffsetWithTermVector
hasNorms
field
storePayloads
mergeFields
int
fieldInfos
FieldInfos
int
docCount
for
forControl
int
i
i
size
i
block
IndexReader
reader
IndexReader
elementAt
i
addIndexed
reader
fieldInfos
getFieldNames
TERMVECTOR_WITH_POSITION_OFFSET
addIndexed
reader
fieldInfos
getFieldNames
TERMVECTOR_WITH_POSITION
addIndexed
reader
fieldInfos
getFieldNames
TERMVECTOR_WITH_OFFSET
addIndexed
reader
fieldInfos
getFieldNames
TERMVECTOR
addIndexed
reader
fieldInfos
getFieldNames
STORES_PAYLOADS
addIndexed
reader
fieldInfos
getFieldNames
INDEXED
add
getFieldNames
UNINDEXED
write
directory
segment
FieldsWriter
fieldsWriter
FieldsWriter
directory
segment
fieldInfos
FieldSelector
fieldSelectorMerge
FieldSelector
accept
FieldSelectorResult
fieldName
String
return
LOAD_FOR_MERGE
try
for
forControl
int
i
i
size
i
block
IndexReader
reader
IndexReader
elementAt
i
int
maxDoc
maxDoc
for
forControl
int
j
j
maxDoc
j
if
isDeleted
j
block
addDocument
document
j
fieldSelectorMerge
docCount
close
return
docCount
mergeVectors
TermVectorsWriter
termVectorsWriter
TermVectorsWriter
directory
segment
fieldInfos
try
for
forControl
int
r
r
size
r
block
IndexReader
reader
IndexReader
elementAt
r
int
maxDoc
maxDoc
for
forControl
int
docNum
docNum
maxDoc
docNum
block
if
isDeleted
docNum
continue
addAllDocVectors
getTermFreqVectors
docNum
close
IndexOutput
freqOutput
IndexOutput
proxOutput
TermInfosWriter
termInfosWriter
int
skipInterval
int
maxSkipLevels
SegmentMergeQueue
queue
DefaultSkipListWriter
skipListWriter
mergeTerms
try
freqOutput
createOutput
segment
proxOutput
createOutput
segment
termInfosWriter
TermInfosWriter
directory
segment
fieldInfos
termIndexInterval
skipInterval
skipInterval
maxSkipLevels
maxSkipLevels
skipListWriter
DefaultSkipListWriter
skipInterval
maxSkipLevels
mergedDocs
freqOutput
proxOutput
queue
SegmentMergeQueue
size
mergeTermInfos
if
freqOutput
close
if
proxOutput
close
if
termInfosWriter
close
if
queue
close
mergeTermInfos
int
base
for
forControl
int
i
i
size
i
block
IndexReader
reader
IndexReader
elementAt
i
TermEnum
termEnum
terms
SegmentMergeInfo
smi
SegmentMergeInfo
base
termEnum
reader
base
numDocs
if
next
put
smi
close
SegmentMergeInfo
match
SegmentMergeInfo
size
while
size
block
int
matchSize
match
matchSize
SegmentMergeInfo
pop
Term
term
match
term
SegmentMergeInfo
top
SegmentMergeInfo
top
while
top
compareTo
term
block
match
matchSize
SegmentMergeInfo
pop
top
SegmentMergeInfo
top
mergeTermInfo
match
matchSize
while
matchSize
block
SegmentMergeInfo
smi
match
matchSize
if
next
put
smi
close
TermInfo
termInfo
TermInfo
mergeTermInfo
smis
SegmentMergeInfo
n
int
long
freqPointer
getFilePointer
long
proxPointer
getFilePointer
int
df
appendPostings
smis
n
long
skipPointer
writeSkip
freqOutput
if
df
block
set
df
freqPointer
proxPointer
int
skipPointer
freqPointer
add
smis
term
termInfo
byte
payloadBuffer
appendPostings
int
smis
SegmentMergeInfo
n
int
int
lastDoc
int
df
resetSkip
boolean
storePayloads
fieldInfo
storePayloads
smis
term
field
int
lastPayloadLength
for
forControl
int
i
i
n
i
block
SegmentMergeInfo
smi
smis
i
TermPositions
postings
getPositions
int
base
base
int
docMap
getDocMap
seek
termEnum
while
next
block
int
doc
doc
if
docMap
doc
docMap
doc
doc
base
if
doc
df
doc
lastDoc
throw
CorruptIndexException
doc
lastDoc
df
if
df
skipInterval
block
setSkipData
lastDoc
storePayloads
lastPayloadLength
bufferSkip
df
int
docCode
doc
lastDoc
lastDoc
doc
int
freq
freq
if
freq
block
writeVInt
docCode
block
writeVInt
docCode
writeVInt
freq
int
lastPosition
for
forControl
int
j
j
freq
j
block
int
position
nextPosition
int
delta
position
lastPosition
if
storePayloads
block
int
payloadLength
getPayloadLength
if
payloadLength
lastPayloadLength
block
writeVInt
delta
block
writeVInt
delta
writeVInt
payloadLength
lastPayloadLength
payloadLength
if
payloadLength
block
if
payloadBuffer
length
payloadLength
block
payloadBuffer
byte
payloadLength
getPayload
payloadBuffer
writeBytes
payloadBuffer
payloadLength
block
writeVInt
delta
lastPosition
position
return
df
mergeNorms
byte
normBuffer
IndexOutput
output
try
for
forControl
int
i
i
size
i
block
FieldInfo
fi
fieldInfo
i
if
isIndexed
omitNorms
block
if
output
block
output
createOutput
segment
NORMS_EXTENSION
writeBytes
NORMS_HEADER
length
for
forControl
int
j
j
size
j
block
IndexReader
reader
IndexReader
elementAt
j
int
maxDoc
maxDoc
if
normBuffer
length
maxDoc
block
normBuffer
byte
maxDoc
norms
name
normBuffer
if
hasDeletions
block
writeBytes
normBuffer
maxDoc
block
for
forControl
int
k
k
maxDoc
k
block
if
isDeleted
k
block
writeByte
normBuffer
k
if
output
block
close
