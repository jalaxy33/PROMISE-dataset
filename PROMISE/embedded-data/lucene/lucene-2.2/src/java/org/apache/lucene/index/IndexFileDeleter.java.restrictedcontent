IndexFileDeleter
List
deletable
Map
refCounts
HashMap
List
commits
ArrayList
List
lastFiles
ArrayList
List
commitsToDelete
ArrayList
PrintStream
infoStream
Directory
directory
IndexDeletionPolicy
policy
setInfoStream
infoStream
PrintStream
infoStream
infoStream
message
message
String
println
currentThread
getName
message
IndexFileDeleter
directory
Directory
policy
IndexDeletionPolicy
segmentInfos
SegmentInfos
infoStream
PrintStream
infoStream
infoStream
policy
policy
directory
directory
long
currentGen
getGeneration
IndexFileNameFilter
filter
getFilter
String
files
list
if
files
throw
IOException
directory
CommitPoint
currentCommitPoint
for
forControl
int
i
i
length
i
block
String
fileName
files
i
if
accept
fileName
equals
SEGMENTS_GEN
block
getRefCount
fileName
if
startsWith
SEGMENTS
block
if
generationFromSegmentsFileName
fileName
currentGen
block
if
infoStream
block
message
fileName
SegmentInfos
sis
SegmentInfos
read
directory
fileName
CommitPoint
commitPoint
CommitPoint
sis
if
getGeneration
getGeneration
block
currentCommitPoint
commitPoint
add
commitPoint
incRef
sis
if
currentCommitPoint
block
throw
CorruptIndexException
sort
commits
Iterator
it
keySet
iterator
while
hasNext
block
String
fileName
String
next
RefCount
rc
RefCount
get
fileName
if
count
block
if
infoStream
block
message
fileName
deleteFile
fileName
onInit
commits
if
deleted
block
checkpoint
segmentInfos
deleteCommits
deleteCommits
int
size
size
if
size
block
for
forControl
int
i
i
size
i
block
CommitPoint
commit
CommitPoint
get
i
if
infoStream
block
message
getSegmentsFileName
int
size2
size
for
forControl
int
j
j
size2
j
block
decRef
List
get
j
decRef
getSegmentsFileName
clear
size
size
int
readFrom
int
writeTo
while
readFrom
size
block
CommitPoint
commit
CommitPoint
get
readFrom
if
deleted
block
if
writeTo
readFrom
block
set
writeTo
get
readFrom
writeTo
readFrom
while
size
writeTo
block
remove
size
size
refresh
String
files
list
if
files
throw
IOException
directory
IndexFileNameFilter
filter
getFilter
for
forControl
int
i
i
length
i
block
String
fileName
files
i
if
accept
fileName
containsKey
fileName
equals
SEGMENTS_GEN
block
if
infoStream
block
message
fileName
deleteFile
fileName
checkpoint
segmentInfos
SegmentInfos
isCommit
boolean
if
infoStream
block
message
getCurrentSegmentFileName
isCommit
if
deletable
block
List
oldDeletable
deletable
deletable
int
size
size
for
forControl
int
i
i
size
i
block
deleteFile
String
get
i
incRef
segmentInfos
isCommit
if
isCommit
block
add
CommitPoint
segmentInfos
onCommit
commits
deleteCommits
int
size
size
if
size
block
for
forControl
int
i
i
size
i
block
decRef
List
get
i
clear
if
isCommit
block
size
size
for
forControl
int
i
i
size
i
block
SegmentInfo
segmentInfo
info
i
if
dir
directory
block
add
files
incRef
segmentInfos
SegmentInfos
isCommit
boolean
int
size
size
for
forControl
int
i
i
size
i
block
SegmentInfo
segmentInfo
info
i
if
dir
directory
block
incRef
files
if
isCommit
block
getRefCount
IncRef
getCurrentSegmentFileName
incRef
files
List
int
size
size
for
forControl
int
i
i
size
i
block
String
fileName
String
get
i
RefCount
rc
getRefCount
fileName
if
infoStream
block
message
fileName
count
IncRef
decRef
files
List
int
size
size
for
forControl
int
i
i
size
i
block
decRef
String
get
i
decRef
fileName
String
RefCount
rc
getRefCount
fileName
if
infoStream
block
message
fileName
count
if
DecRef
block
deleteFile
fileName
remove
fileName
decRef
segmentInfos
SegmentInfos
int
size
size
for
forControl
int
i
i
size
i
block
SegmentInfo
segmentInfo
info
i
if
dir
directory
block
decRef
files
getRefCount
RefCount
fileName
String
RefCount
rc
if
containsKey
fileName
block
rc
RefCount
put
fileName
rc
block
rc
RefCount
get
fileName
return
rc
deleteFile
fileName
String
try
if
infoStream
block
message
fileName
deleteFile
fileName
catchClause
e
if
fileExists
fileName
block
if
infoStream
block
message
fileName
toString
if
deletable
block
deletable
ArrayList
add
fileName
deleteDirect
otherDir
Directory
segments
List
int
size
size
for
forControl
int
i
i
size
i
block
List
filestoDelete
SegmentInfo
get
i
int
size2
size
for
forControl
int
j
j
size2
j
block
deleteFile
String
get
j
RefCount
int
count
IncRef
int
return
count
DecRef
int
return
count
CommitPoint
long
gen
List
files
String
segmentsFileName
boolean
deleted
CommitPoint
segmentInfos
SegmentInfos
segmentsFileName
getCurrentSegmentFileName
int
size
size
files
ArrayList
size
gen
getGeneration
for
forControl
int
i
i
size
i
block
SegmentInfo
segmentInfo
info
i
if
dir
directory
block
add
files
getSegmentsFileName
String
return
segmentsFileName
delete
if
deleted
block
deleted
add
compareTo
int
obj
Object
CommitPoint
commit
CommitPoint
obj
if
gen
gen
block
return
if
gen
gen
block
return
block
return
Comparable
IndexCommitPoint
