StringPool
boolean
DEBUG_ADDITIONS
int
NULL_STRING
int
EMPTY_STRING
StringProducer
toString
String
offset
int
length
int
releaseString
offset
int
length
int
equalsString
boolean
offset
int
length
int
strChars
char
strOffset
int
strLength
int
int
INITIAL_CHUNK_SHIFT
int
INITIAL_CHUNK_SIZE
INITIAL_CHUNK_SHIFT
int
CHUNK_SHIFT
int
CHUNK_SIZE
CHUNK_SHIFT
int
CHUNK_MASK
CHUNK_SIZE
int
INITIAL_CHUNK_COUNT
CHUNK_SHIFT
int
fStringCount
int
fStringFreeList
String
fString
String
INITIAL_CHUNK_COUNT
StringPool
StringProducer
fStringProducer
StringPool
StringProducer
INITIAL_CHUNK_COUNT
int
fOffset
int
INITIAL_CHUNK_COUNT
int
fLength
int
INITIAL_CHUNK_COUNT
int
fCharsOffset
int
INITIAL_CHUNK_COUNT
int
fStringListCount
int
fActiveStringList
int
fStringList
int
INITIAL_CHUNK_COUNT
int
INITIAL_BUCKET_SIZE
int
HASHTABLE_SIZE
int
fSymbolTable
int
HASHTABLE_SIZE
SymbolCache
fSymbolCache
StringPool
fSymbolCache
SymbolCache
if
addSymbol
EMPTY_STRING
throw
RuntimeException
reset
int
chunk
int
index
for
forControl
int
i
i
fStringCount
i
block
fString
chunk
index
if
fStringProducer
chunk
index
fStringProducer
chunk
index
releaseString
fOffset
chunk
index
fLength
chunk
index
fStringProducer
chunk
index
if
index
CHUNK_SIZE
block
chunk
index
for
forControl
int
i
i
HASHTABLE_SIZE
i
fSymbolTable
i
fStringCount
fStringFreeList
fStringListCount
fActiveStringList
reset
fShuffleCount
if
addSymbol
EMPTY_STRING
throw
RuntimeException
ensureCapacity
boolean
chunk
int
index
int
try
return
fOffset
chunk
index
catchClause
ex
if
index
block
String
newString
String
chunk
arraycopy
fString
newString
chunk
fString
newString
StringPool
StringProducer
newProducer
StringPool
StringProducer
chunk
arraycopy
fStringProducer
newProducer
chunk
fStringProducer
newProducer
int
newInt
int
chunk
arraycopy
fOffset
newInt
chunk
fOffset
newInt
newInt
int
chunk
arraycopy
fLength
newInt
chunk
fLength
newInt
newInt
int
chunk
arraycopy
fCharsOffset
newInt
chunk
fCharsOffset
newInt
block
String
newString
String
index
arraycopy
fString
chunk
newString
index
fString
chunk
newString
StringPool
StringProducer
newProducer
StringPool
StringProducer
index
arraycopy
fStringProducer
chunk
newProducer
index
fStringProducer
chunk
newProducer
int
newInt
int
index
arraycopy
fOffset
chunk
newInt
index
fOffset
chunk
newInt
newInt
int
index
arraycopy
fLength
chunk
newInt
index
fLength
chunk
newInt
newInt
int
index
arraycopy
fCharsOffset
chunk
newInt
index
fCharsOffset
chunk
newInt
return
catchClause
ex
fString
chunk
String
INITIAL_CHUNK_SIZE
fStringProducer
chunk
StringPool
StringProducer
INITIAL_CHUNK_SIZE
fOffset
chunk
int
INITIAL_CHUNK_SIZE
fLength
chunk
int
INITIAL_CHUNK_SIZE
fCharsOffset
chunk
int
INITIAL_CHUNK_SIZE
return
addString
int
str
String
int
chunk
int
index
int
stringIndex
if
fStringFreeList
block
stringIndex
fStringFreeList
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
fStringFreeList
fOffset
chunk
index
block
stringIndex
fStringCount
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
ensureCapacity
chunk
index
fString
chunk
index
str
fStringProducer
chunk
index
fOffset
chunk
index
fLength
chunk
index
length
fCharsOffset
chunk
index
if
DEBUG_ADDITIONS
println
str
stringIndex
return
stringIndex
addString
int
stringProducer
StringPool
StringProducer
offset
int
length
int
int
chunk
int
index
int
stringIndex
if
fStringFreeList
block
stringIndex
fStringFreeList
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
fStringFreeList
fOffset
chunk
index
block
stringIndex
fStringCount
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
ensureCapacity
chunk
index
fString
chunk
index
fStringProducer
chunk
index
stringProducer
fOffset
chunk
index
offset
fLength
chunk
index
length
fCharsOffset
chunk
index
if
DEBUG_ADDITIONS
println
toString
offset
length
stringIndex
return
stringIndex
getSymbolCache
SymbolCache
return
fSymbolCache
int
fShuffleCount
resetShuffleCount
fShuffleCount
updateCacheLine
symbolIndex
int
totalMisses
int
length
int
if
fShuffleCount
block
return
int
chunk
symbolIndex
CHUNK_SHIFT
int
index
symbolIndex
CHUNK_MASK
int
charsOffset
fCharsOffset
chunk
index
updateCacheLine
charsOffset
totalMisses
length
createNonMatchingSymbol
int
startOffset
int
entry
int
entries
int
offset
int
int
chunk
int
index
int
stringIndex
if
fStringFreeList
block
stringIndex
fStringFreeList
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
fStringFreeList
fOffset
chunk
index
block
stringIndex
fStringCount
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
ensureCapacity
chunk
index
String
str
createSymbol
stringIndex
startOffset
entry
entries
offset
int
slen
length
fString
chunk
index
str
fStringProducer
chunk
index
fOffset
chunk
index
fLength
chunk
index
slen
fCharsOffset
chunk
index
startOffset
int
hashcode
hashString
str
slen
int
hc
hashcode
HASHTABLE_SIZE
int
bucket
fSymbolTable
hc
hashSymbol
bucket
hashcode
chunk
index
if
DEBUG_ADDITIONS
println
str
stringIndex
return
stringIndex
hashSymbol
bucket
int
hashcode
int
chunk
int
index
int
if
bucket
block
bucket
int
INITIAL_BUCKET_SIZE
bucket
bucket
hashcode
bucket
chunk
bucket
index
int
hc
hashcode
HASHTABLE_SIZE
fSymbolTable
hc
bucket
block
int
count
bucket
int
offset
count
if
offset
length
block
int
newSize
count
INITIAL_BUCKET_SIZE
int
newBucket
int
newSize
arraycopy
bucket
newBucket
offset
bucket
newBucket
int
hc
hashcode
HASHTABLE_SIZE
fSymbolTable
hc
bucket
bucket
offset
hashcode
bucket
offset
chunk
bucket
offset
index
bucket
count
addSymbol
int
str
String
int
slen
length
int
hashcode
hashString
str
slen
int
hc
hashcode
HASHTABLE_SIZE
int
bucket
fSymbolTable
hc
if
bucket
block
int
j
for
forControl
int
i
i
bucket
i
block
if
bucket
j
hashcode
block
int
chunk
bucket
j
int
index
bucket
j
if
slen
fLength
chunk
index
block
int
symoff
fCharsOffset
chunk
index
boolean
match
char
symbolChars
getSymbolChars
for
forControl
int
k
k
slen
k
block
if
symbolChars
symoff
charAt
k
block
match
break
if
match
block
return
chunk
CHUNK_SHIFT
index
j
int
chunk
int
index
int
stringIndex
if
fStringFreeList
block
stringIndex
fStringFreeList
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
fStringFreeList
fOffset
chunk
index
block
stringIndex
fStringCount
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
ensureCapacity
chunk
index
fString
chunk
index
str
fStringProducer
chunk
index
fOffset
chunk
index
fLength
chunk
index
slen
fCharsOffset
chunk
index
addSymbolToCache
str
slen
stringIndex
hashSymbol
bucket
hashcode
chunk
index
if
DEBUG_ADDITIONS
println
str
stringIndex
return
stringIndex
addSymbol
int
stringProducer
StringPool
StringProducer
offset
int
length
int
hashcode
int
int
hc
hashcode
HASHTABLE_SIZE
int
bucket
fSymbolTable
hc
if
bucket
block
int
j
for
forControl
int
i
i
bucket
i
block
if
bucket
j
hashcode
block
int
chunk
bucket
j
int
index
bucket
j
char
symbolChars
getSymbolChars
if
equalsString
offset
length
symbolChars
fCharsOffset
chunk
index
fLength
chunk
index
block
releaseString
offset
length
return
chunk
CHUNK_SHIFT
index
j
int
chunk
int
index
int
stringIndex
if
fStringFreeList
block
stringIndex
fStringFreeList
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
fStringFreeList
fOffset
chunk
index
block
stringIndex
fStringCount
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
ensureCapacity
chunk
index
String
str
toString
offset
length
releaseString
offset
length
int
slen
length
fString
chunk
index
str
fStringProducer
chunk
index
fOffset
chunk
index
fLength
chunk
index
slen
fCharsOffset
chunk
index
addSymbolToCache
str
slen
stringIndex
hashSymbol
bucket
hashcode
chunk
index
if
DEBUG_ADDITIONS
println
str
stringIndex
return
stringIndex
lookupSymbol
int
stringProducer
StringPool
StringProducer
offset
int
length
int
hashcode
int
int
hc
hashcode
HASHTABLE_SIZE
int
bucket
fSymbolTable
hc
if
bucket
block
int
j
for
forControl
int
i
i
bucket
i
block
if
bucket
j
hashcode
block
int
chunk
bucket
j
int
index
bucket
j
char
symbolChars
getSymbolChars
if
equalsString
offset
length
symbolChars
fCharsOffset
chunk
index
fLength
chunk
index
block
return
chunk
CHUNK_SHIFT
index
j
return
addNewSymbol
int
str
String
hashcode
int
int
hc
hashcode
HASHTABLE_SIZE
int
bucket
fSymbolTable
hc
int
chunk
int
index
int
stringIndex
if
fStringFreeList
block
stringIndex
fStringFreeList
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
fStringFreeList
fOffset
chunk
index
block
stringIndex
fStringCount
chunk
stringIndex
CHUNK_SHIFT
index
stringIndex
CHUNK_MASK
ensureCapacity
chunk
index
int
slen
length
fString
chunk
index
str
fStringProducer
chunk
index
fOffset
chunk
index
fLength
chunk
index
slen
fCharsOffset
chunk
index
addSymbolToCache
str
slen
stringIndex
hashSymbol
bucket
hashcode
chunk
index
if
DEBUG_ADDITIONS
println
str
stringIndex
return
stringIndex
addSymbol
int
stringIndex
int
if
stringIndex
stringIndex
fStringCount
return
int
chunk
stringIndex
CHUNK_SHIFT
int
index
stringIndex
CHUNK_MASK
if
fOffset
chunk
index
return
stringIndex
String
s
fString
chunk
index
if
s
block
s
fStringProducer
chunk
index
toString
fOffset
chunk
index
fLength
chunk
index
fStringProducer
chunk
index
releaseString
fOffset
chunk
index
fLength
chunk
index
fString
chunk
index
s
fStringProducer
chunk
index
return
addSymbol
s
CharArrayRange
char
chars
int
offset
int
length
createCharArrayRange
CharArrayRange
return
CharArrayRange
getCharArrayRange
symbolIndex
int
r
CharArrayRange
if
symbolIndex
symbolIndex
fStringCount
block
chars
offset
length
return
int
chunk
symbolIndex
CHUNK_SHIFT
int
index
symbolIndex
CHUNK_MASK
chars
getSymbolChars
offset
fCharsOffset
chunk
index
length
fLength
chunk
index
equalNames
boolean
stringIndex1
int
stringIndex2
int
if
stringIndex1
stringIndex2
return
return
ensureListCapacity
boolean
chunk
int
index
int
try
return
fStringList
chunk
index
catchClause
ex
if
index
block
int
newInt
int
chunk
arraycopy
fStringList
newInt
chunk
fStringList
newInt
block
int
newInt
int
index
arraycopy
fStringList
chunk
newInt
index
fStringList
chunk
newInt
return
catchClause
ex
fStringList
chunk
int
INITIAL_CHUNK_SIZE
return
startStringList
int
fActiveStringList
fStringListCount
return
fStringListCount
addStringToList
boolean
stringListIndex
int
stringIndex
int
if
stringIndex
stringListIndex
fActiveStringList
return
int
chunk
fStringListCount
CHUNK_SHIFT
int
index
fStringListCount
CHUNK_MASK
ensureListCapacity
chunk
index
fStringList
chunk
index
stringIndex
fStringListCount
return
finishStringList
stringListIndex
int
if
stringListIndex
fActiveStringList
return
int
chunk
fStringListCount
CHUNK_SHIFT
int
index
fStringListCount
CHUNK_MASK
ensureListCapacity
chunk
index
fStringList
chunk
index
fActiveStringList
fStringListCount
stringListLength
int
stringListIndex
int
int
chunk
stringListIndex
CHUNK_SHIFT
int
index
stringListIndex
CHUNK_MASK
int
count
while
block
if
fStringList
chunk
index
return
count
count
if
index
CHUNK_SIZE
block
chunk
index
stringInList
boolean
stringListIndex
int
stringIndex
int
int
chunk
stringListIndex
CHUNK_SHIFT
int
index
stringListIndex
CHUNK_MASK
while
block
if
fStringList
chunk
index
stringIndex
return
if
fStringList
chunk
index
return
if
index
CHUNK_SIZE
block
chunk
index
stringListAsString
String
stringListIndex
int
int
chunk
stringListIndex
CHUNK_SHIFT
int
index
stringListIndex
CHUNK_MASK
StringBuffer
sb
StringBuffer
char
sep
while
fStringList
chunk
index
block
append
sep
sep
append
toString
fStringList
chunk
index
if
index
CHUNK_SIZE
block
chunk
index
if
sep
append
return
toString
stringListAsIntArray
int
stringListIndex
int
int
chunk
stringListIndex
CHUNK_SHIFT
int
index
stringListIndex
CHUNK_MASK
int
len
stringListLength
stringListIndex
int
ia
int
len
for
forControl
int
i
i
len
i
block
ia
i
fStringList
chunk
index
if
index
CHUNK_SIZE
block
chunk
index
return
ia
releaseStringInternal
chunk
int
index
int
fString
chunk
index
fStringProducer
chunk
index
fLength
chunk
index
fOffset
chunk
index
fStringFreeList
int
offset
chunk
CHUNK_SHIFT
index
fStringFreeList
offset
releaseString
stringIndex
int
if
stringIndex
stringIndex
fStringCount
return
int
chunk
stringIndex
CHUNK_SHIFT
int
index
stringIndex
CHUNK_MASK
if
fOffset
chunk
index
block
if
fStringProducer
chunk
index
fStringProducer
chunk
index
releaseString
fOffset
chunk
index
fLength
chunk
index
releaseStringInternal
chunk
index
toString
String
stringIndex
int
if
stringIndex
stringIndex
fString
length
block
String
result
fString
stringIndex
if
result
block
return
result
if
stringIndex
stringIndex
fStringCount
return
int
chunk
stringIndex
CHUNK_SHIFT
int
index
stringIndex
CHUNK_MASK
String
s
fString
chunk
index
if
s
return
s
s
fStringProducer
chunk
index
toString
fOffset
chunk
index
fLength
chunk
index
fStringProducer
chunk
index
releaseString
fOffset
chunk
index
fLength
chunk
index
fString
chunk
index
s
fStringProducer
chunk
index
return
s
orphanString
String
stringIndex
int
if
stringIndex
stringIndex
fStringCount
return
int
chunk
stringIndex
CHUNK_SHIFT
int
index
stringIndex
CHUNK_MASK
String
s
fString
chunk
index
if
s
block
s
fStringProducer
chunk
index
toString
fOffset
chunk
index
fLength
chunk
index
fStringProducer
chunk
index
releaseString
fOffset
chunk
index
fLength
chunk
index
releaseStringInternal
chunk
index
if
fOffset
chunk
index
block
releaseStringInternal
chunk
index
return
s
