package
org
apache
tools
tar
import
java
io
FilterInputStream
import
java
io
IOException
import
java
io
InputStream
import
java
io
OutputStream
public
class
TarInputStream
extends
FilterInputStream
protected
boolean
debug
protected
boolean
hasHitEOF
protected
int
entrySize
protected
int
entryOffset
protected
byte
oneBuf
protected
byte
readBuf
protected
TarBuffer
buffer
protected
TarEntry
currEntry
private
boolean
v7Format
public
TarInputStream
InputStream
is
this
is
TarBuffer
DEFAULT_BLKSIZE
TarBuffer
DEFAULT_RCDSIZE
public
TarInputStream
InputStream
is
int
blockSize
this
is
blockSize
TarBuffer
DEFAULT_RCDSIZE
public
TarInputStream
InputStream
is
int
blockSize
int
recordSize
super
is
this
buffer
new
TarBuffer
is
blockSize
recordSize
this
readBuf
this
oneBuf
new
byte
this
debug
this
hasHitEOF
this
v7Format
public
void
setDebug
boolean
debug
this
debug
debug
this
buffer
setDebug
debug
public
void
close
throws
IOException
this
buffer
close
public
int
getRecordSize
return
this
buffer
getRecordSize
public
int
available
throws
IOException
return
this
entrySize
this
entryOffset
public
long
skip
long
numToSkip
throws
IOException
byte
skipBuf
new
byte
long
skip
numToSkip
while
skip
int
realSkip
int
skip
skipBuf
length
skipBuf
length
skip
int
numRead
this
read
skipBuf
realSkip
if
numRead
break
skip
numRead
return
numToSkip
skip
public
boolean
markSupported
return
public
void
mark
int
markLimit
public
void
reset
public
TarEntry
getNextEntry
throws
IOException
if
this
hasHitEOF
return
if
this
currEntry
int
numToSkip
this
entrySize
this
entryOffset
if
this
debug
System
err
println
this
currEntry
getName
this
entrySize
this
entryOffset
numToSkip
if
numToSkip
this
skip
numToSkip
this
readBuf
byte
headerBuf
this
buffer
readRecord
if
headerBuf
if
this
debug
System
err
println
this
hasHitEOF
else
if
this
buffer
isEOFRecord
headerBuf
if
this
debug
System
err
println
this
hasHitEOF
if
this
hasHitEOF
this
currEntry
else
this
currEntry
new
TarEntry
headerBuf
if
headerBuf
headerBuf
headerBuf
headerBuf
headerBuf
this
v7Format
if
this
debug
System
err
println
this
currEntry
getName
this
currEntry
getSize
this
entryOffset
this
entrySize
int
this
currEntry
getSize
if
this
currEntry
this
currEntry
isGNULongNameEntry
StringBuffer
longName
new
StringBuffer
byte
buffer
new
byte
int
length
while
length
read
buffer
longName
append
new
String
buffer
length
getNextEntry
if
longName
length
longName
charAt
longName
length
longName
deleteCharAt
longName
length
this
currEntry
setName
longName
toString
return
this
currEntry
public
int
read
throws
IOException
int
num
this
read
this
oneBuf
if
num
return
num
else
return
int
this
oneBuf
public
int
read
byte
buf
throws
IOException
return
this
read
buf
buf
length
public
int
read
byte
buf
int
offset
int
numToRead
throws
IOException
int
totalRead
if
this
entryOffset
this
entrySize
return
if
numToRead
this
entryOffset
this
entrySize
numToRead
this
entrySize
this
entryOffset
if
this
readBuf
int
sz
numToRead
this
readBuf
length
this
readBuf
length
numToRead
System
arraycopy
this
readBuf
buf
offset
sz
if
sz
this
readBuf
length
this
readBuf
else
int
newLen
this
readBuf
length
sz
byte
newBuf
new
byte
newLen
System
arraycopy
this
readBuf
sz
newBuf
newLen
this
readBuf
newBuf
totalRead
sz
numToRead
sz
offset
sz
while
numToRead
byte
rec
this
buffer
readRecord
if
rec
throw
new
IOException
numToRead
int
sz
numToRead
int
recLen
rec
length
if
recLen
sz
System
arraycopy
rec
buf
offset
sz
this
readBuf
new
byte
recLen
sz
System
arraycopy
rec
sz
this
readBuf
recLen
sz
else
sz
recLen
System
arraycopy
rec
buf
offset
recLen
totalRead
sz
numToRead
sz
offset
sz
this
entryOffset
totalRead
return
totalRead
public
void
copyEntryContents
OutputStream
out
throws
IOException
byte
buf
new
byte
while
int
numRead
this
read
buf
buf
length
if
numRead
break
out
write
buf
numRead
