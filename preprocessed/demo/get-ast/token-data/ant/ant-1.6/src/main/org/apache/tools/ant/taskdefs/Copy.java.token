package
org
apache
tools
ant
taskdefs
import
java
io
File
import
java
io
IOException
import
java
util
Enumeration
import
java
util
Hashtable
import
java
util
Vector
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
DirectoryScanner
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
types
FileSet
import
org
apache
tools
ant
types
FilterChain
import
org
apache
tools
ant
types
FilterSet
import
org
apache
tools
ant
types
FilterSetCollection
import
org
apache
tools
ant
types
Mapper
import
org
apache
tools
ant
util
FileNameMapper
import
org
apache
tools
ant
util
FileUtils
import
org
apache
tools
ant
util
FlatFileNameMapper
import
org
apache
tools
ant
util
IdentityMapper
import
org
apache
tools
ant
util
SourceFileScanner
public
class
Copy
extends
Task
protected
File
file
protected
File
destFile
protected
File
destDir
protected
Vector
filesets
new
Vector
private
boolean
enableMultipleMappings
protected
boolean
filtering
protected
boolean
preserveLastModified
protected
boolean
forceOverwrite
protected
boolean
flatten
protected
int
verbosity
Project
MSG_VERBOSE
protected
boolean
includeEmpty
private
boolean
failonerror
protected
Hashtable
fileCopyMap
new
Hashtable
protected
Hashtable
dirCopyMap
new
Hashtable
protected
Hashtable
completeDirMap
new
Hashtable
protected
Mapper
mapperElement
private
Vector
filterChains
new
Vector
private
Vector
filterSets
new
Vector
private
FileUtils
fileUtils
private
String
inputEncoding
private
String
outputEncoding
public
Copy
fileUtils
FileUtils
newFileUtils
protected
FileUtils
getFileUtils
return
fileUtils
public
void
setFile
File
file
this
file
file
public
void
setTofile
File
destFile
this
destFile
destFile
public
void
setTodir
File
destDir
this
destDir
destDir
public
FilterChain
createFilterChain
FilterChain
filterChain
new
FilterChain
filterChains
addElement
filterChain
return
filterChain
public
FilterSet
createFilterSet
FilterSet
filterSet
new
FilterSet
filterSets
addElement
filterSet
return
filterSet
public
void
setPreserveLastModified
String
preserve
setPreserveLastModified
Project
toBoolean
preserve
public
void
setPreserveLastModified
boolean
preserve
preserveLastModified
preserve
public
boolean
getPreserveLastModified
return
preserveLastModified
protected
Vector
getFilterSets
return
filterSets
protected
Vector
getFilterChains
return
filterChains
public
void
setFiltering
boolean
filtering
this
filtering
filtering
public
void
setOverwrite
boolean
overwrite
this
forceOverwrite
overwrite
public
void
setFlatten
boolean
flatten
this
flatten
flatten
public
void
setVerbose
boolean
verbose
if
verbose
this
verbosity
Project
MSG_INFO
else
this
verbosity
Project
MSG_VERBOSE
public
void
setIncludeEmptyDirs
boolean
includeEmpty
this
includeEmpty
includeEmpty
public
void
setEnableMultipleMappings
boolean
enableMultipleMappings
this
enableMultipleMappings
enableMultipleMappings
public
boolean
isEnableMultipleMapping
return
enableMultipleMappings
public
void
setFailOnError
boolean
failonerror
this
failonerror
failonerror
public
void
addFileset
FileSet
set
filesets
addElement
set
public
Mapper
createMapper
throws
BuildException
if
mapperElement
throw
new
BuildException
getLocation
mapperElement
new
Mapper
getProject
return
mapperElement
public
void
setEncoding
String
encoding
this
inputEncoding
encoding
if
outputEncoding
outputEncoding
encoding
public
String
getEncoding
return
inputEncoding
public
void
setOutputEncoding
String
encoding
this
outputEncoding
encoding
public
String
getOutputEncoding
return
outputEncoding
public
void
execute
throws
BuildException
File
savedFile
file
File
savedDestFile
destFile
File
savedDestDir
destDir
FileSet
savedFileSet
if
file
destFile
filesets
size
savedFileSet
FileSet
filesets
elementAt
validateAttributes
try
if
file
if
file
exists
if
destFile
destFile
new
File
destDir
file
getName
if
forceOverwrite
destFile
exists
file
lastModified
destFile
lastModified
fileCopyMap
put
file
getAbsolutePath
new
String
destFile
getAbsolutePath
else
log
file
destFile
Project
MSG_VERBOSE
else
String
message
file
getAbsolutePath
if
failonerror
log
message
else
throw
new
BuildException
message
for
int
i
i
filesets
size
i
FileSet
fs
FileSet
filesets
elementAt
i
DirectoryScanner
ds
try
ds
fs
getDirectoryScanner
getProject
catch
BuildException
e
if
failonerror
e
getMessage
endsWith
throw
e
else
log
e
getMessage
continue
File
fromDir
fs
getDir
getProject
String
srcFiles
ds
getIncludedFiles
String
srcDirs
ds
getIncludedDirectories
boolean
isEverythingIncluded
ds
isEverythingIncluded
fs
hasSelectors
fs
hasPatterns
if
isEverythingIncluded
flatten
mapperElement
completeDirMap
put
fromDir
destDir
scan
fromDir
destDir
srcFiles
srcDirs
try
doFileOperations
catch
BuildException
e
if
failonerror
log
e
getMessage
Project
MSG_ERR
else
throw
e
finally
file
savedFile
destFile
savedDestFile
destDir
savedDestDir
if
savedFileSet
filesets
insertElementAt
savedFileSet
fileCopyMap
clear
dirCopyMap
clear
completeDirMap
clear
protected
void
validateAttributes
throws
BuildException
if
file
filesets
size
throw
new
BuildException
if
destFile
destDir
throw
new
BuildException
if
destFile
destDir
throw
new
BuildException
if
file
file
exists
file
isDirectory
throw
new
BuildException
if
destFile
filesets
size
if
filesets
size
throw
new
BuildException
else
FileSet
fs
FileSet
filesets
elementAt
DirectoryScanner
ds
fs
getDirectoryScanner
getProject
String
srcFiles
ds
getIncludedFiles
if
srcFiles
length
throw
new
BuildException
else
if
srcFiles
length
if
file
file
new
File
ds
getBasedir
srcFiles
filesets
removeElementAt
else
throw
new
BuildException
else
throw
new
BuildException
if
destFile
destDir
fileUtils
getParentFile
destFile
protected
void
scan
File
fromDir
File
toDir
String
files
String
dirs
FileNameMapper
mapper
if
mapperElement
mapper
mapperElement
getImplementation
else
if
flatten
mapper
new
FlatFileNameMapper
else
mapper
new
IdentityMapper
buildMap
fromDir
toDir
files
mapper
fileCopyMap
if
includeEmpty
buildMap
fromDir
toDir
dirs
mapper
dirCopyMap
protected
void
buildMap
File
fromDir
File
toDir
String
names
FileNameMapper
mapper
Hashtable
map
String
toCopy
if
forceOverwrite
Vector
v
new
Vector
for
int
i
i
names
length
i
if
mapper
mapFileName
names
i
v
addElement
names
i
toCopy
new
String
v
size
v
copyInto
toCopy
else
SourceFileScanner
ds
new
SourceFileScanner
this
toCopy
ds
restrict
names
fromDir
toDir
mapper
for
int
i
i
toCopy
length
i
File
src
new
File
fromDir
toCopy
i
String
mappedFiles
mapper
mapFileName
toCopy
i
if
enableMultipleMappings
map
put
src
getAbsolutePath
new
String
new
File
toDir
mappedFiles
getAbsolutePath
else
for
int
k
k
mappedFiles
length
k
mappedFiles
k
new
File
toDir
mappedFiles
k
getAbsolutePath
map
put
src
getAbsolutePath
mappedFiles
protected
void
doFileOperations
if
fileCopyMap
size
log
fileCopyMap
size
fileCopyMap
size
destDir
getAbsolutePath
Enumeration
e
fileCopyMap
keys
while
e
hasMoreElements
String
fromFile
String
e
nextElement
String
toFiles
String
fileCopyMap
get
fromFile
for
int
i
i
toFiles
length
i
String
toFile
toFiles
i
if
fromFile
equals
toFile
log
fromFile
verbosity
continue
try
log
fromFile
toFile
verbosity
FilterSetCollection
executionFilters
new
FilterSetCollection
if
filtering
executionFilters
addFilterSet
getProject
getGlobalFilterSet
for
Enumeration
filterEnum
filterSets
elements
filterEnum
hasMoreElements
executionFilters
addFilterSet
FilterSet
filterEnum
nextElement
fileUtils
copyFile
fromFile
toFile
executionFilters
filterChains
forceOverwrite
preserveLastModified
inputEncoding
outputEncoding
getProject
catch
IOException
ioe
String
msg
fromFile
toFile
ioe
getMessage
File
targetFile
new
File
toFile
if
targetFile
exists
targetFile
delete
msg
toFile
throw
new
BuildException
msg
ioe
getLocation
if
includeEmpty
Enumeration
e
dirCopyMap
elements
int
createCount
while
e
hasMoreElements
String
dirs
String
e
nextElement
for
int
i
i
dirs
length
i
File
d
new
File
dirs
i
if
d
exists
if
d
mkdirs
log
d
getAbsolutePath
Project
MSG_ERR
else
createCount
if
createCount
log
dirCopyMap
size
dirCopyMap
size
createCount
createCount
destDir
getAbsolutePath
