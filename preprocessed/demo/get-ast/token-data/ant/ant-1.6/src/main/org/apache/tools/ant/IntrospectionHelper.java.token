package
org
apache
tools
ant
import
java
io
File
import
java
lang
reflect
Constructor
import
java
lang
reflect
InvocationTargetException
import
java
lang
reflect
Method
import
java
util
ArrayList
import
java
util
Enumeration
import
java
util
Hashtable
import
java
util
List
import
java
util
Locale
import
org
apache
tools
ant
types
EnumeratedAttribute
import
org
apache
tools
ant
types
Path
import
org
apache
tools
ant
taskdefs
PreSetDef
public
final
class
IntrospectionHelper
implements
BuildListener
private
Hashtable
attributeTypes
private
Hashtable
attributeSetters
private
Hashtable
nestedTypes
private
Hashtable
nestedCreators
private
List
addTypeMethods
private
Method
addText
private
Class
bean
private
static
Hashtable
helpers
new
Hashtable
private
static
final
Hashtable
PRIMITIVE_TYPE_MAP
new
Hashtable
static
Class
primitives
Boolean
TYPE
Byte
TYPE
Character
TYPE
Short
TYPE
Integer
TYPE
Long
TYPE
Float
TYPE
Double
TYPE
Class
wrappers
Boolean
class
Byte
class
Character
class
Short
class
Integer
class
Long
class
Float
class
Double
class
for
int
i
i
primitives
length
i
PRIMITIVE_TYPE_MAP
put
primitives
i
wrappers
i
private
IntrospectionHelper
final
Class
bean
attributeTypes
new
Hashtable
attributeSetters
new
Hashtable
nestedTypes
new
Hashtable
nestedCreators
new
Hashtable
addTypeMethods
new
ArrayList
this
bean
bean
Method
methods
bean
getMethods
for
int
i
i
methods
length
i
final
Method
m
methods
i
final
String
name
m
getName
Class
returnType
m
getReturnType
Class
args
m
getParameterTypes
if
args
length
java
lang
Void
TYPE
equals
returnType
name
equals
name
equals
insertAddTypeMethod
m
continue
if
org
apache
tools
ant
Task
class
isAssignableFrom
bean
args
length
isHiddenSetMethod
name
args
continue
if
org
apache
tools
ant
TaskContainer
class
isAssignableFrom
bean
args
length
equals
name
org
apache
tools
ant
Task
class
equals
args
continue
if
equals
name
java
lang
Void
TYPE
equals
returnType
args
length
java
lang
String
class
equals
args
addText
methods
i
else
if
name
startsWith
java
lang
Void
TYPE
equals
returnType
args
length
args
isArray
String
propName
getPropertyName
name
if
attributeSetters
get
propName
if
java
lang
String
class
equals
args
continue
AttributeSetter
as
createAttributeSetter
m
args
propName
if
as
attributeTypes
put
propName
args
attributeSetters
put
propName
as
else
if
name
startsWith
returnType
isArray
returnType
isPrimitive
args
length
String
propName
getPropertyName
name
if
nestedCreators
get
propName
nestedTypes
put
propName
returnType
nestedCreators
put
propName
new
NestedCreator
public
boolean
isPolyMorphic
return
public
Object
getRealObject
return
public
Class
getElementClass
return
public
Object
create
Project
project
Object
parent
Object
ignore
throws
InvocationTargetException
IllegalAccessException
return
m
invoke
parent
new
Object
public
void
store
Object
parent
Object
child
else
if
name
startsWith
java
lang
Void
TYPE
equals
returnType
args
length
java
lang
String
class
equals
args
args
isArray
args
isPrimitive
try
Constructor
constructor
try
constructor
args
getConstructor
new
Class
catch
NoSuchMethodException
ex
constructor
args
getConstructor
new
Class
Project
class
final
Constructor
c
constructor
String
propName
getPropertyName
name
nestedTypes
put
propName
args
nestedCreators
put
propName
new
NestedCreator
public
boolean
isPolyMorphic
return
public
Object
getRealObject
return
public
Class
getElementClass
return
c
getDeclaringClass
public
Object
create
Project
project
Object
parent
Object
child
throws
InvocationTargetException
IllegalAccessException
InstantiationException
if
child
return
child
else
if
c
getParameterTypes
length
return
c
newInstance
new
Object
else
return
c
newInstance
new
Object
project
public
void
store
Object
parent
Object
child
throws
InvocationTargetException
IllegalAccessException
InstantiationException
m
invoke
parent
new
Object
child
catch
NoSuchMethodException
nse
else
if
name
startsWith
java
lang
Void
TYPE
equals
returnType
args
length
java
lang
String
class
equals
args
args
isArray
args
isPrimitive
try
Constructor
constructor
try
constructor
args
getConstructor
new
Class
catch
NoSuchMethodException
ex
constructor
args
getConstructor
new
Class
Project
class
final
Constructor
c
constructor
String
propName
getPropertyName
name
nestedTypes
put
propName
args
nestedCreators
put
propName
new
NestedCreator
public
boolean
isPolyMorphic
return
public
Object
getRealObject
return
public
Class
getElementClass
return
c
getDeclaringClass
public
Object
create
Project
project
Object
parent
Object
child
throws
InvocationTargetException
IllegalAccessException
InstantiationException
if
child
else
if
c
getParameterTypes
length
child
c
newInstance
new
Object
else
child
c
newInstance
new
Object
project
m
invoke
parent
new
Object
child
return
child
public
void
store
Object
parent
Object
child
throws
InvocationTargetException
IllegalAccessException
InstantiationException
catch
NoSuchMethodException
nse
private
boolean
isHiddenSetMethod
String
name
Class
type
if
equals
name
org
apache
tools
ant
Location
class
equals
type
return
if
equals
name
java
lang
String
class
equals
type
return
return
public
static
synchronized
IntrospectionHelper
getHelper
Class
c
IntrospectionHelper
ih
IntrospectionHelper
helpers
get
c
if
ih
ih
new
IntrospectionHelper
c
helpers
put
c
ih
return
ih
public
static
synchronized
IntrospectionHelper
getHelper
Project
p
Class
c
IntrospectionHelper
ih
IntrospectionHelper
helpers
get
c
if
ih
ih
new
IntrospectionHelper
c
helpers
put
c
ih
p
addBuildListener
ih
return
ih
public
void
setAttribute
Project
p
Object
element
String
attributeName
String
value
throws
BuildException
AttributeSetter
as
AttributeSetter
attributeSetters
get
attributeName
if
as
if
element
instanceof
DynamicConfigurator
DynamicConfigurator
dc
DynamicConfigurator
element
dc
setDynamicAttribute
attributeName
value
return
else
String
msg
getElementName
p
element
attributeName
throw
new
BuildException
msg
try
as
set
p
element
value
catch
IllegalAccessException
ie
throw
new
BuildException
ie
catch
InvocationTargetException
ite
Throwable
t
ite
getTargetException
if
t
instanceof
BuildException
throw
BuildException
t
throw
new
BuildException
t
public
void
addText
Project
project
Object
element
String
text
throws
BuildException
if
addText
if
text
trim
length
return
else
String
msg
project
getElementName
element
throw
new
BuildException
msg
try
addText
invoke
element
new
String
text
catch
IllegalAccessException
ie
throw
new
BuildException
ie
catch
InvocationTargetException
ite
Throwable
t
ite
getTargetException
if
t
instanceof
BuildException
throw
BuildException
t
throw
new
BuildException
t
public
void
throwNotSupported
Project
project
Object
parent
String
elementName
String
msg
project
getElementName
parent
elementName
throw
new
BuildException
msg
private
NestedCreator
getNestedCreator
Project
project
String
parentUri
Object
parent
String
elementName
throws
BuildException
String
uri
ProjectHelper
extractUriFromComponentName
elementName
String
name
ProjectHelper
extractNameFromComponentName
elementName
NestedCreator
nc
if
uri
equals
parentUri
nc
NestedCreator
nestedCreators
get
name
toLowerCase
Locale
US
if
nc
nc
createAddTypeCreator
project
parent
elementName
if
nc
parent
instanceof
DynamicConfigurator
DynamicConfigurator
dc
DynamicConfigurator
parent
final
Object
nestedElement
dc
createDynamicElement
name
toLowerCase
Locale
US
if
nestedElement
nc
new
NestedCreator
public
boolean
isPolyMorphic
return
public
Class
getElementClass
return
public
Object
getRealObject
return
public
Object
create
Project
project
Object
parent
Object
ignore
return
nestedElement
public
void
store
Object
parent
Object
child
if
nc
throwNotSupported
project
parent
elementName
return
nc
public
Object
createElement
Project
project
Object
parent
String
elementName
throws
BuildException
NestedCreator
nc
getNestedCreator
project
parent
elementName
try
Object
nestedElement
nc
create
project
parent
if
project
project
setProjectReference
nestedElement
return
nestedElement
catch
IllegalAccessException
ie
throw
new
BuildException
ie
catch
InstantiationException
ine
throw
new
BuildException
ine
catch
InvocationTargetException
ite
Throwable
t
ite
getTargetException
if
t
instanceof
BuildException
throw
BuildException
t
throw
new
BuildException
t
public
Creator
getElementCreator
Project
project
String
parentUri
Object
parent
String
elementName
UnknownElement
ue
NestedCreator
nc
getNestedCreator
project
parentUri
parent
elementName
return
new
Creator
project
parent
nc
public
boolean
supportsNestedElement
String
elementName
return
nestedCreators
containsKey
elementName
toLowerCase
Locale
US
DynamicConfigurator
class
isAssignableFrom
bean
addTypeMethods
size
public
boolean
supportsNestedElement
String
parentUri
String
elementName
String
uri
ProjectHelper
extractUriFromComponentName
elementName
String
name
ProjectHelper
extractNameFromComponentName
elementName
return
nestedCreators
containsKey
name
toLowerCase
Locale
US
uri
equals
parentUri
DynamicConfigurator
class
isAssignableFrom
bean
addTypeMethods
size
public
void
storeElement
Project
project
Object
parent
Object
child
String
elementName
throws
BuildException
if
elementName
return
NestedCreator
ns
NestedCreator
nestedCreators
get
elementName
toLowerCase
Locale
US
if
ns
return
try
ns
store
parent
child
catch
IllegalAccessException
ie
throw
new
BuildException
ie
catch
InstantiationException
ine
throw
new
BuildException
ine
catch
InvocationTargetException
ite
Throwable
t
ite
getTargetException
if
t
instanceof
BuildException
throw
BuildException
t
throw
new
BuildException
t
public
Class
getElementType
String
elementName
throws
BuildException
Class
nt
Class
nestedTypes
get
elementName
if
nt
String
msg
bean
getName
elementName
throw
new
BuildException
msg
return
nt
public
Class
getAttributeType
String
attributeName
throws
BuildException
Class
at
Class
attributeTypes
get
attributeName
if
at
String
msg
bean
getName
attributeName
throw
new
BuildException
msg
return
at
public
boolean
supportsCharacters
return
addText
public
Enumeration
getAttributes
return
attributeSetters
keys
public
Enumeration
getNestedElements
return
nestedTypes
keys
private
AttributeSetter
createAttributeSetter
final
Method
m
Class
arg
final
String
attrName
final
Class
reflectedArg
PRIMITIVE_TYPE_MAP
containsKey
arg
Class
PRIMITIVE_TYPE_MAP
get
arg
arg
if
java
lang
String
class
equals
reflectedArg
return
new
AttributeSetter
public
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
m
invoke
parent
new
String
value
else
if
java
lang
Character
class
equals
reflectedArg
return
new
AttributeSetter
public
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
if
value
length
throw
new
BuildException
attrName
m
invoke
parent
new
Character
new
Character
value
charAt
else
if
java
lang
Boolean
class
equals
reflectedArg
return
new
AttributeSetter
public
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
m
invoke
parent
new
Boolean
new
Boolean
Project
toBoolean
value
else
if
java
lang
Class
class
equals
reflectedArg
return
new
AttributeSetter
public
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
BuildException
try
m
invoke
parent
new
Class
Class
forName
value
catch
ClassNotFoundException
ce
throw
new
BuildException
ce
else
if
java
io
File
class
equals
reflectedArg
return
new
AttributeSetter
public
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
m
invoke
parent
new
File
p
resolveFile
value
else
if
org
apache
tools
ant
types
Path
class
equals
reflectedArg
return
new
AttributeSetter
public
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
m
invoke
parent
new
Path
new
Path
p
value
else
if
EnumeratedAttribute
class
isAssignableFrom
reflectedArg
return
new
AttributeSetter
public
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
BuildException
try
EnumeratedAttribute
ea
EnumeratedAttribute
reflectedArg
newInstance
ea
setValue
value
m
invoke
parent
new
EnumeratedAttribute
ea
catch
InstantiationException
ie
throw
new
BuildException
ie
else
try
final
Constructor
c
reflectedArg
getConstructor
new
Class
java
lang
String
class
return
new
AttributeSetter
public
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
BuildException
try
Object
attribute
c
newInstance
new
String
value
if
p
p
setProjectReference
attribute
m
invoke
parent
new
Object
attribute
catch
InstantiationException
ie
throw
new
BuildException
ie
catch
NoSuchMethodException
nme
return
protected
String
getElementName
Project
project
Object
element
return
project
getElementName
element
private
String
getPropertyName
String
methodName
String
prefix
int
start
prefix
length
return
methodName
substring
start
toLowerCase
Locale
US
public
static
final
class
Creator
private
NestedCreator
nestedCreator
private
Object
parent
private
Project
project
private
Object
nestedObject
private
String
polyType
private
Creator
Project
project
Object
parent
NestedCreator
nestedCreator
this
project
project
this
parent
parent
this
nestedCreator
nestedCreator
public
void
setPolyType
String
polyType
this
polyType
polyType
public
Object
create
if
polyType
if
nestedCreator
isPolyMorphic
throw
new
BuildException
Class
elementClass
nestedCreator
getElementClass
ComponentHelper
helper
ComponentHelper
getComponentHelper
project
nestedObject
ComponentHelper
getComponentHelper
project
createComponent
polyType
if
nestedObject
throw
new
BuildException
polyType
try
nestedObject
nestedCreator
create
project
parent
nestedObject
if
project
project
setProjectReference
nestedObject
return
nestedObject
catch
IllegalAccessException
ex
throw
new
BuildException
ex
catch
InstantiationException
ex
throw
new
BuildException
ex
catch
IllegalArgumentException
ex
if
polyType
throw
new
BuildException
polyType
throw
ex
catch
InvocationTargetException
ex
Throwable
t
ex
getTargetException
if
t
instanceof
BuildException
throw
BuildException
t
throw
new
BuildException
t
public
Object
getRealObject
return
nestedCreator
getRealObject
public
void
store
try
nestedCreator
store
parent
nestedObject
catch
IllegalAccessException
ex
throw
new
BuildException
ex
catch
InstantiationException
ex
throw
new
BuildException
ex
catch
IllegalArgumentException
ex
if
polyType
throw
new
BuildException
polyType
throw
ex
catch
InvocationTargetException
ex
Throwable
t
ex
getTargetException
if
t
instanceof
BuildException
throw
BuildException
t
throw
new
BuildException
t
private
interface
NestedCreator
boolean
isPolyMorphic
Class
getElementClass
Object
getRealObject
Object
create
Project
project
Object
parent
Object
child
throws
InvocationTargetException
IllegalAccessException
InstantiationException
void
store
Object
parent
Object
child
throws
InvocationTargetException
IllegalAccessException
InstantiationException
private
interface
AttributeSetter
void
set
Project
p
Object
parent
String
value
throws
InvocationTargetException
IllegalAccessException
BuildException
public
void
buildFinished
BuildEvent
event
attributeTypes
clear
attributeSetters
clear
nestedTypes
clear
nestedCreators
clear
addText
helpers
clear
public
void
buildStarted
BuildEvent
event
public
void
targetStarted
BuildEvent
event
public
void
targetFinished
BuildEvent
event
public
void
taskStarted
BuildEvent
event
public
void
taskFinished
BuildEvent
event
public
void
messageLogged
BuildEvent
event
private
NestedCreator
createAddTypeCreator
Project
project
Object
parent
String
elementName
throws
BuildException
if
addTypeMethods
size
return
ComponentHelper
helper
ComponentHelper
getComponentHelper
project
Object
addedObject
Method
addMethod
Class
clazz
helper
getComponentClass
elementName
if
clazz
return
addMethod
findMatchingMethod
clazz
addTypeMethods
if
addMethod
return
addedObject
helper
createComponent
elementName
if
addedObject
return
Object
rObject
addedObject
if
addedObject
instanceof
PreSetDef
PreSetDefinition
rObject
PreSetDef
PreSetDefinition
addedObject
createObject
project
final
Method
method
addMethod
final
Object
nestedObject
addedObject
final
Object
realObject
rObject
return
new
NestedCreator
public
boolean
isPolyMorphic
return
public
Class
getElementClass
return
public
Object
create
Project
project
Object
parent
Object
ignore
throws
InvocationTargetException
IllegalAccessException
if
method
getName
endsWith
method
invoke
parent
new
Object
realObject
return
nestedObject
public
Object
getRealObject
return
realObject
public
void
store
Object
parent
Object
child
throws
InvocationTargetException
IllegalAccessException
InstantiationException
if
method
getName
endsWith
method
invoke
parent
new
Object
realObject
private
void
insertAddTypeMethod
Method
method
Class
argClass
method
getParameterTypes
for
int
c
c
addTypeMethods
size
c
Method
current
Method
addTypeMethods
get
c
if
current
getParameterTypes
equals
argClass
return
if
current
getParameterTypes
isAssignableFrom
argClass
addTypeMethods
add
c
method
return
addTypeMethods
add
method
private
Method
findMatchingMethod
Class
paramClass
List
methods
Class
matchedClass
Method
matchedMethod
for
int
i
i
methods
size
i
Method
method
Method
methods
get
i
Class
methodClass
method
getParameterTypes
if
methodClass
isAssignableFrom
paramClass
if
matchedClass
matchedClass
methodClass
matchedMethod
method
else
if
methodClass
isAssignableFrom
matchedClass
throw
new
BuildException
matchedClass
getName
methodClass
getName
paramClass
getName
return
matchedMethod
