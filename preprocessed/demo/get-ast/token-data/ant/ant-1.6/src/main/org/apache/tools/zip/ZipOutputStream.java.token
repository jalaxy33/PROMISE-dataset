package
org
apache
tools
zip
import
java
io
File
import
java
io
FileOutputStream
import
java
io
FilterOutputStream
import
java
io
IOException
import
java
io
OutputStream
import
java
io
RandomAccessFile
import
java
io
UnsupportedEncodingException
import
java
util
Date
import
java
util
Hashtable
import
java
util
Vector
import
java
util
zip
CRC32
import
java
util
zip
Deflater
import
java
util
zip
ZipException
public
class
ZipOutputStream
extends
FilterOutputStream
private
ZipEntry
entry
private
String
comment
private
int
level
Deflater
DEFAULT_COMPRESSION
private
boolean
hasCompressionLevelChanged
private
int
method
DEFLATED
private
Vector
entries
new
Vector
private
CRC32
crc
new
CRC32
private
long
written
private
long
dataStart
private
long
localDataStart
private
ZipLong
cdOffset
new
ZipLong
private
ZipLong
cdLength
new
ZipLong
private
static
final
byte
ZERO
private
static
final
byte
LZERO
private
Hashtable
offsets
new
Hashtable
private
String
encoding
protected
Deflater
def
new
Deflater
Deflater
DEFAULT_COMPRESSION
protected
byte
buf
new
byte
private
RandomAccessFile
raf
public
static
final
int
DEFLATED
ZipEntry
DEFLATED
public
static
final
int
STORED
ZipEntry
STORED
public
ZipOutputStream
OutputStream
out
super
out
public
ZipOutputStream
File
file
throws
IOException
super
try
raf
new
RandomAccessFile
file
raf
setLength
catch
IOException
e
if
raf
try
raf
close
catch
IOException
inner
raf
out
new
FileOutputStream
file
public
boolean
isSeekable
return
raf
public
void
setEncoding
String
encoding
this
encoding
encoding
public
String
getEncoding
return
encoding
public
void
finish
throws
IOException
closeEntry
cdOffset
new
ZipLong
written
for
int
i
i
entries
size
i
writeCentralFileHeader
ZipEntry
entries
elementAt
i
cdLength
new
ZipLong
written
cdOffset
getValue
writeCentralDirectoryEnd
offsets
clear
entries
removeAllElements
public
void
closeEntry
throws
IOException
if
entry
return
long
realCrc
crc
getValue
crc
reset
if
entry
getMethod
DEFLATED
def
finish
while
def
finished
deflate
entry
setSize
def
getTotalIn
entry
setComprSize
def
getTotalOut
entry
setCrc
realCrc
def
reset
written
entry
getCompressedSize
else
if
raf
if
entry
getCrc
realCrc
throw
new
ZipException
entry
getName
Long
toHexString
entry
getCrc
Long
toHexString
realCrc
if
entry
getSize
written
dataStart
throw
new
ZipException
entry
getName
entry
getSize
written
dataStart
else
long
size
written
dataStart
entry
setSize
size
entry
setComprSize
size
entry
setCrc
realCrc
if
raf
long
save
raf
getFilePointer
raf
seek
localDataStart
writeOut
new
ZipLong
entry
getCrc
getBytes
writeOut
new
ZipLong
entry
getCompressedSize
getBytes
writeOut
new
ZipLong
entry
getSize
getBytes
raf
seek
save
writeDataDescriptor
entry
entry
public
void
putNextEntry
ZipEntry
ze
throws
IOException
closeEntry
entry
ze
entries
addElement
entry
if
entry
getMethod
entry
setMethod
method
if
entry
getTime
entry
setTime
System
currentTimeMillis
if
entry
getMethod
STORED
raf
if
entry
getSize
throw
new
ZipException
if
entry
getCrc
throw
new
ZipException
entry
setComprSize
entry
getSize
if
entry
getMethod
DEFLATED
hasCompressionLevelChanged
def
setLevel
level
hasCompressionLevelChanged
writeLocalFileHeader
entry
public
void
setComment
String
comment
this
comment
comment
public
void
setLevel
int
level
hasCompressionLevelChanged
this
level
level
this
level
level
public
void
setMethod
int
method
this
method
method
public
void
write
byte
b
int
offset
int
length
throws
IOException
if
entry
getMethod
DEFLATED
if
length
if
def
finished
def
setInput
b
offset
length
while
def
needsInput
deflate
else
writeOut
b
offset
length
written
length
crc
update
b
offset
length
public
void
write
int
b
throws
IOException
byte
buf
new
byte
buf
byte
b
write
buf
public
void
close
throws
IOException
finish
if
raf
raf
close
if
out
out
close
public
void
flush
throws
IOException
if
out
out
flush
protected
static
final
ZipLong
LFH_SIG
new
ZipLong
protected
static
final
ZipLong
DD_SIG
new
ZipLong
protected
static
final
ZipLong
CFH_SIG
new
ZipLong
protected
static
final
ZipLong
EOCD_SIG
new
ZipLong
protected
final
void
deflate
throws
IOException
int
len
def
deflate
buf
buf
length
if
len
writeOut
buf
len
protected
void
writeLocalFileHeader
ZipEntry
ze
throws
IOException
offsets
put
ze
new
ZipLong
written
writeOut
LFH_SIG
getBytes
written
if
ze
getMethod
DEFLATED
raf
writeOut
new
ZipShort
getBytes
writeOut
new
ZipShort
getBytes
else
writeOut
new
ZipShort
getBytes
writeOut
ZERO
written
writeOut
new
ZipShort
ze
getMethod
getBytes
written
writeOut
toDosTime
new
Date
ze
getTime
getBytes
written
localDataStart
written
if
ze
getMethod
DEFLATED
raf
writeOut
LZERO
writeOut
LZERO
writeOut
LZERO
else
writeOut
new
ZipLong
ze
getCrc
getBytes
writeOut
new
ZipLong
ze
getSize
getBytes
writeOut
new
ZipLong
ze
getSize
getBytes
written
byte
name
getBytes
ze
getName
writeOut
new
ZipShort
name
length
getBytes
written
byte
extra
ze
getLocalFileDataExtra
writeOut
new
ZipShort
extra
length
getBytes
written
writeOut
name
written
name
length
writeOut
extra
written
extra
length
dataStart
written
protected
void
writeDataDescriptor
ZipEntry
ze
throws
IOException
if
ze
getMethod
DEFLATED
raf
return
writeOut
DD_SIG
getBytes
writeOut
new
ZipLong
entry
getCrc
getBytes
writeOut
new
ZipLong
entry
getCompressedSize
getBytes
writeOut
new
ZipLong
entry
getSize
getBytes
written
protected
void
writeCentralFileHeader
ZipEntry
ze
throws
IOException
writeOut
CFH_SIG
getBytes
written
writeOut
new
ZipShort
ze
getPlatform
getBytes
written
if
ze
getMethod
DEFLATED
raf
writeOut
new
ZipShort
getBytes
writeOut
new
ZipShort
getBytes
else
writeOut
new
ZipShort
getBytes
writeOut
ZERO
written
writeOut
new
ZipShort
ze
getMethod
getBytes
written
writeOut
toDosTime
new
Date
ze
getTime
getBytes
written
writeOut
new
ZipLong
ze
getCrc
getBytes
writeOut
new
ZipLong
ze
getCompressedSize
getBytes
writeOut
new
ZipLong
ze
getSize
getBytes
written
byte
name
getBytes
ze
getName
writeOut
new
ZipShort
name
length
getBytes
written
byte
extra
ze
getCentralDirectoryExtra
writeOut
new
ZipShort
extra
length
getBytes
written
String
comm
ze
getComment
if
comm
comm
byte
comment
getBytes
comm
writeOut
new
ZipShort
comment
length
getBytes
written
writeOut
ZERO
written
writeOut
new
ZipShort
ze
getInternalAttributes
getBytes
written
writeOut
new
ZipLong
ze
getExternalAttributes
getBytes
written
writeOut
ZipLong
offsets
get
ze
getBytes
written
writeOut
name
written
name
length
writeOut
extra
written
extra
length
writeOut
comment
written
comment
length
protected
void
writeCentralDirectoryEnd
throws
IOException
writeOut
EOCD_SIG
getBytes
writeOut
ZERO
writeOut
ZERO
byte
num
new
ZipShort
entries
size
getBytes
writeOut
num
writeOut
num
writeOut
cdLength
getBytes
writeOut
cdOffset
getBytes
byte
data
getBytes
comment
writeOut
new
ZipShort
data
length
getBytes
writeOut
data
private
static
final
ZipLong
DOS_TIME_MIN
new
ZipLong
protected
static
ZipLong
toDosTime
Date
time
int
year
time
getYear
int
month
time
getMonth
if
year
return
DOS_TIME_MIN
long
value
year
month
time
getDate
time
getHours
time
getMinutes
time
getSeconds
byte
result
new
byte
result
byte
value
result
byte
value
result
byte
value
result
byte
value
return
new
ZipLong
result
protected
byte
getBytes
String
name
throws
ZipException
if
encoding
return
name
getBytes
else
try
return
name
getBytes
encoding
catch
UnsupportedEncodingException
uee
throw
new
ZipException
uee
getMessage
protected
final
void
writeOut
byte
data
throws
IOException
writeOut
data
data
length
protected
final
void
writeOut
byte
data
int
offset
int
length
throws
IOException
if
raf
raf
write
data
offset
length
else
out
write
data
offset
length
