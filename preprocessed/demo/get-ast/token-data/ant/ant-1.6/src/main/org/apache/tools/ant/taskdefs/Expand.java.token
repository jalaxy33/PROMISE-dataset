package
org
apache
tools
ant
taskdefs
import
java
io
File
import
java
io
FileOutputStream
import
java
io
FileNotFoundException
import
java
io
InputStream
import
java
io
IOException
import
java
util
Date
import
java
util
Enumeration
import
java
util
Vector
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
DirectoryScanner
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
types
FileSet
import
org
apache
tools
ant
types
PatternSet
import
org
apache
tools
ant
types
selectors
SelectorUtils
import
org
apache
tools
ant
util
FileUtils
import
org
apache
tools
zip
ZipEntry
import
org
apache
tools
zip
ZipFile
public
class
Expand
extends
Task
private
File
dest
private
File
source
private
boolean
overwrite
private
Vector
patternsets
new
Vector
private
Vector
filesets
new
Vector
private
static
final
String
NATIVE_ENCODING
private
String
encoding
public
void
execute
throws
BuildException
if
equals
getTaskType
log
if
source
filesets
size
throw
new
BuildException
if
dest
throw
new
BuildException
if
dest
exists
dest
isDirectory
throw
new
BuildException
getLocation
FileUtils
fileUtils
FileUtils
newFileUtils
if
source
if
source
isDirectory
throw
new
BuildException
getLocation
else
expandFile
fileUtils
source
dest
if
filesets
size
for
int
j
j
filesets
size
j
FileSet
fs
FileSet
filesets
elementAt
j
DirectoryScanner
ds
fs
getDirectoryScanner
getProject
File
fromDir
fs
getDir
getProject
String
files
ds
getIncludedFiles
for
int
i
i
files
length
i
File
file
new
File
fromDir
files
i
expandFile
fileUtils
file
dest
protected
void
expandFile
FileUtils
fileUtils
File
srcF
File
dir
log
srcF
dir
Project
MSG_INFO
ZipFile
zf
try
zf
new
ZipFile
srcF
encoding
Enumeration
e
zf
getEntries
while
e
hasMoreElements
ZipEntry
ze
ZipEntry
e
nextElement
extractFile
fileUtils
srcF
dir
zf
getInputStream
ze
ze
getName
new
Date
ze
getTime
ze
isDirectory
log
Project
MSG_VERBOSE
catch
IOException
ioe
throw
new
BuildException
srcF
getPath
ioe
finally
if
zf
try
zf
close
catch
IOException
e
protected
void
extractFile
FileUtils
fileUtils
File
srcF
File
dir
InputStream
compressedInputStream
String
entryName
Date
entryDate
boolean
isDirectory
throws
IOException
if
patternsets
patternsets
size
String
name
entryName
replace
File
separatorChar
replace
File
separatorChar
boolean
included
for
int
v
v
patternsets
size
v
PatternSet
p
PatternSet
patternsets
elementAt
v
String
incls
p
getIncludePatterns
getProject
if
incls
incls
length
incls
new
String
for
int
w
w
incls
length
w
String
pattern
incls
w
replace
File
separatorChar
replace
File
separatorChar
if
pattern
endsWith
File
separator
pattern
included
SelectorUtils
matchPath
pattern
name
if
included
break
if
included
break
String
excls
p
getExcludePatterns
getProject
if
excls
for
int
w
w
excls
length
w
String
pattern
excls
w
replace
File
separatorChar
replace
File
separatorChar
if
pattern
endsWith
File
separator
pattern
included
SelectorUtils
matchPath
pattern
name
if
included
break
if
included
return
File
f
fileUtils
resolveFile
dir
entryName
try
if
overwrite
f
exists
f
lastModified
entryDate
getTime
log
f
Project
MSG_DEBUG
return
log
entryName
f
Project
MSG_VERBOSE
File
dirF
fileUtils
getParentFile
f
if
dirF
dirF
mkdirs
if
isDirectory
f
mkdirs
else
byte
buffer
new
byte
int
length
FileOutputStream
fos
try
fos
new
FileOutputStream
f
while
length
compressedInputStream
read
buffer
fos
write
buffer
length
fos
close
fos
finally
if
fos
try
fos
close
catch
IOException
e
fileUtils
setFileLastModified
f
entryDate
getTime
catch
FileNotFoundException
ex
log
f
getPath
Project
MSG_WARN
public
void
setDest
File
d
this
dest
d
public
void
setSrc
File
s
this
source
s
public
void
setOverwrite
boolean
b
overwrite
b
public
void
addPatternset
PatternSet
set
patternsets
addElement
set
public
void
addFileset
FileSet
set
filesets
addElement
set
public
void
setEncoding
String
encoding
if
NATIVE_ENCODING
equals
encoding
encoding
this
encoding
encoding
