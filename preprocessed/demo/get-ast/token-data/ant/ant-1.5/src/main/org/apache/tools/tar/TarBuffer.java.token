package
org
apache
tools
tar
import
java
io
InputStream
import
java
io
OutputStream
import
java
io
IOException
public
class
TarBuffer
public
static
final
int
DEFAULT_RCDSIZE
public
static
final
int
DEFAULT_BLKSIZE
DEFAULT_RCDSIZE
private
InputStream
inStream
private
OutputStream
outStream
private
byte
blockBuffer
private
int
currBlkIdx
private
int
currRecIdx
private
int
blockSize
private
int
recordSize
private
int
recsPerBlock
private
boolean
debug
public
TarBuffer
InputStream
inStream
this
inStream
TarBuffer
DEFAULT_BLKSIZE
public
TarBuffer
InputStream
inStream
int
blockSize
this
inStream
blockSize
TarBuffer
DEFAULT_RCDSIZE
public
TarBuffer
InputStream
inStream
int
blockSize
int
recordSize
this
inStream
inStream
this
outStream
this
initialize
blockSize
recordSize
public
TarBuffer
OutputStream
outStream
this
outStream
TarBuffer
DEFAULT_BLKSIZE
public
TarBuffer
OutputStream
outStream
int
blockSize
this
outStream
blockSize
TarBuffer
DEFAULT_RCDSIZE
public
TarBuffer
OutputStream
outStream
int
blockSize
int
recordSize
this
inStream
this
outStream
outStream
this
initialize
blockSize
recordSize
private
void
initialize
int
blockSize
int
recordSize
this
debug
this
blockSize
blockSize
this
recordSize
recordSize
this
recsPerBlock
this
blockSize
this
recordSize
this
blockBuffer
new
byte
this
blockSize
if
this
inStream
this
currBlkIdx
this
currRecIdx
this
recsPerBlock
else
this
currBlkIdx
this
currRecIdx
public
int
getBlockSize
return
this
blockSize
public
int
getRecordSize
return
this
recordSize
public
void
setDebug
boolean
debug
this
debug
debug
public
boolean
isEOFRecord
byte
record
for
int
i
sz
this
getRecordSize
i
sz
i
if
record
i
return
return
public
void
skipRecord
throws
IOException
if
this
debug
System
err
println
this
currRecIdx
this
currBlkIdx
if
this
inStream
throw
new
IOException
if
this
currRecIdx
this
recsPerBlock
if
this
readBlock
return
this
currRecIdx
public
byte
readRecord
throws
IOException
if
this
debug
System
err
println
this
currRecIdx
this
currBlkIdx
if
this
inStream
throw
new
IOException
if
this
currRecIdx
this
recsPerBlock
if
this
readBlock
return
byte
result
new
byte
this
recordSize
System
arraycopy
this
blockBuffer
this
currRecIdx
this
recordSize
result
this
recordSize
this
currRecIdx
return
result
private
boolean
readBlock
throws
IOException
if
this
debug
System
err
println
this
currBlkIdx
if
this
inStream
throw
new
IOException
this
currRecIdx
int
offset
int
bytesNeeded
this
blockSize
while
bytesNeeded
long
numBytes
this
inStream
read
this
blockBuffer
offset
bytesNeeded
if
numBytes
break
offset
numBytes
bytesNeeded
numBytes
if
numBytes
this
blockSize
if
this
debug
System
err
println
numBytes
this
blockSize
this
currBlkIdx
return
public
int
getCurrentBlockNum
return
this
currBlkIdx
public
int
getCurrentRecordNum
return
this
currRecIdx
public
void
writeRecord
byte
record
throws
IOException
if
this
debug
System
err
println
this
currRecIdx
this
currBlkIdx
if
this
outStream
throw
new
IOException
if
record
length
this
recordSize
throw
new
IOException
record
length
this
recordSize
if
this
currRecIdx
this
recsPerBlock
this
writeBlock
System
arraycopy
record
this
blockBuffer
this
currRecIdx
this
recordSize
this
recordSize
this
currRecIdx
public
void
writeRecord
byte
buf
int
offset
throws
IOException
if
this
debug
System
err
println
this
currRecIdx
this
currBlkIdx
if
this
outStream
throw
new
IOException
if
offset
this
recordSize
buf
length
throw
new
IOException
buf
length
offset
this
recordSize
if
this
currRecIdx
this
recsPerBlock
this
writeBlock
System
arraycopy
buf
offset
this
blockBuffer
this
currRecIdx
this
recordSize
this
recordSize
this
currRecIdx
private
void
writeBlock
throws
IOException
if
this
debug
System
err
println
this
currBlkIdx
if
this
outStream
throw
new
IOException
this
outStream
write
this
blockBuffer
this
blockSize
this
outStream
flush
this
currRecIdx
this
currBlkIdx
private
void
flushBlock
throws
IOException
if
this
debug
System
err
println
if
this
outStream
throw
new
IOException
if
this
currRecIdx
this
writeBlock
public
void
close
throws
IOException
if
this
debug
System
err
println
if
this
outStream
this
flushBlock
if
this
outStream
System
out
this
outStream
System
err
this
outStream
close
this
outStream
else
if
this
inStream
if
this
inStream
System
in
this
inStream
close
this
inStream
