package
org
apache
tools
ant
taskdefs
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
ProjectComponent
import
org
apache
tools
ant
BuildListener
import
org
apache
tools
ant
DefaultLogger
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
ProjectHelper
import
org
apache
tools
ant
util
FileUtils
import
java
io
File
import
java
io
PrintStream
import
java
io
FileOutputStream
import
java
io
IOException
import
java
lang
reflect
Method
import
java
util
Vector
import
java
util
Hashtable
import
java
util
Enumeration
public
class
Ant
extends
Task
private
File
dir
private
String
antFile
private
String
target
private
String
output
private
boolean
inheritAll
private
boolean
inheritRefs
private
Vector
properties
new
Vector
private
Vector
references
new
Vector
private
Project
newProject
private
PrintStream
out
public
void
setInheritAll
boolean
value
inheritAll
value
public
void
setInheritRefs
boolean
value
inheritRefs
value
public
void
init
newProject
new
Project
newProject
setJavaVersionProperty
newProject
addTaskDefinition
Class
project
getTaskDefinitions
get
private
void
reinit
init
final
int
count
properties
size
for
int
i
i
count
i
Property
p
Property
properties
elementAt
i
Property
newP
Property
newProject
createTask
newP
setName
p
getName
if
p
getValue
newP
setValue
p
getValue
if
p
getFile
newP
setFile
p
getFile
if
p
getResource
newP
setResource
p
getResource
if
p
getPrefix
newP
setPrefix
p
getPrefix
if
p
getRefid
newP
setRefid
p
getRefid
if
p
getEnvironment
newP
setEnvironment
p
getEnvironment
if
p
getClasspath
newP
setClasspath
p
getClasspath
properties
setElementAt
newP
i
private
void
initializeProject
newProject
setInputHandler
getProject
getInputHandler
Vector
listeners
project
getBuildListeners
final
int
count
listeners
size
for
int
i
i
count
i
newProject
addBuildListener
BuildListener
listeners
elementAt
i
if
output
File
outfile
if
dir
outfile
FileUtils
newFileUtils
resolveFile
dir
output
else
outfile
getProject
resolveFile
output
try
out
new
PrintStream
new
FileOutputStream
outfile
DefaultLogger
logger
new
DefaultLogger
logger
setMessageOutputLevel
Project
MSG_INFO
logger
setOutputPrintStream
out
logger
setErrorPrintStream
out
newProject
addBuildListener
logger
catch
IOException
ex
log
output
Hashtable
taskdefs
project
getTaskDefinitions
Enumeration
et
taskdefs
keys
while
et
hasMoreElements
String
taskName
String
et
nextElement
if
taskName
equals
continue
Class
taskClass
Class
taskdefs
get
taskName
newProject
addTaskDefinition
taskName
taskClass
Hashtable
typedefs
project
getDataTypeDefinitions
Enumeration
e
typedefs
keys
while
e
hasMoreElements
String
typeName
String
e
nextElement
Class
typeClass
Class
typedefs
get
typeName
newProject
addDataTypeDefinition
typeName
typeClass
getProject
copyUserProperties
newProject
if
inheritAll
newProject
setSystemProperties
else
Hashtable
props
getProject
getProperties
e
props
keys
while
e
hasMoreElements
String
arg
e
nextElement
toString
if
equals
arg
equals
arg
continue
String
value
props
get
arg
toString
if
newProject
getProperty
arg
newProject
setNewProperty
arg
value
protected
void
handleOutput
String
line
if
newProject
newProject
demuxOutput
line
else
super
handleOutput
line
protected
void
handleErrorOutput
String
line
if
newProject
newProject
demuxOutput
line
else
super
handleErrorOutput
line
public
void
execute
throws
BuildException
File
savedDir
dir
String
savedAntFile
antFile
String
savedTarget
target
try
if
newProject
reinit
if
dir
inheritAll
dir
project
getBaseDir
initializeProject
if
dir
newProject
setBaseDir
dir
if
savedDir
newProject
setInheritedProperty
dir
getAbsolutePath
else
dir
project
getBaseDir
overrideProperties
if
antFile
antFile
File
file
FileUtils
newFileUtils
resolveFile
dir
antFile
antFile
file
getAbsolutePath
log
target
target
antFile
toString
Project
MSG_VERBOSE
newProject
setUserProperty
antFile
ProjectHelper
configureProject
newProject
new
File
antFile
if
target
target
newProject
getDefaultTarget
addReferences
if
newProject
getBaseDir
equals
project
getBaseDir
newProject
getProperty
equals
project
getProperty
getOwningTarget
target
equals
this
getOwningTarget
getName
throw
new
BuildException
newProject
executeTarget
target
finally
newProject
if
output
out
try
out
close
catch
final
Exception
e
dir
savedDir
antFile
savedAntFile
target
savedTarget
private
void
overrideProperties
throws
BuildException
Enumeration
e
properties
elements
while
e
hasMoreElements
Property
p
Property
e
nextElement
p
setProject
newProject
p
execute
getProject
copyInheritedProperties
newProject
private
void
addReferences
throws
BuildException
Hashtable
thisReferences
Hashtable
project
getReferences
clone
Hashtable
newReferences
newProject
getReferences
Enumeration
e
if
references
size
for
e
references
elements
e
hasMoreElements
Reference
ref
Reference
e
nextElement
String
refid
ref
getRefId
if
refid
throw
new
BuildException
if
thisReferences
containsKey
refid
log
refid
Project
MSG_WARN
continue
thisReferences
remove
refid
String
toRefid
ref
getToRefid
if
toRefid
toRefid
refid
copyReference
refid
toRefid
if
inheritRefs
for
e
thisReferences
keys
e
hasMoreElements
String
key
String
e
nextElement
if
newReferences
containsKey
key
continue
copyReference
key
key
private
void
copyReference
String
oldKey
String
newKey
Object
orig
project
getReference
oldKey
Class
c
orig
getClass
Object
copy
orig
try
Method
cloneM
c
getMethod
new
Class
if
cloneM
copy
cloneM
invoke
orig
new
Object
catch
Exception
e
if
copy
instanceof
ProjectComponent
ProjectComponent
copy
setProject
newProject
else
try
Method
setProjectM
c
getMethod
new
Class
Project
class
if
setProjectM
setProjectM
invoke
copy
new
Object
newProject
catch
NoSuchMethodException
e
catch
Exception
e2
String
msg
oldKey
throw
new
BuildException
msg
e2
location
newProject
addReference
newKey
copy
public
void
setDir
File
d
this
dir
d
public
void
setAntfile
String
s
this
antFile
s
public
void
setTarget
String
s
this
target
s
public
void
setOutput
String
s
this
output
s
public
Property
createProperty
if
newProject
reinit
Property
p
new
Property
getProject
p
setProject
newProject
p
setTaskName
properties
addElement
p
return
p
public
void
addReference
Reference
r
references
addElement
r
public
static
class
Reference
extends
org
apache
tools
ant
types
Reference
public
Reference
super
private
String
targetid
public
void
setToRefid
String
targetid
this
targetid
targetid
public
String
getToRefid
return
targetid
