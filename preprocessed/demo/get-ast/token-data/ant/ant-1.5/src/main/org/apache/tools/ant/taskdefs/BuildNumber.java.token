package
org
apache
tools
ant
taskdefs
import
java
io
File
import
java
io
FileInputStream
import
java
io
FileOutputStream
import
java
io
IOException
import
java
util
Properties
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
util
FileUtils
public
class
BuildNumber
extends
Task
private
static
final
String
DEFAULT_PROPERTY_NAME
private
static
final
String
DEFAULT_FILENAME
DEFAULT_PROPERTY_NAME
private
File
m_file
public
void
setFile
final
File
file
m_file
file
public
void
execute
throws
BuildException
File
savedFile
m_file
validate
final
Properties
properties
loadProperties
final
int
buildNumber
getBuildNumber
properties
properties
put
DEFAULT_PROPERTY_NAME
String
valueOf
buildNumber
FileOutputStream
output
try
output
new
FileOutputStream
m_file
final
String
header
properties
save
output
header
catch
final
IOException
ioe
final
String
message
m_file
throw
new
BuildException
message
ioe
finally
if
output
try
output
close
catch
final
IOException
ioe
m_file
savedFile
getProject
setNewProperty
DEFAULT_PROPERTY_NAME
String
valueOf
buildNumber
private
int
getBuildNumber
final
Properties
properties
throws
BuildException
final
String
buildNumber
properties
getProperty
DEFAULT_PROPERTY_NAME
trim
try
return
Integer
parseInt
buildNumber
catch
final
NumberFormatException
nfe
final
String
message
m_file
buildNumber
throw
new
BuildException
message
nfe
private
Properties
loadProperties
throws
BuildException
FileInputStream
input
try
final
Properties
properties
new
Properties
input
new
FileInputStream
m_file
properties
load
input
return
properties
catch
final
IOException
ioe
throw
new
BuildException
ioe
finally
if
input
try
input
close
catch
final
IOException
ioe
private
void
validate
throws
BuildException
if
m_file
m_file
getProject
resolveFile
DEFAULT_FILENAME
if
m_file
exists
try
FileUtils
newFileUtils
createNewFile
m_file
catch
final
IOException
ioe
final
String
message
m_file
throw
new
BuildException
message
ioe
if
m_file
canRead
final
String
message
m_file
throw
new
BuildException
message
if
m_file
canWrite
final
String
message
m_file
throw
new
BuildException
message
