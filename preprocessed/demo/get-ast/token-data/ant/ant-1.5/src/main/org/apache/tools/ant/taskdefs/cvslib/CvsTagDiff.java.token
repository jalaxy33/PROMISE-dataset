package
org
apache
tools
ant
taskdefs
cvslib
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
taskdefs
Cvs
import
org
apache
tools
ant
util
FileUtils
import
java
io
BufferedReader
import
java
io
File
import
java
io
FileOutputStream
import
java
io
FileReader
import
java
io
IOException
import
java
io
OutputStreamWriter
import
java
io
PrintWriter
import
java
io
UnsupportedEncodingException
import
java
util
Vector
public
class
CvsTagDiff
extends
Task
static
final
String
FILE_IS_NEW
static
final
String
FILE_HAS_CHANGED
static
final
String
FILE_WAS_REMOVED
private
Cvs
m_cvs
private
String
m_package
private
String
m_startTag
private
String
m_endTag
private
String
m_startDate
private
String
m_endDate
private
File
m_destfile
private
FileUtils
m_fileUtils
FileUtils
newFileUtils
public
void
init
throws
BuildException
m_cvs
Cvs
getProject
createTask
public
void
setCompressionLevel
int
level
m_cvs
setCompressionLevel
level
public
void
setCompression
boolean
usecomp
m_cvs
setCompression
usecomp
public
void
setCvsRoot
String
cvsRoot
m_cvs
setCvsRoot
cvsRoot
public
void
setCvsRsh
String
rsh
m_cvs
setCvsRsh
rsh
public
void
setPackage
String
p
m_package
p
public
void
setQuiet
boolean
quiet
m_cvs
setQuiet
quiet
public
void
setPort
int
port
m_cvs
setPort
port
public
void
setPassfile
File
f
m_cvs
setPassfile
f
public
void
setFailOnError
boolean
b
m_cvs
setFailOnError
b
public
void
setStartTag
String
s
m_startTag
s
public
void
setStartDate
String
s
m_startDate
s
public
void
setEndTag
String
s
m_endTag
s
public
void
setEndDate
String
s
m_endDate
s
public
void
setDestFile
File
f
m_destfile
f
public
void
execute
throws
BuildException
validate
String
rdiff
m_startTag
m_startTag
m_startDate
m_endTag
m_endTag
m_endDate
m_package
log
rdiff
Project
MSG_VERBOSE
m_cvs
setCommand
rdiff
File
tmpFile
try
tmpFile
m_fileUtils
createTempFile
m_cvs
setOutput
tmpFile
m_cvs
execute
CvsTagEntry
entries
parseRDiff
tmpFile
writeTagDiff
entries
finally
if
tmpFile
tmpFile
delete
private
CvsTagEntry
parseRDiff
File
tmpFile
throws
BuildException
BufferedReader
reader
try
reader
new
BufferedReader
new
FileReader
tmpFile
int
headerLength
m_package
length
Vector
entries
new
Vector
String
line
reader
readLine
int
index
CvsTagEntry
entry
while
line
line
line
substring
headerLength
if
index
line
indexOf
FILE_IS_NEW
String
filename
line
substring
index
String
rev
line
substring
index
FILE_IS_NEW
length
entries
addElement
entry
new
CvsTagEntry
filename
rev
log
entry
toString
Project
MSG_VERBOSE
else
if
index
line
indexOf
FILE_HAS_CHANGED
String
filename
line
substring
index
int
revSeparator
line
indexOf
index
String
prevRevision
line
substring
index
FILE_HAS_CHANGED
length
revSeparator
String
revision
line
substring
revSeparator
entries
addElement
entry
new
CvsTagEntry
filename
revision
prevRevision
log
entry
toString
Project
MSG_VERBOSE
else
if
index
line
indexOf
FILE_WAS_REMOVED
String
filename
line
substring
index
entries
addElement
entry
new
CvsTagEntry
filename
log
entry
toString
Project
MSG_VERBOSE
line
reader
readLine
CvsTagEntry
array
new
CvsTagEntry
entries
size
entries
copyInto
array
return
array
catch
IOException
e
throw
new
BuildException
e
finally
if
reader
try
reader
close
catch
IOException
e
private
void
writeTagDiff
CvsTagEntry
entries
throws
BuildException
FileOutputStream
output
try
output
new
FileOutputStream
m_destfile
PrintWriter
writer
new
PrintWriter
new
OutputStreamWriter
output
writer
println
writer
print
if
m_startTag
writer
print
m_startTag
else
writer
print
m_startDate
if
m_endTag
writer
print
m_endTag
else
writer
print
m_endDate
writer
println
for
int
i
c
entries
length
i
c
i
writeTagEntry
writer
entries
i
writer
println
writer
flush
writer
close
catch
UnsupportedEncodingException
uee
log
uee
toString
Project
MSG_ERR
catch
IOException
ioe
throw
new
BuildException
ioe
toString
ioe
finally
if
output
try
output
close
catch
IOException
ioe
private
void
writeTagEntry
PrintWriter
writer
CvsTagEntry
entry
writer
println
writer
println
writer
println
entry
getFile
if
entry
getRevision
writer
println
entry
getRevision
if
entry
getPreviousRevision
writer
println
entry
getPreviousRevision
writer
println
writer
println
private
void
validate
throws
BuildException
if
m_package
throw
new
BuildException
if
m_destfile
throw
new
BuildException
if
m_startTag
m_startDate
throw
new
BuildException
if
m_startTag
m_startDate
throw
new
BuildException
if
m_endTag
m_endDate
throw
new
BuildException
if
m_endTag
m_endDate
throw
new
BuildException
