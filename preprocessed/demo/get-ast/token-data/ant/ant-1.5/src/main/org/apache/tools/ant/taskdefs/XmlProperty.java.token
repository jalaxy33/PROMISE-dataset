package
org
apache
tools
ant
taskdefs
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Project
import
org
w3c
dom
Element
import
org
w3c
dom
Node
import
org
w3c
dom
NodeList
import
org
xml
sax
SAXException
import
javax
xml
parsers
DocumentBuilder
import
javax
xml
parsers
DocumentBuilderFactory
import
javax
xml
parsers
FactoryConfigurationError
import
javax
xml
parsers
ParserConfigurationException
import
java
io
BufferedInputStream
import
java
io
File
import
java
io
FileInputStream
import
java
io
IOException
import
java
util
Vector
public
class
XmlProperty
extends
org
apache
tools
ant
Task
private
File
src
private
String
prefix
private
boolean
keepRoot
private
boolean
validate
private
boolean
collapseAttributes
private
org
w3c
dom
Document
document
public
XmlProperty
super
public
void
init
super
init
public
void
execute
throws
BuildException
BufferedInputStream
configurationStream
try
configurationStream
new
BufferedInputStream
new
FileInputStream
src
DocumentBuilderFactory
factory
DocumentBuilderFactory
newInstance
factory
setValidating
validate
factory
setNamespaceAware
DocumentBuilder
builder
factory
newDocumentBuilder
document
builder
parse
configurationStream
Element
topElement
document
getDocumentElement
NodeList
topChildren
topElement
getChildNodes
int
numChildren
topChildren
getLength
log
prefix
Project
MSG_DEBUG
if
keepRoot
addNodeRecursively
topElement
prefix
else
for
int
i
i
numChildren
i
addNodeRecursively
topChildren
item
i
prefix
catch
SAXException
sxe
Exception
x
sxe
if
sxe
getException
x
sxe
getException
throw
new
BuildException
x
catch
ParserConfigurationException
pce
throw
new
BuildException
pce
catch
IOException
ioe
throw
new
BuildException
ioe
finally
if
configurationStream
try
configurationStream
close
catch
Exception
e
void
addNodeRecursively
org
w3c
dom
Node
node
String
prefix
if
node
hasAttributes
org
w3c
dom
NamedNodeMap
nodeAttributes
node
getAttributes
for
int
i
i
nodeAttributes
getLength
i
Node
attributeNode
nodeAttributes
item
i
String
attributeName
if
collapseAttributes
attributeName
prefix
prefix
trim
equals
node
getNodeName
attributeNode
getNodeName
else
attributeName
prefix
prefix
trim
equals
node
getNodeName
attributeNode
getNodeName
String
attributeValue
attributeNode
getNodeValue
log
attributeName
attributeValue
Project
MSG_DEBUG
project
setNewProperty
attributeName
attributeValue
if
node
getNodeType
Node
TEXT_NODE
String
nodeText
node
getNodeValue
if
nodeText
trim
length
log
prefix
nodeText
Project
MSG_DEBUG
project
setNewProperty
prefix
nodeText
if
node
hasChildNodes
prefix
prefix
trim
equals
node
getNodeName
org
w3c
dom
NodeList
nodeChildren
node
getChildNodes
int
numChildren
nodeChildren
getLength
for
int
i
i
numChildren
i
addNodeRecursively
nodeChildren
item
i
prefix
public
void
setFile
File
src
this
src
src
public
void
setPrefix
String
prefix
this
prefix
prefix
trim
public
void
setKeeproot
boolean
keepRoot
this
keepRoot
keepRoot
public
void
setValidate
boolean
validate
this
validate
validate
public
void
setCollapseAttributes
boolean
collapseAttributes
this
collapseAttributes
collapseAttributes
