package
org
apache
tools
ant
import
org
apache
tools
ant
util
LoaderUtils
import
org
apache
tools
ant
util
FileUtils
import
org
apache
tools
ant
util
JAXPUtils
import
org
apache
tools
ant
util
ProxySetup
import
org
apache
tools
ant
util
JavaEnvUtils
import
org
apache
tools
ant
launch
Launcher
import
org
xml
sax
XMLReader
import
javax
xml
parsers
SAXParserFactory
import
javax
xml
parsers
SAXParser
import
java
io
File
import
java
io
FilenameFilter
import
java
io
PrintStream
import
java
io
InputStream
import
java
io
IOException
import
java
io
FileOutputStream
import
java
util
Enumeration
import
java
util
Properties
import
java
util
Calendar
import
java
util
TimeZone
import
java
lang
reflect
Method
import
java
lang
reflect
InvocationTargetException
public
final
class
Diagnostics
private
static
final
int
BIG_DRIFT_LIMIT
private
static
final
int
TEST_FILE_SIZE
private
static
final
int
KILOBYTE
private
static
final
int
SECONDS_PER_MILLISECOND
private
static
final
int
SECONDS_PER_MINUTE
private
static
final
int
MINUTES_PER_HOUR
private
static
final
String
TEST_CLASS
protected
static
final
String
ERROR_PROPERTY_ACCESS_BLOCKED
private
Diagnostics
public
static
boolean
isOptionalAvailable
try
Class
forName
TEST_CLASS
catch
ClassNotFoundException
e
return
return
public
static
void
validateVersion
throws
BuildException
try
Class
optional
Class
forName
TEST_CLASS
String
coreVersion
getImplementationVersion
Main
class
String
optionalVersion
getImplementationVersion
optional
if
coreVersion
coreVersion
equals
optionalVersion
throw
new
BuildException
coreVersion
optionalVersion
catch
ClassNotFoundException
e
ignoreThrowable
e
public
static
File
listLibraries
String
home
System
getProperty
MagicNames
ANT_HOME
if
home
return
File
libDir
new
File
home
return
listJarFiles
libDir
private
static
File
listJarFiles
File
libDir
FilenameFilter
filter
new
FilenameFilter
public
boolean
accept
File
dir
String
name
return
name
endsWith
File
files
libDir
listFiles
filter
return
files
public
static
void
main
String
args
doReport
System
out
private
static
String
getImplementationVersion
Class
clazz
Package
pkg
clazz
getPackage
return
pkg
getImplementationVersion
private
static
String
getXmlParserName
SAXParser
saxParser
getSAXParser
if
saxParser
return
String
saxParserName
saxParser
getClass
getName
return
saxParserName
private
static
SAXParser
getSAXParser
SAXParserFactory
saxParserFactory
SAXParserFactory
newInstance
if
saxParserFactory
return
SAXParser
saxParser
try
saxParser
saxParserFactory
newSAXParser
catch
Exception
e
ignoreThrowable
e
return
saxParser
private
static
String
getXMLParserLocation
SAXParser
saxParser
getSAXParser
if
saxParser
return
String
location
getClassLocation
saxParser
getClass
return
location
private
static
String
getNamespaceParserName
try
XMLReader
reader
JAXPUtils
getNamespaceXMLReader
return
reader
getClass
getName
catch
BuildException
e
ignoreThrowable
e
return
private
static
String
getNamespaceParserLocation
try
XMLReader
reader
JAXPUtils
getNamespaceXMLReader
return
getClassLocation
reader
getClass
catch
BuildException
e
ignoreThrowable
e
return
private
static
void
ignoreThrowable
Throwable
thrown
private
static
String
getClassLocation
Class
clazz
File
f
LoaderUtils
getClassSource
clazz
return
f
f
getAbsolutePath
public
static
void
doReport
PrintStream
out
out
println
out
println
Main
getAntVersion
header
out
out
println
getImplementationVersion
Main
class
Class
optional
try
optional
Class
forName
TEST_CLASS
out
println
getImplementationVersion
optional
catch
ClassNotFoundException
e
ignoreThrowable
e
out
println
header
out
doReportAntProperties
out
header
out
doReportAntHomeLibraries
out
header
out
doReportUserHomeLibraries
out
header
out
doReportTasksAvailability
out
header
out
doReportWhich
out
header
out
doReportParserInfo
out
header
out
doReportSystemProperties
out
header
out
doReportTempDir
out
header
out
doReportLocale
out
header
out
doReportProxy
out
out
println
private
static
void
header
PrintStream
out
String
section
out
println
out
println
out
print
out
println
section
out
println
private
static
void
doReportSystemProperties
PrintStream
out
Properties
sysprops
try
sysprops
System
getProperties
catch
SecurityException
e
ignoreThrowable
e
out
println
for
Enumeration
keys
sysprops
propertyNames
keys
hasMoreElements
String
key
String
keys
nextElement
String
value
getProperty
key
out
println
key
value
private
static
String
getProperty
String
key
String
value
try
value
System
getProperty
key
catch
SecurityException
e
value
ERROR_PROPERTY_ACCESS_BLOCKED
return
value
private
static
void
doReportAntProperties
PrintStream
out
Project
p
new
Project
p
initProperties
out
println
MagicNames
ANT_VERSION
p
getProperty
MagicNames
ANT_VERSION
out
println
MagicNames
ANT_JAVA_VERSION
p
getProperty
MagicNames
ANT_JAVA_VERSION
out
println
MagicNames
ANT_LIB
p
getProperty
MagicNames
ANT_LIB
out
println
MagicNames
ANT_HOME
p
getProperty
MagicNames
ANT_HOME
private
static
void
doReportAntHomeLibraries
PrintStream
out
out
println
MagicNames
ANT_HOME
System
getProperty
MagicNames
ANT_HOME
File
libs
listLibraries
printLibraries
libs
out
private
static
void
doReportUserHomeLibraries
PrintStream
out
String
home
System
getProperty
Launcher
USER_HOMEDIR
out
println
home
File
libDir
new
File
home
Launcher
USER_LIBDIR
File
libs
listJarFiles
libDir
printLibraries
libs
out
private
static
void
printLibraries
File
libs
PrintStream
out
if
libs
out
println
return
for
int
i
i
libs
length
i
out
println
libs
i
getName
libs
i
length
private
static
void
doReportWhich
PrintStream
out
Throwable
error
try
Class
which
Class
forName
Method
method
which
getMethod
new
Class
String
class
method
invoke
new
Object
new
String
catch
ClassNotFoundException
e
out
println
out
println
catch
InvocationTargetException
e
error
e
getTargetException
e
e
getTargetException
catch
Throwable
e
error
e
if
error
out
println
error
printStackTrace
private
static
void
doReportTasksAvailability
PrintStream
out
InputStream
is
Main
class
getResourceAsStream
MagicNames
TASKDEF_PROPERTIES_RESOURCE
if
is
out
println
else
Properties
props
new
Properties
try
props
load
is
for
Enumeration
keys
props
keys
keys
hasMoreElements
String
key
String
keys
nextElement
String
classname
props
getProperty
key
try
Class
forName
classname
props
remove
key
catch
ClassNotFoundException
e
out
println
key
catch
NoClassDefFoundError
e
String
pkg
e
getMessage
replace
out
println
key
pkg
catch
LinkageError
e
out
println
key
if
props
size
out
println
else
out
println
catch
IOException
e
out
println
e
getMessage
private
static
void
doReportParserInfo
PrintStream
out
String
parserName
getXmlParserName
String
parserLocation
getXMLParserLocation
printParserInfo
out
parserName
parserLocation
printParserInfo
out
getNamespaceParserName
getNamespaceParserLocation
private
static
void
printParserInfo
PrintStream
out
String
parserType
String
parserName
String
parserLocation
if
parserName
parserName
if
parserLocation
parserLocation
out
println
parserType
parserName
out
println
parserType
parserLocation
private
static
void
doReportTempDir
PrintStream
out
String
tempdir
System
getProperty
if
tempdir
out
println
return
out
println
tempdir
File
tempDirectory
new
File
tempdir
if
tempDirectory
exists
out
println
tempdir
return
long
now
System
currentTimeMillis
File
tempFile
FileOutputStream
fileout
try
tempFile
File
createTempFile
tempDirectory
fileout
new
FileOutputStream
tempFile
byte
buffer
new
byte
KILOBYTE
for
int
i
i
TEST_FILE_SIZE
i
fileout
write
buffer
fileout
close
fileout
long
filetime
tempFile
lastModified
tempFile
delete
out
println
long
drift
filetime
now
out
println
drift
if
Math
abs
drift
BIG_DRIFT_LIMIT
out
println
catch
IOException
e
ignoreThrowable
e
out
println
tempdir
out
println
tempFile
finally
FileUtils
close
fileout
if
tempFile
tempFile
exists
tempFile
delete
private
static
void
doReportLocale
PrintStream
out
Calendar
cal
Calendar
getInstance
TimeZone
tz
cal
getTimeZone
out
println
tz
getDisplayName
tz
getOffset
cal
get
Calendar
ERA
cal
get
Calendar
YEAR
cal
get
Calendar
MONTH
cal
get
Calendar
DAY_OF_MONTH
cal
get
Calendar
DAY_OF_WEEK
cal
get
Calendar
HOUR_OF_DAY
MINUTES_PER_HOUR
cal
get
Calendar
MINUTE
SECONDS_PER_MINUTE
cal
get
Calendar
SECOND
SECONDS_PER_MILLISECOND
cal
get
Calendar
MILLISECOND
private
static
void
printProperty
PrintStream
out
String
key
String
value
getProperty
key
if
value
out
print
key
out
print
out
print
out
print
value
out
println
private
static
void
doReportProxy
PrintStream
out
printProperty
out
ProxySetup
HTTP_PROXY_HOST
printProperty
out
ProxySetup
HTTP_PROXY_PORT
printProperty
out
ProxySetup
HTTP_PROXY_USERNAME
printProperty
out
ProxySetup
HTTP_PROXY_PASSWORD
printProperty
out
ProxySetup
HTTP_NON_PROXY_HOSTS
printProperty
out
ProxySetup
HTTPS_PROXY_HOST
printProperty
out
ProxySetup
HTTPS_PROXY_PORT
printProperty
out
ProxySetup
HTTPS_NON_PROXY_HOSTS
printProperty
out
ProxySetup
FTP_PROXY_HOST
printProperty
out
ProxySetup
FTP_PROXY_PORT
printProperty
out
ProxySetup
FTP_NON_PROXY_HOSTS
printProperty
out
ProxySetup
SOCKS_PROXY_HOST
printProperty
out
ProxySetup
SOCKS_PROXY_PORT
printProperty
out
ProxySetup
SOCKS_PROXY_USERNAME
printProperty
out
ProxySetup
SOCKS_PROXY_PASSWORD
if
JavaEnvUtils
getJavaVersionNumber
return
printProperty
out
ProxySetup
USE_SYSTEM_PROXIES
final
String
proxyDiagClassname
try
Class
proxyDiagClass
Class
forName
proxyDiagClassname
Object
instance
proxyDiagClass
newInstance
out
println
out
println
instance
toString
catch
ClassNotFoundException
e
catch
IllegalAccessException
e
catch
InstantiationException
e
catch
NoClassDefFoundError
e
