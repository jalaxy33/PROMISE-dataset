package
org
apache
tools
ant
taskdefs
import
java
io
File
import
java
io
FileInputStream
import
java
io
FileOutputStream
import
java
io
IOException
import
java
util
Properties
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
util
FileUtils
public
class
BuildNumber
extends
Task
private
static
final
String
DEFAULT_PROPERTY_NAME
private
static
final
String
DEFAULT_FILENAME
DEFAULT_PROPERTY_NAME
private
static
final
FileUtils
FILE_UTILS
FileUtils
getFileUtils
private
File
myFile
public
void
setFile
final
File
file
myFile
file
public
void
execute
throws
BuildException
File
savedFile
myFile
validate
final
Properties
properties
loadProperties
final
int
buildNumber
getBuildNumber
properties
properties
put
DEFAULT_PROPERTY_NAME
String
valueOf
buildNumber
FileOutputStream
output
try
output
new
FileOutputStream
myFile
final
String
header
properties
store
output
header
catch
final
IOException
ioe
final
String
message
myFile
throw
new
BuildException
message
ioe
finally
if
output
try
output
close
catch
final
IOException
ioe
log
ioe
Project
MSG_ERR
myFile
savedFile
getProject
setNewProperty
DEFAULT_PROPERTY_NAME
String
valueOf
buildNumber
private
int
getBuildNumber
final
Properties
properties
throws
BuildException
final
String
buildNumber
properties
getProperty
DEFAULT_PROPERTY_NAME
trim
try
return
Integer
parseInt
buildNumber
catch
final
NumberFormatException
nfe
final
String
message
myFile
buildNumber
throw
new
BuildException
message
nfe
private
Properties
loadProperties
throws
BuildException
FileInputStream
input
try
final
Properties
properties
new
Properties
input
new
FileInputStream
myFile
properties
load
input
return
properties
catch
final
IOException
ioe
throw
new
BuildException
ioe
finally
if
input
try
input
close
catch
final
IOException
ioe
log
ioe
Project
MSG_ERR
private
void
validate
throws
BuildException
if
myFile
myFile
FILE_UTILS
resolveFile
getProject
getBaseDir
DEFAULT_FILENAME
if
myFile
exists
try
FILE_UTILS
createNewFile
myFile
catch
final
IOException
ioe
final
String
message
myFile
throw
new
BuildException
message
ioe
if
myFile
canRead
final
String
message
myFile
throw
new
BuildException
message
if
myFile
canWrite
final
String
message
myFile
throw
new
BuildException
message
