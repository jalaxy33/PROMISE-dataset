package
org
apache
tools
ant
taskdefs
optional
ejb
import
java
io
File
import
java
io
FileInputStream
import
java
io
FileNotFoundException
import
java
io
IOException
import
java
io
InputStream
import
java
net
URL
import
java
util
Hashtable
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
Task
import
org
xml
sax
AttributeList
import
org
xml
sax
InputSource
import
org
xml
sax
SAXException
public
class
DescriptorHandler
extends
org
xml
sax
HandlerBase
private
static
final
int
DEFAULT_HASH_TABLE_SIZE
private
static
final
int
STATE_LOOKING_EJBJAR
private
static
final
int
STATE_IN_EJBJAR
private
static
final
int
STATE_IN_BEANS
private
static
final
int
STATE_IN_SESSION
private
static
final
int
STATE_IN_ENTITY
private
static
final
int
STATE_IN_MESSAGE
private
Task
owningTask
private
String
publicId
private
static
final
String
EJB_REF
private
static
final
String
EJB_LOCAL_REF
private
static
final
String
HOME_INTERFACE
private
static
final
String
REMOTE_INTERFACE
private
static
final
String
LOCAL_HOME_INTERFACE
private
static
final
String
LOCAL_INTERFACE
private
static
final
String
BEAN_CLASS
private
static
final
String
PK_CLASS
private
static
final
String
EJB_NAME
private
static
final
String
EJB_JAR
private
static
final
String
ENTERPRISE_BEANS
private
static
final
String
ENTITY_BEAN
private
static
final
String
SESSION_BEAN
private
static
final
String
MESSAGE_BEAN
private
int
parseState
STATE_LOOKING_EJBJAR
protected
String
currentElement
protected
String
currentText
protected
Hashtable
ejbFiles
protected
String
ejbName
private
Hashtable
fileDTDs
new
Hashtable
private
Hashtable
resourceDTDs
new
Hashtable
private
boolean
inEJBRef
private
Hashtable
urlDTDs
new
Hashtable
private
File
srcDir
public
DescriptorHandler
Task
task
File
srcDir
this
owningTask
task
this
srcDir
srcDir
public
void
registerDTD
String
publicId
String
location
if
location
return
File
fileDTD
new
File
location
if
fileDTD
exists
fileDTD
owningTask
getProject
resolveFile
location
if
fileDTD
exists
if
publicId
fileDTDs
put
publicId
fileDTD
owningTask
log
publicId
fileDTD
Project
MSG_VERBOSE
return
if
getClass
getResource
location
if
publicId
resourceDTDs
put
publicId
location
owningTask
log
publicId
location
Project
MSG_VERBOSE
try
if
publicId
URL
urldtd
new
URL
location
urlDTDs
put
publicId
urldtd
catch
java
net
MalformedURLException
e
public
InputSource
resolveEntity
String
publicId
String
systemId
throws
SAXException
this
publicId
publicId
File
dtdFile
File
fileDTDs
get
publicId
if
dtdFile
try
owningTask
log
publicId
dtdFile
Project
MSG_VERBOSE
return
new
InputSource
new
FileInputStream
dtdFile
catch
FileNotFoundException
ex
String
dtdResourceName
String
resourceDTDs
get
publicId
if
dtdResourceName
InputStream
is
this
getClass
getResourceAsStream
dtdResourceName
if
is
owningTask
log
publicId
dtdResourceName
Project
MSG_VERBOSE
return
new
InputSource
is
URL
dtdUrl
URL
urlDTDs
get
publicId
if
dtdUrl
try
InputStream
is
dtdUrl
openStream
owningTask
log
publicId
dtdUrl
Project
MSG_VERBOSE
return
new
InputSource
is
catch
IOException
ioe
owningTask
log
publicId
systemId
Project
MSG_INFO
return
public
Hashtable
getFiles
return
ejbFiles
new
Hashtable
ejbFiles
public
String
getPublicId
return
publicId
public
String
getEjbName
return
ejbName
public
void
startDocument
throws
SAXException
this
ejbFiles
new
Hashtable
DEFAULT_HASH_TABLE_SIZE
this
currentElement
inEJBRef
public
void
startElement
String
name
AttributeList
attrs
throws
SAXException
this
currentElement
name
currentText
if
name
equals
EJB_REF
name
equals
EJB_LOCAL_REF
inEJBRef
else
if
parseState
STATE_LOOKING_EJBJAR
name
equals
EJB_JAR
parseState
STATE_IN_EJBJAR
else
if
parseState
STATE_IN_EJBJAR
name
equals
ENTERPRISE_BEANS
parseState
STATE_IN_BEANS
else
if
parseState
STATE_IN_BEANS
name
equals
SESSION_BEAN
parseState
STATE_IN_SESSION
else
if
parseState
STATE_IN_BEANS
name
equals
ENTITY_BEAN
parseState
STATE_IN_ENTITY
else
if
parseState
STATE_IN_BEANS
name
equals
MESSAGE_BEAN
parseState
STATE_IN_MESSAGE
public
void
endElement
String
name
throws
SAXException
processElement
currentText
this
currentElement
if
name
equals
EJB_REF
name
equals
EJB_LOCAL_REF
inEJBRef
else
if
parseState
STATE_IN_ENTITY
name
equals
ENTITY_BEAN
parseState
STATE_IN_BEANS
else
if
parseState
STATE_IN_SESSION
name
equals
SESSION_BEAN
parseState
STATE_IN_BEANS
else
if
parseState
STATE_IN_MESSAGE
name
equals
MESSAGE_BEAN
parseState
STATE_IN_BEANS
else
if
parseState
STATE_IN_BEANS
name
equals
ENTERPRISE_BEANS
parseState
STATE_IN_EJBJAR
else
if
parseState
STATE_IN_EJBJAR
name
equals
EJB_JAR
parseState
STATE_LOOKING_EJBJAR
public
void
characters
char
ch
int
start
int
length
throws
SAXException
currentText
new
String
ch
start
length
protected
void
processElement
if
inEJBRef
parseState
STATE_IN_ENTITY
parseState
STATE_IN_SESSION
parseState
STATE_IN_MESSAGE
return
if
currentElement
equals
HOME_INTERFACE
currentElement
equals
REMOTE_INTERFACE
currentElement
equals
LOCAL_INTERFACE
currentElement
equals
LOCAL_HOME_INTERFACE
currentElement
equals
BEAN_CLASS
currentElement
equals
PK_CLASS
File
classFile
String
className
currentText
trim
if
className
startsWith
className
startsWith
className
className
replace
File
separatorChar
className
classFile
new
File
srcDir
className
ejbFiles
put
className
classFile
if
currentElement
equals
EJB_NAME
if
ejbName
ejbName
currentText
trim
