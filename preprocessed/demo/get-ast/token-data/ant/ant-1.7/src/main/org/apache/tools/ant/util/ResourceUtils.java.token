package
org
apache
tools
ant
util
import
java
io
File
import
java
io
Reader
import
java
io
InputStream
import
java
io
IOException
import
java
io
OutputStream
import
java
io
BufferedReader
import
java
io
BufferedWriter
import
java
io
InputStreamReader
import
java
io
OutputStreamWriter
import
java
io
BufferedInputStream
import
java
util
Arrays
import
java
util
Vector
import
java
util
Iterator
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
ProjectComponent
import
org
apache
tools
ant
filters
util
ChainReaderHelper
import
org
apache
tools
ant
types
Resource
import
org
apache
tools
ant
types
TimeComparison
import
org
apache
tools
ant
types
ResourceFactory
import
org
apache
tools
ant
types
ResourceCollection
import
org
apache
tools
ant
types
FilterSetCollection
import
org
apache
tools
ant
types
resources
Union
import
org
apache
tools
ant
types
resources
Restrict
import
org
apache
tools
ant
types
resources
Resources
import
org
apache
tools
ant
types
resources
Touchable
import
org
apache
tools
ant
types
resources
selectors
Or
import
org
apache
tools
ant
types
resources
selectors
And
import
org
apache
tools
ant
types
resources
selectors
Not
import
org
apache
tools
ant
types
resources
selectors
Date
import
org
apache
tools
ant
types
resources
selectors
Type
import
org
apache
tools
ant
types
resources
selectors
Exists
import
org
apache
tools
ant
types
resources
selectors
ResourceSelector
import
org
apache
tools
ant
types
selectors
SelectorUtils
public
class
ResourceUtils
private
static
final
class
Outdated
implements
ResourceSelector
private
Resource
control
private
long
granularity
private
Outdated
Resource
control
long
granularity
this
control
control
this
granularity
granularity
public
boolean
isSelected
Resource
r
return
SelectorUtils
isOutOfDate
control
r
granularity
private
static
final
FileUtils
FILE_UTILS
FileUtils
getFileUtils
private
static
final
ResourceSelector
NOT_EXISTS
new
Not
new
Exists
public
static
Resource
selectOutOfDateSources
ProjectComponent
logTo
Resource
source
FileNameMapper
mapper
ResourceFactory
targets
return
selectOutOfDateSources
logTo
source
mapper
targets
FILE_UTILS
getFileTimestampGranularity
public
static
Resource
selectOutOfDateSources
ProjectComponent
logTo
Resource
source
FileNameMapper
mapper
ResourceFactory
targets
long
granularity
Union
u
new
Union
u
addAll
Arrays
asList
source
ResourceCollection
rc
selectOutOfDateSources
logTo
u
mapper
targets
granularity
return
rc
size
new
Resource
Union
rc
listResources
public
static
ResourceCollection
selectOutOfDateSources
ProjectComponent
logTo
ResourceCollection
source
FileNameMapper
mapper
ResourceFactory
targets
long
granularity
if
source
size
logTo
log
Project
MSG_VERBOSE
return
Resources
NONE
source
Union
getInstance
source
logFuture
logTo
source
granularity
Union
result
new
Union
for
Iterator
iter
source
iterator
iter
hasNext
Resource
sr
Resource
iter
next
String
srName
sr
getName
srName
srName
srName
srName
replace
File
separatorChar
String
targetnames
try
targetnames
mapper
mapFileName
srName
catch
Exception
e
logTo
log
e
sr
Project
MSG_VERBOSE
if
targetnames
targetnames
length
logTo
log
sr
Project
MSG_VERBOSE
continue
Union
targetColl
new
Union
for
int
i
i
targetnames
length
i
targetColl
add
targets
getResource
targetnames
i
replace
File
separatorChar
Restrict
r
new
Restrict
r
add
new
And
new
ResourceSelector
Type
FILE
new
Or
new
ResourceSelector
NOT_EXISTS
new
Outdated
sr
granularity
r
add
targetColl
if
r
size
result
add
sr
Resource
t
Resource
r
iterator
next
logTo
log
sr
getName
t
getName
t
isExists
Project
MSG_VERBOSE
continue
logTo
log
sr
getName
targetColl
toString
targetColl
size
Project
MSG_VERBOSE
return
result
public
static
void
copyResource
Resource
source
Resource
dest
throws
IOException
copyResource
source
dest
public
static
void
copyResource
Resource
source
Resource
dest
Project
project
throws
IOException
copyResource
source
dest
project
public
static
void
copyResource
Resource
source
Resource
dest
FilterSetCollection
filters
Vector
filterChains
boolean
overwrite
boolean
preserveLastModified
String
inputEncoding
String
outputEncoding
Project
project
throws
IOException
if
overwrite
long
slm
source
getLastModified
if
dest
isExists
slm
dest
getLastModified
slm
return
final
boolean
filterSetsAvailable
filters
filters
hasFilters
final
boolean
filterChainsAvailable
filterChains
filterChains
size
if
filterSetsAvailable
BufferedReader
in
BufferedWriter
out
try
InputStreamReader
isr
if
inputEncoding
isr
new
InputStreamReader
source
getInputStream
else
isr
new
InputStreamReader
source
getInputStream
inputEncoding
in
new
BufferedReader
isr
OutputStreamWriter
osw
if
outputEncoding
osw
new
OutputStreamWriter
dest
getOutputStream
else
osw
new
OutputStreamWriter
dest
getOutputStream
outputEncoding
out
new
BufferedWriter
osw
if
filterChainsAvailable
ChainReaderHelper
crh
new
ChainReaderHelper
crh
setBufferSize
FileUtils
BUF_SIZE
crh
setPrimaryReader
in
crh
setFilterChains
filterChains
crh
setProject
project
Reader
rdr
crh
getAssembledReader
in
new
BufferedReader
rdr
LineTokenizer
lineTokenizer
new
LineTokenizer
lineTokenizer
setIncludeDelims
String
newline
String
line
lineTokenizer
getToken
in
while
line
if
line
length
out
newLine
else
newline
filters
replaceTokens
line
out
write
newline
line
lineTokenizer
getToken
in
finally
FileUtils
close
out
FileUtils
close
in
else
if
filterChainsAvailable
inputEncoding
inputEncoding
equals
outputEncoding
inputEncoding
outputEncoding
BufferedReader
in
BufferedWriter
out
try
InputStreamReader
isr
if
inputEncoding
isr
new
InputStreamReader
source
getInputStream
else
isr
new
InputStreamReader
source
getInputStream
inputEncoding
in
new
BufferedReader
isr
OutputStreamWriter
osw
if
outputEncoding
osw
new
OutputStreamWriter
dest
getOutputStream
else
osw
new
OutputStreamWriter
dest
getOutputStream
outputEncoding
out
new
BufferedWriter
osw
if
filterChainsAvailable
ChainReaderHelper
crh
new
ChainReaderHelper
crh
setBufferSize
FileUtils
BUF_SIZE
crh
setPrimaryReader
in
crh
setFilterChains
filterChains
crh
setProject
project
Reader
rdr
crh
getAssembledReader
in
new
BufferedReader
rdr
char
buffer
new
char
FileUtils
BUF_SIZE
while
int
nRead
in
read
buffer
buffer
length
if
nRead
break
out
write
buffer
nRead
finally
FileUtils
close
out
FileUtils
close
in
else
InputStream
in
OutputStream
out
try
in
source
getInputStream
out
dest
getOutputStream
byte
buffer
new
byte
FileUtils
BUF_SIZE
int
count
do
out
write
buffer
count
count
in
read
buffer
buffer
length
while
count
finally
FileUtils
close
out
FileUtils
close
in
if
preserveLastModified
dest
instanceof
Touchable
setLastModified
Touchable
dest
source
getLastModified
public
static
void
setLastModified
Touchable
t
long
time
t
touch
time
System
currentTimeMillis
time
public
static
boolean
contentEquals
Resource
r1
Resource
r2
boolean
text
throws
IOException
if
r1
isExists
r2
isExists
return
if
r1
isExists
return
if
r1
isDirectory
r2
isDirectory
return
if
r1
equals
r2
return
if
text
r1
getSize
r2
getSize
return
return
compareContent
r1
r2
text
public
static
int
compareContent
Resource
r1
Resource
r2
boolean
text
throws
IOException
if
r1
equals
r2
return
boolean
e1
r1
isExists
boolean
e2
r2
isExists
if
e1
e2
return
if
e1
e2
return
e1
boolean
d1
r1
isDirectory
boolean
d2
r2
isDirectory
if
d1
d2
return
if
d1
d2
return
d1
return
text
textCompare
r1
r2
binaryCompare
r1
r2
private
static
int
binaryCompare
Resource
r1
Resource
r2
throws
IOException
InputStream
in1
InputStream
in2
try
in1
new
BufferedInputStream
r1
getInputStream
in2
new
BufferedInputStream
r2
getInputStream
for
int
b1
in1
read
b1
b1
in1
read
int
b2
in2
read
if
b1
b2
return
b1
b2
return
in2
read
finally
FileUtils
close
in1
FileUtils
close
in2
private
static
int
textCompare
Resource
r1
Resource
r2
throws
IOException
BufferedReader
in1
BufferedReader
in2
try
in1
new
BufferedReader
new
InputStreamReader
r1
getInputStream
in2
new
BufferedReader
new
InputStreamReader
r2
getInputStream
String
expected
in1
readLine
while
expected
String
actual
in2
readLine
if
expected
equals
actual
return
expected
compareTo
actual
expected
in1
readLine
return
in2
readLine
finally
FileUtils
close
in1
FileUtils
close
in2
private
static
void
logFuture
ProjectComponent
logTo
ResourceCollection
rc
long
granularity
long
now
System
currentTimeMillis
granularity
Date
sel
new
Date
sel
setMillis
now
sel
setWhen
TimeComparison
AFTER
Restrict
future
new
Restrict
future
add
sel
future
add
rc
for
Iterator
iter
future
iterator
iter
hasNext
logTo
log
Resource
iter
next
getName
Project
MSG_WARN
