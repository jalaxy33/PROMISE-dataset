package
org
apache
tools
ant
taskdefs
optional
ssh
import
java
io
File
import
java
io
IOException
import
com
jcraft
jsch
JSchException
import
com
jcraft
jsch
Session
import
com
jcraft
jsch
ChannelSftp
import
com
jcraft
jsch
SftpException
import
com
jcraft
jsch
SftpATTRS
import
com
jcraft
jsch
SftpProgressMonitor
public
class
ScpFromMessageBySftp
extends
ScpFromMessage
private
String
remoteFile
private
File
localFile
private
boolean
isRecursive
private
boolean
verbose
public
ScpFromMessageBySftp
boolean
verbose
Session
session
String
aRemoteFile
File
aLocalFile
boolean
recursive
super
verbose
session
this
verbose
verbose
this
remoteFile
aRemoteFile
this
localFile
aLocalFile
this
isRecursive
recursive
public
ScpFromMessageBySftp
Session
session
String
aRemoteFile
File
aLocalFile
boolean
recursive
this
session
aRemoteFile
aLocalFile
recursive
public
void
execute
throws
IOException
JSchException
ChannelSftp
channel
openSftpChannel
try
channel
connect
try
SftpATTRS
attrs
channel
stat
remoteFile
if
attrs
isDir
remoteFile
endsWith
remoteFile
remoteFile
catch
SftpException
ee
getDir
channel
remoteFile
localFile
catch
SftpException
e
throw
new
JSchException
e
toString
finally
if
channel
channel
disconnect
log
private
void
getDir
ChannelSftp
channel
String
remoteFile
File
localFile
throws
IOException
SftpException
String
pwd
remoteFile
if
remoteFile
lastIndexOf
if
remoteFile
length
pwd
remoteFile
substring
remoteFile
lastIndexOf
channel
cd
pwd
if
localFile
exists
localFile
mkdirs
java
util
Vector
files
channel
ls
remoteFile
for
int
i
i
files
size
i
ChannelSftp
LsEntry
le
ChannelSftp
LsEntry
files
elementAt
i
String
name
le
getFilename
if
le
getAttrs
isDir
if
name
equals
name
equals
continue
getDir
channel
channel
pwd
name
new
File
localFile
le
getFilename
else
getFile
channel
le
localFile
channel
cd
private
void
getFile
ChannelSftp
channel
ChannelSftp
LsEntry
le
File
localFile
throws
IOException
SftpException
String
remoteFile
le
getFilename
if
localFile
exists
String
path
localFile
getAbsolutePath
int
i
if
i
path
lastIndexOf
File
pathSeparator
if
path
length
File
pathSeparator
length
new
File
path
substring
i
mkdirs
if
localFile
isDirectory
localFile
new
File
localFile
remoteFile
long
startTime
System
currentTimeMillis
long
totalLength
le
getAttrs
getSize
SftpProgressMonitor
monitor
boolean
trackProgress
getVerbose
totalLength
if
trackProgress
monitor
getProgressMonitor
try
log
remoteFile
le
getAttrs
getSize
channel
get
remoteFile
localFile
getAbsolutePath
monitor
finally
long
endTime
System
currentTimeMillis
logStats
startTime
endTime
int
totalLength
