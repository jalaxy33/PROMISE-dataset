package
org
apache
tools
ant
taskdefs
import
java
io
File
import
java
util
HashSet
import
java
util
Iterator
import
java
util
Map
import
java
util
Set
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
DirectoryScanner
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
types
AbstractFileSet
import
org
apache
tools
ant
types
FileSet
import
org
apache
tools
ant
types
PatternSet
import
org
apache
tools
ant
types
Resource
import
org
apache
tools
ant
types
ResourceCollection
import
org
apache
tools
ant
types
selectors
FileSelector
import
org
apache
tools
ant
types
selectors
NoneSelector
public
class
Sync
extends
Task
private
MyCopy
myCopy
private
SyncTarget
syncTarget
public
void
init
throws
BuildException
myCopy
new
MyCopy
configureTask
myCopy
myCopy
setFiltering
myCopy
setIncludeEmptyDirs
myCopy
setPreserveLastModified
private
void
configureTask
Task
helper
helper
setProject
getProject
helper
setTaskName
getTaskName
helper
setOwningTarget
getOwningTarget
helper
init
public
void
execute
throws
BuildException
File
toDir
myCopy
getToDir
Set
allFiles
myCopy
nonOrphans
boolean
noRemovalNecessary
toDir
exists
toDir
list
length
log
toDir
Project
MSG_DEBUG
myCopy
execute
if
noRemovalNecessary
log
toDir
Project
MSG_DEBUG
return
log
toDir
Project
MSG_DEBUG
int
removedFileCount
removeOrphanFiles
allFiles
toDir
logRemovedCount
removedFileCount
logRemovedCount
removedFileCount
if
myCopy
getIncludeEmptyDirs
log
toDir
Project
MSG_DEBUG
int
removedDirCount
removeEmptyDirectories
toDir
logRemovedCount
removedDirCount
private
void
logRemovedCount
int
count
String
prefix
String
singularSuffix
String
pluralSuffix
File
toDir
myCopy
getToDir
String
what
prefix
prefix
what
count
singularSuffix
pluralSuffix
if
count
log
count
what
toDir
Project
MSG_INFO
else
log
what
toDir
Project
MSG_VERBOSE
private
int
removeOrphanFiles
Set
nonOrphans
File
toDir
int
removedCount
new
int
String
excls
String
nonOrphans
toArray
new
String
nonOrphans
size
excls
nonOrphans
size
DirectoryScanner
ds
if
syncTarget
FileSet
fs
new
FileSet
fs
setDir
toDir
fs
setCaseSensitive
syncTarget
isCaseSensitive
fs
setFollowSymlinks
syncTarget
isFollowSymlinks
PatternSet
ps
syncTarget
mergePatterns
getProject
fs
appendExcludes
ps
getIncludePatterns
getProject
fs
appendIncludes
ps
getExcludePatterns
getProject
fs
setDefaultexcludes
syncTarget
getDefaultexcludes
FileSelector
s
syncTarget
getSelectors
getProject
if
s
length
NoneSelector
ns
new
NoneSelector
for
int
i
i
s
length
i
ns
appendSelector
s
i
fs
appendSelector
ns
ds
fs
getDirectoryScanner
getProject
else
ds
new
DirectoryScanner
ds
setBasedir
toDir
ds
addExcludes
excls
ds
scan
String
files
ds
getIncludedFiles
for
int
i
i
files
length
i
File
f
new
File
toDir
files
i
log
f
Project
MSG_DEBUG
f
delete
removedCount
String
dirs
ds
getIncludedDirectories
for
int
i
dirs
length
i
i
File
f
new
File
toDir
dirs
i
if
f
list
length
log
f
Project
MSG_DEBUG
f
delete
removedCount
return
removedCount
private
int
removeEmptyDirectories
File
dir
boolean
removeIfEmpty
int
removedCount
if
dir
isDirectory
File
children
dir
listFiles
for
int
i
i
children
length
i
File
file
children
i
if
file
isDirectory
removedCount
removeEmptyDirectories
file
if
children
length
children
dir
listFiles
if
children
length
removeIfEmpty
log
dir
Project
MSG_DEBUG
dir
delete
removedCount
return
removedCount
public
void
setTodir
File
destDir
myCopy
setTodir
destDir
public
void
setVerbose
boolean
verbose
myCopy
setVerbose
verbose
public
void
setOverwrite
boolean
overwrite
myCopy
setOverwrite
overwrite
public
void
setIncludeEmptyDirs
boolean
includeEmpty
myCopy
setIncludeEmptyDirs
includeEmpty
public
void
setFailOnError
boolean
failonerror
myCopy
setFailOnError
failonerror
public
void
addFileset
FileSet
set
add
set
public
void
add
ResourceCollection
rc
myCopy
add
rc
public
void
setGranularity
long
granularity
myCopy
setGranularity
granularity
public
void
addPreserveInTarget
SyncTarget
s
if
syncTarget
throw
new
BuildException
syncTarget
s
public
static
class
MyCopy
extends
Copy
private
Set
nonOrphans
new
HashSet
public
MyCopy
protected
void
scan
File
fromDir
File
toDir
String
files
String
dirs
assertTrue
mapperElement
super
scan
fromDir
toDir
files
dirs
for
int
i
i
files
length
i
nonOrphans
add
files
i
for
int
i
i
dirs
length
i
nonOrphans
add
dirs
i
protected
Map
scan
Resource
resources
File
toDir
assertTrue
mapperElement
Map
m
super
scan
resources
toDir
Iterator
iter
m
keySet
iterator
while
iter
hasNext
nonOrphans
add
Resource
iter
next
getName
return
m
public
File
getToDir
return
destDir
public
boolean
getIncludeEmptyDirs
return
includeEmpty
protected
boolean
supportsNonFileResources
return
public
static
class
SyncTarget
extends
AbstractFileSet
public
SyncTarget
super
public
void
setDir
File
dir
throws
BuildException
throw
new
BuildException
private
static
void
assertTrue
String
message
boolean
condition
if
condition
throw
new
BuildException
message
