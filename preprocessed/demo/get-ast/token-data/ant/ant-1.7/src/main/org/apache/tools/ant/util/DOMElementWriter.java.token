package
org
apache
tools
ant
util
import
java
io
IOException
import
java
io
OutputStream
import
java
io
OutputStreamWriter
import
java
io
Writer
import
java
util
ArrayList
import
java
util
HashMap
import
java
util
Iterator
import
org
w3c
dom
Attr
import
org
w3c
dom
Element
import
org
w3c
dom
NamedNodeMap
import
org
w3c
dom
Node
import
org
w3c
dom
NodeList
import
org
w3c
dom
Text
public
class
DOMElementWriter
private
static
final
String
NS
private
boolean
xmlDeclaration
private
XmlNamespacePolicy
namespacePolicy
XmlNamespacePolicy
IGNORE
private
HashMap
nsPrefixMap
new
HashMap
private
int
nextPrefix
private
HashMap
nsURIByElement
new
HashMap
public
static
class
XmlNamespacePolicy
private
boolean
qualifyElements
private
boolean
qualifyAttributes
public
static
final
XmlNamespacePolicy
IGNORE
new
XmlNamespacePolicy
public
static
final
XmlNamespacePolicy
ONLY_QUALIFY_ELEMENTS
new
XmlNamespacePolicy
public
static
final
XmlNamespacePolicy
QUALIFY_ALL
new
XmlNamespacePolicy
public
XmlNamespacePolicy
boolean
qualifyElements
boolean
qualifyAttributes
this
qualifyElements
qualifyElements
this
qualifyAttributes
qualifyAttributes
public
DOMElementWriter
public
DOMElementWriter
boolean
xmlDeclaration
this
xmlDeclaration
XmlNamespacePolicy
IGNORE
public
DOMElementWriter
boolean
xmlDeclaration
XmlNamespacePolicy
namespacePolicy
this
xmlDeclaration
xmlDeclaration
this
namespacePolicy
namespacePolicy
private
static
String
lSep
System
getProperty
protected
String
knownEntities
public
void
write
Element
root
OutputStream
out
throws
IOException
Writer
wri
new
OutputStreamWriter
out
writeXMLDeclaration
wri
write
root
wri
wri
flush
public
void
writeXMLDeclaration
Writer
wri
throws
IOException
if
xmlDeclaration
wri
write
public
void
write
Element
element
Writer
out
int
indent
String
indentWith
throws
IOException
NodeList
children
element
getChildNodes
boolean
hasChildren
children
getLength
boolean
hasChildElements
openElement
element
out
indent
indentWith
hasChildren
if
hasChildren
for
int
i
i
children
getLength
i
Node
child
children
item
i
switch
child
getNodeType
case
Node
ELEMENT_NODE
hasChildElements
if
i
out
write
lSep
write
Element
child
out
indent
indentWith
break
case
Node
TEXT_NODE
out
write
encode
child
getNodeValue
break
case
Node
COMMENT_NODE
out
write
out
write
encode
child
getNodeValue
out
write
break
case
Node
CDATA_SECTION_NODE
out
write
out
write
encodedata
Text
child
getData
out
write
break
case
Node
ENTITY_REFERENCE_NODE
out
write
out
write
child
getNodeName
out
write
break
case
Node
PROCESSING_INSTRUCTION_NODE
out
write
out
write
child
getNodeName
String
data
child
getNodeValue
if
data
data
length
out
write
out
write
data
out
write
break
default
closeElement
element
out
indent
indentWith
hasChildElements
public
void
openElement
Element
element
Writer
out
int
indent
String
indentWith
throws
IOException
openElement
element
out
indent
indentWith
public
void
openElement
Element
element
Writer
out
int
indent
String
indentWith
boolean
hasChildren
throws
IOException
for
int
i
i
indent
i
out
write
indentWith
out
write
if
namespacePolicy
qualifyElements
String
uri
getNamespaceURI
element
String
prefix
String
nsPrefixMap
get
uri
if
prefix
if
nsPrefixMap
isEmpty
prefix
else
prefix
NS
nextPrefix
nsPrefixMap
put
uri
prefix
addNSDefinition
element
uri
if
equals
prefix
out
write
prefix
out
write
out
write
element
getTagName
NamedNodeMap
attrs
element
getAttributes
for
int
i
i
attrs
getLength
i
Attr
attr
Attr
attrs
item
i
out
write
if
namespacePolicy
qualifyAttributes
String
uri
getNamespaceURI
attr
String
prefix
String
nsPrefixMap
get
uri
if
prefix
prefix
NS
nextPrefix
nsPrefixMap
put
uri
prefix
addNSDefinition
element
uri
out
write
prefix
out
write
out
write
attr
getName
out
write
out
write
encode
attr
getValue
out
write
ArrayList
al
ArrayList
nsURIByElement
get
element
if
al
Iterator
iter
al
iterator
while
iter
hasNext
String
uri
String
iter
next
String
prefix
String
nsPrefixMap
get
uri
out
write
if
equals
prefix
out
write
out
write
prefix
out
write
out
write
uri
out
write
if
hasChildren
out
write
else
removeNSDefinitions
element
out
write
out
write
lSep
out
flush
public
void
closeElement
Element
element
Writer
out
int
indent
String
indentWith
boolean
hasChildren
throws
IOException
if
hasChildren
for
int
i
i
indent
i
out
write
indentWith
out
write
if
namespacePolicy
qualifyElements
String
uri
getNamespaceURI
element
String
prefix
String
nsPrefixMap
get
uri
if
prefix
equals
prefix
out
write
prefix
out
write
removeNSDefinitions
element
out
write
element
getTagName
out
write
out
write
lSep
out
flush
public
String
encode
String
value
StringBuffer
sb
new
StringBuffer
int
len
value
length
for
int
i
i
len
i
char
c
value
charAt
i
switch
c
case
sb
append
break
case
sb
append
break
case
sb
append
break
case
sb
append
break
case
int
nextSemi
value
indexOf
i
if
nextSemi
isReference
value
substring
i
nextSemi
sb
append
else
sb
append
break
default
if
isLegalCharacter
c
sb
append
c
break
return
sb
substring
public
String
encodedata
final
String
value
StringBuffer
sb
new
StringBuffer
int
len
value
length
for
int
i
i
len
i
char
c
value
charAt
i
if
isLegalCharacter
c
sb
append
c
String
result
sb
substring
int
cdEnd
result
indexOf
while
cdEnd
sb
setLength
cdEnd
sb
append
append
result
substring
cdEnd
result
sb
substring
cdEnd
result
indexOf
return
result
public
boolean
isReference
String
ent
if
ent
charAt
ent
endsWith
return
if
ent
charAt
if
ent
charAt
try
Integer
parseInt
ent
substring
ent
length
return
catch
NumberFormatException
nfe
return
else
try
Integer
parseInt
ent
substring
ent
length
return
catch
NumberFormatException
nfe
return
String
name
ent
substring
ent
length
for
int
i
i
knownEntities
length
i
if
name
equals
knownEntities
i
return
return
public
boolean
isLegalCharacter
char
c
if
c
c
c
return
else
if
c
return
else
if
c
return
else
if
c
return
else
if
c
return
return
private
void
removeNSDefinitions
Element
element
ArrayList
al
ArrayList
nsURIByElement
get
element
if
al
Iterator
iter
al
iterator
while
iter
hasNext
nsPrefixMap
remove
iter
next
nsURIByElement
remove
element
private
void
addNSDefinition
Element
element
String
uri
ArrayList
al
ArrayList
nsURIByElement
get
element
if
al
al
new
ArrayList
nsURIByElement
put
element
al
al
add
uri
private
static
String
getNamespaceURI
Node
n
String
uri
n
getNamespaceURI
if
uri
uri
return
uri
