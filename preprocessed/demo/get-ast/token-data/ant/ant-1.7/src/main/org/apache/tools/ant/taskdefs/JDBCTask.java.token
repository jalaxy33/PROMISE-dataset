package
org
apache
tools
ant
taskdefs
import
java
sql
Connection
import
java
sql
DatabaseMetaData
import
java
sql
Driver
import
java
sql
SQLException
import
java
util
Hashtable
import
java
util
Properties
import
java
util
Locale
import
org
apache
tools
ant
AntClassLoader
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
types
Path
import
org
apache
tools
ant
types
Reference
public
abstract
class
JDBCTask
extends
Task
private
static
Hashtable
loaderMap
new
Hashtable
private
boolean
caching
private
Path
classpath
private
AntClassLoader
loader
private
boolean
autocommit
private
String
driver
private
String
url
private
String
userId
private
String
password
private
String
rdbms
private
String
version
public
void
setClasspath
Path
classpath
this
classpath
classpath
public
void
setCaching
boolean
enable
caching
enable
public
Path
createClasspath
if
this
classpath
this
classpath
new
Path
getProject
return
this
classpath
createPath
public
void
setClasspathRef
Reference
r
createClasspath
setRefid
r
public
void
setDriver
String
driver
this
driver
driver
trim
public
void
setUrl
String
url
this
url
url
public
void
setPassword
String
password
this
password
password
public
void
setAutocommit
boolean
autocommit
this
autocommit
autocommit
public
void
setRdbms
String
rdbms
this
rdbms
rdbms
public
void
setVersion
String
version
this
version
version
protected
boolean
isValidRdbms
Connection
conn
if
rdbms
version
return
try
DatabaseMetaData
dmd
conn
getMetaData
if
rdbms
String
theVendor
dmd
getDatabaseProductName
toLowerCase
log
theVendor
Project
MSG_VERBOSE
if
theVendor
theVendor
indexOf
rdbms
log
rdbms
Project
MSG_VERBOSE
return
if
version
String
theVersion
dmd
getDatabaseProductVersion
toLowerCase
Locale
ENGLISH
log
theVersion
Project
MSG_VERBOSE
if
theVersion
theVersion
startsWith
version
theVersion
indexOf
version
log
version
Project
MSG_VERBOSE
return
catch
SQLException
e
log
Project
MSG_ERR
return
return
protected
static
Hashtable
getLoaderMap
return
loaderMap
protected
AntClassLoader
getLoader
return
loader
protected
Connection
getConnection
throws
BuildException
if
userId
throw
new
BuildException
getLocation
if
password
throw
new
BuildException
getLocation
if
url
throw
new
BuildException
getLocation
try
log
getUrl
Project
MSG_VERBOSE
Properties
info
new
Properties
info
put
getUserId
info
put
getPassword
Connection
conn
getDriver
connect
getUrl
info
if
conn
throw
new
SQLException
url
conn
setAutoCommit
autocommit
return
conn
catch
SQLException
e
throw
new
BuildException
e
getLocation
private
Driver
getDriver
throws
BuildException
if
driver
throw
new
BuildException
getLocation
Driver
driverInstance
try
Class
dc
if
classpath
synchronized
loaderMap
if
caching
loader
AntClassLoader
loaderMap
get
driver
if
loader
log
driver
classpath
Project
MSG_VERBOSE
loader
getProject
createClassLoader
classpath
if
caching
loaderMap
put
driver
loader
else
log
driver
Project
MSG_VERBOSE
dc
loader
loadClass
driver
else
log
driver
Project
MSG_VERBOSE
dc
Class
forName
driver
driverInstance
Driver
dc
newInstance
catch
ClassNotFoundException
e
throw
new
BuildException
driver
e
getLocation
catch
IllegalAccessException
e
throw
new
BuildException
driver
e
getLocation
catch
InstantiationException
e
throw
new
BuildException
driver
e
getLocation
return
driverInstance
public
void
isCaching
boolean
value
caching
value
public
Path
getClasspath
return
classpath
public
boolean
isAutocommit
return
autocommit
public
String
getUrl
return
url
public
String
getUserId
return
userId
public
void
setUserid
String
userId
this
userId
userId
public
String
getPassword
return
password
public
String
getRdbms
return
rdbms
public
String
getVersion
return
version
