package
org
apache
tools
ant
taskdefs
optional
ejb
import
java
io
BufferedReader
import
java
io
File
import
java
io
IOException
import
java
io
InputStream
import
java
io
InputStreamReader
import
java
io
OutputStream
import
java
util
Hashtable
import
java
util
Iterator
import
java
util
Vector
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
taskdefs
ExecTask
import
org
apache
tools
ant
taskdefs
Execute
import
org
apache
tools
ant
taskdefs
ExecuteStreamHandler
import
org
apache
tools
ant
taskdefs
Java
import
org
apache
tools
ant
types
Commandline
import
org
apache
tools
ant
types
Path
public
class
BorlandDeploymentTool
extends
GenericDeploymentTool
implements
ExecuteStreamHandler
public
static
final
String
PUBLICID_BORLAND_EJB
protected
static
final
String
DEFAULT_BAS45_EJB11_DTD_LOCATION
protected
static
final
String
DEFAULT_BAS_DTD_LOCATION
protected
static
final
String
BAS_DD
protected
static
final
String
BES_DD
protected
static
final
String
JAVA2IIOP
protected
static
final
String
VERIFY
private
String
jarSuffix
private
String
borlandDTD
private
boolean
java2iiopdebug
private
String
java2iioparams
private
boolean
generateclient
static
final
int
BES
static
final
int
BAS
private
int
version
BAS
private
boolean
verify
private
String
verifyArgs
private
Hashtable
genfiles
new
Hashtable
public
void
setDebug
boolean
debug
this
java2iiopdebug
debug
public
void
setVerify
boolean
verify
this
verify
verify
public
void
setSuffix
String
inString
this
jarSuffix
inString
public
void
setVerifyArgs
String
args
this
verifyArgs
args
public
void
setBASdtd
String
inString
this
borlandDTD
inString
public
void
setGenerateclient
boolean
b
this
generateclient
b
public
void
setVersion
int
version
this
version
version
public
void
setJava2iiopParams
String
params
this
java2iioparams
params
protected
DescriptorHandler
getBorlandDescriptorHandler
final
File
srcDir
DescriptorHandler
handler
new
DescriptorHandler
getTask
srcDir
protected
void
processElement
if
currentElement
equals
String
fileNameWithMETA
currentText
String
fileName
fileNameWithMETA
substring
META_DIR
length
fileNameWithMETA
length
File
descriptorFile
new
File
srcDir
fileName
ejbFiles
put
fileNameWithMETA
descriptorFile
handler
registerDTD
PUBLICID_BORLAND_EJB
borlandDTD
DEFAULT_BAS_DTD_LOCATION
borlandDTD
for
Iterator
i
getConfig
dtdLocations
iterator
i
hasNext
EjbJar
DTDLocation
dtdLocation
EjbJar
DTDLocation
i
next
handler
registerDTD
dtdLocation
getPublicId
dtdLocation
getLocation
return
handler
protected
void
addVendorFiles
Hashtable
ejbFiles
String
ddPrefix
if
version
BES
version
BAS
throw
new
BuildException
version
String
dd
version
BES
BES_DD
BAS_DD
log
ddPrefix
dd
Project
MSG_DEBUG
File
borlandDD
new
File
getConfig
descriptorDir
ddPrefix
dd
if
borlandDD
exists
log
borlandDD
Project
MSG_VERBOSE
ejbFiles
put
META_DIR
dd
borlandDD
else
log
borlandDD
getPath
Project
MSG_WARN
return
File
getVendorOutputJarFile
String
baseName
return
new
File
getDestDir
baseName
jarSuffix
private
void
verifyBorlandJar
File
sourceJar
if
version
BAS
verifyBorlandJarV4
sourceJar
return
if
version
BES
verifyBorlandJarV5
sourceJar
return
log
version
Project
MSG_WARN
private
void
verifyBorlandJarV5
File
sourceJar
log
sourceJar
Project
MSG_INFO
try
ExecTask
execTask
execTask
new
ExecTask
getTask
execTask
setDir
new
File
execTask
setExecutable
if
getCombinedClasspath
execTask
createArg
setValue
execTask
createArg
setValue
getCombinedClasspath
toString
if
java2iiopdebug
execTask
createArg
setValue
execTask
createArg
setValue
execTask
createArg
setValue
execTask
createArg
setValue
sourceJar
getPath
log
Project
MSG_VERBOSE
execTask
execute
catch
Exception
e
String
msg
e
toString
throw
new
BuildException
msg
e
private
void
verifyBorlandJarV4
File
sourceJar
org
apache
tools
ant
taskdefs
Java
javaTask
log
sourceJar
Project
MSG_INFO
try
String
args
verifyArgs
args
sourceJar
getPath
javaTask
new
Java
getTask
javaTask
setTaskName
javaTask
setClassname
VERIFY
Commandline
Argument
arguments
javaTask
createArg
arguments
setLine
args
Path
classpath
getCombinedClasspath
if
classpath
javaTask
setClasspath
classpath
javaTask
setFork
log
VERIFY
sourceJar
toString
Project
MSG_VERBOSE
javaTask
execute
catch
Exception
e
String
msg
VERIFY
e
toString
throw
new
BuildException
msg
e
private
void
generateClient
File
sourceJar
getTask
getProject
addTaskDefinition
org
apache
tools
ant
taskdefs
optional
ejb
BorlandGenerateClient
class
org
apache
tools
ant
taskdefs
optional
ejb
BorlandGenerateClient
gentask
log
sourceJar
Project
MSG_INFO
try
Project
project
getTask
getProject
gentask
BorlandGenerateClient
project
createTask
gentask
setEjbjar
sourceJar
gentask
setDebug
java2iiopdebug
Path
classpath
getCombinedClasspath
if
classpath
gentask
setClasspath
classpath
gentask
setVersion
version
gentask
setTaskName
gentask
execute
catch
Exception
e
String
msg
VERIFY
e
toString
throw
new
BuildException
msg
e
private
void
buildBorlandStubs
Iterator
ithomes
Execute
execTask
execTask
new
Execute
this
Project
project
getTask
getProject
execTask
setAntRun
project
execTask
setWorkingDirectory
project
getBaseDir
Commandline
commandline
new
Commandline
commandline
setExecutable
JAVA2IIOP
if
java2iiopdebug
commandline
createArgument
setValue
commandline
createArgument
setValue
commandline
createArgument
setPath
getCombinedClasspath
commandline
createArgument
setValue
commandline
createArgument
setValue
if
java2iioparams
log
java2iioparams
commandline
createArgument
setValue
java2iioparams
commandline
createArgument
setValue
commandline
createArgument
setValue
getConfig
srcDir
getAbsolutePath
commandline
createArgument
setValue
while
ithomes
hasNext
commandline
createArgument
setValue
ithomes
next
toString
try
log
Project
MSG_VERBOSE
log
commandline
describeCommand
Project
MSG_DEBUG
execTask
setCommandline
commandline
getCommandline
int
result
execTask
execute
if
Execute
isFailure
result
String
msg
result
throw
new
BuildException
msg
getTask
getLocation
catch
java
io
IOException
e
log
e
getMessage
Project
MSG_ERR
throw
new
BuildException
e
getTask
getLocation
protected
void
writeJar
String
baseName
File
jarFile
Hashtable
files
String
publicId
throws
BuildException
Vector
homes
new
Vector
Iterator
it
files
keySet
iterator
while
it
hasNext
String
clazz
String
it
next
if
clazz
endsWith
String
home
toClass
clazz
homes
add
home
log
home
Project
MSG_VERBOSE
buildBorlandStubs
homes
iterator
files
putAll
genfiles
super
writeJar
baseName
jarFile
files
publicId
if
verify
verifyBorlandJar
jarFile
if
generateclient
generateClient
jarFile
private
String
toClass
String
filename
String
classname
filename
substring
filename
lastIndexOf
classname
classname
replace
return
classname
private
String
toClassFile
String
filename
String
classfile
filename
substring
filename
lastIndexOf
classfile
classfile
return
classfile
public
void
start
throws
IOException
public
void
stop
public
void
setProcessInputStream
OutputStream
param1
throws
IOException
public
void
setProcessOutputStream
InputStream
is
throws
IOException
try
BufferedReader
reader
new
BufferedReader
new
InputStreamReader
is
String
javafile
while
javafile
reader
readLine
if
javafile
endsWith
String
classfile
toClassFile
javafile
String
key
classfile
substring
getConfig
srcDir
getAbsolutePath
length
genfiles
put
key
new
File
classfile
reader
close
catch
Exception
e
String
msg
e
toString
throw
new
BuildException
msg
e
public
void
setProcessErrorStream
InputStream
is
throws
IOException
BufferedReader
reader
new
BufferedReader
new
InputStreamReader
is
String
s
reader
readLine
if
s
log
s
Project
MSG_ERR
