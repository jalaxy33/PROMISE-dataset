package
org
apache
tools
ant
taskdefs
optional
ssh
import
com
jcraft
jsch
Channel
import
com
jcraft
jsch
ChannelExec
import
com
jcraft
jsch
JSchException
import
com
jcraft
jsch
Session
import
com
jcraft
jsch
ChannelSftp
import
com
jcraft
jsch
SftpProgressMonitor
import
java
io
IOException
import
java
io
OutputStream
import
java
io
InputStream
import
java
text
NumberFormat
import
org
apache
tools
ant
BuildException
public
abstract
class
AbstractSshMessage
private
Session
session
private
boolean
verbose
private
LogListener
listener
new
LogListener
public
void
log
String
message
public
AbstractSshMessage
Session
session
this
session
public
AbstractSshMessage
boolean
verbose
Session
session
this
verbose
verbose
this
session
session
protected
Channel
openExecChannel
String
command
throws
JSchException
ChannelExec
channel
ChannelExec
session
openChannel
channel
setCommand
command
return
channel
protected
ChannelSftp
openSftpChannel
throws
JSchException
ChannelSftp
channel
ChannelSftp
session
openChannel
return
channel
protected
void
sendAck
OutputStream
out
throws
IOException
byte
buf
new
byte
buf
out
write
buf
out
flush
protected
void
waitForAck
InputStream
in
throws
IOException
BuildException
int
b
in
read
if
b
throw
new
BuildException
else
if
b
StringBuffer
sb
new
StringBuffer
int
c
in
read
while
c
c
sb
append
char
c
c
in
read
if
b
throw
new
BuildException
sb
toString
else
if
b
throw
new
BuildException
sb
toString
else
throw
new
BuildException
b
sb
toString
public
abstract
void
execute
throws
IOException
JSchException
public
void
setLogListener
LogListener
aListener
listener
aListener
protected
void
log
String
message
listener
log
message
protected
void
logStats
long
timeStarted
long
timeEnded
long
totalLength
double
duration
timeEnded
timeStarted
NumberFormat
format
NumberFormat
getNumberInstance
format
setMaximumFractionDigits
format
setMinimumFractionDigits
listener
log
format
format
duration
format
format
totalLength
duration
protected
final
boolean
getVerbose
return
verbose
protected
final
int
trackProgress
long
filesize
long
totalLength
int
percentTransmitted
int
percent
int
Math
round
Math
floor
totalLength
double
filesize
if
percent
percentTransmitted
if
filesize
if
percent
if
percent
System
out
println
else
System
out
print
else
if
percent
System
out
println
else
if
percent
System
out
println
else
System
out
print
return
percent
private
ProgressMonitor
monitor
protected
SftpProgressMonitor
getProgressMonitor
if
monitor
monitor
new
ProgressMonitor
return
monitor
private
class
ProgressMonitor
implements
SftpProgressMonitor
private
long
initFileSize
private
long
totalLength
private
int
percentTransmitted
public
void
init
int
op
String
src
String
dest
long
max
initFileSize
max
totalLength
percentTransmitted
public
boolean
count
long
len
totalLength
len
percentTransmitted
trackProgress
initFileSize
totalLength
percentTransmitted
return
public
void
end
public
long
getTotalLength
return
totalLength
