package
org
apache
tools
ant
taskdefs
optional
import
java
io
BufferedInputStream
import
java
io
BufferedOutputStream
import
java
io
File
import
java
io
FileInputStream
import
java
io
FileOutputStream
import
java
io
IOException
import
java
text
DateFormat
import
java
text
DecimalFormat
import
java
text
ParseException
import
java
text
SimpleDateFormat
import
java
util
Calendar
import
java
util
Date
import
java
util
Enumeration
import
java
util
HashMap
import
java
util
Map
import
java
util
Properties
import
java
util
Vector
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
util
FileUtils
import
org
apache
tools
ant
types
EnumeratedAttribute
public
class
PropertyFile
extends
Task
private
String
comment
private
Properties
properties
private
File
propertyfile
private
Vector
entries
new
Vector
public
void
execute
throws
BuildException
checkParameters
readFile
executeOperation
writeFile
public
Entry
createEntry
Entry
e
new
Entry
entries
addElement
e
return
e
private
void
executeOperation
throws
BuildException
for
Enumeration
e
entries
elements
e
hasMoreElements
Entry
entry
Entry
e
nextElement
entry
executeOn
properties
private
void
readFile
throws
BuildException
properties
new
Properties
try
if
propertyfile
exists
log
propertyfile
getAbsolutePath
FileInputStream
fis
try
fis
new
FileInputStream
propertyfile
BufferedInputStream
bis
new
BufferedInputStream
fis
properties
load
bis
finally
if
fis
fis
close
else
log
propertyfile
getAbsolutePath
FileOutputStream
out
try
out
new
FileOutputStream
propertyfile
getAbsolutePath
out
flush
finally
if
out
out
close
catch
IOException
ioe
throw
new
BuildException
ioe
toString
private
void
checkParameters
throws
BuildException
if
checkParam
propertyfile
throw
new
BuildException
getLocation
public
void
setFile
File
file
propertyfile
file
public
void
setComment
String
hdr
comment
hdr
private
void
writeFile
throws
BuildException
BufferedOutputStream
bos
try
bos
new
BufferedOutputStream
new
FileOutputStream
propertyfile
properties
store
bos
comment
catch
IOException
ioe
throw
new
BuildException
ioe
getLocation
finally
FileUtils
close
bos
private
boolean
checkParam
File
param
return
param
public
static
class
Entry
private
static
final
int
DEFAULT_INT_VALUE
private
static
final
String
DEFAULT_DATE_VALUE
private
static
final
String
DEFAULT_STRING_VALUE
private
String
key
private
int
type
Type
STRING_TYPE
private
int
operation
Operation
EQUALS_OPER
private
String
value
private
String
defaultValue
private
String
newValue
private
String
pattern
private
int
field
Calendar
DATE
public
void
setKey
String
value
this
key
value
public
void
setValue
String
value
this
value
value
public
void
setOperation
Operation
value
this
operation
Operation
toOperation
value
getValue
public
void
setType
Type
value
this
type
Type
toType
value
getValue
public
void
setDefault
String
value
this
defaultValue
value
public
void
setPattern
String
value
this
pattern
value
public
void
setUnit
PropertyFile
Unit
unit
field
unit
getCalendarField
protected
void
executeOn
Properties
props
throws
BuildException
checkParameters
String
oldValue
String
props
get
key
try
if
type
Type
INTEGER_TYPE
executeInteger
oldValue
else
if
type
Type
DATE_TYPE
executeDate
oldValue
else
if
type
Type
STRING_TYPE
executeString
oldValue
else
throw
new
BuildException
type
catch
NullPointerException
npe
npe
printStackTrace
if
newValue
newValue
props
put
key
newValue
private
void
executeDate
String
oldValue
throws
BuildException
Calendar
currentValue
Calendar
getInstance
if
pattern
pattern
DateFormat
fmt
new
SimpleDateFormat
pattern
String
currentStringValue
getCurrentValue
oldValue
if
currentStringValue
currentStringValue
DEFAULT_DATE_VALUE
if
equals
currentStringValue
currentValue
setTime
new
Date
else
try
currentValue
setTime
fmt
parse
currentStringValue
catch
ParseException
pe
if
operation
Operation
EQUALS_OPER
int
offset
try
offset
Integer
parseInt
value
if
operation
Operation
DECREMENT_OPER
offset
offset
catch
NumberFormatException
e
throw
new
BuildException
key
currentValue
add
field
offset
newValue
fmt
format
currentValue
getTime
private
void
executeInteger
String
oldValue
throws
BuildException
int
currentValue
DEFAULT_INT_VALUE
int
newV
DEFAULT_INT_VALUE
DecimalFormat
fmt
pattern
new
DecimalFormat
pattern
new
DecimalFormat
try
String
curval
getCurrentValue
oldValue
if
curval
currentValue
fmt
parse
curval
intValue
else
currentValue
catch
NumberFormatException
nfe
catch
ParseException
pe
if
operation
Operation
EQUALS_OPER
newV
currentValue
else
int
operationValue
if
value
try
operationValue
fmt
parse
value
intValue
catch
NumberFormatException
nfe
catch
ParseException
pe
if
operation
Operation
INCREMENT_OPER
newV
currentValue
operationValue
else
if
operation
Operation
DECREMENT_OPER
newV
currentValue
operationValue
this
newValue
fmt
format
newV
private
void
executeString
String
oldValue
throws
BuildException
String
newV
DEFAULT_STRING_VALUE
String
currentValue
getCurrentValue
oldValue
if
currentValue
currentValue
DEFAULT_STRING_VALUE
if
operation
Operation
EQUALS_OPER
newV
currentValue
else
if
operation
Operation
INCREMENT_OPER
newV
currentValue
value
this
newValue
newV
private
void
checkParameters
throws
BuildException
if
type
Type
STRING_TYPE
operation
Operation
DECREMENT_OPER
throw
new
BuildException
key
if
value
defaultValue
throw
new
BuildException
key
if
key
throw
new
BuildException
if
type
Type
STRING_TYPE
pattern
throw
new
BuildException
key
private
String
getCurrentValue
String
oldValue
String
ret
if
operation
Operation
EQUALS_OPER
if
value
defaultValue
ret
value
if
value
defaultValue
oldValue
ret
oldValue
if
value
defaultValue
oldValue
ret
defaultValue
if
value
defaultValue
oldValue
ret
value
if
value
defaultValue
oldValue
ret
defaultValue
else
ret
oldValue
defaultValue
oldValue
return
ret
public
static
class
Operation
extends
EnumeratedAttribute
public
static
final
int
INCREMENT_OPER
public
static
final
int
DECREMENT_OPER
public
static
final
int
EQUALS_OPER
public
String
getValues
return
new
String
public
static
int
toOperation
String
oper
if
equals
oper
return
INCREMENT_OPER
else
if
equals
oper
return
DECREMENT_OPER
return
EQUALS_OPER
public
static
class
Type
extends
EnumeratedAttribute
public
static
final
int
INTEGER_TYPE
public
static
final
int
DATE_TYPE
public
static
final
int
STRING_TYPE
public
String
getValues
return
new
String
public
static
int
toType
String
type
if
equals
type
return
INTEGER_TYPE
else
if
equals
type
return
DATE_TYPE
return
STRING_TYPE
public
static
class
Unit
extends
EnumeratedAttribute
private
static
final
String
MILLISECOND
private
static
final
String
SECOND
private
static
final
String
MINUTE
private
static
final
String
HOUR
private
static
final
String
DAY
private
static
final
String
WEEK
private
static
final
String
MONTH
private
static
final
String
YEAR
private
static
final
String
UNITS
MILLISECOND
SECOND
MINUTE
HOUR
DAY
WEEK
MONTH
YEAR
private
Map
calendarFields
new
HashMap
public
Unit
calendarFields
put
MILLISECOND
new
Integer
Calendar
MILLISECOND
calendarFields
put
SECOND
new
Integer
Calendar
SECOND
calendarFields
put
MINUTE
new
Integer
Calendar
MINUTE
calendarFields
put
HOUR
new
Integer
Calendar
HOUR_OF_DAY
calendarFields
put
DAY
new
Integer
Calendar
DATE
calendarFields
put
WEEK
new
Integer
Calendar
WEEK_OF_YEAR
calendarFields
put
MONTH
new
Integer
Calendar
MONTH
calendarFields
put
YEAR
new
Integer
Calendar
YEAR
public
int
getCalendarField
String
key
getValue
toLowerCase
Integer
i
Integer
calendarFields
get
key
return
i
intValue
public
String
getValues
return
UNITS
