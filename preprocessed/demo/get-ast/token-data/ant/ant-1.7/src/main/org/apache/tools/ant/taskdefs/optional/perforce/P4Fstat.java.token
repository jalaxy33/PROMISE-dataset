package
org
apache
tools
ant
taskdefs
optional
perforce
import
java
io
File
import
java
util
Vector
import
java
util
ArrayList
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
DirectoryScanner
import
org
apache
tools
ant
types
FileSet
public
class
P4Fstat
extends
P4Base
private
int
changelist
private
String
addCmd
private
Vector
filesets
new
Vector
private
static
final
int
DEFAULT_CMD_LENGTH
private
int
cmdLength
DEFAULT_CMD_LENGTH
private
static
final
int
SHOW_ALL
private
static
final
int
SHOW_EXISTING
private
static
final
int
SHOW_NON_EXISTING
private
int
show
SHOW_NON_EXISTING
private
FStatP4OutputHandler
handler
private
StringBuffer
filelist
private
int
fileNum
private
int
doneFileNum
private
boolean
debug
private
static
final
String
EXISTING_HEADER
private
static
final
String
NONEXISTING_HEADER
public
void
setShowFilter
String
filter
if
filter
equalsIgnoreCase
show
SHOW_ALL
else
if
filter
equalsIgnoreCase
show
SHOW_EXISTING
else
if
filter
equalsIgnoreCase
show
SHOW_NON_EXISTING
else
throw
new
BuildException
public
void
setChangelist
int
changelist
throws
BuildException
if
changelist
throw
new
BuildException
this
changelist
changelist
public
void
addFileset
FileSet
set
filesets
addElement
set
public
void
execute
throws
BuildException
handler
new
FStatP4OutputHandler
this
if
P4View
addCmd
P4View
P4CmdOpts
changelist
changelist
filelist
new
StringBuffer
for
int
i
i
filesets
size
i
FileSet
fs
FileSet
filesets
elementAt
i
DirectoryScanner
ds
fs
getDirectoryScanner
getProject
String
srcFiles
ds
getIncludedFiles
fileNum
srcFiles
length
if
srcFiles
for
int
j
j
srcFiles
length
j
File
f
new
File
ds
getBasedir
srcFiles
j
filelist
append
append
append
f
getAbsolutePath
append
doneFileNum
if
filelist
length
cmdLength
execP4Fstat
filelist
filelist
new
StringBuffer
if
filelist
length
execP4Fstat
filelist
else
log
Project
MSG_WARN
if
show
SHOW_ALL
show
SHOW_EXISTING
printRes
handler
getExisting
EXISTING_HEADER
if
show
SHOW_ALL
show
SHOW_NON_EXISTING
printRes
handler
getNonExisting
NONEXISTING_HEADER
public
int
getLengthOfTask
return
fileNum
int
getPasses
return
filesets
size
private
void
printRes
ArrayList
ar
String
header
log
header
Project
MSG_INFO
for
int
i
i
ar
size
i
log
String
ar
get
i
Project
MSG_INFO
private
void
execP4Fstat
StringBuffer
list
String
l
list
substring
if
debug
log
P4CmdOpts
addCmd
l
Project
MSG_INFO
execP4Command
P4CmdOpts
addCmd
l
handler
