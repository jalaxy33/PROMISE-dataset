package
org
apache
tools
ant
taskdefs
import
java
util
HashMap
import
java
util
Map
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
taskdefs
condition
Condition
import
org
apache
tools
ant
taskdefs
condition
ConditionBase
import
org
apache
tools
ant
types
EnumeratedAttribute
public
class
WaitFor
extends
ConditionBase
private
long
maxWaitMillis
private
long
maxWaitMultiplier
private
long
checkEveryMillis
private
long
checkEveryMultiplier
private
String
timeoutProperty
public
WaitFor
super
public
void
setMaxWait
long
time
maxWaitMillis
time
public
void
setMaxWaitUnit
Unit
unit
maxWaitMultiplier
unit
getMultiplier
public
void
setCheckEvery
long
time
checkEveryMillis
time
public
void
setCheckEveryUnit
Unit
unit
checkEveryMultiplier
unit
getMultiplier
public
void
setTimeoutProperty
String
p
timeoutProperty
p
public
void
execute
throws
BuildException
if
countConditions
throw
new
BuildException
getTaskName
if
countConditions
throw
new
BuildException
getTaskName
Condition
c
Condition
getConditions
nextElement
long
savedMaxWaitMillis
maxWaitMillis
long
savedCheckEveryMillis
checkEveryMillis
try
maxWaitMillis
maxWaitMultiplier
checkEveryMillis
checkEveryMultiplier
long
start
System
currentTimeMillis
long
end
start
maxWaitMillis
while
System
currentTimeMillis
end
if
c
eval
processSuccess
return
try
Thread
sleep
checkEveryMillis
catch
InterruptedException
e
processTimeout
finally
maxWaitMillis
savedMaxWaitMillis
checkEveryMillis
savedCheckEveryMillis
protected
void
processSuccess
log
getTaskName
Project
MSG_VERBOSE
protected
void
processTimeout
log
getTaskName
Project
MSG_VERBOSE
if
timeoutProperty
getProject
setNewProperty
timeoutProperty
public
static
class
Unit
extends
EnumeratedAttribute
public
static
final
String
MILLISECOND
public
static
final
String
SECOND
public
static
final
String
MINUTE
public
static
final
String
HOUR
public
static
final
String
DAY
public
static
final
String
WEEK
private
static
final
String
UNITS
MILLISECOND
SECOND
MINUTE
HOUR
DAY
WEEK
private
Map
timeTable
new
HashMap
public
Unit
timeTable
put
MILLISECOND
new
Long
timeTable
put
SECOND
new
Long
timeTable
put
MINUTE
new
Long
timeTable
put
HOUR
new
Long
timeTable
put
DAY
new
Long
timeTable
put
WEEK
new
Long
public
long
getMultiplier
String
key
getValue
toLowerCase
Long
l
Long
timeTable
get
key
return
l
longValue
public
String
getValues
return
UNITS
