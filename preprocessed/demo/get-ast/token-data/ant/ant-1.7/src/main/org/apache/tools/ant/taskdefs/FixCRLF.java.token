package
org
apache
tools
ant
taskdefs
import
java
io
File
import
java
io
Reader
import
java
io
FileReader
import
java
io
IOException
import
java
io
BufferedReader
import
java
io
FileInputStream
import
java
io
InputStreamReader
import
java
util
Vector
import
java
util
Enumeration
import
java
util
NoSuchElementException
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
DirectoryScanner
import
org
apache
tools
ant
filters
FixCrLfFilter
import
org
apache
tools
ant
filters
ChainableReader
import
org
apache
tools
ant
types
FilterChain
import
org
apache
tools
ant
types
EnumeratedAttribute
import
org
apache
tools
ant
util
FileUtils
public
class
FixCRLF
extends
MatchingTask
implements
ChainableReader
public
static
final
String
ERROR_FILE_AND_SRCDIR
private
static
final
FileUtils
FILE_UTILS
FileUtils
getFileUtils
private
boolean
preserveLastModified
private
File
srcDir
private
File
destDir
private
File
file
private
FixCrLfFilter
filter
new
FixCrLfFilter
private
Vector
fcv
private
String
encoding
private
String
outputEncoding
public
final
Reader
chain
final
Reader
rdr
return
filter
chain
rdr
public
void
setSrcdir
File
srcDir
this
srcDir
srcDir
public
void
setDestdir
File
destDir
this
destDir
destDir
public
void
setJavafiles
boolean
javafiles
filter
setJavafiles
javafiles
public
void
setFile
File
file
this
file
file
public
void
setEol
CrLf
attr
filter
setEol
FixCrLfFilter
CrLf
newInstance
attr
getValue
public
void
setCr
AddAsisRemove
attr
log
Project
MSG_WARN
log
Project
MSG_WARN
String
option
attr
getValue
CrLf
c
new
CrLf
if
option
equals
c
setValue
else
if
option
equals
c
setValue
else
c
setValue
setEol
c
public
void
setTab
AddAsisRemove
attr
filter
setTab
FixCrLfFilter
AddAsisRemove
newInstance
attr
getValue
public
void
setTablength
int
tlength
throws
BuildException
try
filter
setTablength
tlength
catch
IOException
e
throw
new
BuildException
e
public
void
setEof
AddAsisRemove
attr
filter
setEof
FixCrLfFilter
AddAsisRemove
newInstance
attr
getValue
public
void
setEncoding
String
encoding
this
encoding
encoding
public
void
setOutputEncoding
String
outputEncoding
this
outputEncoding
outputEncoding
public
void
setFixlast
boolean
fixlast
filter
setFixlast
fixlast
public
void
setPreserveLastModified
boolean
preserve
preserveLastModified
preserve
public
void
execute
throws
BuildException
validate
String
enc
encoding
encoding
log
filter
getEol
getValue
filter
getTab
getValue
filter
getEof
getValue
filter
getTablength
enc
outputEncoding
enc
outputEncoding
Project
MSG_VERBOSE
DirectoryScanner
ds
super
getDirectoryScanner
srcDir
String
files
ds
getIncludedFiles
for
int
i
i
files
length
i
processFile
files
i
private
void
validate
throws
BuildException
if
file
if
srcDir
throw
new
BuildException
ERROR_FILE_AND_SRCDIR
fileset
setFile
file
srcDir
file
getParentFile
if
srcDir
throw
new
BuildException
if
srcDir
exists
throw
new
BuildException
if
srcDir
isDirectory
throw
new
BuildException
if
destDir
if
destDir
exists
throw
new
BuildException
if
destDir
isDirectory
throw
new
BuildException
private
void
processFile
String
file
throws
BuildException
File
srcFile
new
File
srcDir
file
long
lastModified
srcFile
lastModified
File
destD
destDir
srcDir
destDir
if
fcv
FilterChain
fc
new
FilterChain
fc
add
filter
fcv
new
Vector
fcv
add
fc
File
tmpFile
FILE_UTILS
createTempFile
tmpFile
deleteOnExit
try
FILE_UTILS
copyFile
srcFile
tmpFile
fcv
encoding
outputEncoding
encoding
outputEncoding
getProject
File
destFile
new
File
destD
file
boolean
destIsWrong
if
destFile
exists
log
Project
MSG_DEBUG
destIsWrong
FILE_UTILS
contentEquals
destFile
tmpFile
log
destFile
destIsWrong
Project
MSG_DEBUG
if
destIsWrong
FILE_UTILS
rename
tmpFile
destFile
if
preserveLastModified
log
Project
MSG_DEBUG
FILE_UTILS
setFileLastModified
destFile
lastModified
tmpFile
catch
IOException
e
throw
new
BuildException
e
protected
class
OneLiner
implements
Enumeration
private
static
final
int
UNDEF
private
static
final
int
NOTJAVA
private
static
final
int
LOOKING
private
static
final
int
INBUFLEN
private
static
final
int
LINEBUFLEN
private
static
final
char
CTRLZ
private
int
state
filter
getJavafiles
LOOKING
NOTJAVA
private
StringBuffer
eolStr
new
StringBuffer
LINEBUFLEN
private
StringBuffer
eofStr
new
StringBuffer
private
BufferedReader
reader
private
StringBuffer
line
new
StringBuffer
private
boolean
reachedEof
private
File
srcFile
public
OneLiner
File
srcFile
throws
BuildException
this
srcFile
srcFile
try
reader
new
BufferedReader
encoding
new
FileReader
srcFile
new
InputStreamReader
new
FileInputStream
srcFile
encoding
INBUFLEN
nextLine
catch
IOException
e
throw
new
BuildException
srcFile
e
getMessage
e
getLocation
protected
void
nextLine
throws
BuildException
int
ch
int
eolcount
eolStr
new
StringBuffer
line
new
StringBuffer
try
ch
reader
read
while
ch
ch
ch
line
append
char
ch
ch
reader
read
if
ch
line
length
reachedEof
return
switch
char
ch
case
eolcount
eolStr
append
reader
mark
ch
reader
read
switch
ch
case
ch
reader
read
if
char
ch
eolcount
eolStr
append
else
reader
reset
break
case
eolcount
eolStr
append
break
case
break
default
reader
reset
break
break
case
eolcount
eolStr
append
break
default
if
eolcount
int
i
line
length
while
i
line
charAt
i
CTRLZ
if
i
line
length
eofStr
append
line
toString
substring
i
if
i
line
setLength
reachedEof
else
line
setLength
i
catch
IOException
e
throw
new
BuildException
srcFile
e
getMessage
e
getLocation
public
String
getEofStr
return
eofStr
substring
public
int
getState
return
state
public
void
setState
int
state
this
state
state
public
boolean
hasMoreElements
return
reachedEof
public
Object
nextElement
throws
NoSuchElementException
if
hasMoreElements
throw
new
NoSuchElementException
BufferLine
tmpLine
new
BufferLine
line
toString
eolStr
substring
nextLine
return
tmpLine
public
void
close
throws
IOException
if
reader
reader
close
class
BufferLine
private
int
next
private
int
column
private
int
lookahead
UNDEF
private
String
line
private
String
eolStr
public
BufferLine
String
line
String
eolStr
throws
BuildException
next
column
this
line
line
this
eolStr
eolStr
public
int
getNext
return
next
public
void
setNext
int
next
this
next
next
public
int
getLookahead
return
lookahead
public
void
setLookahead
int
lookahead
this
lookahead
lookahead
public
char
getChar
int
i
return
line
charAt
i
public
char
getNextChar
return
getChar
next
public
char
getNextCharInc
return
getChar
next
public
int
getColumn
return
column
public
void
setColumn
int
col
column
col
public
int
incColumn
return
column
public
int
length
return
line
length
public
int
getEolLength
return
eolStr
length
public
String
getLineString
return
line
public
String
getEol
return
eolStr
public
String
substring
int
begin
return
line
substring
begin
public
String
substring
int
begin
int
end
return
line
substring
begin
end
public
void
setState
int
state
OneLiner
this
setState
state
public
int
getState
return
OneLiner
this
getState
public
static
class
AddAsisRemove
extends
EnumeratedAttribute
public
String
getValues
return
new
String
public
static
class
CrLf
extends
EnumeratedAttribute
public
String
getValues
return
new
String
