package
org
apache
tools
ant
taskdefs
import
java
io
BufferedReader
import
java
io
IOException
import
java
io
InputStream
import
java
io
InputStreamReader
import
java
io
PrintWriter
import
java
io
Reader
import
java
io
StringWriter
import
java
io
UnsupportedEncodingException
import
java
util
Enumeration
import
java
util
Hashtable
import
java
util
Vector
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
util
FileUtils
public
class
Manifest
public
static
final
String
ATTRIBUTE_MANIFEST_VERSION
public
static
final
String
ATTRIBUTE_SIGNATURE_VERSION
public
static
final
String
ATTRIBUTE_NAME
public
static
final
String
ATTRIBUTE_FROM
public
static
final
String
ATTRIBUTE_CLASSPATH
public
static
final
String
DEFAULT_MANIFEST_VERSION
public
static
final
int
MAX_LINE_LENGTH
public
static
final
int
MAX_SECTION_LENGTH
MAX_LINE_LENGTH
public
static
final
String
EOL
public
static
final
String
ERROR_FROM_FORBIDDEN
ATTRIBUTE_FROM
public
static
final
String
JAR_ENCODING
public
static
class
Attribute
private
static
final
int
MAX_NAME_VALUE_LENGTH
private
static
final
int
MAX_NAME_LENGTH
private
String
name
private
Vector
values
new
Vector
private
int
currentIndex
public
Attribute
public
Attribute
String
line
throws
ManifestException
parse
line
public
Attribute
String
name
String
value
this
name
name
setValue
value
public
int
hashCode
int
hashCode
if
name
hashCode
getKey
hashCode
hashCode
values
hashCode
return
hashCode
public
boolean
equals
Object
rhs
if
rhs
rhs
getClass
getClass
return
if
rhs
this
return
Attribute
rhsAttribute
Attribute
rhs
String
lhsKey
getKey
String
rhsKey
rhsAttribute
getKey
if
lhsKey
rhsKey
lhsKey
rhsKey
lhsKey
equals
rhsKey
return
return
values
equals
rhsAttribute
values
public
void
parse
String
line
throws
ManifestException
int
index
line
indexOf
if
index
throw
new
ManifestException
line
name
line
substring
index
setValue
line
substring
index
public
void
setName
String
name
this
name
name
public
String
getName
return
name
public
String
getKey
if
name
return
return
name
toLowerCase
public
void
setValue
String
value
if
currentIndex
values
size
values
addElement
value
currentIndex
values
size
else
values
setElementAt
value
currentIndex
public
String
getValue
if
values
size
return
String
fullValue
for
Enumeration
e
getValues
e
hasMoreElements
String
value
String
e
nextElement
fullValue
value
return
fullValue
trim
public
void
addValue
String
value
currentIndex
setValue
value
public
Enumeration
getValues
return
values
elements
public
void
addContinuation
String
line
String
currentValue
String
values
elementAt
currentIndex
setValue
currentValue
line
substring
public
void
write
PrintWriter
writer
throws
IOException
for
Enumeration
e
getValues
e
hasMoreElements
writeValue
writer
String
e
nextElement
private
void
writeValue
PrintWriter
writer
String
value
throws
IOException
String
line
int
nameLength
name
getBytes
JAR_ENCODING
length
if
nameLength
MAX_NAME_VALUE_LENGTH
if
nameLength
MAX_NAME_LENGTH
throw
new
IOException
name
value
writer
print
name
EOL
line
value
else
line
name
value
while
line
getBytes
JAR_ENCODING
length
MAX_SECTION_LENGTH
int
breakIndex
MAX_SECTION_LENGTH
if
breakIndex
line
length
breakIndex
line
length
String
section
line
substring
breakIndex
while
section
getBytes
JAR_ENCODING
length
MAX_SECTION_LENGTH
breakIndex
breakIndex
section
line
substring
breakIndex
if
breakIndex
throw
new
IOException
name
value
writer
print
section
EOL
line
line
substring
breakIndex
writer
print
line
EOL
public
static
class
Section
private
Vector
warnings
new
Vector
private
String
name
private
Hashtable
attributes
new
Hashtable
private
Vector
attributeIndex
new
Vector
public
void
setName
String
name
this
name
name
public
String
getName
return
name
public
String
read
BufferedReader
reader
throws
ManifestException
IOException
Attribute
attribute
while
String
line
reader
readLine
if
line
line
length
return
if
line
charAt
if
attribute
if
name
name
line
substring
else
throw
new
ManifestException
line
else
attribute
addContinuation
line
else
attribute
new
Attribute
line
String
nameReadAhead
addAttributeAndCheck
attribute
attribute
getAttribute
attribute
getKey
if
nameReadAhead
return
nameReadAhead
public
void
merge
Section
section
throws
ManifestException
if
name
section
getName
name
name
equalsIgnoreCase
section
getName
throw
new
ManifestException
Enumeration
e
section
getAttributeKeys
Attribute
classpathAttribute
while
e
hasMoreElements
String
attributeName
String
e
nextElement
Attribute
attribute
section
getAttribute
attributeName
if
attributeName
equalsIgnoreCase
ATTRIBUTE_CLASSPATH
if
classpathAttribute
classpathAttribute
new
Attribute
classpathAttribute
setName
ATTRIBUTE_CLASSPATH
Enumeration
cpe
attribute
getValues
while
cpe
hasMoreElements
String
value
String
cpe
nextElement
classpathAttribute
addValue
value
else
storeAttribute
attribute
if
classpathAttribute
storeAttribute
classpathAttribute
Enumeration
warnEnum
section
warnings
elements
while
warnEnum
hasMoreElements
warnings
addElement
warnEnum
nextElement
public
void
write
PrintWriter
writer
throws
IOException
if
name
Attribute
nameAttr
new
Attribute
ATTRIBUTE_NAME
name
nameAttr
write
writer
Enumeration
e
getAttributeKeys
while
e
hasMoreElements
String
key
String
e
nextElement
Attribute
attribute
getAttribute
key
attribute
write
writer
writer
print
EOL
public
Attribute
getAttribute
String
attributeName
return
Attribute
attributes
get
attributeName
toLowerCase
public
Enumeration
getAttributeKeys
return
attributeIndex
elements
public
String
getAttributeValue
String
attributeName
Attribute
attribute
getAttribute
attributeName
toLowerCase
if
attribute
return
return
attribute
getValue
public
void
removeAttribute
String
attributeName
String
key
attributeName
toLowerCase
attributes
remove
key
attributeIndex
removeElement
key
public
void
addConfiguredAttribute
Attribute
attribute
throws
ManifestException
String
check
addAttributeAndCheck
attribute
if
check
throw
new
BuildException
public
String
addAttributeAndCheck
Attribute
attribute
throws
ManifestException
if
attribute
getName
attribute
getValue
throw
new
BuildException
if
attribute
getKey
equalsIgnoreCase
ATTRIBUTE_NAME
warnings
addElement
ATTRIBUTE_NAME
attribute
getName
attribute
getValue
return
attribute
getValue
if
attribute
getKey
startsWith
ATTRIBUTE_FROM
toLowerCase
warnings
addElement
ERROR_FROM_FORBIDDEN
attribute
getName
attribute
getValue
else
String
attributeKey
attribute
getKey
if
attributeKey
equalsIgnoreCase
ATTRIBUTE_CLASSPATH
Attribute
classpathAttribute
Attribute
attributes
get
attributeKey
if
classpathAttribute
storeAttribute
attribute
else
warnings
addElement
Enumeration
e
attribute
getValues
while
e
hasMoreElements
String
value
String
e
nextElement
classpathAttribute
addValue
value
else
if
attributes
containsKey
attributeKey
throw
new
ManifestException
attribute
getName
else
storeAttribute
attribute
return
public
Object
clone
Section
cloned
new
Section
cloned
setName
name
Enumeration
e
getAttributeKeys
while
e
hasMoreElements
String
key
String
e
nextElement
Attribute
attribute
getAttribute
key
cloned
storeAttribute
new
Attribute
attribute
getName
attribute
getValue
return
cloned
private
void
storeAttribute
Attribute
attribute
if
attribute
return
String
attributeKey
attribute
getKey
attributes
put
attributeKey
attribute
if
attributeIndex
contains
attributeKey
attributeIndex
addElement
attributeKey
public
Enumeration
getWarnings
return
warnings
elements
public
int
hashCode
return
attributes
hashCode
public
boolean
equals
Object
rhs
if
rhs
rhs
getClass
getClass
return
if
rhs
this
return
Section
rhsSection
Section
rhs
return
attributes
equals
rhsSection
attributes
private
String
manifestVersion
DEFAULT_MANIFEST_VERSION
private
Section
mainSection
new
Section
private
Hashtable
sections
new
Hashtable
private
Vector
sectionIndex
new
Vector
public
static
Manifest
getDefaultManifest
throws
BuildException
InputStream
in
InputStreamReader
insr
try
String
defManifest
in
Manifest
class
getResourceAsStream
defManifest
if
in
throw
new
BuildException
defManifest
try
insr
new
InputStreamReader
in
Manifest
defaultManifest
new
Manifest
insr
Attribute
createdBy
new
Attribute
System
getProperty
System
getProperty
defaultManifest
getMainSection
storeAttribute
createdBy
return
defaultManifest
catch
UnsupportedEncodingException
e
insr
new
InputStreamReader
in
return
new
Manifest
insr
catch
ManifestException
e
throw
new
BuildException
e
catch
IOException
e
throw
new
BuildException
e
finally
FileUtils
close
insr
FileUtils
close
in
public
Manifest
manifestVersion
public
Manifest
Reader
r
throws
ManifestException
IOException
BufferedReader
reader
new
BufferedReader
r
String
nextSectionName
mainSection
read
reader
String
readManifestVersion
mainSection
getAttributeValue
ATTRIBUTE_MANIFEST_VERSION
if
readManifestVersion
manifestVersion
readManifestVersion
mainSection
removeAttribute
ATTRIBUTE_MANIFEST_VERSION
String
line
while
line
reader
readLine
if
line
length
continue
Section
section
new
Section
if
nextSectionName
Attribute
sectionName
new
Attribute
line
if
sectionName
getName
equalsIgnoreCase
ATTRIBUTE_NAME
throw
new
ManifestException
ATTRIBUTE_NAME
sectionName
getName
nextSectionName
sectionName
getValue
else
Attribute
firstAttribute
new
Attribute
line
section
addAttributeAndCheck
firstAttribute
section
setName
nextSectionName
nextSectionName
section
read
reader
addConfiguredSection
section
public
void
addConfiguredSection
Section
section
throws
ManifestException
String
sectionName
section
getName
if
sectionName
throw
new
BuildException
sections
put
sectionName
section
if
sectionIndex
contains
sectionName
sectionIndex
addElement
sectionName
public
void
addConfiguredAttribute
Attribute
attribute
throws
ManifestException
if
attribute
getKey
attribute
getValue
throw
new
BuildException
if
attribute
getKey
equalsIgnoreCase
ATTRIBUTE_MANIFEST_VERSION
manifestVersion
attribute
getValue
else
mainSection
addConfiguredAttribute
attribute
public
void
merge
Manifest
other
throws
ManifestException
merge
other
public
void
merge
Manifest
other
boolean
overwriteMain
throws
ManifestException
if
other
if
overwriteMain
mainSection
Section
other
mainSection
clone
else
mainSection
merge
other
mainSection
if
other
manifestVersion
manifestVersion
other
manifestVersion
Enumeration
e
other
getSectionNames
while
e
hasMoreElements
String
sectionName
String
e
nextElement
Section
ourSection
Section
sections
get
sectionName
Section
otherSection
Section
other
sections
get
sectionName
if
ourSection
if
otherSection
addConfiguredSection
Section
otherSection
clone
else
ourSection
merge
otherSection
public
void
write
PrintWriter
writer
throws
IOException
writer
print
ATTRIBUTE_MANIFEST_VERSION
manifestVersion
EOL
String
signatureVersion
mainSection
getAttributeValue
ATTRIBUTE_SIGNATURE_VERSION
if
signatureVersion
writer
print
ATTRIBUTE_SIGNATURE_VERSION
signatureVersion
EOL
mainSection
removeAttribute
ATTRIBUTE_SIGNATURE_VERSION
mainSection
write
writer
if
signatureVersion
try
Attribute
svAttr
new
Attribute
ATTRIBUTE_SIGNATURE_VERSION
signatureVersion
mainSection
addConfiguredAttribute
svAttr
catch
ManifestException
e
Enumeration
e
sectionIndex
elements
while
e
hasMoreElements
String
sectionName
String
e
nextElement
Section
section
getSection
sectionName
section
write
writer
public
String
toString
StringWriter
sw
new
StringWriter
try
write
new
PrintWriter
sw
catch
IOException
e
return
return
sw
toString
public
Enumeration
getWarnings
Vector
warnings
new
Vector
Enumeration
warnEnum
mainSection
getWarnings
while
warnEnum
hasMoreElements
warnings
addElement
warnEnum
nextElement
Enumeration
e
sections
elements
while
e
hasMoreElements
Section
section
Section
e
nextElement
Enumeration
e2
section
getWarnings
while
e2
hasMoreElements
warnings
addElement
e2
nextElement
return
warnings
elements
public
int
hashCode
int
hashCode
if
manifestVersion
hashCode
manifestVersion
hashCode
hashCode
mainSection
hashCode
hashCode
sections
hashCode
return
hashCode
public
boolean
equals
Object
rhs
if
rhs
rhs
getClass
getClass
return
if
rhs
this
return
Manifest
rhsManifest
Manifest
rhs
if
manifestVersion
if
rhsManifest
manifestVersion
return
else
if
manifestVersion
equals
rhsManifest
manifestVersion
return
if
mainSection
equals
rhsManifest
mainSection
return
return
sections
equals
rhsManifest
sections
public
String
getManifestVersion
return
manifestVersion
public
Section
getMainSection
return
mainSection
public
Section
getSection
String
name
return
Section
sections
get
name
public
Enumeration
getSectionNames
return
sectionIndex
elements
