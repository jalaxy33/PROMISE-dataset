package
org
apache
tools
ant
taskdefs
optional
ejb
import
java
io
BufferedReader
import
java
io
File
import
java
io
FileInputStream
import
java
io
IOException
import
java
io
InputStream
import
java
io
InputStreamReader
import
java
util
ArrayList
import
java
util
Date
import
java
util
HashMap
import
java
util
Hashtable
import
java
util
Iterator
import
java
util
List
import
java
util
Map
import
java
util
Properties
import
java
util
StringTokenizer
import
javax
xml
parsers
SAXParser
import
javax
xml
parsers
SAXParserFactory
import
org
xml
sax
AttributeList
import
org
xml
sax
HandlerBase
import
org
xml
sax
InputSource
import
org
xml
sax
SAXException
public
class
IPlanetEjbc
private
static
final
int
MIN_NUM_ARGS
private
static
final
int
MAX_NUM_ARGS
private
static
final
int
NUM_CLASSES_WITH_IIOP
private
static
final
int
NUM_CLASSES_WITHOUT_IIOP
private
static
final
String
ENTITY_BEAN
private
static
final
String
STATELESS_SESSION
private
static
final
String
STATEFUL_SESSION
private
File
stdDescriptor
private
File
iasDescriptor
private
File
destDirectory
private
String
classpath
private
String
classpathElements
private
boolean
retainSource
private
boolean
debugOutput
private
File
iasHomeDir
private
SAXParser
parser
private
EjbcHandler
handler
new
EjbcHandler
private
Hashtable
ejbFiles
new
Hashtable
private
String
displayName
public
IPlanetEjbc
File
stdDescriptor
File
iasDescriptor
File
destDirectory
String
classpath
SAXParser
parser
this
stdDescriptor
stdDescriptor
this
iasDescriptor
iasDescriptor
this
destDirectory
destDirectory
this
classpath
classpath
this
parser
parser
List
elements
new
ArrayList
if
classpath
StringTokenizer
st
new
StringTokenizer
classpath
File
pathSeparator
while
st
hasMoreTokens
elements
add
st
nextToken
classpathElements
String
elements
toArray
new
String
elements
size
public
void
setRetainSource
boolean
retainSource
this
retainSource
retainSource
public
void
setDebugOutput
boolean
debugOutput
this
debugOutput
debugOutput
public
void
registerDTD
String
publicID
String
location
handler
registerDTD
publicID
location
public
void
setIasHomeDir
File
iasHomeDir
this
iasHomeDir
iasHomeDir
public
Hashtable
getEjbFiles
return
ejbFiles
public
String
getDisplayName
return
displayName
public
String
getCmpDescriptors
List
returnList
new
ArrayList
EjbInfo
ejbs
handler
getEjbs
for
int
i
i
ejbs
length
i
List
descriptors
List
ejbs
i
getCmpDescriptors
returnList
addAll
descriptors
return
String
returnList
toArray
new
String
returnList
size
public
static
void
main
String
args
File
stdDescriptor
File
iasDescriptor
File
destDirectory
String
classpath
SAXParser
parser
boolean
debug
boolean
retainSource
IPlanetEjbc
ejbc
if
args
length
MIN_NUM_ARGS
args
length
MAX_NUM_ARGS
usage
return
stdDescriptor
new
File
args
args
length
iasDescriptor
new
File
args
args
length
for
int
i
i
args
length
i
if
args
i
equals
classpath
args
i
else
if
args
i
equals
destDirectory
new
File
args
i
else
if
args
i
equals
debug
else
if
args
i
equals
retainSource
else
usage
return
if
classpath
Properties
props
System
getProperties
classpath
props
getProperty
if
destDirectory
Properties
props
System
getProperties
destDirectory
new
File
props
getProperty
SAXParserFactory
parserFactory
SAXParserFactory
newInstance
parserFactory
setValidating
try
parser
parserFactory
newSAXParser
catch
Exception
e
System
out
println
System
out
println
e
printStackTrace
return
ejbc
new
IPlanetEjbc
stdDescriptor
iasDescriptor
destDirectory
classpath
parser
ejbc
setDebugOutput
debug
ejbc
setRetainSource
retainSource
try
ejbc
execute
catch
IOException
e
System
out
println
e
getMessage
return
catch
SAXException
e
System
out
println
e
getMessage
return
catch
IPlanetEjbc
EjbcException
e
System
out
println
e
getMessage
return
private
static
void
usage
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
System
out
println
public
void
execute
throws
EjbcException
IOException
SAXException
checkConfiguration
EjbInfo
ejbs
getEjbs
for
int
i
i
ejbs
length
i
log
log
ejbs
i
toString
for
int
i
i
ejbs
length
i
EjbInfo
ejb
ejbs
i
ejb
checkConfiguration
destDirectory
if
ejb
mustBeRecompiled
destDirectory
log
ejb
getName
String
arguments
buildArgumentList
ejb
callEjbc
arguments
else
log
ejb
getName
private
void
callEjbc
String
arguments
StringBuffer
args
new
StringBuffer
for
int
i
i
arguments
length
i
args
append
arguments
i
append
String
command
if
iasHomeDir
command
else
command
iasHomeDir
toString
File
separator
File
separator
command
log
command
args
try
Process
p
Runtime
getRuntime
exec
command
args
RedirectOutput
output
new
RedirectOutput
p
getInputStream
RedirectOutput
error
new
RedirectOutput
p
getErrorStream
output
start
error
start
p
waitFor
p
destroy
catch
IOException
e
log
e
printStackTrace
catch
InterruptedException
e
protected
void
checkConfiguration
throws
EjbcException
String
msg
if
stdDescriptor
msg
if
iasDescriptor
msg
if
classpath
msg
if
parser
msg
if
destDirectory
msg
else
if
destDirectory
exists
msg
else
if
destDirectory
isDirectory
msg
if
msg
length
throw
new
EjbcException
msg
private
EjbInfo
getEjbs
throws
IOException
SAXException
EjbInfo
ejbs
parser
parse
stdDescriptor
handler
parser
parse
iasDescriptor
handler
ejbs
handler
getEjbs
return
ejbs
private
String
buildArgumentList
EjbInfo
ejb
List
arguments
new
ArrayList
if
debugOutput
arguments
add
if
ejb
getBeantype
equals
STATELESS_SESSION
arguments
add
else
if
ejb
getBeantype
equals
STATEFUL_SESSION
arguments
add
if
ejb
getIiop
arguments
add
if
ejb
getCmp
arguments
add
if
retainSource
arguments
add
if
ejb
getHasession
arguments
add
arguments
add
arguments
add
classpath
arguments
add
arguments
add
destDirectory
toString
arguments
add
ejb
getHome
getQualifiedClassName
arguments
add
ejb
getRemote
getQualifiedClassName
arguments
add
ejb
getImplementation
getQualifiedClassName
return
String
arguments
toArray
new
String
arguments
size
private
void
log
String
msg
if
debugOutput
System
out
println
msg
public
class
EjbcException
extends
Exception
public
EjbcException
String
msg
super
msg
private
class
EjbcHandler
extends
HandlerBase
private
static
final
String
PUBLICID_EJB11
private
static
final
String
PUBLICID_IPLANET_EJB_60
private
static
final
String
DEFAULT_IAS60_EJB11_DTD_LOCATION
private
static
final
String
DEFAULT_IAS60_DTD_LOCATION
private
Map
resourceDtds
new
HashMap
private
Map
fileDtds
new
HashMap
private
Map
ejbs
new
HashMap
private
EjbInfo
currentEjb
private
boolean
iasDescriptor
private
String
currentLoc
private
String
currentText
private
String
ejbType
public
EjbcHandler
registerDTD
PUBLICID_EJB11
DEFAULT_IAS60_EJB11_DTD_LOCATION
registerDTD
PUBLICID_IPLANET_EJB_60
DEFAULT_IAS60_DTD_LOCATION
public
EjbInfo
getEjbs
return
EjbInfo
ejbs
values
toArray
new
EjbInfo
ejbs
size
public
String
getDisplayName
return
displayName
public
void
registerDTD
String
publicID
String
location
log
location
if
publicID
location
return
if
ClassLoader
getSystemResource
location
log
location
resourceDtds
put
publicID
location
else
File
dtdFile
new
File
location
if
dtdFile
exists
dtdFile
isFile
log
location
fileDtds
put
publicID
location
public
InputSource
resolveEntity
String
publicId
String
systemId
throws
SAXException
InputStream
inputStream
try
String
location
String
resourceDtds
get
publicId
if
location
inputStream
ClassLoader
getSystemResource
location
openStream
else
location
String
fileDtds
get
publicId
if
location
inputStream
new
FileInputStream
location
catch
IOException
e
return
super
resolveEntity
publicId
systemId
if
inputStream
return
super
resolveEntity
publicId
systemId
else
return
new
InputSource
inputStream
public
void
startElement
String
name
AttributeList
atts
throws
SAXException
currentLoc
name
currentText
if
currentLoc
equals
iasDescriptor
else
if
currentLoc
equals
iasDescriptor
if
name
equals
name
equals
ejbType
name
public
void
characters
char
ch
int
start
int
len
throws
SAXException
currentText
new
String
ch
substring
start
start
len
public
void
endElement
String
name
throws
SAXException
if
iasDescriptor
iasCharacters
currentText
else
stdCharacters
currentText
int
nameLength
name
length
int
locLength
currentLoc
length
currentLoc
currentLoc
substring
locLength
nameLength
private
void
stdCharacters
String
value
if
currentLoc
equals
displayName
value
return
String
base
ejbType
if
currentLoc
equals
base
currentEjb
EjbInfo
ejbs
get
value
if
currentEjb
currentEjb
new
EjbInfo
value
ejbs
put
value
currentEjb
else
if
currentLoc
equals
base
currentEjb
setHome
value
else
if
currentLoc
equals
base
currentEjb
setRemote
value
else
if
currentLoc
equals
base
currentEjb
setImplementation
value
else
if
currentLoc
equals
base
currentEjb
setPrimaryKey
value
else
if
currentLoc
equals
base
currentEjb
setBeantype
value
else
if
currentLoc
equals
base
currentEjb
setCmp
value
private
void
iasCharacters
String
value
String
base
ejbType
if
currentLoc
equals
base
currentEjb
EjbInfo
ejbs
get
value
if
currentEjb
currentEjb
new
EjbInfo
value
ejbs
put
value
currentEjb
else
if
currentLoc
equals
base
currentEjb
setIiop
value
else
if
currentLoc
equals
base
currentEjb
setHasession
value
else
if
currentLoc
equals
base
currentEjb
addCmpDescriptor
value
private
class
EjbInfo
private
String
name
private
Classname
home
private
Classname
remote
private
Classname
implementation
private
Classname
primaryKey
private
String
beantype
private
boolean
cmp
private
boolean
iiop
private
boolean
hasession
private
List
cmpDescriptors
new
ArrayList
public
EjbInfo
String
name
this
name
name
public
String
getName
if
name
if
implementation
return
else
return
implementation
getClassName
return
name
public
void
setHome
String
home
setHome
new
Classname
home
public
void
setHome
Classname
home
this
home
home
public
Classname
getHome
return
home
public
void
setRemote
String
remote
setRemote
new
Classname
remote
public
void
setRemote
Classname
remote
this
remote
remote
public
Classname
getRemote
return
remote
public
void
setImplementation
String
implementation
setImplementation
new
Classname
implementation
public
void
setImplementation
Classname
implementation
this
implementation
implementation
public
Classname
getImplementation
return
implementation
public
void
setPrimaryKey
String
primaryKey
setPrimaryKey
new
Classname
primaryKey
public
void
setPrimaryKey
Classname
primaryKey
this
primaryKey
primaryKey
public
Classname
getPrimaryKey
return
primaryKey
public
void
setBeantype
String
beantype
this
beantype
beantype
toLowerCase
public
String
getBeantype
return
beantype
public
void
setCmp
boolean
cmp
this
cmp
cmp
public
void
setCmp
String
cmp
setCmp
cmp
equals
public
boolean
getCmp
return
cmp
public
void
setIiop
boolean
iiop
this
iiop
iiop
public
void
setIiop
String
iiop
setIiop
iiop
equals
public
boolean
getIiop
return
iiop
public
void
setHasession
boolean
hasession
this
hasession
hasession
public
void
setHasession
String
hasession
setHasession
hasession
equals
public
boolean
getHasession
return
hasession
public
void
addCmpDescriptor
String
descriptor
cmpDescriptors
add
descriptor
public
List
getCmpDescriptors
return
cmpDescriptors
private
void
checkConfiguration
File
buildDir
throws
EjbcException
if
home
throw
new
EjbcException
name
if
remote
throw
new
EjbcException
name
if
implementation
throw
new
EjbcException
name
if
beantype
equals
ENTITY_BEAN
beantype
equals
STATELESS_SESSION
beantype
equals
STATEFUL_SESSION
throw
new
EjbcException
beantype
name
if
cmp
beantype
equals
ENTITY_BEAN
System
out
println
name
if
hasession
beantype
equals
STATEFUL_SESSION
System
out
println
name
if
remote
getClassFile
buildDir
exists
throw
new
EjbcException
remote
getQualifiedClassName
if
home
getClassFile
buildDir
exists
throw
new
EjbcException
home
getQualifiedClassName
if
implementation
getClassFile
buildDir
exists
throw
new
EjbcException
implementation
getQualifiedClassName
public
boolean
mustBeRecompiled
File
destDir
long
sourceModified
sourceClassesModified
destDir
long
destModified
destClassesModified
destDir
return
destModified
sourceModified
private
long
sourceClassesModified
File
buildDir
long
latestModified
long
modified
File
remoteFile
File
homeFile
File
implFile
File
pkFile
remoteFile
remote
getClassFile
buildDir
modified
remoteFile
lastModified
if
modified
System
out
println
remote
getQualifiedClassName
return
latestModified
modified
homeFile
home
getClassFile
buildDir
modified
homeFile
lastModified
if
modified
System
out
println
home
getQualifiedClassName
return
latestModified
Math
max
latestModified
modified
if
primaryKey
pkFile
primaryKey
getClassFile
buildDir
modified
pkFile
lastModified
if
modified
System
out
println
primaryKey
getQualifiedClassName
return
latestModified
Math
max
latestModified
modified
else
pkFile
implFile
implementation
getClassFile
buildDir
modified
implFile
lastModified
if
modified
System
out
println
implementation
getQualifiedClassName
return
String
pathToFile
remote
getQualifiedClassName
pathToFile
pathToFile
replace
File
separatorChar
ejbFiles
put
pathToFile
remoteFile
pathToFile
home
getQualifiedClassName
pathToFile
pathToFile
replace
File
separatorChar
ejbFiles
put
pathToFile
homeFile
pathToFile
implementation
getQualifiedClassName
pathToFile
pathToFile
replace
File
separatorChar
ejbFiles
put
pathToFile
implFile
if
pkFile
pathToFile
primaryKey
getQualifiedClassName
pathToFile
pathToFile
replace
File
separatorChar
ejbFiles
put
pathToFile
pkFile
return
latestModified
private
long
destClassesModified
File
destDir
String
classnames
classesToGenerate
long
destClassesModified
new
Date
getTime
boolean
allClassesFound
for
int
i
i
classnames
length
i
String
pathToClass
classnames
i
replace
File
separatorChar
File
classFile
new
File
destDir
pathToClass
ejbFiles
put
pathToClass
classFile
allClassesFound
allClassesFound
classFile
exists
if
allClassesFound
long
fileMod
classFile
lastModified
destClassesModified
Math
min
destClassesModified
fileMod
return
allClassesFound
destClassesModified
private
String
classesToGenerate
String
classnames
iiop
new
String
NUM_CLASSES_WITH_IIOP
new
String
NUM_CLASSES_WITHOUT_IIOP
final
String
remotePkg
remote
getPackageName
final
String
remoteClass
remote
getClassName
final
String
homePkg
home
getPackageName
final
String
homeClass
home
getClassName
final
String
implPkg
implementation
getPackageName
final
String
implFullClass
implementation
getQualifiedWithUnderscores
int
index
classnames
index
implPkg
implFullClass
classnames
index
implPkg
implFullClass
classnames
index
implPkg
implFullClass
classnames
index
remotePkg
remoteClass
classnames
index
homePkg
homeClass
classnames
index
remotePkg
remoteClass
classnames
index
homePkg
homeClass
classnames
index
remotePkg
remoteClass
classnames
index
homePkg
homeClass
if
iiop
return
classnames
classnames
index
remotePkg
remoteClass
classnames
index
homePkg
homeClass
classnames
index
remotePkg
remoteClass
classnames
index
homePkg
homeClass
classnames
index
remotePkg
remoteClass
classnames
index
homePkg
homeClass
return
classnames
public
String
toString
String
s
name
home
remote
implementation
primaryKey
beantype
cmp
iiop
hasession
Iterator
i
cmpDescriptors
iterator
while
i
hasNext
s
i
next
return
s
private
static
class
Classname
private
String
qualifiedName
private
String
packageName
private
String
className
public
Classname
String
qualifiedName
if
qualifiedName
return
this
qualifiedName
qualifiedName
int
index
qualifiedName
lastIndexOf
if
index
className
qualifiedName
packageName
else
packageName
qualifiedName
substring
index
className
qualifiedName
substring
index
public
String
getQualifiedClassName
return
qualifiedName
public
String
getPackageName
return
packageName
public
String
getClassName
return
className
public
String
getQualifiedWithUnderscores
return
qualifiedName
replace
public
File
getClassFile
File
directory
String
pathToFile
qualifiedName
replace
File
separatorChar
return
new
File
directory
pathToFile
public
String
toString
return
getQualifiedClassName
private
static
class
RedirectOutput
extends
Thread
private
InputStream
stream
public
RedirectOutput
InputStream
stream
this
stream
stream
public
void
run
BufferedReader
reader
new
BufferedReader
new
InputStreamReader
stream
String
text
try
while
text
reader
readLine
System
out
println
text
catch
IOException
e
e
printStackTrace
finally
try
reader
close
catch
IOException
e
