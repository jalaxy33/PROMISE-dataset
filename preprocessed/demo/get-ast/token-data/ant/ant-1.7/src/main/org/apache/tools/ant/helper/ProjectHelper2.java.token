package
org
apache
tools
ant
helper
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Location
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
ProjectHelper
import
org
apache
tools
ant
RuntimeConfigurable
import
org
apache
tools
ant
Target
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
UnknownElement
import
org
apache
tools
ant
util
FileUtils
import
org
apache
tools
ant
util
JAXPUtils
import
org
xml
sax
Attributes
import
org
xml
sax
InputSource
import
org
xml
sax
Locator
import
org
xml
sax
SAXException
import
org
xml
sax
SAXParseException
import
org
xml
sax
XMLReader
import
org
xml
sax
helpers
DefaultHandler
import
java
io
File
import
java
io
FileInputStream
import
java
io
FileNotFoundException
import
java
io
IOException
import
java
io
InputStream
import
java
io
UnsupportedEncodingException
import
java
net
URL
import
java
util
HashMap
import
java
util
Hashtable
import
java
util
Map
import
java
util
Stack
public
class
ProjectHelper2
extends
ProjectHelper
private
static
AntHandler
elementHandler
new
ElementHandler
private
static
AntHandler
targetHandler
new
TargetHandler
private
static
AntHandler
mainHandler
new
MainHandler
private
static
AntHandler
projectHandler
new
ProjectHandler
private
static
final
FileUtils
FILE_UTILS
FileUtils
getFileUtils
public
UnknownElement
parseUnknownElement
Project
project
URL
source
throws
BuildException
Target
dummyTarget
new
Target
dummyTarget
setProject
project
AntXMLContext
context
new
AntXMLContext
project
context
addTarget
dummyTarget
context
setImplicitTarget
dummyTarget
parse
context
getProject
source
new
RootHandler
context
elementHandler
Task
tasks
dummyTarget
getTasks
if
tasks
length
throw
new
BuildException
return
UnknownElement
tasks
public
void
parse
Project
project
Object
source
throws
BuildException
getImportStack
addElement
source
AntXMLContext
context
context
AntXMLContext
project
getReference
if
context
context
new
AntXMLContext
project
project
addReference
context
project
addReference
context
getTargets
if
getImportStack
size
context
setIgnoreProjectTag
Target
currentTarget
context
getCurrentTarget
Target
currentImplicit
context
getImplicitTarget
Map
currentTargets
context
getCurrentTargets
try
Target
newCurrent
new
Target
newCurrent
setProject
project
newCurrent
setName
context
setCurrentTarget
newCurrent
context
setCurrentTargets
new
HashMap
context
setImplicitTarget
newCurrent
parse
project
source
new
RootHandler
context
mainHandler
newCurrent
execute
finally
context
setCurrentTarget
currentTarget
context
setImplicitTarget
currentImplicit
context
setCurrentTargets
currentTargets
else
context
setCurrentTargets
new
HashMap
parse
project
source
new
RootHandler
context
mainHandler
context
getImplicitTarget
execute
public
void
parse
Project
project
Object
source
RootHandler
handler
throws
BuildException
AntXMLContext
context
handler
context
File
buildFile
URL
url
String
buildFileName
if
source
instanceof
File
buildFile
File
source
buildFile
FILE_UTILS
normalize
buildFile
getAbsolutePath
context
setBuildFile
buildFile
buildFileName
buildFile
toString
else
if
source
instanceof
URL
url
URL
source
buildFileName
url
toString
else
throw
new
BuildException
source
getClass
getName
InputStream
inputStream
InputSource
inputSource
try
XMLReader
parser
JAXPUtils
getNamespaceXMLReader
String
uri
if
buildFile
uri
FILE_UTILS
toURI
buildFile
getAbsolutePath
inputStream
new
FileInputStream
buildFile
else
inputStream
url
openStream
uri
url
toString
inputSource
new
InputSource
inputStream
if
uri
inputSource
setSystemId
uri
project
log
buildFileName
uri
Project
MSG_VERBOSE
DefaultHandler
hb
handler
parser
setContentHandler
hb
parser
setEntityResolver
hb
parser
setErrorHandler
hb
parser
setDTDHandler
hb
parser
parse
inputSource
catch
SAXParseException
exc
Location
location
new
Location
exc
getSystemId
exc
getLineNumber
exc
getColumnNumber
Throwable
t
exc
getException
if
t
instanceof
BuildException
BuildException
be
BuildException
t
if
be
getLocation
Location
UNKNOWN_LOCATION
be
setLocation
location
throw
be
else
if
t
t
exc
throw
new
BuildException
exc
getMessage
t
location
catch
SAXException
exc
Throwable
t
exc
getException
if
t
instanceof
BuildException
throw
BuildException
t
else
if
t
t
exc
throw
new
BuildException
exc
getMessage
t
catch
FileNotFoundException
exc
throw
new
BuildException
exc
catch
UnsupportedEncodingException
exc
throw
new
BuildException
buildFileName
exc
catch
IOException
exc
throw
new
BuildException
buildFileName
exc
getMessage
exc
finally
FileUtils
close
inputStream
protected
static
AntHandler
getMainHandler
return
mainHandler
protected
static
void
setMainHandler
AntHandler
handler
mainHandler
handler
protected
static
AntHandler
getProjectHandler
return
projectHandler
protected
static
void
setProjectHandler
AntHandler
handler
projectHandler
handler
protected
static
AntHandler
getTargetHandler
return
targetHandler
protected
static
void
setTargetHandler
AntHandler
handler
targetHandler
handler
protected
static
AntHandler
getElementHandler
return
elementHandler
protected
static
void
setElementHandler
AntHandler
handler
elementHandler
handler
public
static
class
AntHandler
public
void
onStartElement
String
uri
String
tag
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
public
AntHandler
onStartChild
String
uri
String
tag
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
throw
new
SAXParseException
qname
context
getLocator
public
void
onEndChild
String
uri
String
tag
String
qname
AntXMLContext
context
throws
SAXParseException
public
void
onEndElement
String
uri
String
tag
AntXMLContext
context
public
void
characters
char
buf
int
start
int
count
AntXMLContext
context
throws
SAXParseException
String
s
new
String
buf
start
count
trim
if
s
length
throw
new
SAXParseException
s
context
getLocator
protected
void
checkNamespace
String
uri
public
static
class
RootHandler
extends
DefaultHandler
private
Stack
antHandlers
new
Stack
private
AntHandler
currentHandler
private
AntXMLContext
context
public
RootHandler
AntXMLContext
context
AntHandler
rootHandler
currentHandler
rootHandler
antHandlers
push
currentHandler
this
context
context
public
AntHandler
getCurrentAntHandler
return
currentHandler
public
InputSource
resolveEntity
String
publicId
String
systemId
context
getProject
log
systemId
Project
MSG_VERBOSE
if
systemId
startsWith
String
path
FILE_UTILS
fromURI
systemId
File
file
new
File
path
if
file
isAbsolute
file
FILE_UTILS
resolveFile
context
getBuildFileParent
path
context
getProject
log
systemId
context
getBuildFile
path
replace
Project
MSG_WARN
context
getProject
log
file
Project
MSG_DEBUG
try
InputSource
inputSource
new
InputSource
new
FileInputStream
file
inputSource
setSystemId
FILE_UTILS
toURI
file
getAbsolutePath
return
inputSource
catch
FileNotFoundException
fne
context
getProject
log
file
getAbsolutePath
Project
MSG_WARN
context
getProject
log
Project
MSG_DEBUG
return
public
void
startElement
String
uri
String
tag
String
qname
Attributes
attrs
throws
SAXParseException
AntHandler
next
currentHandler
onStartChild
uri
tag
qname
attrs
context
antHandlers
push
currentHandler
currentHandler
next
currentHandler
onStartElement
uri
tag
qname
attrs
context
public
void
setDocumentLocator
Locator
locator
context
setLocator
locator
public
void
endElement
String
uri
String
name
String
qName
throws
SAXException
currentHandler
onEndElement
uri
name
context
AntHandler
prev
AntHandler
antHandlers
pop
currentHandler
prev
if
currentHandler
currentHandler
onEndChild
uri
name
qName
context
public
void
characters
char
buf
int
start
int
count
throws
SAXParseException
currentHandler
characters
buf
start
count
context
public
void
startPrefixMapping
String
prefix
String
uri
context
startPrefixMapping
prefix
uri
public
void
endPrefixMapping
String
prefix
context
endPrefixMapping
prefix
public
static
class
MainHandler
extends
AntHandler
public
AntHandler
onStartChild
String
uri
String
name
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
if
name
equals
uri
equals
uri
equals
ANT_CORE_URI
return
ProjectHelper2
projectHandler
else
if
name
equals
qname
throw
new
SAXParseException
uri
name
ANT_CORE_URI
name
context
getLocator
else
throw
new
SAXParseException
qname
name
context
getLocator
public
static
class
ProjectHandler
extends
AntHandler
public
void
onStartElement
String
uri
String
tag
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
String
baseDir
boolean
nameAttributeSet
Project
project
context
getProject
context
getImplicitTarget
setLocation
new
Location
context
getLocator
for
int
i
i
attrs
getLength
i
String
attrUri
attrs
getURI
i
if
attrUri
attrUri
equals
attrUri
equals
uri
continue
String
key
attrs
getLocalName
i
String
value
attrs
getValue
i
if
key
equals
if
value
value
equals
if
context
isIgnoringProjectTag
project
setDefault
value
else
if
key
equals
if
value
context
setCurrentProjectName
value
nameAttributeSet
if
context
isIgnoringProjectTag
project
setName
value
project
addReference
value
project
else
if
key
equals
if
value
if
context
isIgnoringProjectTag
project
addReference
value
project
else
if
key
equals
if
context
isIgnoringProjectTag
baseDir
value
else
throw
new
SAXParseException
attrs
getQName
i
context
getLocator
String
antFileProp
context
getCurrentProjectName
String
dup
project
getProperty
antFileProp
if
dup
nameAttributeSet
File
dupFile
new
File
dup
if
context
isIgnoringProjectTag
dupFile
equals
context
getBuildFile
project
log
context
getCurrentProjectName
dup
context
getBuildFile
Project
MSG_WARN
if
context
getBuildFile
nameAttributeSet
project
setUserProperty
context
getCurrentProjectName
context
getBuildFile
toString
if
context
isIgnoringProjectTag
return
if
project
getProperty
project
setBasedir
project
getProperty
else
if
baseDir
project
setBasedir
context
getBuildFileParent
getAbsolutePath
else
if
new
File
baseDir
isAbsolute
project
setBasedir
baseDir
else
project
setBaseDir
FILE_UTILS
resolveFile
context
getBuildFileParent
baseDir
project
addTarget
context
getImplicitTarget
context
setCurrentTarget
context
getImplicitTarget
public
AntHandler
onStartChild
String
uri
String
name
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
if
name
equals
uri
equals
uri
equals
ANT_CORE_URI
return
ProjectHelper2
targetHandler
else
return
ProjectHelper2
elementHandler
public
static
class
TargetHandler
extends
AntHandler
public
void
onStartElement
String
uri
String
tag
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
String
name
String
depends
Project
project
context
getProject
Target
target
new
Target
target
setProject
project
target
setLocation
new
Location
context
getLocator
context
addTarget
target
for
int
i
i
attrs
getLength
i
String
attrUri
attrs
getURI
i
if
attrUri
attrUri
equals
attrUri
equals
uri
continue
String
key
attrs
getLocalName
i
String
value
attrs
getValue
i
if
key
equals
name
value
if
equals
name
throw
new
BuildException
else
if
key
equals
depends
value
else
if
key
equals
target
setIf
value
else
if
key
equals
target
setUnless
value
else
if
key
equals
if
value
value
equals
context
getProject
addReference
value
target
else
if
key
equals
target
setDescription
value
else
throw
new
SAXParseException
key
context
getLocator
if
name
throw
new
SAXParseException
context
getLocator
if
context
getCurrentTargets
get
name
throw
new
BuildException
name
target
getLocation
Hashtable
projectTargets
project
getTargets
boolean
usedTarget
if
projectTargets
containsKey
name
project
log
name
Project
MSG_VERBOSE
else
target
setName
name
context
getCurrentTargets
put
name
target
project
addOrReplaceTarget
name
target
usedTarget
if
depends
length
target
setDepends
depends
if
context
isIgnoringProjectTag
context
getCurrentProjectName
context
getCurrentProjectName
length
String
newName
context
getCurrentProjectName
name
Target
newTarget
usedTarget
new
Target
target
target
newTarget
setName
newName
context
getCurrentTargets
put
newName
newTarget
project
addOrReplaceTarget
newName
newTarget
public
AntHandler
onStartChild
String
uri
String
name
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
return
ProjectHelper2
elementHandler
public
void
onEndElement
String
uri
String
tag
AntXMLContext
context
context
setCurrentTarget
context
getImplicitTarget
public
static
class
ElementHandler
extends
AntHandler
public
ElementHandler
public
void
onStartElement
String
uri
String
tag
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
RuntimeConfigurable
parentWrapper
context
currentWrapper
Object
parent
if
parentWrapper
parent
parentWrapper
getProxy
UnknownElement
task
new
UnknownElement
tag
task
setProject
context
getProject
task
setNamespace
uri
task
setQName
qname
task
setTaskType
ProjectHelper
genComponentName
task
getNamespace
tag
task
setTaskName
qname
Location
location
new
Location
context
getLocator
getSystemId
context
getLocator
getLineNumber
context
getLocator
getColumnNumber
task
setLocation
location
task
setOwningTarget
context
getCurrentTarget
if
parent
UnknownElement
parent
addChild
task
else
context
getCurrentTarget
addTask
task
context
configureId
task
attrs
RuntimeConfigurable
wrapper
new
RuntimeConfigurable
task
task
getTaskName
for
int
i
i
attrs
getLength
i
String
name
attrs
getLocalName
i
String
attrUri
attrs
getURI
i
if
attrUri
attrUri
equals
attrUri
equals
uri
name
attrUri
attrs
getQName
i
String
value
attrs
getValue
i
if
ANT_TYPE
equals
name
ANT_CORE_URI
equals
attrUri
ANT_TYPE
equals
attrs
getLocalName
i
name
ANT_TYPE
int
index
value
indexOf
if
index
String
prefix
value
substring
index
String
mappedUri
context
getPrefixMapping
prefix
if
mappedUri
throw
new
BuildException
prefix
value
ProjectHelper
genComponentName
mappedUri
value
substring
index
wrapper
setAttribute
name
value
if
parentWrapper
parentWrapper
addChild
wrapper
context
pushWrapper
wrapper
public
void
characters
char
buf
int
start
int
count
AntXMLContext
context
throws
SAXParseException
RuntimeConfigurable
wrapper
context
currentWrapper
wrapper
addText
buf
start
count
public
AntHandler
onStartChild
String
uri
String
tag
String
qname
Attributes
attrs
AntXMLContext
context
throws
SAXParseException
return
ProjectHelper2
elementHandler
public
void
onEndElement
String
uri
String
tag
AntXMLContext
context
context
popWrapper
