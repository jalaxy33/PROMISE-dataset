package
org
apache
tools
ant
taskdefs
optional
ejb
import
java
io
File
import
java
io
FileOutputStream
import
java
io
IOException
import
java
io
InputStream
import
java
util
Enumeration
import
java
util
Hashtable
import
java
util
Iterator
import
java
util
jar
JarEntry
import
java
util
jar
JarFile
import
java
util
jar
JarOutputStream
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
taskdefs
Java
import
org
apache
tools
ant
types
Environment
import
org
apache
tools
ant
types
Path
import
org
apache
tools
ant
util
FileUtils
public
class
WebsphereDeploymentTool
extends
GenericDeploymentTool
public
static
final
String
PUBLICID_EJB11
public
static
final
String
PUBLICID_EJB20
protected
static
final
String
SCHEMA_DIR
protected
static
final
String
WAS_EXT
protected
static
final
String
WAS_BND
protected
static
final
String
WAS_CMP_MAP
protected
static
final
String
WAS_CMP_SCHEMA
private
static
final
FileUtils
FILE_UTILS
FileUtils
getFileUtils
private
String
jarSuffix
private
String
ejb11DTD
private
boolean
keepGeneric
private
boolean
alwaysRebuild
private
boolean
ejbdeploy
private
boolean
newCMP
private
Path
wasClasspath
private
String
dbVendor
private
String
dbName
private
String
dbSchema
private
boolean
codegen
private
boolean
quiet
private
boolean
novalidate
private
boolean
nowarn
private
boolean
noinform
private
boolean
trace
private
String
rmicOptions
private
boolean
use35MappingRules
private
String
tempdir
private
File
websphereHome
public
Path
createWASClasspath
if
wasClasspath
wasClasspath
new
Path
getTask
getProject
return
wasClasspath
createPath
public
void
setWASClasspath
Path
wasClasspath
this
wasClasspath
wasClasspath
public
void
setDbvendor
String
dbvendor
this
dbVendor
dbvendor
public
void
setDbname
String
dbName
this
dbName
dbName
public
void
setDbschema
String
dbSchema
this
dbSchema
dbSchema
public
void
setCodegen
boolean
codegen
this
codegen
codegen
public
void
setQuiet
boolean
quiet
this
quiet
quiet
public
void
setNovalidate
boolean
novalidate
this
novalidate
novalidate
public
void
setNowarn
boolean
nowarn
this
nowarn
nowarn
public
void
setNoinform
boolean
noinform
this
noinform
noinform
public
void
setTrace
boolean
trace
this
trace
trace
public
void
setRmicoptions
String
options
this
rmicOptions
options
public
void
setUse35
boolean
attr
use35MappingRules
attr
public
void
setRebuild
boolean
rebuild
this
alwaysRebuild
rebuild
public
void
setSuffix
String
inString
this
jarSuffix
inString
public
void
setKeepgeneric
boolean
inValue
this
keepGeneric
inValue
public
void
setEjbdeploy
boolean
ejbdeploy
this
ejbdeploy
ejbdeploy
public
void
setEJBdtd
String
inString
this
ejb11DTD
inString
public
void
setOldCMP
boolean
oldCMP
this
newCMP
oldCMP
public
void
setNewCMP
boolean
newCMP
this
newCMP
newCMP
public
void
setTempdir
String
tempdir
this
tempdir
tempdir
protected
DescriptorHandler
getDescriptorHandler
File
srcDir
DescriptorHandler
handler
new
DescriptorHandler
getTask
srcDir
handler
registerDTD
PUBLICID_EJB11
ejb11DTD
for
Iterator
i
getConfig
dtdLocations
iterator
i
hasNext
EjbJar
DTDLocation
dtdLocation
EjbJar
DTDLocation
i
next
handler
registerDTD
dtdLocation
getPublicId
dtdLocation
getLocation
return
handler
protected
DescriptorHandler
getWebsphereDescriptorHandler
final
File
srcDir
DescriptorHandler
handler
new
DescriptorHandler
getTask
srcDir
protected
void
processElement
for
Iterator
i
getConfig
dtdLocations
iterator
i
hasNext
EjbJar
DTDLocation
dtdLocation
EjbJar
DTDLocation
i
next
handler
registerDTD
dtdLocation
getPublicId
dtdLocation
getLocation
return
handler
protected
void
addVendorFiles
Hashtable
ejbFiles
String
baseName
String
ddPrefix
usingBaseJarName
baseName
String
dbPrefix
dbVendor
dbVendor
File
websphereEXT
new
File
getConfig
descriptorDir
ddPrefix
WAS_EXT
if
websphereEXT
exists
ejbFiles
put
META_DIR
WAS_EXT
websphereEXT
else
log
websphereEXT
getPath
Project
MSG_VERBOSE
File
websphereBND
new
File
getConfig
descriptorDir
ddPrefix
WAS_BND
if
websphereBND
exists
ejbFiles
put
META_DIR
WAS_BND
websphereBND
else
log
websphereBND
getPath
Project
MSG_VERBOSE
if
newCMP
log
Project
MSG_VERBOSE
log
Project
MSG_VERBOSE
else
try
File
websphereMAP
new
File
getConfig
descriptorDir
ddPrefix
dbPrefix
WAS_CMP_MAP
if
websphereMAP
exists
ejbFiles
put
META_DIR
WAS_CMP_MAP
websphereMAP
else
log
websphereMAP
getPath
Project
MSG_VERBOSE
File
websphereSchema
new
File
getConfig
descriptorDir
ddPrefix
dbPrefix
WAS_CMP_SCHEMA
if
websphereSchema
exists
ejbFiles
put
META_DIR
SCHEMA_DIR
WAS_CMP_SCHEMA
websphereSchema
else
log
websphereSchema
getPath
Project
MSG_VERBOSE
catch
Exception
e
String
msg
e
toString
throw
new
BuildException
msg
e
File
getVendorOutputJarFile
String
baseName
return
new
File
getDestDir
baseName
jarSuffix
protected
String
getOptions
StringBuffer
options
new
StringBuffer
if
dbVendor
options
append
append
dbVendor
if
dbName
options
append
append
dbName
append
if
dbSchema
options
append
append
dbSchema
append
if
codegen
options
append
if
quiet
options
append
if
novalidate
options
append
if
nowarn
options
append
if
noinform
options
append
if
trace
options
append
if
use35MappingRules
options
append
if
rmicOptions
options
append
append
rmicOptions
append
return
options
toString
private
void
buildWebsphereJar
File
sourceJar
File
destJar
try
if
ejbdeploy
Java
javaTask
new
Java
getTask
javaTask
createJvmarg
setValue
javaTask
createJvmarg
setValue
Environment
Variable
var
new
Environment
Variable
var
setKey
File
libdir
new
File
websphereHome
var
setValue
libdir
getAbsolutePath
javaTask
addSysproperty
var
javaTask
setDir
websphereHome
javaTask
setTaskName
javaTask
setClassname
javaTask
createArg
setValue
sourceJar
getPath
javaTask
createArg
setValue
tempdir
javaTask
createArg
setValue
destJar
getPath
javaTask
createArg
setLine
getOptions
if
getCombinedClasspath
getCombinedClasspath
toString
length
javaTask
createArg
setValue
javaTask
createArg
setValue
getCombinedClasspath
toString
Path
classpath
wasClasspath
if
classpath
classpath
getCombinedClasspath
if
classpath
javaTask
setClasspath
classpath
javaTask
setFork
else
javaTask
setFork
log
sourceJar
toString
Project
MSG_VERBOSE
javaTask
execute
catch
Exception
e
String
msg
e
toString
throw
new
BuildException
msg
e
protected
void
writeJar
String
baseName
File
jarFile
Hashtable
files
String
publicId
throws
BuildException
if
ejbdeploy
File
genericJarFile
super
getVendorOutputJarFile
baseName
super
writeJar
baseName
genericJarFile
files
publicId
if
alwaysRebuild
isRebuildRequired
genericJarFile
jarFile
buildWebsphereJar
genericJarFile
jarFile
if
keepGeneric
log
genericJarFile
toString
Project
MSG_VERBOSE
genericJarFile
delete
else
super
writeJar
baseName
jarFile
files
publicId
public
void
validateConfigured
throws
BuildException
super
validateConfigured
if
ejbdeploy
String
home
getTask
getProject
getProperty
if
home
throw
new
BuildException
websphereHome
getTask
getProject
resolveFile
home
protected
boolean
isRebuildRequired
File
genericJarFile
File
websphereJarFile
boolean
rebuild
JarFile
genericJar
JarFile
wasJar
File
newwasJarFile
JarOutputStream
newJarStream
try
log
websphereJarFile
getName
Project
MSG_VERBOSE
if
genericJarFile
exists
genericJarFile
isFile
websphereJarFile
exists
websphereJarFile
isFile
genericJar
new
JarFile
genericJarFile
wasJar
new
JarFile
websphereJarFile
Hashtable
genericEntries
new
Hashtable
Hashtable
wasEntries
new
Hashtable
Hashtable
replaceEntries
new
Hashtable
for
Enumeration
e
genericJar
entries
e
hasMoreElements
JarEntry
je
JarEntry
e
nextElement
genericEntries
put
je
getName
replace
je
for
Enumeration
e
wasJar
entries
e
hasMoreElements
JarEntry
je
JarEntry
e
nextElement
wasEntries
put
je
getName
je
ClassLoader
genericLoader
getClassLoaderFromJar
genericJarFile
for
Enumeration
e
genericEntries
keys
e
hasMoreElements
String
filepath
String
e
nextElement
if
wasEntries
containsKey
filepath
JarEntry
genericEntry
JarEntry
genericEntries
get
filepath
JarEntry
wasEntry
JarEntry
wasEntries
get
filepath
if
genericEntry
getCrc
wasEntry
getCrc
genericEntry
getSize
wasEntry
getSize
if
genericEntry
getName
endsWith
String
classname
genericEntry
getName
replace
File
separatorChar
classname
classname
substring
classname
lastIndexOf
Class
genclass
genericLoader
loadClass
classname
if
genclass
isInterface
log
genclass
getName
Project
MSG_VERBOSE
rebuild
break
else
replaceEntries
put
filepath
genericEntry
else
if
genericEntry
getName
equals
log
genericEntry
getName
Project
MSG_VERBOSE
rebuild
break
else
log
filepath
Project
MSG_VERBOSE
rebuild
break
if
rebuild
log
Project
MSG_VERBOSE
newwasJarFile
new
File
websphereJarFile
getAbsolutePath
if
newwasJarFile
exists
newwasJarFile
delete
newJarStream
new
JarOutputStream
new
FileOutputStream
newwasJarFile
newJarStream
setLevel
for
Enumeration
e
wasEntries
elements
e
hasMoreElements
byte
buffer
new
byte
DEFAULT_BUFFER_SIZE
int
bytesRead
InputStream
is
JarEntry
je
JarEntry
e
nextElement
if
je
getCompressedSize
je
getCompressedSize
je
getSize
newJarStream
setLevel
else
newJarStream
setLevel
JAR_COMPRESS_LEVEL
if
replaceEntries
containsKey
je
getName
log
je
getName
Project
MSG_VERBOSE
je
JarEntry
replaceEntries
get
je
getName
is
genericJar
getInputStream
je
else
is
wasJar
getInputStream
je
newJarStream
putNextEntry
new
JarEntry
je
getName
while
bytesRead
is
read
buffer
newJarStream
write
buffer
bytesRead
is
close
else
log
Project
MSG_VERBOSE
else
rebuild
catch
ClassNotFoundException
cnfe
String
cnfmsg
cnfe
getMessage
throw
new
BuildException
cnfmsg
cnfe
catch
IOException
ioe
String
msg
ioe
getMessage
throw
new
BuildException
msg
ioe
finally
if
genericJar
try
genericJar
close
catch
IOException
closeException
if
wasJar
try
wasJar
close
catch
IOException
closeException
if
newJarStream
try
newJarStream
close
catch
IOException
closeException
try
FILE_UTILS
rename
newwasJarFile
websphereJarFile
catch
IOException
renameException
log
renameException
getMessage
Project
MSG_WARN
rebuild
return
rebuild
protected
ClassLoader
getClassLoaderFromJar
File
classjar
throws
IOException
Path
lookupPath
new
Path
getTask
getProject
lookupPath
setLocation
classjar
Path
classpath
getCombinedClasspath
if
classpath
lookupPath
append
classpath
return
getTask
getProject
createClassLoader
lookupPath
