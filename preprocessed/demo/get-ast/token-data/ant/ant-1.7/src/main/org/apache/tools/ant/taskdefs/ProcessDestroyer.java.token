package
org
apache
tools
ant
taskdefs
import
java
lang
reflect
InvocationTargetException
import
java
lang
reflect
Method
import
java
util
Enumeration
import
java
util
Vector
class
ProcessDestroyer
implements
Runnable
private
Vector
processes
new
Vector
private
Method
addShutdownHookMethod
private
Method
removeShutdownHookMethod
private
ProcessDestroyerImpl
destroyProcessThread
private
boolean
added
private
boolean
running
private
class
ProcessDestroyerImpl
extends
Thread
private
boolean
shouldDestroy
public
ProcessDestroyerImpl
super
public
void
run
if
shouldDestroy
ProcessDestroyer
this
run
public
void
setShouldDestroy
boolean
shouldDestroy
this
shouldDestroy
shouldDestroy
public
ProcessDestroyer
try
Class
paramTypes
Thread
class
addShutdownHookMethod
Runtime
class
getMethod
paramTypes
removeShutdownHookMethod
Runtime
class
getMethod
paramTypes
catch
NoSuchMethodException
e
catch
Exception
e
e
printStackTrace
private
void
addShutdownHook
if
addShutdownHookMethod
running
destroyProcessThread
new
ProcessDestroyerImpl
Object
args
destroyProcessThread
try
addShutdownHookMethod
invoke
Runtime
getRuntime
args
added
catch
IllegalAccessException
e
e
printStackTrace
catch
InvocationTargetException
e
Throwable
t
e
getTargetException
if
t
t
getClass
IllegalStateException
class
running
else
e
printStackTrace
private
void
removeShutdownHook
if
removeShutdownHookMethod
added
running
Object
args
destroyProcessThread
try
Boolean
removed
Boolean
removeShutdownHookMethod
invoke
Runtime
getRuntime
args
if
removed
booleanValue
System
err
println
catch
IllegalAccessException
e
e
printStackTrace
catch
InvocationTargetException
e
Throwable
t
e
getTargetException
if
t
t
getClass
IllegalStateException
class
running
else
e
printStackTrace
destroyProcessThread
setShouldDestroy
if
destroyProcessThread
getThreadGroup
isDestroyed
destroyProcessThread
start
try
destroyProcessThread
join
catch
InterruptedException
ie
destroyProcessThread
added
public
boolean
isAddedAsShutdownHook
return
added
public
boolean
add
Process
process
synchronized
processes
if
processes
size
addShutdownHook
processes
addElement
process
return
processes
contains
process
public
boolean
remove
Process
process
synchronized
processes
boolean
processRemoved
processes
removeElement
process
if
processRemoved
processes
size
removeShutdownHook
return
processRemoved
public
void
run
synchronized
processes
running
Enumeration
e
processes
elements
while
e
hasMoreElements
Process
e
nextElement
destroy
