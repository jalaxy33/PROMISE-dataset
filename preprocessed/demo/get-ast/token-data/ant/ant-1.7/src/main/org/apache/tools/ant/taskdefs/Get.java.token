package
org
apache
tools
ant
taskdefs
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
util
FileUtils
import
java
io
File
import
java
io
FileOutputStream
import
java
io
IOException
import
java
io
InputStream
import
java
io
PrintStream
import
java
net
HttpURLConnection
import
java
net
URL
import
java
net
URLConnection
import
java
util
Date
public
class
Get
extends
Task
private
static
final
FileUtils
FILE_UTILS
FileUtils
getFileUtils
private
URL
source
private
File
dest
private
boolean
verbose
private
boolean
useTimestamp
private
boolean
ignoreErrors
private
String
uname
private
String
pword
public
void
execute
throws
BuildException
int
logLevel
Project
MSG_INFO
DownloadProgress
progress
if
verbose
progress
new
VerboseProgress
System
out
try
doGet
logLevel
progress
catch
IOException
ioe
log
source
dest
if
ignoreErrors
throw
new
BuildException
ioe
getLocation
public
boolean
doGet
int
logLevel
DownloadProgress
progress
throws
IOException
if
source
throw
new
BuildException
getLocation
if
dest
throw
new
BuildException
getLocation
if
dest
exists
dest
isDirectory
throw
new
BuildException
getLocation
if
dest
exists
dest
canWrite
throw
new
BuildException
dest
getAbsolutePath
getLocation
if
progress
progress
new
NullProgress
log
source
logLevel
log
dest
getAbsolutePath
logLevel
long
timestamp
boolean
hasTimestamp
if
useTimestamp
dest
exists
timestamp
dest
lastModified
if
verbose
Date
t
new
Date
timestamp
log
t
toString
logLevel
hasTimestamp
URLConnection
connection
source
openConnection
if
hasTimestamp
connection
setIfModifiedSince
timestamp
if
uname
pword
String
up
uname
pword
String
encoding
Base64Converter
encoder
new
Base64Converter
encoding
encoder
encode
up
getBytes
connection
setRequestProperty
encoding
connection
connect
if
connection
instanceof
HttpURLConnection
HttpURLConnection
httpConnection
HttpURLConnection
connection
long
lastModified
httpConnection
getLastModified
if
httpConnection
getResponseCode
HttpURLConnection
HTTP_NOT_MODIFIED
lastModified
hasTimestamp
timestamp
lastModified
log
logLevel
return
if
httpConnection
getResponseCode
HttpURLConnection
HTTP_UNAUTHORIZED
String
message
if
ignoreErrors
log
message
logLevel
return
else
throw
new
BuildException
message
InputStream
is
for
int
i
i
i
try
is
connection
getInputStream
break
catch
IOException
ex
log
ex
logLevel
if
is
log
source
dest
logLevel
if
ignoreErrors
return
throw
new
BuildException
source
dest
getLocation
FileOutputStream
fos
new
FileOutputStream
dest
progress
beginDownload
boolean
finished
try
byte
buffer
new
byte
int
length
while
length
is
read
buffer
fos
write
buffer
length
progress
onTick
finished
finally
FileUtils
close
fos
FileUtils
close
is
if
finished
dest
delete
progress
endDownload
if
useTimestamp
long
remoteTimestamp
connection
getLastModified
if
verbose
Date
t
new
Date
remoteTimestamp
log
t
toString
remoteTimestamp
logLevel
if
remoteTimestamp
FILE_UTILS
setFileLastModified
dest
remoteTimestamp
return
public
void
setSrc
URL
u
this
source
u
public
void
setDest
File
dest
this
dest
dest
public
void
setVerbose
boolean
v
verbose
v
public
void
setIgnoreErrors
boolean
v
ignoreErrors
v
public
void
setUseTimestamp
boolean
v
useTimestamp
v
public
void
setUsername
String
u
this
uname
u
public
void
setPassword
String
p
this
pword
p
protected
static
class
Base64Converter
extends
org
apache
tools
ant
util
Base64Converter
public
interface
DownloadProgress
void
beginDownload
void
onTick
void
endDownload
public
static
class
NullProgress
implements
DownloadProgress
public
void
beginDownload
public
void
onTick
public
void
endDownload
public
static
class
VerboseProgress
implements
DownloadProgress
private
int
dots
PrintStream
out
public
VerboseProgress
PrintStream
out
this
out
out
public
void
beginDownload
dots
public
void
onTick
out
print
if
dots
out
flush
dots
public
void
endDownload
out
println
out
flush
