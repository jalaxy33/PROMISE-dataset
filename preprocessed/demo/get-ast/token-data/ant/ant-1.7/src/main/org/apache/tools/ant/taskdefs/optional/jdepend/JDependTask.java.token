package
org
apache
tools
ant
taskdefs
optional
jdepend
import
java
io
File
import
java
io
FileWriter
import
java
io
IOException
import
java
io
PrintWriter
import
java
lang
reflect
Constructor
import
java
lang
reflect
Method
import
java
util
Vector
import
java
util
Enumeration
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
Project
import
org
apache
tools
ant
Task
import
org
apache
tools
ant
taskdefs
Execute
import
org
apache
tools
ant
taskdefs
ExecuteWatchdog
import
org
apache
tools
ant
taskdefs
LogStreamHandler
import
org
apache
tools
ant
types
Commandline
import
org
apache
tools
ant
types
CommandlineJava
import
org
apache
tools
ant
types
EnumeratedAttribute
import
org
apache
tools
ant
types
Path
import
org
apache
tools
ant
types
PatternSet
import
org
apache
tools
ant
types
Reference
import
org
apache
tools
ant
util
FileUtils
import
org
apache
tools
ant
util
LoaderUtils
public
class
JDependTask
extends
Task
private
Path
sourcesPath
private
Path
classesPath
private
File
outputFile
private
File
dir
private
Path
compileClasspath
private
boolean
haltonerror
private
boolean
fork
private
Long
timeout
private
String
jvm
private
String
format
private
PatternSet
defaultPatterns
new
PatternSet
private
static
Constructor
packageFilterC
private
static
Method
setFilter
private
boolean
includeRuntime
private
Path
runtimeClasses
static
try
Class
packageFilter
Class
forName
packageFilterC
packageFilter
getConstructor
new
Class
java
util
Collection
class
setFilter
jdepend
textui
JDepend
class
getDeclaredMethod
new
Class
packageFilter
catch
Throwable
t
if
setFilter
packageFilterC
public
void
setIncluderuntime
boolean
b
includeRuntime
b
public
void
setTimeout
Long
value
timeout
value
public
Long
getTimeout
return
timeout
public
void
setOutputFile
File
outputFile
this
outputFile
outputFile
public
File
getOutputFile
return
outputFile
public
void
setHaltonerror
boolean
haltonerror
this
haltonerror
haltonerror
public
boolean
getHaltonerror
return
haltonerror
public
void
setFork
boolean
value
fork
value
public
boolean
getFork
return
fork
public
void
setJvm
String
value
jvm
value
public
Path
createSourcespath
if
sourcesPath
sourcesPath
new
Path
getProject
return
sourcesPath
createPath
public
Path
getSourcespath
return
sourcesPath
public
Path
createClassespath
if
classesPath
classesPath
new
Path
getProject
return
classesPath
createPath
public
Path
getClassespath
return
classesPath
public
void
setDir
File
dir
this
dir
dir
public
File
getDir
return
dir
public
void
setClasspath
Path
classpath
if
compileClasspath
compileClasspath
classpath
else
compileClasspath
append
classpath
public
Path
getClasspath
return
compileClasspath
public
Path
createClasspath
if
compileClasspath
compileClasspath
new
Path
getProject
return
compileClasspath
createPath
public
Commandline
Argument
createJvmarg
CommandlineJava
commandline
return
commandline
createVmArgument
public
void
setClasspathRef
Reference
r
createClasspath
setRefid
r
public
PatternSet
NameEntry
createExclude
return
defaultPatterns
createExclude
public
PatternSet
getExcludes
return
defaultPatterns
public
void
setFormat
FormatAttribute
ea
format
ea
getValue
public
static
class
FormatAttribute
extends
EnumeratedAttribute
private
String
formats
new
String
public
String
getValues
return
formats
private
static
final
int
SUCCESS
private
static
final
int
ERRORS
private
void
addClasspathEntry
String
resource
if
resource
startsWith
resource
resource
substring
else
resource
resource
File
f
LoaderUtils
getResourceSource
getClass
getClassLoader
resource
if
f
log
f
getAbsolutePath
Project
MSG_DEBUG
runtimeClasses
createPath
setLocation
f
else
log
resource
Project
MSG_DEBUG
public
void
execute
throws
BuildException
CommandlineJava
commandline
new
CommandlineJava
if
equals
format
commandline
setClassname
else
if
equals
format
commandline
setClassname
if
jvm
commandline
setVm
jvm
if
getSourcespath
getClassespath
throw
new
BuildException
else
if
getClassespath
String
msg
log
msg
int
exitValue
JDependTask
ERRORS
boolean
wasKilled
if
getFork
exitValue
executeInVM
commandline
else
ExecuteWatchdog
watchdog
createWatchdog
exitValue
executeAsForked
commandline
watchdog
if
watchdog
wasKilled
watchdog
killedProcess
boolean
errorOccurred
exitValue
JDependTask
ERRORS
wasKilled
if
errorOccurred
String
errorMessage
wasKilled
if
getHaltonerror
throw
new
BuildException
errorMessage
getLocation
else
log
errorMessage
Project
MSG_ERR
public
int
executeInVM
CommandlineJava
commandline
throws
BuildException
jdepend
textui
JDepend
jdepend
if
equals
format
jdepend
new
jdepend
xmlui
JDepend
else
jdepend
new
jdepend
textui
JDepend
FileWriter
fw
if
getOutputFile
try
fw
new
FileWriter
getOutputFile
getPath
catch
IOException
e
String
msg
e
getMessage
log
msg
throw
new
BuildException
msg
jdepend
setWriter
new
PrintWriter
fw
log
getOutputFile
getPath
try
if
getClassespath
String
cP
getClassespath
list
for
int
i
i
cP
length
i
File
f
new
File
cP
i
if
f
exists
String
msg
f
getPath
log
msg
throw
new
BuildException
msg
try
jdepend
addDirectory
f
getPath
catch
IOException
e
String
msg
e
getMessage
log
msg
throw
new
BuildException
msg
else
if
getSourcespath
String
sP
getSourcespath
list
for
int
i
i
sP
length
i
File
f
new
File
sP
i
if
f
exists
f
isDirectory
String
msg
f
getPath
log
msg
throw
new
BuildException
msg
try
jdepend
addDirectory
f
getPath
catch
IOException
e
String
msg
e
getMessage
log
msg
throw
new
BuildException
msg
String
patterns
defaultPatterns
getExcludePatterns
getProject
if
patterns
patterns
length
if
setFilter
Vector
v
new
Vector
for
int
i
i
patterns
length
i
v
addElement
patterns
i
try
Object
o
packageFilterC
newInstance
new
Object
v
setFilter
invoke
jdepend
new
Object
o
catch
Throwable
e
log
e
getMessage
Project
MSG_WARN
else
log
Project
MSG_WARN
jdepend
analyze
finally
FileUtils
close
fw
return
SUCCESS
public
int
executeAsForked
CommandlineJava
commandline
ExecuteWatchdog
watchdog
throws
BuildException
runtimeClasses
new
Path
getProject
addClasspathEntry
createClasspath
if
getClasspath
toString
length
createJvmarg
commandline
setValue
createJvmarg
commandline
setValue
getClasspath
toString
if
includeRuntime
Vector
v
Execute
getProcEnvironment
Enumeration
e
v
elements
while
e
hasMoreElements
String
s
String
e
nextElement
if
s
startsWith
commandline
createClasspath
getProject
createPath
append
new
Path
getProject
s
substring
length
log
runtimeClasses
Project
MSG_VERBOSE
commandline
createClasspath
getProject
createPath
append
runtimeClasses
if
getOutputFile
commandline
createArgument
setValue
commandline
createArgument
setValue
outputFile
getPath
if
getSourcespath
String
sP
getSourcespath
list
for
int
i
i
sP
length
i
File
f
new
File
sP
i
if
f
exists
f
isDirectory
throw
new
BuildException
f
getPath
commandline
createArgument
setValue
f
getPath
if
getClassespath
String
cP
getClassespath
list
for
int
i
i
cP
length
i
File
f
new
File
cP
i
if
f
exists
throw
new
BuildException
f
getPath
commandline
createArgument
setValue
f
getPath
Execute
execute
new
Execute
new
LogStreamHandler
this
Project
MSG_INFO
Project
MSG_WARN
watchdog
execute
setCommandline
commandline
getCommandline
if
getDir
execute
setWorkingDirectory
getDir
execute
setAntRun
getProject
if
getOutputFile
log
getOutputFile
getPath
log
commandline
describeCommand
Project
MSG_VERBOSE
try
return
execute
execute
catch
IOException
e
throw
new
BuildException
e
getLocation
protected
ExecuteWatchdog
createWatchdog
throws
BuildException
if
getTimeout
return
return
new
ExecuteWatchdog
getTimeout
longValue
