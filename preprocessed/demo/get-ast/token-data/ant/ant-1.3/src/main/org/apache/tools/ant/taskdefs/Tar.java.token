package
org
apache
tools
ant
taskdefs
import
java
io
import
java
util
import
org
apache
tools
ant
import
org
apache
tools
ant
util
import
org
apache
tools
tar
import
org
apache
tools
ant
types
public
class
Tar
extends
MatchingTask
static
public
final
String
WARN
static
public
final
String
FAIL
static
public
final
String
TRUNCATE
static
public
final
String
GNU
static
public
final
String
OMIT
private
String
validModes
new
String
WARN
FAIL
TRUNCATE
GNU
OMIT
File
tarFile
File
baseDir
String
longFileMode
WARN
Vector
filesets
new
Vector
Vector
fileSetFiles
new
Vector
private
boolean
longWarningGiven
public
TarFileSet
createTarFileSet
TarFileSet
fileset
new
TarFileSet
filesets
addElement
fileset
return
fileset
public
void
setTarfile
File
tarFile
this
tarFile
tarFile
public
void
setBasedir
File
baseDir
this
baseDir
baseDir
public
void
setLongfile
String
mode
for
int
i
i
validModes
length
i
if
mode
equalsIgnoreCase
validModes
i
this
longFileMode
mode
return
throw
new
BuildException
mode
public
void
execute
throws
BuildException
if
tarFile
throw
new
BuildException
location
if
tarFile
exists
tarFile
isDirectory
throw
new
BuildException
location
if
tarFile
exists
tarFile
canWrite
throw
new
BuildException
location
if
baseDir
if
baseDir
exists
throw
new
BuildException
location
TarFileSet
mainFileSet
new
TarFileSet
fileset
mainFileSet
setDir
baseDir
mainFileSet
setDefaultexcludes
useDefaultExcludes
filesets
addElement
mainFileSet
if
filesets
size
throw
new
BuildException
location
boolean
upToDate
for
Enumeration
e
filesets
elements
e
hasMoreElements
TarFileSet
fs
TarFileSet
e
nextElement
String
files
fs
getFiles
project
if
archiveIsUpToDate
files
upToDate
for
int
i
i
files
length
i
if
tarFile
equals
new
File
fs
getDir
project
files
i
throw
new
BuildException
location
if
upToDate
log
tarFile
getAbsolutePath
Project
MSG_INFO
return
log
tarFile
getAbsolutePath
Project
MSG_INFO
TarOutputStream
tOut
try
tOut
new
TarOutputStream
new
FileOutputStream
tarFile
tOut
setDebug
if
longFileMode
equalsIgnoreCase
TRUNCATE
tOut
setLongFileMode
TarOutputStream
LONGFILE_TRUNCATE
else
if
longFileMode
equalsIgnoreCase
FAIL
longFileMode
equalsIgnoreCase
OMIT
tOut
setLongFileMode
TarOutputStream
LONGFILE_ERROR
else
tOut
setLongFileMode
TarOutputStream
LONGFILE_GNU
longWarningGiven
for
Enumeration
e
filesets
elements
e
hasMoreElements
TarFileSet
fs
TarFileSet
e
nextElement
String
files
fs
getFiles
project
for
int
i
i
files
length
i
File
f
new
File
baseDir
files
i
String
name
files
i
replace
File
separatorChar
tarFile
f
tOut
name
fs
catch
IOException
ioe
String
msg
ioe
getMessage
throw
new
BuildException
msg
ioe
location
finally
if
tOut
try
tOut
close
catch
IOException
e
protected
void
tarFile
File
file
TarOutputStream
tOut
String
vPath
TarFileSet
tarFileSet
throws
IOException
FileInputStream
fIn
new
FileInputStream
file
try
if
vPath
length
TarConstants
NAMELEN
if
longFileMode
equalsIgnoreCase
OMIT
log
vPath
Project
MSG_INFO
return
else
if
longFileMode
equalsIgnoreCase
WARN
log
vPath
TarConstants
NAMELEN
Project
MSG_WARN
if
longWarningGiven
log
Project
MSG_WARN
longWarningGiven
else
if
longFileMode
equalsIgnoreCase
FAIL
throw
new
BuildException
vPath
TarConstants
NAMELEN
location
TarEntry
te
new
TarEntry
vPath
te
setSize
file
length
te
setModTime
file
lastModified
if
file
isDirectory
te
setMode
tarFileSet
getMode
te
setUserName
tarFileSet
getUserName
te
setGroupName
tarFileSet
getGroup
tOut
putNextEntry
te
byte
buffer
new
byte
int
count
do
tOut
write
buffer
count
count
fIn
read
buffer
buffer
length
while
count
tOut
closeEntry
finally
fIn
close
protected
boolean
archiveIsUpToDate
String
files
SourceFileScanner
sfs
new
SourceFileScanner
this
MergingMapper
mm
new
MergingMapper
mm
setTo
tarFile
getAbsolutePath
return
sfs
restrict
files
baseDir
mm
length
static
public
class
TarFileSet
extends
FileSet
private
String
files
private
int
mode
private
String
userName
private
String
groupName
public
TarFileSet
FileSet
fileset
super
fileset
public
TarFileSet
super
public
String
getFiles
Project
p
if
files
DirectoryScanner
ds
getDirectoryScanner
p
files
ds
getIncludedFiles
return
files
public
void
setMode
String
octalString
this
mode
Integer
parseInt
octalString
public
int
getMode
return
mode
public
void
setUserName
String
userName
this
userName
userName
public
String
getUserName
return
userName
public
void
setGroup
String
groupName
this
groupName
groupName
public
String
getGroup
return
groupName
