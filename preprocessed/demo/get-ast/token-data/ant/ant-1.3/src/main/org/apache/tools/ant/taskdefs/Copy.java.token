package
org
apache
tools
ant
taskdefs
import
org
apache
tools
ant
import
org
apache
tools
ant
types
import
org
apache
tools
ant
util
import
java
io
import
java
util
public
class
Copy
extends
Task
protected
File
file
protected
File
destFile
protected
File
destDir
protected
Vector
filesets
new
Vector
protected
boolean
filtering
protected
boolean
preserveLastModified
protected
boolean
forceOverwrite
protected
boolean
flatten
protected
int
verbosity
Project
MSG_VERBOSE
protected
boolean
includeEmpty
protected
Hashtable
fileCopyMap
new
Hashtable
protected
Hashtable
dirCopyMap
new
Hashtable
protected
Mapper
mapperElement
public
void
setFile
File
file
this
file
file
public
void
setTofile
File
destFile
this
destFile
destFile
public
void
setTodir
File
destDir
this
destDir
destDir
public
void
setPreserveLastModified
String
preserve
preserveLastModified
Project
toBoolean
preserve
public
void
setFiltering
boolean
filtering
this
filtering
filtering
public
void
setOverwrite
boolean
overwrite
this
forceOverwrite
overwrite
public
void
setFlatten
boolean
flatten
this
flatten
flatten
public
void
setVerbose
boolean
verbose
if
verbose
this
verbosity
Project
MSG_INFO
else
this
verbosity
Project
MSG_VERBOSE
public
void
setIncludeEmptyDirs
boolean
includeEmpty
this
includeEmpty
includeEmpty
public
void
addFileset
FileSet
set
filesets
addElement
set
public
Mapper
createMapper
throws
BuildException
if
mapperElement
throw
new
BuildException
location
mapperElement
new
Mapper
project
return
mapperElement
public
void
execute
throws
BuildException
validateAttributes
if
file
if
file
exists
if
destFile
destFile
new
File
destDir
file
getName
if
forceOverwrite
file
lastModified
destFile
lastModified
fileCopyMap
put
file
getAbsolutePath
destFile
getAbsolutePath
else
log
file
getAbsolutePath
for
int
i
i
filesets
size
i
FileSet
fs
FileSet
filesets
elementAt
i
DirectoryScanner
ds
fs
getDirectoryScanner
project
File
fromDir
fs
getDir
project
String
srcFiles
ds
getIncludedFiles
String
srcDirs
ds
getIncludedDirectories
scan
fromDir
destDir
srcFiles
srcDirs
doFileOperations
if
destFile
destDir
protected
void
validateAttributes
throws
BuildException
if
file
filesets
size
throw
new
BuildException
if
destFile
destDir
throw
new
BuildException
if
destFile
destDir
throw
new
BuildException
if
file
file
exists
file
isDirectory
throw
new
BuildException
if
destFile
filesets
size
throw
new
BuildException
if
destFile
destDir
new
File
destFile
getParent
protected
void
scan
File
fromDir
File
toDir
String
files
String
dirs
FileNameMapper
mapper
if
mapperElement
mapper
mapperElement
getImplementation
else
if
flatten
mapper
new
FlatFileNameMapper
else
mapper
new
IdentityMapper
buildMap
fromDir
toDir
files
mapper
fileCopyMap
if
includeEmpty
buildMap
fromDir
toDir
dirs
mapper
dirCopyMap
protected
void
buildMap
File
fromDir
File
toDir
String
names
FileNameMapper
mapper
Hashtable
map
String
toCopy
if
forceOverwrite
Vector
v
new
Vector
for
int
i
i
names
length
i
if
mapper
mapFileName
names
i
v
addElement
names
i
toCopy
new
String
v
size
v
copyInto
toCopy
else
SourceFileScanner
ds
new
SourceFileScanner
this
toCopy
ds
restrict
names
fromDir
toDir
mapper
for
int
i
i
toCopy
length
i
File
src
new
File
fromDir
toCopy
i
File
dest
new
File
toDir
mapper
mapFileName
toCopy
i
map
put
src
getAbsolutePath
dest
getAbsolutePath
protected
void
doFileOperations
if
fileCopyMap
size
log
fileCopyMap
size
fileCopyMap
size
destDir
getAbsolutePath
Enumeration
e
fileCopyMap
keys
while
e
hasMoreElements
String
fromFile
String
e
nextElement
String
toFile
String
fileCopyMap
get
fromFile
if
fromFile
equals
toFile
log
fromFile
verbosity
continue
try
log
fromFile
toFile
verbosity
project
copyFile
fromFile
toFile
filtering
forceOverwrite
preserveLastModified
catch
IOException
ioe
String
msg
fromFile
toFile
ioe
getMessage
throw
new
BuildException
msg
ioe
location
if
includeEmpty
Enumeration
e
dirCopyMap
elements
int
count
while
e
hasMoreElements
File
d
new
File
String
e
nextElement
if
d
exists
if
d
mkdirs
log
d
getAbsolutePath
Project
MSG_ERR
else
count
if
count
log
count
count
destDir
getAbsolutePath
