package
org
apache
tools
ant
import
java
io
import
java
util
public
class
Main
public
static
final
String
DEFAULT_BUILD_FILENAME
private
int
msgOutputLevel
Project
MSG_INFO
private
File
buildFile
private
PrintStream
out
System
out
private
PrintStream
err
System
err
private
Vector
targets
new
Vector
private
Properties
definedProps
new
Properties
private
Vector
listeners
new
Vector
private
String
loggerClassname
private
boolean
emacsMode
private
boolean
readyToRun
private
boolean
projectHelp
private
static
void
printMessage
Throwable
t
String
message
t
getMessage
if
message
System
err
println
message
public
static
void
main
String
args
Main
m
try
m
new
Main
args
catch
Throwable
exc
printMessage
exc
System
exit
try
m
runBuild
System
exit
catch
BuildException
be
if
m
err
System
err
printMessage
be
System
exit
catch
Throwable
exc
printMessage
exc
System
exit
protected
Main
String
args
throws
BuildException
String
searchForThis
for
int
i
i
args
length
i
String
arg
args
i
if
arg
equals
printUsage
return
else
if
arg
equals
printVersion
return
else
if
arg
equals
arg
equals
msgOutputLevel
Project
MSG_WARN
else
if
arg
equals
arg
equals
printVersion
msgOutputLevel
Project
MSG_VERBOSE
else
if
arg
equals
printVersion
msgOutputLevel
Project
MSG_DEBUG
else
if
arg
equals
arg
equals
try
File
logFile
new
File
args
i
i
out
new
PrintStream
new
FileOutputStream
logFile
err
out
System
setOut
out
System
setErr
out
catch
IOException
ioe
String
msg
System
out
println
msg
return
catch
ArrayIndexOutOfBoundsException
aioobe
String
msg
System
out
println
msg
return
else
if
arg
equals
arg
equals
arg
equals
try
buildFile
new
File
args
i
i
catch
ArrayIndexOutOfBoundsException
aioobe
String
msg
System
out
println
msg
return
else
if
arg
equals
try
listeners
addElement
args
i
i
catch
ArrayIndexOutOfBoundsException
aioobe
String
msg
System
out
println
msg
return
else
if
arg
startsWith
String
name
arg
substring
arg
length
String
value
int
posEq
name
indexOf
if
posEq
value
name
substring
posEq
name
name
substring
posEq
else
if
i
args
length
value
args
i
definedProps
put
name
value
else
if
arg
equals
if
loggerClassname
System
out
println
return
loggerClassname
args
i
else
if
arg
equals
emacsMode
else
if
arg
equals
projectHelp
else
if
arg
equals
if
i
args
length
searchForThis
args
i
else
searchForThis
DEFAULT_BUILD_FILENAME
else
if
arg
startsWith
String
msg
arg
System
out
println
msg
printUsage
return
else
targets
addElement
arg
if
buildFile
if
searchForThis
buildFile
findBuildFile
searchForThis
else
buildFile
new
File
DEFAULT_BUILD_FILENAME
if
buildFile
exists
System
out
println
buildFile
throw
new
BuildException
if
buildFile
isDirectory
System
out
println
buildFile
throw
new
BuildException
readyToRun
private
File
getParentFile
File
file
String
filename
file
getAbsolutePath
file
new
File
filename
filename
file
getParent
if
filename
msgOutputLevel
Project
MSG_VERBOSE
System
out
println
filename
return
filename
new
File
filename
private
File
findBuildFile
String
start
String
suffix
throws
BuildException
if
msgOutputLevel
Project
MSG_INFO
System
out
println
suffix
File
parent
new
File
new
File
start
getAbsolutePath
File
file
new
File
parent
suffix
while
file
exists
parent
getParentFile
parent
if
parent
throw
new
BuildException
file
new
File
parent
suffix
return
file
private
void
runBuild
throws
BuildException
if
readyToRun
return
if
msgOutputLevel
Project
MSG_INFO
System
out
println
buildFile
Project
project
new
Project
Throwable
error
try
addBuildListeners
project
project
fireBuildStarted
project
init
Enumeration
e
definedProps
keys
while
e
hasMoreElements
String
arg
String
e
nextElement
String
value
String
definedProps
get
arg
project
setUserProperty
arg
value
project
setUserProperty
buildFile
getAbsolutePath
try
Class
forName
ProjectHelper
configureProject
project
buildFile
catch
NoClassDefFoundError
ncdfe
throw
new
BuildException
ncdfe
catch
ClassNotFoundException
cnfe
throw
new
BuildException
cnfe
catch
NullPointerException
npe
throw
new
BuildException
npe
if
targets
size
targets
addElement
project
getDefaultTarget
if
projectHelp
printTargets
project
else
project
executeTargets
targets
catch
RuntimeException
exc
error
exc
throw
exc
catch
Error
err
error
err
throw
err
finally
project
fireBuildFinished
error
protected
void
addBuildListeners
Project
project
project
addBuildListener
createLogger
for
int
i
i
listeners
size
i
String
className
String
listeners
elementAt
i
try
BuildListener
listener
BuildListener
Class
forName
className
newInstance
project
addBuildListener
listener
catch
Exception
exc
throw
new
BuildException
className
exc
private
BuildLogger
createLogger
BuildLogger
logger
if
loggerClassname
try
logger
BuildLogger
Class
forName
loggerClassname
newInstance
catch
ClassCastException
e
System
err
println
loggerClassname
throw
new
RuntimeException
catch
Exception
e
System
err
println
loggerClassname
e
getClass
getName
throw
new
RuntimeException
else
logger
new
DefaultLogger
logger
setMessageOutputLevel
msgOutputLevel
logger
setOutputPrintStream
out
logger
setErrorPrintStream
err
logger
setEmacsMode
emacsMode
return
logger
private
static
void
printUsage
String
lSep
System
getProperty
StringBuffer
msg
new
StringBuffer
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
msg
append
lSep
System
out
println
msg
toString
private
static
void
printVersion
try
Properties
props
new
Properties
InputStream
in
Main
class
getResourceAsStream
props
load
in
in
close
String
lSep
System
getProperty
StringBuffer
msg
new
StringBuffer
msg
append
msg
append
props
getProperty
msg
append
msg
append
props
getProperty
msg
append
lSep
System
out
println
msg
toString
catch
IOException
ioe
System
err
println
System
err
println
ioe
getMessage
catch
NullPointerException
npe
System
err
println
private
static
void
printTargets
Project
project
int
maxLength
Enumeration
ptargets
project
getTargets
elements
String
targetName
String
targetDescription
Target
currentTarget
Vector
topNames
new
Vector
Vector
topDescriptions
new
Vector
Vector
subNames
new
Vector
while
ptargets
hasMoreElements
currentTarget
Target
ptargets
nextElement
targetName
currentTarget
getName
targetDescription
currentTarget
getDescription
if
targetDescription
int
pos
findTargetPosition
subNames
targetName
subNames
insertElementAt
targetName
pos
else
int
pos
findTargetPosition
topNames
targetName
topNames
insertElementAt
targetName
pos
topDescriptions
insertElementAt
targetDescription
pos
if
targetName
length
maxLength
maxLength
targetName
length
printTargets
topNames
topDescriptions
maxLength
printTargets
subNames
private
static
int
findTargetPosition
Vector
names
String
name
int
res
names
size
for
int
i
i
names
size
res
names
size
i
if
name
compareTo
String
names
elementAt
i
res
i
return
res
private
static
void
printTargets
Vector
names
Vector
descriptions
String
heading
int
maxlen
String
lSep
System
getProperty
String
spaces
while
spaces
length
maxlen
spaces
spaces
StringBuffer
msg
new
StringBuffer
msg
append
heading
lSep
lSep
for
int
i
i
names
size
i
msg
append
msg
append
names
elementAt
i
if
descriptions
msg
append
spaces
substring
maxlen
String
names
elementAt
i
length
msg
append
descriptions
elementAt
i
msg
append
lSep
System
out
println
msg
toString
