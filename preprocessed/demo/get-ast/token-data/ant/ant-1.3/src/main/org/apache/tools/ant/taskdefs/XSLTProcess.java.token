package
org
apache
tools
ant
taskdefs
import
java
io
import
java
util
Enumeration
import
java
util
Hashtable
import
java
util
StringTokenizer
import
java
util
Vector
import
org
apache
tools
ant
public
class
XSLTProcess
extends
MatchingTask
private
File
destDir
private
File
baseDir
private
File
xslFile
private
String
targetExtension
private
Vector
params
new
Vector
private
File
inFile
private
File
outFile
private
XSLTLiaison
liaison
public
XSLTProcess
public
void
execute
throws
BuildException
DirectoryScanner
scanner
String
list
String
dirs
if
baseDir
baseDir
project
resolveFile
if
destDir
String
msg
throw
new
BuildException
msg
scanner
getDirectoryScanner
baseDir
log
destDir
Project
MSG_INFO
if
liaison
try
setProcessor
catch
Throwable
e1
try
setProcessor
catch
Throwable
e2
try
setProcessor
catch
Throwable
e3
throw
new
BuildException
e1
log
liaison
getClass
toString
Project
MSG_VERBOSE
long
styleSheetLastModified
if
xslFile
try
File
file
new
File
baseDir
xslFile
toString
styleSheetLastModified
file
lastModified
log
file
Project
MSG_INFO
liaison
setStylesheet
file
toString
for
Enumeration
e
params
elements
e
hasMoreElements
Param
p
Param
e
nextElement
liaison
addParam
p
getName
p
getExpression
catch
Exception
ex
log
xslFile
Project
MSG_INFO
throw
new
BuildException
ex
if
inFile
outFile
process
inFile
outFile
styleSheetLastModified
return
list
scanner
getIncludedFiles
for
int
i
i
list
length
i
process
baseDir
list
i
destDir
styleSheetLastModified
dirs
scanner
getIncludedDirectories
for
int
j
j
dirs
length
j
list
new
File
baseDir
dirs
j
list
for
int
i
i
list
length
i
process
baseDir
list
i
destDir
styleSheetLastModified
public
void
setBasedir
File
dir
baseDir
dir
public
void
setDestdir
File
dir
destDir
dir
public
void
setExtension
String
name
targetExtension
name
public
void
setStyle
String
xslFile
this
xslFile
new
File
xslFile
public
void
setProcessor
String
processor
throws
Exception
if
processor
equals
final
Class
clazz
Class
forName
liaison
XSLTLiaison
clazz
newInstance
else
if
processor
equals
final
Class
clazz
Class
forName
liaison
XSLTLiaison
clazz
newInstance
else
if
processor
equals
final
Class
clazz
Class
forName
liaison
XSLTLiaison
clazz
newInstance
else
liaison
XSLTLiaison
Class
forName
processor
newInstance
public
void
setOut
File
outFile
this
outFile
outFile
public
void
setIn
File
inFile
this
inFile
inFile
private
void
process
File
baseDir
String
xmlFile
File
destDir
long
styleSheetLastModified
throws
BuildException
String
fileExt
targetExtension
File
outFile
File
inFile
try
inFile
new
File
baseDir
xmlFile
int
dotPos
xmlFile
lastIndexOf
if
dotPos
outFile
new
File
destDir
xmlFile
substring
xmlFile
lastIndexOf
fileExt
else
outFile
new
File
destDir
xmlFile
fileExt
if
inFile
lastModified
outFile
lastModified
styleSheetLastModified
outFile
lastModified
ensureDirectoryFor
outFile
log
destDir
liaison
transform
inFile
toString
outFile
toString
catch
Exception
ex
log
inFile
Project
MSG_INFO
if
outFile
outFile
delete
throw
new
BuildException
ex
private
void
process
File
inFile
File
outFile
long
styleSheetLastModified
throws
BuildException
try
log
inFile
inFile
lastModified
Project
MSG_DEBUG
log
outFile
outFile
lastModified
Project
MSG_DEBUG
log
xslFile
styleSheetLastModified
Project
MSG_DEBUG
if
inFile
lastModified
outFile
lastModified
styleSheetLastModified
outFile
lastModified
ensureDirectoryFor
outFile
log
inFile
outFile
Project
MSG_INFO
liaison
transform
inFile
toString
outFile
toString
catch
Exception
ex
log
inFile
Project
MSG_INFO
if
outFile
outFile
delete
throw
new
BuildException
ex
private
void
ensureDirectoryFor
File
targetFile
throws
BuildException
File
directory
new
File
targetFile
getParent
if
directory
exists
if
directory
mkdirs
throw
new
BuildException
directory
getAbsolutePath
public
Param
createParam
Param
p
new
Param
params
addElement
p
return
p
public
class
Param
private
String
name
private
String
expression
public
void
setName
String
name
this
name
name
public
void
setExpression
String
expression
this
expression
expression
public
String
getName
throws
BuildException
if
name
throw
new
BuildException
return
name
public
String
getExpression
throws
BuildException
if
expression
throw
new
BuildException
return
expression
