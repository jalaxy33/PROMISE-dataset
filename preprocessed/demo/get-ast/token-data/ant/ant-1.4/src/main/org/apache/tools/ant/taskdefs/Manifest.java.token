package
org
apache
tools
ant
taskdefs
import
java
util
import
java
io
import
org
apache
tools
ant
BuildException
public
class
Manifest
static
public
final
String
ATTRIBUTE_MANIFEST_VERSION
static
public
final
String
ATTRIBUTE_SIGNATURE_VERSION
static
public
final
String
ATTRIBUTE_NAME
static
public
final
String
ATTRIBUTE_FROM
static
public
final
String
DEFAULT_MANIFEST_VERSION
static
public
final
int
MAX_LINE_LENGTH
static
public
class
Attribute
private
String
name
private
String
value
public
Attribute
public
Attribute
String
line
throws
ManifestException
parse
line
public
Attribute
String
name
String
value
this
name
name
this
value
value
public
boolean
equals
Object
rhs
if
rhs
instanceof
Attribute
return
Attribute
rhsAttribute
Attribute
rhs
return
name
rhsAttribute
name
name
toLowerCase
equals
rhsAttribute
name
toLowerCase
value
value
equals
rhsAttribute
value
public
void
parse
String
line
throws
ManifestException
int
index
line
indexOf
if
index
throw
new
ManifestException
line
name
line
substring
index
value
line
substring
index
public
void
setName
String
name
this
name
name
public
String
getName
return
name
public
void
setValue
String
value
this
value
value
public
String
getValue
return
value
public
void
addContinuation
String
line
value
line
substring
public
void
write
PrintWriter
writer
throws
IOException
String
line
name
value
while
line
getBytes
length
MAX_LINE_LENGTH
int
breakIndex
MAX_LINE_LENGTH
String
section
line
substring
breakIndex
while
section
getBytes
length
MAX_LINE_LENGTH
breakIndex
breakIndex
section
line
substring
breakIndex
if
breakIndex
throw
new
IOException
name
value
writer
println
section
line
line
substring
breakIndex
writer
println
line
static
public
class
Section
private
Vector
warnings
new
Vector
private
String
name
private
Hashtable
attributes
new
Hashtable
public
void
setName
String
name
this
name
name
public
String
getName
return
name
public
String
read
BufferedReader
reader
throws
ManifestException
IOException
Attribute
attribute
while
String
line
reader
readLine
if
line
line
length
return
if
line
charAt
if
attribute
throw
new
ManifestException
line
attribute
addContinuation
line
else
attribute
new
Attribute
line
String
nameReadAhead
addAttributeAndCheck
attribute
if
nameReadAhead
return
nameReadAhead
public
void
merge
Section
section
throws
ManifestException
if
name
section
getName
name
name
equalsIgnoreCase
section
getName
throw
new
ManifestException
for
Enumeration
e
section
attributes
keys
e
hasMoreElements
String
attributeName
String
e
nextElement
attributes
put
attributeName
section
attributes
get
attributeName
for
Enumeration
e
section
warnings
elements
e
hasMoreElements
warnings
addElement
e
nextElement
public
void
write
PrintWriter
writer
throws
IOException
if
name
Attribute
nameAttr
new
Attribute
ATTRIBUTE_NAME
name
nameAttr
write
writer
for
Enumeration
e
attributes
elements
e
hasMoreElements
Attribute
attribute
Attribute
e
nextElement
attribute
write
writer
writer
println
public
String
getAttributeValue
String
attributeName
Attribute
attribute
Attribute
attributes
get
attributeName
toLowerCase
if
attribute
return
return
attribute
getValue
public
void
removeAttribute
String
attributeName
attributes
remove
attributeName
toLowerCase
public
void
addConfiguredAttribute
Attribute
attribute
throws
ManifestException
String
check
addAttributeAndCheck
attribute
if
check
throw
new
BuildException
public
String
addAttributeAndCheck
Attribute
attribute
throws
ManifestException
if
attribute
getName
attribute
getValue
throw
new
BuildException
if
attribute
getName
equalsIgnoreCase
ATTRIBUTE_NAME
warnings
addElement
ATTRIBUTE_NAME
attribute
getName
attribute
getValue
return
attribute
getValue
if
attribute
getName
toLowerCase
startsWith
ATTRIBUTE_FROM
toLowerCase
warnings
addElement
ATTRIBUTE_FROM
attribute
getName
attribute
getValue
else
if
attributes
containsKey
attribute
getName
toLowerCase
throw
new
ManifestException
attribute
getName
else
attributes
put
attribute
getName
toLowerCase
attribute
return
public
Enumeration
getWarnings
return
warnings
elements
public
boolean
equals
Object
rhs
if
rhs
instanceof
Section
return
Section
rhsSection
Section
rhs
if
attributes
size
rhsSection
attributes
size
return
for
Enumeration
e
attributes
elements
e
hasMoreElements
Attribute
attribute
Attribute
e
nextElement
Attribute
rshAttribute
Attribute
rhsSection
attributes
get
attribute
getName
toLowerCase
if
attribute
equals
rshAttribute
return
return
private
String
manifestVersion
DEFAULT_MANIFEST_VERSION
private
Section
mainSection
new
Section
private
Hashtable
sections
new
Hashtable
public
Manifest
public
Manifest
InputStream
is
throws
ManifestException
IOException
BufferedReader
reader
new
BufferedReader
new
InputStreamReader
is
String
nextSectionName
mainSection
read
reader
String
readManifestVersion
mainSection
getAttributeValue
ATTRIBUTE_MANIFEST_VERSION
if
readManifestVersion
manifestVersion
readManifestVersion
mainSection
removeAttribute
ATTRIBUTE_MANIFEST_VERSION
String
line
while
line
reader
readLine
if
line
length
continue
Section
section
new
Section
if
nextSectionName
Attribute
sectionName
new
Attribute
line
if
sectionName
getName
equalsIgnoreCase
ATTRIBUTE_NAME
throw
new
ManifestException
ATTRIBUTE_NAME
sectionName
getName
nextSectionName
sectionName
getValue
else
Attribute
firstAttribute
new
Attribute
line
section
addAttributeAndCheck
firstAttribute
section
setName
nextSectionName
nextSectionName
section
read
reader
addConfiguredSection
section
public
void
addConfiguredSection
Section
section
throws
ManifestException
if
section
getName
throw
new
BuildException
sections
put
section
getName
toLowerCase
section
public
void
addConfiguredAttribute
Attribute
attribute
throws
ManifestException
mainSection
addConfiguredAttribute
attribute
public
void
merge
Manifest
other
throws
ManifestException
manifestVersion
other
manifestVersion
mainSection
merge
other
mainSection
for
Enumeration
e
other
sections
keys
e
hasMoreElements
String
sectionName
String
e
nextElement
Section
ourSection
Section
sections
get
sectionName
Section
otherSection
Section
other
sections
get
sectionName
if
ourSection
sections
put
sectionName
toLowerCase
otherSection
else
ourSection
merge
otherSection
public
void
write
PrintWriter
writer
throws
IOException
writer
println
ATTRIBUTE_MANIFEST_VERSION
manifestVersion
String
signatureVersion
mainSection
getAttributeValue
ATTRIBUTE_SIGNATURE_VERSION
if
signatureVersion
writer
println
ATTRIBUTE_SIGNATURE_VERSION
signatureVersion
mainSection
removeAttribute
ATTRIBUTE_SIGNATURE_VERSION
mainSection
write
writer
if
signatureVersion
try
mainSection
addConfiguredAttribute
new
Attribute
ATTRIBUTE_SIGNATURE_VERSION
signatureVersion
catch
ManifestException
e
for
Enumeration
e
sections
elements
e
hasMoreElements
Section
section
Section
e
nextElement
section
write
writer
public
String
toString
StringWriter
sw
new
StringWriter
try
write
new
PrintWriter
sw
catch
IOException
e
return
return
sw
toString
public
Enumeration
getWarnings
Vector
warnings
new
Vector
for
Enumeration
e2
mainSection
getWarnings
e2
hasMoreElements
warnings
addElement
e2
nextElement
for
Enumeration
e
sections
elements
e
hasMoreElements
Section
section
Section
e
nextElement
for
Enumeration
e2
section
getWarnings
e2
hasMoreElements
warnings
addElement
e2
nextElement
return
warnings
elements
public
boolean
equals
Object
rhs
if
rhs
instanceof
Manifest
return
Manifest
rhsManifest
Manifest
rhs
if
manifestVersion
equals
rhsManifest
manifestVersion
return
if
sections
size
rhsManifest
sections
size
return
if
mainSection
equals
rhsManifest
mainSection
return
for
Enumeration
e
sections
elements
e
hasMoreElements
Section
section
Section
e
nextElement
Section
rhsSection
Section
rhsManifest
sections
get
section
getName
toLowerCase
if
section
equals
rhsSection
return
return
