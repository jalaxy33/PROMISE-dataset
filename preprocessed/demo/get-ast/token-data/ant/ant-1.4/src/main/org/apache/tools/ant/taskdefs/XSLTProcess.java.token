package
org
apache
tools
ant
taskdefs
import
java
io
import
java
util
Enumeration
import
java
util
Hashtable
import
java
util
StringTokenizer
import
java
util
Vector
import
org
apache
tools
ant
import
org
apache
tools
ant
types
Path
import
org
apache
tools
ant
types
Reference
import
org
apache
tools
ant
util
FileUtils
public
class
XSLTProcess
extends
MatchingTask
private
File
destDir
private
File
baseDir
private
String
xslFile
private
String
targetExtension
private
Vector
params
new
Vector
private
File
inFile
private
File
outFile
private
String
processor
private
Path
classpath
private
XSLTLiaison
liaison
private
boolean
stylesheetLoaded
private
boolean
force
private
FileUtils
fileUtils
public
XSLTProcess
fileUtils
FileUtils
newFileUtils
public
void
execute
throws
BuildException
DirectoryScanner
scanner
String
list
String
dirs
if
xslFile
throw
new
BuildException
location
if
baseDir
baseDir
project
resolveFile
liaison
getLiaison
log
liaison
getClass
toString
Project
MSG_VERBOSE
File
stylesheet
project
resolveFile
xslFile
if
stylesheet
exists
stylesheet
fileUtils
resolveFile
baseDir
xslFile
if
stylesheet
exists
log
log
if
inFile
outFile
process
inFile
outFile
stylesheet
return
if
destDir
String
msg
throw
new
BuildException
msg
scanner
getDirectoryScanner
baseDir
log
destDir
Project
MSG_INFO
list
scanner
getIncludedFiles
for
int
i
i
list
length
i
process
baseDir
list
i
destDir
stylesheet
dirs
scanner
getIncludedDirectories
for
int
j
j
dirs
length
j
list
new
File
baseDir
dirs
j
list
for
int
i
i
list
length
i
process
baseDir
list
i
destDir
stylesheet
public
void
setForce
boolean
force
this
force
force
public
void
setBasedir
File
dir
baseDir
dir
public
void
setDestdir
File
dir
destDir
dir
public
void
setExtension
String
name
targetExtension
name
public
void
setStyle
String
xslFile
this
xslFile
xslFile
public
void
setClasspath
Path
classpath
createClasspath
append
classpath
public
Path
createClasspath
if
classpath
classpath
new
Path
project
return
classpath
createPath
public
void
setClasspathRef
Reference
r
createClasspath
setRefid
r
public
void
setProcessor
String
processor
this
processor
processor
private
void
resolveProcessor
String
proc
throws
Exception
if
proc
equals
final
Class
clazz
loadClass
liaison
XSLTLiaison
clazz
newInstance
else
if
proc
equals
log
final
Class
clazz
loadClass
liaison
XSLTLiaison
clazz
newInstance
else
if
proc
equals
final
Class
clazz
loadClass
liaison
XSLTLiaison
clazz
newInstance
else
liaison
XSLTLiaison
loadClass
proc
newInstance
private
Class
loadClass
String
classname
throws
Exception
if
classpath
return
Class
forName
classname
else
AntClassLoader
al
new
AntClassLoader
project
classpath
Class
c
al
loadClass
classname
AntClassLoader
initializeClass
c
return
c
public
void
setOut
File
outFile
this
outFile
outFile
public
void
setIn
File
inFile
this
inFile
inFile
private
void
process
File
baseDir
String
xmlFile
File
destDir
File
stylesheet
throws
BuildException
String
fileExt
targetExtension
File
outFile
File
inFile
try
long
styleSheetLastModified
stylesheet
lastModified
inFile
new
File
baseDir
xmlFile
int
dotPos
xmlFile
lastIndexOf
if
dotPos
outFile
new
File
destDir
xmlFile
substring
xmlFile
lastIndexOf
fileExt
else
outFile
new
File
destDir
xmlFile
fileExt
if
force
inFile
lastModified
outFile
lastModified
styleSheetLastModified
outFile
lastModified
ensureDirectoryFor
outFile
log
destDir
configureLiaison
stylesheet
liaison
transform
inFile
outFile
catch
Exception
ex
log
inFile
Project
MSG_INFO
if
outFile
outFile
delete
throw
new
BuildException
ex
private
void
process
File
inFile
File
outFile
File
stylesheet
throws
BuildException
try
long
styleSheetLastModified
stylesheet
lastModified
log
inFile
inFile
lastModified
Project
MSG_DEBUG
log
outFile
outFile
lastModified
Project
MSG_DEBUG
log
xslFile
styleSheetLastModified
Project
MSG_DEBUG
if
force
inFile
lastModified
outFile
lastModified
styleSheetLastModified
outFile
lastModified
ensureDirectoryFor
outFile
log
inFile
outFile
Project
MSG_INFO
configureLiaison
stylesheet
liaison
transform
inFile
outFile
catch
Exception
ex
log
inFile
Project
MSG_INFO
if
outFile
outFile
delete
throw
new
BuildException
ex
private
void
ensureDirectoryFor
File
targetFile
throws
BuildException
File
directory
new
File
targetFile
getParent
if
directory
exists
if
directory
mkdirs
throw
new
BuildException
directory
getAbsolutePath
protected
XSLTLiaison
getLiaison
if
liaison
if
processor
try
resolveProcessor
processor
catch
Exception
e
throw
new
BuildException
e
else
try
resolveProcessor
catch
Throwable
e1
try
resolveProcessor
catch
Throwable
e2
try
resolveProcessor
catch
Throwable
e3
e3
printStackTrace
e2
printStackTrace
throw
new
BuildException
e1
return
liaison
public
Param
createParam
Param
p
new
Param
params
addElement
p
return
p
public
class
Param
private
String
name
private
String
expression
public
void
setName
String
name
this
name
name
public
void
setExpression
String
expression
this
expression
expression
public
String
getName
throws
BuildException
if
name
throw
new
BuildException
return
name
public
String
getExpression
throws
BuildException
if
expression
throw
new
BuildException
return
expression
protected
void
configureLiaison
File
stylesheet
throws
BuildException
if
stylesheetLoaded
return
stylesheetLoaded
try
log
stylesheet
Project
MSG_INFO
liaison
setStylesheet
stylesheet
for
Enumeration
e
params
elements
e
hasMoreElements
Param
p
Param
e
nextElement
liaison
addParam
p
getName
p
getExpression
catch
Exception
ex
log
stylesheet
Project
MSG_INFO
throw
new
BuildException
ex
