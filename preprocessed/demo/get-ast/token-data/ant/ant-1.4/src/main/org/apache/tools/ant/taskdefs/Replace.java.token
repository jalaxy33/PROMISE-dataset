package
org
apache
tools
ant
taskdefs
import
org
apache
tools
ant
import
org
apache
tools
ant
taskdefs
import
java
io
import
java
util
public
class
Replace
extends
MatchingTask
private
File
src
private
NestedString
token
private
NestedString
value
new
NestedString
private
File
propertyFile
private
Properties
properties
private
Vector
replacefilters
new
Vector
private
File
dir
private
int
fileCount
private
int
replaceCount
private
boolean
summary
public
class
NestedString
private
StringBuffer
buf
new
StringBuffer
public
void
addText
String
val
buf
append
val
public
String
getText
return
buf
toString
public
class
Replacefilter
private
String
token
private
String
value
private
String
property
public
void
validate
throws
BuildException
if
token
String
message
throw
new
BuildException
message
if
equals
token
String
message
throw
new
BuildException
message
if
value
property
String
message
throw
new
BuildException
message
if
property
if
propertyFile
String
message
throw
new
BuildException
message
if
properties
properties
getProperty
property
String
message
property
propertyFile
getPath
throw
new
BuildException
message
public
String
getReplaceValue
if
property
return
String
properties
getProperty
property
else
if
value
return
value
else
if
Replace
this
value
return
Replace
this
value
getText
else
return
new
String
public
void
setToken
String
token
this
token
token
public
String
getToken
return
token
public
void
setValue
String
value
this
value
value
public
String
getValue
return
value
public
void
setProperty
String
property
this
property
property
public
String
getProperty
return
property
public
void
execute
throws
BuildException
validateAttributes
if
propertyFile
properties
getProperties
propertyFile
validateReplacefilters
fileCount
replaceCount
if
src
processFile
src
if
dir
DirectoryScanner
ds
super
getDirectoryScanner
dir
String
srcs
ds
getIncludedFiles
for
int
i
i
srcs
length
i
File
file
new
File
dir
srcs
i
processFile
file
if
summary
log
replaceCount
fileCount
Project
MSG_INFO
public
void
validateAttributes
throws
BuildException
if
src
dir
String
message
throw
new
BuildException
message
location
if
propertyFile
propertyFile
exists
String
message
propertyFile
getPath
throw
new
BuildException
message
location
if
token
replacefilters
size
String
message
throw
new
BuildException
message
location
if
token
equals
token
getText
String
message
throw
new
BuildException
message
location
public
void
validateReplacefilters
throws
BuildException
for
int
i
i
replacefilters
size
i
Replacefilter
element
Replacefilter
replacefilters
elementAt
i
element
validate
public
Properties
getProperties
File
propertyFile
throws
BuildException
Properties
properties
new
Properties
try
properties
load
new
FileInputStream
propertyFile
catch
FileNotFoundException
e
String
message
propertyFile
getPath
throw
new
BuildException
message
catch
IOException
e
String
message
propertyFile
getPath
throw
new
BuildException
message
return
properties
private
void
processFile
File
src
throws
BuildException
if
src
exists
throw
new
BuildException
src
getPath
location
File
temp
new
File
src
getPath
if
temp
exists
throw
new
BuildException
temp
getPath
location
try
BufferedReader
br
new
BufferedReader
new
FileReader
src
BufferedWriter
bw
new
BufferedWriter
new
FileWriter
temp
int
fileLengthInBytes
int
src
length
StringBuffer
tmpBuf
new
StringBuffer
fileLengthInBytes
int
readChar
int
totread
while
readChar
br
read
if
readChar
break
tmpBuf
append
char
readChar
totread
String
buf
tmpBuf
toString
String
newString
new
String
buf
if
token
String
linesep
System
getProperty
String
val
stringReplace
value
getText
linesep
String
tok
stringReplace
token
getText
linesep
log
src
getPath
token
getText
value
getText
Project
MSG_VERBOSE
newString
stringReplace
newString
tok
val
if
replacefilters
size
newString
processReplacefilters
newString
src
getPath
boolean
changes
newString
equals
buf
if
changes
bw
write
newString
newString
length
bw
flush
bw
close
br
close
if
changes
fileCount
src
delete
temp
renameTo
src
else
temp
delete
catch
IOException
ioe
ioe
printStackTrace
throw
new
BuildException
ioe
location
private
String
processReplacefilters
String
buffer
String
filename
String
newString
new
String
buffer
for
int
i
i
replacefilters
size
i
Replacefilter
filter
Replacefilter
replacefilters
elementAt
i
log
filename
filter
getToken
filter
getReplaceValue
Project
MSG_VERBOSE
newString
stringReplace
newString
filter
getToken
filter
getReplaceValue
return
newString
public
void
setFile
File
file
this
src
file
public
void
setSummary
boolean
summary
this
summary
summary
public
void
setDir
File
dir
this
dir
dir
public
void
setToken
String
token
createReplaceToken
addText
token
public
void
setValue
String
value
createReplaceValue
addText
value
public
NestedString
createReplaceToken
if
token
token
new
NestedString
return
token
public
NestedString
createReplaceValue
return
value
public
void
setPropertyFile
File
filename
propertyFile
filename
public
Replacefilter
createReplacefilter
Replacefilter
filter
new
Replacefilter
replacefilters
addElement
filter
return
filter
private
String
stringReplace
String
str
String
str1
String
str2
StringBuffer
ret
new
StringBuffer
int
start
int
found
str
indexOf
str1
while
found
if
found
start
ret
append
str
substring
start
found
if
str2
ret
append
str2
start
found
str1
length
found
str
indexOf
str1
start
replaceCount
if
str
length
start
ret
append
str
substring
start
str
length
return
ret
toString
