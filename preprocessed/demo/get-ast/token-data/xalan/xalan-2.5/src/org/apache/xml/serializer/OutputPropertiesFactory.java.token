package
org
apache
xml
serializer
import
java
io
BufferedInputStream
import
java
io
IOException
import
java
io
InputStream
import
java
util
Enumeration
import
java
util
Properties
import
javax
xml
transform
OutputKeys
import
org
apache
xml
res
XMLErrorResources
import
org
apache
xml
res
XMLMessages
import
org
apache
xml
utils
Constants
import
org
apache
xml
utils
WrappedRuntimeException
public
class
OutputPropertiesFactory
public
static
final
String
S_BUILTIN_EXTENSIONS_UNIVERSAL
Constants
S_BUILTIN_EXTENSIONS_URL
public
static
final
String
S_KEY_INDENT_AMOUNT
S_BUILTIN_EXTENSIONS_UNIVERSAL
public
static
final
String
S_KEY_CONTENT_HANDLER
S_BUILTIN_EXTENSIONS_UNIVERSAL
public
static
final
String
S_KEY_ENTITIES
S_BUILTIN_EXTENSIONS_UNIVERSAL
public
static
final
String
S_USE_URL_ESCAPING
S_BUILTIN_EXTENSIONS_UNIVERSAL
public
static
final
String
S_OMIT_META_TAG
S_BUILTIN_EXTENSIONS_UNIVERSAL
public
static
final
String
S_BUILTIN_OLD_EXTENSIONS_UNIVERSAL
Constants
S_BUILTIN_OLD_EXTENSIONS_URL
public
static
final
int
S_BUILTIN_OLD_EXTENSIONS_UNIVERSAL_LEN
S_BUILTIN_OLD_EXTENSIONS_UNIVERSAL
length
private
static
final
String
S_XSLT_PREFIX
private
static
final
int
S_XSLT_PREFIX_LEN
S_XSLT_PREFIX
length
private
static
final
String
S_XALAN_PREFIX
private
static
final
int
S_XALAN_PREFIX_LEN
S_XALAN_PREFIX
length
private
static
final
Class
NO_CLASSES
new
Class
private
static
Integer
m_synch_object
new
Integer
private
static
final
Object
NO_OBJS
new
Object
private
static
final
String
PROP_DIR
private
static
final
String
PROP_FILE_XML
private
static
final
String
PROP_FILE_TEXT
private
static
final
String
PROP_FILE_HTML
private
static
final
String
PROP_FILE_UNKNOWN
private
static
Properties
m_xml_properties
private
static
Properties
m_html_properties
private
static
Properties
m_text_properties
private
static
Properties
m_unknown_properties
static
public
Properties
getDefaultMethodProperties
String
method
String
fileName
Properties
defaultProperties
try
synchronized
m_synch_object
if
m_xml_properties
fileName
PROP_FILE_XML
m_xml_properties
loadPropertiesFile
fileName
if
method
equals
Method
XML
defaultProperties
m_xml_properties
else
if
method
equals
Method
HTML
if
m_html_properties
fileName
PROP_FILE_HTML
m_html_properties
loadPropertiesFile
fileName
m_xml_properties
defaultProperties
m_html_properties
else
if
method
equals
Method
TEXT
if
m_text_properties
fileName
PROP_FILE_TEXT
m_text_properties
loadPropertiesFile
fileName
m_xml_properties
if
m_text_properties
getProperty
OutputKeys
ENCODING
String
mimeEncoding
Encodings
getMimeEncoding
m_text_properties
put
OutputKeys
ENCODING
mimeEncoding
defaultProperties
m_text_properties
else
if
method
equals
org
apache
xml
serializer
Method
UNKNOWN
if
m_unknown_properties
fileName
PROP_FILE_UNKNOWN
m_unknown_properties
loadPropertiesFile
fileName
m_xml_properties
defaultProperties
m_unknown_properties
else
defaultProperties
m_xml_properties
catch
IOException
ioe
throw
new
WrappedRuntimeException
XMLMessages
createXMLMessage
XMLErrorResources
ER_COULD_NOT_LOAD_METHOD_PROPERTY
new
Object
fileName
method
ioe
return
defaultProperties
static
private
Properties
loadPropertiesFile
final
String
resourceName
Properties
defaults
throws
IOException
Properties
props
new
Properties
defaults
InputStream
is
BufferedInputStream
bis
Class
accessControllerClass
try
try
try
accessControllerClass
Class
forName
is
InputStream
java
security
AccessController
doPrivileged
new
java
security
PrivilegedAction
public
Object
run
try
java
lang
reflect
Method
getCCL
Thread
class
getMethod
NO_CLASSES
if
getCCL
ClassLoader
contextClassLoader
ClassLoader
getCCL
invoke
Thread
currentThread
NO_OBJS
return
contextClassLoader
getResourceAsStream
PROP_DIR
resourceName
catch
Exception
e
return
catch
ClassNotFoundException
e
try
java
lang
reflect
Method
getCCL
Thread
class
getMethod
NO_CLASSES
if
getCCL
ClassLoader
contextClassLoader
ClassLoader
getCCL
invoke
Thread
currentThread
NO_OBJS
is
contextClassLoader
getResourceAsStream
PROP_DIR
resourceName
catch
Exception
exception
catch
Exception
e
if
is
if
accessControllerClass
is
InputStream
java
security
AccessController
doPrivileged
new
java
security
PrivilegedAction
public
Object
run
return
OutputPropertiesFactory
class
getResourceAsStream
resourceName
else
is
OutputPropertiesFactory
class
getResourceAsStream
resourceName
bis
new
BufferedInputStream
is
props
load
bis
catch
IOException
ioe
if
defaults
throw
ioe
else
throw
new
WrappedRuntimeException
XMLMessages
createXMLMessage
XMLErrorResources
ER_COULD_NOT_LOAD_RESOURCE
new
Object
resourceName
ioe
catch
SecurityException
se
if
defaults
throw
se
else
throw
new
WrappedRuntimeException
XMLMessages
createXMLMessage
XMLErrorResources
ER_COULD_NOT_LOAD_RESOURCE
new
Object
resourceName
se
finally
if
bis
bis
close
if
is
is
close
Enumeration
keys
Properties
props
clone
keys
while
keys
hasMoreElements
String
key
String
keys
nextElement
String
value
try
value
System
getProperty
key
catch
SecurityException
se
if
value
value
String
props
get
key
String
newKey
fixupPropertyString
key
String
newValue
try
newValue
System
getProperty
newKey
catch
SecurityException
se
if
newValue
newValue
fixupPropertyString
value
else
newValue
fixupPropertyString
newValue
if
key
newKey
value
newValue
props
remove
key
props
put
newKey
newValue
return
props
static
private
String
fixupPropertyString
String
s
boolean
doClipping
int
index
if
doClipping
s
startsWith
S_XSLT_PREFIX
s
s
substring
S_XSLT_PREFIX_LEN
if
s
startsWith
S_XALAN_PREFIX
s
S_BUILTIN_EXTENSIONS_UNIVERSAL
s
substring
S_XALAN_PREFIX_LEN
if
index
s
indexOf
String
temp
s
substring
index
s
s
substring
index
temp
return
s
