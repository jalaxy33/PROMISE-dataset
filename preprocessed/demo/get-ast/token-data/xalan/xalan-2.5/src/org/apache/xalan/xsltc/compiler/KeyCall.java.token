package
org
apache
xalan
xsltc
compiler
import
java
util
Vector
import
org
apache
bcel
generic
ALOAD
import
org
apache
bcel
generic
ASTORE
import
org
apache
bcel
generic
BranchHandle
import
org
apache
bcel
generic
ConstantPoolGen
import
org
apache
bcel
generic
GOTO
import
org
apache
bcel
generic
IFGT
import
org
apache
bcel
generic
INVOKEINTERFACE
import
org
apache
bcel
generic
INVOKESPECIAL
import
org
apache
bcel
generic
INVOKEVIRTUAL
import
org
apache
bcel
generic
InstructionHandle
import
org
apache
bcel
generic
InstructionList
import
org
apache
bcel
generic
LocalVariableGen
import
org
apache
bcel
generic
NEW
import
org
apache
bcel
generic
PUSH
import
org
apache
xalan
xsltc
compiler
util
ClassGenerator
import
org
apache
xalan
xsltc
compiler
util
MethodGenerator
import
org
apache
xalan
xsltc
compiler
util
StringType
import
org
apache
xalan
xsltc
compiler
util
Type
import
org
apache
xalan
xsltc
compiler
util
TypeCheckError
import
org
apache
xalan
xsltc
compiler
util
Util
final
class
KeyCall
extends
FunctionCall
private
Expression
_name
private
Expression
_value
private
Type
_valueType
private
QName
_resolvedQName
public
KeyCall
QName
fname
Vector
arguments
super
fname
arguments
switch
argumentCount
case
_name
_value
argument
break
case
_name
argument
_value
argument
break
default
_name
_value
break
public
Type
typeCheck
SymbolTable
stable
throws
TypeCheckError
final
Type
returnType
super
typeCheck
stable
if
_name
final
Type
nameType
_name
typeCheck
stable
if
_name
instanceof
LiteralExpr
final
LiteralExpr
literal
LiteralExpr
_name
_resolvedQName
getParser
getQNameIgnoreDefaultNs
literal
getValue
else
if
nameType
instanceof
StringType
_name
new
CastExpr
_name
Type
String
_valueType
_value
typeCheck
stable
if
_valueType
Type
NodeSet
_valueType
Type
String
_value
new
CastExpr
_value
Type
String
return
returnType
public
void
translate
ClassGenerator
classGen
MethodGenerator
methodGen
final
ConstantPoolGen
cpg
classGen
getConstantPool
final
InstructionList
il
methodGen
getInstructionList
final
int
getNodeHandle
cpg
addInterfaceMethodref
DOM_INTF
NODE_SIG
final
int
dupInit
cpg
addMethodref
DUP_FILTERED_ITERATOR
NODE_ITERATOR_SIG
il
append
new
NEW
cpg
addClass
DUP_FILTERED_ITERATOR
il
append
DUP
translateCall
classGen
methodGen
il
append
new
INVOKESPECIAL
dupInit
private
void
translateCall
ClassGenerator
classGen
MethodGenerator
methodGen
final
ConstantPoolGen
cpg
classGen
getConstantPool
final
InstructionList
il
methodGen
getInstructionList
final
int
getNodeValue
cpg
addInterfaceMethodref
DOM_INTF
GET_NODE_VALUE
STRING_SIG
final
int
getKeyIndex
cpg
addMethodref
TRANSLET_CLASS
KEY_INDEX_SIG
final
int
lookupId
cpg
addMethodref
KEY_INDEX_CLASS
final
int
lookupKey
cpg
addMethodref
KEY_INDEX_CLASS
final
int
merge
cpg
addMethodref
KEY_INDEX_CLASS
KEY_INDEX_SIG
final
int
indexConstructor
cpg
addMethodref
TRANSLET_CLASS
KEY_INDEX_SIG
final
int
keyDom
cpg
addMethodref
XSLT_PACKAGE
DOM_INTF_SIG
final
LocalVariableGen
returnIndex
methodGen
addLocalVariable
Util
getJCRefType
KEY_INDEX_SIG
il
getEnd
final
LocalVariableGen
searchIndex
methodGen
addLocalVariable
Util
getJCRefType
KEY_INDEX_SIG
il
getEnd
if
_valueType
Type
NodeSet
il
append
methodGen
loadCurrentNode
il
append
methodGen
loadIterator
_value
translate
classGen
methodGen
_value
startResetIterator
classGen
methodGen
il
append
methodGen
storeIterator
il
append
classGen
loadTranslet
il
append
new
INVOKEVIRTUAL
indexConstructor
il
append
DUP
il
append
methodGen
loadDOM
il
append
new
INVOKEVIRTUAL
keyDom
il
append
new
ASTORE
returnIndex
getIndex
il
append
classGen
loadTranslet
if
_name
il
append
new
PUSH
cpg
else
if
_resolvedQName
il
append
new
PUSH
cpg
_resolvedQName
toString
else
_name
translate
classGen
methodGen
il
append
new
INVOKEVIRTUAL
getKeyIndex
il
append
new
ASTORE
searchIndex
getIndex
final
BranchHandle
nextNode
il
append
new
GOTO
final
InstructionHandle
loop
il
append
NOP
il
append
new
ALOAD
returnIndex
getIndex
il
append
new
ALOAD
searchIndex
getIndex
il
append
DUP
il
append
methodGen
loadDOM
il
append
methodGen
loadCurrentNode
il
append
new
INVOKEINTERFACE
getNodeValue
if
_name
il
append
new
INVOKEVIRTUAL
lookupId
else
il
append
new
INVOKEVIRTUAL
lookupKey
il
append
new
INVOKEVIRTUAL
merge
nextNode
setTarget
il
append
methodGen
loadIterator
il
append
methodGen
nextNode
il
append
DUP
il
append
methodGen
storeCurrentNode
il
append
new
IFGT
loop
il
append
methodGen
storeIterator
il
append
methodGen
storeCurrentNode
il
append
new
ALOAD
returnIndex
getIndex
else
il
append
classGen
loadTranslet
if
_name
il
append
new
PUSH
cpg
else
if
_resolvedQName
il
append
new
PUSH
cpg
_resolvedQName
toString
else
_name
translate
classGen
methodGen
il
append
new
INVOKEVIRTUAL
getKeyIndex
il
append
DUP
_value
translate
classGen
methodGen
if
_name
il
append
new
INVOKEVIRTUAL
lookupId
else
il
append
new
INVOKEVIRTUAL
lookupKey
