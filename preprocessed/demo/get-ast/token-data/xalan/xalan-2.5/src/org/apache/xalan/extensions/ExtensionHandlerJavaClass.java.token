package
org
apache
xalan
extensions
import
java
io
IOException
import
java
lang
reflect
Constructor
import
java
lang
reflect
InvocationTargetException
import
java
lang
reflect
Method
import
java
lang
reflect
Modifier
import
java
util
Vector
import
javax
xml
transform
TransformerException
import
org
apache
xalan
templates
ElemTemplateElement
import
org
apache
xalan
templates
Stylesheet
import
org
apache
xalan
transformer
TransformerImpl
import
org
apache
xpath
functions
FuncExtFunction
import
org
apache
xpath
objects
XObject
public
class
ExtensionHandlerJavaClass
extends
ExtensionHandlerJava
private
Class
m_classObj
private
Object
m_defaultInstance
public
ExtensionHandlerJavaClass
String
namespaceUri
String
scriptLang
String
className
super
namespaceUri
scriptLang
className
try
m_classObj
getClassForName
className
catch
ClassNotFoundException
e
public
boolean
isFunctionAvailable
String
function
Method
methods
m_classObj
getMethods
int
nMethods
methods
length
for
int
i
i
nMethods
i
if
methods
i
getName
equals
function
return
return
public
boolean
isElementAvailable
String
element
Method
methods
m_classObj
getMethods
int
nMethods
methods
length
for
int
i
i
nMethods
i
if
methods
i
getName
equals
element
Class
paramTypes
methods
i
getParameterTypes
if
paramTypes
length
paramTypes
isAssignableFrom
org
apache
xalan
extensions
XSLProcessorContext
class
paramTypes
isAssignableFrom
org
apache
xalan
templates
ElemExtensionCall
class
return
return
public
Object
callFunction
String
funcName
Vector
args
Object
methodKey
ExpressionContext
exprContext
throws
TransformerException
Object
methodArgs
Object
convertedArgs
Class
paramTypes
try
if
funcName
equals
methodArgs
new
Object
args
size
convertedArgs
new
Object
for
int
i
i
methodArgs
length
i
methodArgs
i
args
elementAt
i
Constructor
c
Constructor
getFromCache
methodKey
methodArgs
if
c
try
paramTypes
c
getParameterTypes
MethodResolver
convertParams
methodArgs
convertedArgs
paramTypes
exprContext
return
c
newInstance
convertedArgs
catch
InvocationTargetException
ite
throw
ite
catch
Exception
e
c
MethodResolver
getConstructor
m_classObj
methodArgs
convertedArgs
exprContext
putToCache
methodKey
methodArgs
c
return
c
newInstance
convertedArgs
else
int
resolveType
Object
targetObject
methodArgs
new
Object
args
size
convertedArgs
new
Object
for
int
i
i
methodArgs
length
i
methodArgs
i
args
elementAt
i
Method
m
Method
getFromCache
methodKey
methodArgs
if
m
try
paramTypes
m
getParameterTypes
MethodResolver
convertParams
methodArgs
convertedArgs
paramTypes
exprContext
if
Modifier
isStatic
m
getModifiers
return
m
invoke
convertedArgs
else
int
nTargetArgs
convertedArgs
length
if
ExpressionContext
class
isAssignableFrom
paramTypes
nTargetArgs
if
methodArgs
length
nTargetArgs
return
m
invoke
m_defaultInstance
convertedArgs
else
targetObject
methodArgs
if
targetObject
instanceof
XObject
targetObject
XObject
targetObject
object
return
m
invoke
targetObject
convertedArgs
catch
InvocationTargetException
ite
throw
ite
catch
Exception
e
if
args
size
targetObject
methodArgs
if
targetObject
instanceof
XObject
targetObject
XObject
targetObject
object
if
m_classObj
isAssignableFrom
targetObject
getClass
resolveType
MethodResolver
DYNAMIC
else
resolveType
MethodResolver
STATIC_AND_INSTANCE
else
targetObject
resolveType
MethodResolver
STATIC_AND_INSTANCE
m
MethodResolver
getMethod
m_classObj
funcName
methodArgs
convertedArgs
exprContext
resolveType
putToCache
methodKey
methodArgs
m
if
MethodResolver
DYNAMIC
resolveType
return
m
invoke
targetObject
convertedArgs
else
if
Modifier
isStatic
m
getModifiers
return
m
invoke
convertedArgs
else
if
m_defaultInstance
m_defaultInstance
m_classObj
newInstance
return
m
invoke
m_defaultInstance
convertedArgs
catch
InvocationTargetException
ite
Throwable
resultException
ite
Throwable
targetException
ite
getTargetException
if
targetException
instanceof
TransformerException
throw
TransformerException
targetException
else
if
targetException
resultException
targetException
throw
new
TransformerException
resultException
catch
Exception
e
throw
new
TransformerException
e
public
Object
callFunction
FuncExtFunction
extFunction
Vector
args
ExpressionContext
exprContext
throws
TransformerException
return
callFunction
extFunction
getFunctionName
args
extFunction
getMethodKey
exprContext
public
void
processElement
String
localPart
ElemTemplateElement
element
TransformerImpl
transformer
Stylesheet
stylesheetTree
Object
methodKey
throws
TransformerException
IOException
Object
result
Method
m
Method
getFromCache
methodKey
if
m
try
m
MethodResolver
getElementMethod
m_classObj
localPart
if
m_defaultInstance
Modifier
isStatic
m
getModifiers
m_defaultInstance
m_classObj
newInstance
catch
Exception
e
throw
new
TransformerException
e
getMessage
e
putToCache
methodKey
m
XSLProcessorContext
xpc
new
XSLProcessorContext
transformer
stylesheetTree
try
result
m
invoke
m_defaultInstance
new
Object
xpc
element
catch
InvocationTargetException
e
Throwable
targetException
e
getTargetException
if
targetException
instanceof
TransformerException
throw
TransformerException
targetException
else
if
targetException
throw
new
TransformerException
targetException
getMessage
targetException
else
throw
new
TransformerException
e
getMessage
e
catch
Exception
e
throw
new
TransformerException
e
getMessage
e
if
result
xpc
outputToResultTree
stylesheetTree
result
