package
org
apache
xalan
xsltc
compiler
import
java
text
Collator
import
java
util
ArrayList
import
java
util
NoSuchElementException
import
java
util
StringTokenizer
import
java
util
Vector
import
org
apache
bcel
classfile
Field
import
org
apache
bcel
classfile
Method
import
org
apache
bcel
generic
ALOAD
import
org
apache
bcel
generic
ANEWARRAY
import
org
apache
bcel
generic
CHECKCAST
import
org
apache
bcel
generic
ConstantPoolGen
import
org
apache
bcel
generic
GETFIELD
import
org
apache
bcel
generic
ICONST
import
org
apache
bcel
generic
ILOAD
import
org
apache
bcel
generic
INVOKEINTERFACE
import
org
apache
bcel
generic
INVOKESPECIAL
import
org
apache
bcel
generic
INVOKESTATIC
import
org
apache
bcel
generic
INVOKEVIRTUAL
import
org
apache
bcel
generic
InstructionHandle
import
org
apache
bcel
generic
InstructionList
import
org
apache
bcel
generic
NEW
import
org
apache
bcel
generic
NOP
import
org
apache
bcel
generic
PUSH
import
org
apache
bcel
generic
PUTFIELD
import
org
apache
bcel
generic
TABLESWITCH
import
org
apache
xalan
xsltc
compiler
util
ClassGenerator
import
org
apache
xalan
xsltc
compiler
util
CompareGenerator
import
org
apache
xalan
xsltc
compiler
util
ErrorMsg
import
org
apache
xalan
xsltc
compiler
util
IntType
import
org
apache
xalan
xsltc
compiler
util
MethodGenerator
import
org
apache
xalan
xsltc
compiler
util
NodeSortRecordFactGenerator
import
org
apache
xalan
xsltc
compiler
util
NodeSortRecordGenerator
import
org
apache
xalan
xsltc
compiler
util
StringType
import
org
apache
xalan
xsltc
compiler
util
Type
import
org
apache
xalan
xsltc
compiler
util
TypeCheckError
import
org
apache
xalan
xsltc
compiler
util
Util
import
org
apache
xalan
xsltc
dom
Axis
final
class
Sort
extends
Instruction
implements
Closure
private
Expression
_select
private
AttributeValue
_order
private
AttributeValue
_caseOrder
private
AttributeValue
_dataType
private
String
_data
public
String
_lang
public
String
_country
private
String
_className
private
ArrayList
_closureVars
private
boolean
_needsSortRecordFactory
public
boolean
inInnerClass
return
_className
public
Closure
getParentClosure
return
public
String
getInnerClassName
return
_className
public
void
addVariable
VariableRefBase
variableRef
if
_closureVars
_closureVars
new
ArrayList
if
_closureVars
contains
variableRef
_closureVars
add
variableRef
_needsSortRecordFactory
private
void
setInnerClassName
String
className
_className
className
public
void
parseContents
Parser
parser
final
SyntaxTreeNode
parent
getParent
if
parent
instanceof
ApplyTemplates
parent
instanceof
ForEach
reportError
this
parser
ErrorMsg
STRAY_SORT_ERR
return
_select
parser
parseExpression
this
String
val
getAttribute
if
val
length
val
_order
AttributeValue
create
this
val
parser
val
getAttribute
if
val
length
val
_caseOrder
AttributeValue
create
this
val
parser
val
getAttribute
if
val
length
try
final
Type
type
_select
typeCheck
parser
getSymbolTable
if
type
instanceof
IntType
val
else
val
catch
TypeCheckError
e
val
_dataType
AttributeValue
create
this
val
parser
if
val
getAttribute
try
StringTokenizer
st
new
StringTokenizer
val
_lang
st
nextToken
_country
st
nextToken
catch
NoSuchElementException
e
public
Type
typeCheck
SymbolTable
stable
throws
TypeCheckError
final
Type
tselect
_select
typeCheck
stable
if
tselect
instanceof
StringType
_select
new
CastExpr
_select
Type
String
_order
typeCheck
stable
_caseOrder
typeCheck
stable
_dataType
typeCheck
stable
return
Type
Void
public
void
translateSortType
ClassGenerator
classGen
MethodGenerator
methodGen
_dataType
translate
classGen
methodGen
public
void
translateSortOrder
ClassGenerator
classGen
MethodGenerator
methodGen
_order
translate
classGen
methodGen
public
void
translateSelect
ClassGenerator
classGen
MethodGenerator
methodGen
_select
translate
classGen
methodGen
public
void
translate
ClassGenerator
classGen
MethodGenerator
methodGen
public
static
void
translateSortIterator
ClassGenerator
classGen
MethodGenerator
methodGen
Expression
nodeSet
Vector
sortObjects
final
ConstantPoolGen
cpg
classGen
getConstantPool
final
InstructionList
il
methodGen
getInstructionList
final
int
init
cpg
addMethodref
SORT_ITERATOR
NODE_ITERATOR_SIG
NODE_SORT_FACTORY_SIG
il
append
new
NEW
cpg
addClass
SORT_ITERATOR
il
append
DUP
if
nodeSet
final
int
children
cpg
addInterfaceMethodref
DOM_INTF
NODE_ITERATOR_SIG
il
append
methodGen
loadDOM
il
append
new
PUSH
cpg
Axis
CHILD
il
append
new
INVOKEINTERFACE
children
else
nodeSet
translate
classGen
methodGen
compileSortRecordFactory
sortObjects
classGen
methodGen
il
append
new
INVOKESPECIAL
init
public
static
void
compileSortRecordFactory
Vector
sortObjects
ClassGenerator
classGen
MethodGenerator
methodGen
String
sortRecordClass
compileSortRecord
sortObjects
classGen
methodGen
boolean
needsSortRecordFactory
final
int
nsorts
sortObjects
size
for
int
i
i
nsorts
i
final
Sort
sort
Sort
sortObjects
elementAt
i
needsSortRecordFactory
sort
_needsSortRecordFactory
String
sortRecordFactoryClass
NODE_SORT_FACTORY
if
needsSortRecordFactory
sortRecordFactoryClass
compileSortRecordFactory
sortObjects
classGen
methodGen
sortRecordClass
final
ConstantPoolGen
cpg
classGen
getConstantPool
final
InstructionList
il
methodGen
getInstructionList
il
append
new
NEW
cpg
addClass
sortRecordFactoryClass
il
append
DUP
il
append
methodGen
loadDOM
il
append
new
PUSH
cpg
sortRecordClass
il
append
classGen
loadTranslet
il
append
new
PUSH
cpg
nsorts
il
append
new
ANEWARRAY
cpg
addClass
STRING
for
int
level
level
nsorts
level
final
Sort
sort
Sort
sortObjects
elementAt
level
il
append
DUP
il
append
new
PUSH
cpg
level
sort
translateSortOrder
classGen
methodGen
il
append
AASTORE
il
append
new
PUSH
cpg
nsorts
il
append
new
ANEWARRAY
cpg
addClass
STRING
for
int
level
level
nsorts
level
final
Sort
sort
Sort
sortObjects
elementAt
level
il
append
DUP
il
append
new
PUSH
cpg
level
sort
translateSortType
classGen
methodGen
il
append
AASTORE
il
append
new
INVOKESPECIAL
cpg
addMethodref
sortRecordFactoryClass
DOM_INTF_SIG
STRING_SIG
TRANSLET_INTF_SIG
STRING_SIG
STRING_SIG
final
ArrayList
dups
new
ArrayList
for
int
j
j
nsorts
j
final
Sort
sort
Sort
sortObjects
get
j
final
int
length
sort
_closureVars
sort
_closureVars
size
for
int
i
i
length
i
VariableRefBase
varRef
VariableRefBase
sort
_closureVars
get
i
if
dups
contains
varRef
continue
final
VariableBase
var
varRef
getVariable
il
append
DUP
il
append
var
loadInstruction
il
append
new
PUTFIELD
cpg
addFieldref
sortRecordFactoryClass
var
getVariable
var
getType
toSignature
dups
add
varRef
public
static
String
compileSortRecordFactory
Vector
sortObjects
ClassGenerator
classGen
MethodGenerator
methodGen
String
sortRecordClass
final
XSLTC
xsltc
Sort
sortObjects
firstElement
getXSLTC
final
String
className
xsltc
getHelperClassName
final
NodeSortRecordFactGenerator
sortRecordFactory
new
NodeSortRecordFactGenerator
className
NODE_SORT_FACTORY
className
ACC_PUBLIC
ACC_SUPER
ACC_FINAL
new
String
classGen
getStylesheet
ConstantPoolGen
cpg
sortRecordFactory
getConstantPool
final
int
nsorts
sortObjects
size
final
ArrayList
dups
new
ArrayList
for
int
j
j
nsorts
j
final
Sort
sort
Sort
sortObjects
get
j
final
int
length
sort
_closureVars
sort
_closureVars
size
for
int
i
i
length
i
final
VariableRef
varRef
VariableRef
sort
_closureVars
get
i
if
dups
contains
varRef
continue
final
VariableBase
var
varRef
getVariable
sortRecordFactory
addField
new
Field
ACC_PUBLIC
cpg
addUtf8
var
getVariable
cpg
addUtf8
var
getType
toSignature
cpg
getConstantPool
dups
add
varRef
final
org
apache
bcel
generic
Type
argTypes
new
org
apache
bcel
generic
Type
argTypes
Util
getJCRefType
DOM_INTF_SIG
argTypes
Util
getJCRefType
STRING_SIG
argTypes
Util
getJCRefType
TRANSLET_INTF_SIG
argTypes
Util
getJCRefType
STRING_SIG
argTypes
Util
getJCRefType
STRING_SIG
final
String
argNames
new
String
argNames
DOCUMENT_PNAME
argNames
argNames
TRANSLET_PNAME
argNames
argNames
InstructionList
il
new
InstructionList
final
MethodGenerator
constructor
new
MethodGenerator
ACC_PUBLIC
org
apache
bcel
generic
Type
VOID
argTypes
argNames
className
il
cpg
il
append
ALOAD_0
il
append
ALOAD_1
il
append
ALOAD_2
il
append
new
ALOAD
il
append
new
ALOAD
il
append
new
ALOAD
il
append
new
INVOKESPECIAL
cpg
addMethodref
NODE_SORT_FACTORY
DOM_INTF_SIG
STRING_SIG
TRANSLET_INTF_SIG
STRING_SIG
STRING_SIG
il
append
RETURN
il
new
InstructionList
final
MethodGenerator
makeNodeSortRecord
new
MethodGenerator
ACC_PUBLIC
Util
getJCRefType
NODE_SORT_RECORD_SIG
new
org
apache
bcel
generic
Type
org
apache
bcel
generic
Type
INT
org
apache
bcel
generic
Type
INT
new
String
className
il
cpg
il
append
ALOAD_0
il
append
ILOAD_1
il
append
ILOAD_2
il
append
new
INVOKESPECIAL
cpg
addMethodref
NODE_SORT_FACTORY
NODE_SORT_RECORD_SIG
il
append
DUP
il
append
new
CHECKCAST
cpg
addClass
sortRecordClass
final
int
ndups
dups
size
for
int
i
i
ndups
i
final
VariableRef
varRef
VariableRef
dups
get
i
final
VariableBase
var
varRef
getVariable
final
Type
varType
var
getType
il
append
DUP
il
append
ALOAD_0
il
append
new
GETFIELD
cpg
addFieldref
className
var
getVariable
varType
toSignature
il
append
new
PUTFIELD
cpg
addFieldref
sortRecordClass
var
getVariable
varType
toSignature
il
append
POP
il
append
ARETURN
constructor
setMaxLocals
constructor
setMaxStack
sortRecordFactory
addMethod
constructor
getMethod
makeNodeSortRecord
setMaxLocals
makeNodeSortRecord
setMaxStack
sortRecordFactory
addMethod
makeNodeSortRecord
getMethod
xsltc
dumpClass
sortRecordFactory
getJavaClass
return
className
private
static
String
compileSortRecord
Vector
sortObjects
ClassGenerator
classGen
MethodGenerator
methodGen
final
XSLTC
xsltc
Sort
sortObjects
firstElement
getXSLTC
final
String
className
xsltc
getHelperClassName
final
NodeSortRecordGenerator
sortRecord
new
NodeSortRecordGenerator
className
NODE_SORT_RECORD
ACC_PUBLIC
ACC_SUPER
ACC_FINAL
new
String
classGen
getStylesheet
final
ConstantPoolGen
cpg
sortRecord
getConstantPool
final
int
nsorts
sortObjects
size
final
ArrayList
dups
new
ArrayList
for
int
j
j
nsorts
j
final
Sort
sort
Sort
sortObjects
get
j
sort
setInnerClassName
className
final
int
length
sort
_closureVars
sort
_closureVars
size
for
int
i
i
length
i
final
VariableRef
varRef
VariableRef
sort
_closureVars
get
i
if
dups
contains
varRef
continue
final
VariableBase
var
varRef
getVariable
sortRecord
addField
new
Field
ACC_PUBLIC
cpg
addUtf8
var
getVariable
cpg
addUtf8
var
getType
toSignature
cpg
getConstantPool
dups
add
varRef
Method
init
compileInit
sortObjects
sortRecord
cpg
className
Method
extract
compileExtract
sortObjects
sortRecord
cpg
className
sortRecord
addMethod
init
sortRecord
addMethod
extract
xsltc
dumpClass
sortRecord
getJavaClass
return
className
private
static
Method
compileInit
Vector
sortObjects
NodeSortRecordGenerator
sortRecord
ConstantPoolGen
cpg
String
className
final
InstructionList
il
new
InstructionList
final
MethodGenerator
init
new
MethodGenerator
ACC_PUBLIC
org
apache
bcel
generic
Type
VOID
className
il
cpg
il
append
ALOAD_0
il
append
new
INVOKESPECIAL
cpg
addMethodref
NODE_SORT_RECORD
final
int
initLocale
cpg
addMethodref
final
int
getCollator
cpg
addMethodref
COLLATOR_CLASS
COLLATOR_SIG
final
int
setStrength
cpg
addMethodref
COLLATOR_CLASS
final
int
levels
sortObjects
size
String
language
String
country
Sort
sort
Sort
sortObjects
elementAt
for
int
level
level
levels
level
if
language
sort
_lang
language
sort
_lang
if
country
sort
_country
country
sort
_country
final
int
collator
cpg
addFieldref
className
COLLATOR_SIG
final
int
locale
cpg
addFieldref
className
LOCALE_SIG
if
language
il
append
new
NEW
cpg
addClass
il
append
DUP
il
append
DUP
il
append
new
PUSH
cpg
language
il
append
new
PUSH
cpg
country
country
EMPTYSTRING
il
append
new
INVOKESPECIAL
initLocale
il
append
ALOAD_0
il
append
SWAP
il
append
new
PUTFIELD
locale
il
append
new
INVOKESTATIC
getCollator
il
append
ALOAD_0
il
append
SWAP
il
append
new
PUTFIELD
collator
il
append
ALOAD_0
il
append
new
GETFIELD
collator
il
append
new
ICONST
Collator
TERTIARY
il
append
new
INVOKEVIRTUAL
setStrength
il
append
RETURN
init
stripAttributes
init
setMaxLocals
init
setMaxStack
return
init
getMethod
private
static
Method
compileExtract
Vector
sortObjects
NodeSortRecordGenerator
sortRecord
ConstantPoolGen
cpg
String
className
final
InstructionList
il
new
InstructionList
final
CompareGenerator
extractMethod
new
CompareGenerator
ACC_PUBLIC
ACC_FINAL
org
apache
bcel
generic
Type
STRING
new
org
apache
bcel
generic
Type
Util
getJCRefType
DOM_INTF_SIG
org
apache
bcel
generic
Type
INT
org
apache
bcel
generic
Type
INT
Util
getJCRefType
TRANSLET_SIG
org
apache
bcel
generic
Type
INT
new
String
className
il
cpg
final
int
levels
sortObjects
size
final
int
match
new
int
levels
final
InstructionHandle
target
new
InstructionHandle
levels
InstructionHandle
tblswitch
if
levels
il
append
new
ILOAD
extractMethod
getLocalIndex
tblswitch
il
append
new
NOP
for
int
level
level
levels
level
match
level
level
final
Sort
sort
Sort
sortObjects
elementAt
level
target
level
il
append
NOP
sort
translateSelect
sortRecord
extractMethod
il
append
ARETURN
if
levels
InstructionHandle
defaultTarget
il
append
new
PUSH
cpg
EMPTYSTRING
il
insert
tblswitch
new
TABLESWITCH
match
target
defaultTarget
il
append
ARETURN
extractMethod
stripAttributes
extractMethod
setMaxLocals
extractMethod
setMaxStack
extractMethod
removeNOPs
return
extractMethod
getMethod
