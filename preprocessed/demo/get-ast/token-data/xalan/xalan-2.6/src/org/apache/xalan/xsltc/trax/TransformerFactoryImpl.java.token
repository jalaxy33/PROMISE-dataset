package
org
apache
xalan
xsltc
trax
import
java
io
File
import
java
io
FileInputStream
import
java
io
FileNotFoundException
import
java
io
FilenameFilter
import
java
io
IOException
import
java
io
InputStream
import
java
net
MalformedURLException
import
java
net
URL
import
java
util
Enumeration
import
java
util
Hashtable
import
java
util
Properties
import
java
util
Vector
import
java
util
zip
ZipEntry
import
java
util
zip
ZipFile
import
javax
xml
parsers
SAXParserFactory
import
javax
xml
parsers
SAXParser
import
javax
xml
parsers
ParserConfigurationException
import
javax
xml
transform
ErrorListener
import
javax
xml
transform
Source
import
javax
xml
transform
Templates
import
javax
xml
transform
Transformer
import
javax
xml
transform
TransformerConfigurationException
import
javax
xml
transform
TransformerException
import
javax
xml
transform
URIResolver
import
javax
xml
transform
dom
DOMResult
import
javax
xml
transform
dom
DOMSource
import
javax
xml
transform
sax
SAXResult
import
javax
xml
transform
sax
SAXSource
import
javax
xml
transform
sax
SAXTransformerFactory
import
javax
xml
transform
sax
TemplatesHandler
import
javax
xml
transform
sax
TransformerHandler
import
javax
xml
transform
stream
StreamResult
import
javax
xml
transform
stream
StreamSource
import
org
apache
xml
utils
StylesheetPIHandler
import
org
apache
xml
utils
StopParseException
import
org
apache
xalan
xsltc
compiler
SourceLoader
import
org
apache
xalan
xsltc
compiler
XSLTC
import
org
apache
xalan
xsltc
compiler
util
ErrorMsg
import
org
apache
xalan
xsltc
dom
XSLTCDTMManager
import
org
xml
sax
InputSource
import
org
xml
sax
XMLFilter
import
org
xml
sax
XMLReader
import
org
xml
sax
helpers
XMLReaderFactory
public
class
TransformerFactoryImpl
extends
SAXTransformerFactory
implements
SourceLoader
ErrorListener
public
final
static
String
TRANSLET_NAME
public
final
static
String
DESTINATION_DIRECTORY
public
final
static
String
PACKAGE_NAME
public
final
static
String
JAR_NAME
public
final
static
String
GENERATE_TRANSLET
public
final
static
String
AUTO_TRANSLET
public
final
static
String
USE_CLASSPATH
public
final
static
String
DEBUG
public
final
static
String
ENABLE_INLINING
public
final
static
String
INDENT_NUMBER
private
ErrorListener
_errorListener
this
private
URIResolver
_uriResolver
protected
static
String
DEFAULT_TRANSLET_NAME
private
String
_transletName
DEFAULT_TRANSLET_NAME
private
String
_destinationDirectory
private
String
_packageName
private
String
_jarFileName
private
Hashtable
_piParams
static
ThreadLocal
_xmlReader
new
ThreadLocal
private
static
class
PIParamWrapper
public
String
_media
public
String
_title
public
String
_charset
public
PIParamWrapper
String
media
String
title
String
charset
_media
media
_title
title
_charset
charset
private
boolean
_debug
private
boolean
_enableInlining
private
boolean
_generateTranslet
private
boolean
_autoTranslet
private
boolean
_useClasspath
private
int
_indentNumber
private
Class
m_DTMManagerClass
public
TransformerFactoryImpl
m_DTMManagerClass
XSLTCDTMManager
getDTMManagerClass
public
void
setErrorListener
ErrorListener
listener
throws
IllegalArgumentException
if
listener
ErrorMsg
err
new
ErrorMsg
ErrorMsg
ERROR_LISTENER_NULL_ERR
throw
new
IllegalArgumentException
err
toString
_errorListener
listener
public
ErrorListener
getErrorListener
return
_errorListener
public
Object
getAttribute
String
name
throws
IllegalArgumentException
if
name
equals
TRANSLET_NAME
return
_transletName
else
if
name
equals
GENERATE_TRANSLET
return
new
Boolean
_generateTranslet
else
if
name
equals
AUTO_TRANSLET
return
new
Boolean
_autoTranslet
ErrorMsg
err
new
ErrorMsg
ErrorMsg
JAXP_INVALID_ATTR_ERR
name
throw
new
IllegalArgumentException
err
toString
public
void
setAttribute
String
name
Object
value
throws
IllegalArgumentException
if
name
equals
TRANSLET_NAME
value
instanceof
String
_transletName
String
value
return
else
if
name
equals
DESTINATION_DIRECTORY
value
instanceof
String
_destinationDirectory
String
value
return
else
if
name
equals
PACKAGE_NAME
value
instanceof
String
_packageName
String
value
return
else
if
name
equals
JAR_NAME
value
instanceof
String
_jarFileName
String
value
return
else
if
name
equals
GENERATE_TRANSLET
if
value
instanceof
Boolean
_generateTranslet
Boolean
value
booleanValue
return
else
if
value
instanceof
String
_generateTranslet
String
value
equalsIgnoreCase
return
else
if
name
equals
AUTO_TRANSLET
if
value
instanceof
Boolean
_autoTranslet
Boolean
value
booleanValue
return
else
if
value
instanceof
String
_autoTranslet
String
value
equalsIgnoreCase
return
else
if
name
equals
USE_CLASSPATH
if
value
instanceof
Boolean
_useClasspath
Boolean
value
booleanValue
return
else
if
value
instanceof
String
_useClasspath
String
value
equalsIgnoreCase
return
else
if
name
equals
DEBUG
if
value
instanceof
Boolean
_debug
Boolean
value
booleanValue
return
else
if
value
instanceof
String
_debug
String
value
equalsIgnoreCase
return
else
if
name
equals
ENABLE_INLINING
if
value
instanceof
Boolean
_enableInlining
Boolean
value
booleanValue
return
else
if
value
instanceof
String
_enableInlining
String
value
equalsIgnoreCase
return
else
if
name
equals
INDENT_NUMBER
if
value
instanceof
String
try
_indentNumber
Integer
parseInt
String
value
return
catch
NumberFormatException
e
else
if
value
instanceof
Integer
_indentNumber
Integer
value
intValue
return
final
ErrorMsg
err
new
ErrorMsg
ErrorMsg
JAXP_INVALID_ATTR_ERR
name
throw
new
IllegalArgumentException
err
toString
public
boolean
getFeature
String
name
String
features
DOMSource
FEATURE
DOMResult
FEATURE
SAXSource
FEATURE
SAXResult
FEATURE
StreamSource
FEATURE
StreamResult
FEATURE
SAXTransformerFactory
FEATURE
SAXTransformerFactory
FEATURE_XMLFILTER
for
int
i
i
features
length
i
if
name
equals
features
i
return
return
public
URIResolver
getURIResolver
return
_uriResolver
public
void
setURIResolver
URIResolver
resolver
_uriResolver
resolver
public
Source
getAssociatedStylesheet
Source
source
String
media
String
title
String
charset
throws
TransformerConfigurationException
String
baseId
XMLReader
reader
InputSource
isource
StylesheetPIHandler
_stylesheetPIHandler
new
StylesheetPIHandler
media
title
charset
try
if
source
instanceof
DOMSource
final
DOMSource
domsrc
DOMSource
source
baseId
domsrc
getSystemId
final
org
w3c
dom
Node
node
domsrc
getNode
final
DOM2SAX
dom2sax
new
DOM2SAX
node
_stylesheetPIHandler
setBaseId
baseId
dom2sax
setContentHandler
_stylesheetPIHandler
dom2sax
parse
else
isource
SAXSource
sourceToInputSource
source
baseId
isource
getSystemId
SAXParserFactory
factory
SAXParserFactory
newInstance
factory
setNamespaceAware
SAXParser
jaxpParser
factory
newSAXParser
reader
jaxpParser
getXMLReader
if
reader
reader
XMLReaderFactory
createXMLReader
_stylesheetPIHandler
setBaseId
baseId
reader
setContentHandler
_stylesheetPIHandler
reader
parse
isource
if
_uriResolver
_stylesheetPIHandler
setURIResolver
_uriResolver
catch
StopParseException
e
catch
javax
xml
parsers
ParserConfigurationException
e
throw
new
TransformerConfigurationException
e
catch
org
xml
sax
SAXException
se
throw
new
TransformerConfigurationException
se
catch
IOException
ioe
throw
new
TransformerConfigurationException
ioe
return
_stylesheetPIHandler
getAssociatedStylesheet
public
Transformer
newTransformer
throws
TransformerConfigurationException
TransformerImpl
result
new
TransformerImpl
new
Properties
_indentNumber
this
if
_uriResolver
result
setURIResolver
_uriResolver
return
result
public
Transformer
newTransformer
Source
source
throws
TransformerConfigurationException
final
Templates
templates
newTemplates
source
final
Transformer
transformer
templates
newTransformer
if
_uriResolver
transformer
setURIResolver
_uriResolver
return
transformer
private
void
passWarningsToListener
Vector
messages
throws
TransformerException
if
_errorListener
messages
return
final
int
count
messages
size
for
int
pos
pos
count
pos
String
message
messages
elementAt
pos
toString
_errorListener
error
new
TransformerConfigurationException
message
private
void
passErrorsToListener
Vector
messages
try
if
_errorListener
messages
return
final
int
count
messages
size
for
int
pos
pos
count
pos
String
message
messages
elementAt
pos
toString
_errorListener
error
new
TransformerException
message
catch
TransformerException
e
public
Templates
newTemplates
Source
source
throws
TransformerConfigurationException
if
_useClasspath
String
transletName
getTransletBaseName
source
if
_packageName
transletName
_packageName
transletName
try
final
Class
clazz
ObjectFactory
findProviderClass
transletName
ObjectFactory
findClassLoader
resetTransientAttributes
return
new
TemplatesImpl
new
Class
clazz
transletName
_indentNumber
this
catch
ClassNotFoundException
cnfe
ErrorMsg
err
new
ErrorMsg
ErrorMsg
CLASS_NOT_FOUND_ERR
transletName
throw
new
TransformerConfigurationException
err
toString
catch
Exception
e
ErrorMsg
err
new
ErrorMsg
new
ErrorMsg
ErrorMsg
RUNTIME_ERROR_KEY
e
getMessage
throw
new
TransformerConfigurationException
err
toString
if
_autoTranslet
byte
bytecodes
String
transletClassName
getTransletBaseName
source
if
_packageName
transletClassName
_packageName
transletClassName
if
_jarFileName
bytecodes
getBytecodesFromJar
source
transletClassName
else
bytecodes
getBytecodesFromClasses
source
transletClassName
if
bytecodes
if
_debug
if
_jarFileName
System
err
println
new
ErrorMsg
ErrorMsg
TRANSFORM_WITH_JAR_STR
transletClassName
_jarFileName
else
System
err
println
new
ErrorMsg
ErrorMsg
TRANSFORM_WITH_TRANSLET_STR
transletClassName
resetTransientAttributes
return
new
TemplatesImpl
bytecodes
transletClassName
_indentNumber
this
final
XSLTC
xsltc
new
XSLTC
if
_debug
xsltc
setDebug
if
_enableInlining
xsltc
setTemplateInlining
xsltc
init
if
_uriResolver
xsltc
setSourceLoader
this
if
_piParams
_piParams
get
source
PIParamWrapper
p
PIParamWrapper
_piParams
get
source
if
p
xsltc
setPIParameters
p
_media
p
_title
p
_charset
int
outputType
XSLTC
BYTEARRAY_OUTPUT
if
_generateTranslet
_autoTranslet
xsltc
setClassName
getTransletBaseName
source
if
_destinationDirectory
xsltc
setDestDirectory
_destinationDirectory
else
String
xslName
getStylesheetFileName
source
if
xslName
File
xslFile
new
File
xslName
String
xslDir
xslFile
getParent
if
xslDir
xsltc
setDestDirectory
xslDir
if
_packageName
xsltc
setPackageName
_packageName
if
_jarFileName
xsltc
setJarFileName
_jarFileName
outputType
XSLTC
BYTEARRAY_AND_JAR_OUTPUT
else
outputType
XSLTC
BYTEARRAY_AND_FILE_OUTPUT
final
InputSource
input
Util
getInputSource
xsltc
source
byte
bytecodes
xsltc
compile
input
outputType
final
String
transletName
xsltc
getClassName
if
_generateTranslet
_autoTranslet
bytecodes
_jarFileName
try
xsltc
outputToJar
catch
java
io
IOException
e
resetTransientAttributes
if
_errorListener
this
try
passWarningsToListener
xsltc
getWarnings
catch
TransformerException
e
throw
new
TransformerConfigurationException
e
else
xsltc
printWarnings
if
bytecodes
ErrorMsg
err
new
ErrorMsg
ErrorMsg
JAXP_COMPILE_ERR
TransformerConfigurationException
exc
new
TransformerConfigurationException
err
toString
if
_errorListener
passErrorsToListener
xsltc
getErrors
try
_errorListener
fatalError
exc
catch
TransformerException
te
else
xsltc
printErrors
throw
exc
return
new
TemplatesImpl
bytecodes
transletName
xsltc
getOutputProperties
_indentNumber
this
public
TemplatesHandler
newTemplatesHandler
throws
TransformerConfigurationException
final
TemplatesHandlerImpl
handler
new
TemplatesHandlerImpl
_indentNumber
this
if
_uriResolver
handler
setURIResolver
_uriResolver
return
handler
public
TransformerHandler
newTransformerHandler
throws
TransformerConfigurationException
final
Transformer
transformer
newTransformer
if
_uriResolver
transformer
setURIResolver
_uriResolver
return
new
TransformerHandlerImpl
TransformerImpl
transformer
public
TransformerHandler
newTransformerHandler
Source
src
throws
TransformerConfigurationException
final
Transformer
transformer
newTransformer
src
if
_uriResolver
transformer
setURIResolver
_uriResolver
return
new
TransformerHandlerImpl
TransformerImpl
transformer
public
TransformerHandler
newTransformerHandler
Templates
templates
throws
TransformerConfigurationException
final
Transformer
transformer
templates
newTransformer
final
TransformerImpl
internal
TransformerImpl
transformer
return
new
TransformerHandlerImpl
internal
public
XMLFilter
newXMLFilter
Source
src
throws
TransformerConfigurationException
Templates
templates
newTemplates
src
if
templates
return
return
newXMLFilter
templates
public
XMLFilter
newXMLFilter
Templates
templates
throws
TransformerConfigurationException
try
return
new
org
apache
xalan
xsltc
trax
TrAXFilter
templates
catch
TransformerConfigurationException
e1
if
_errorListener
try
_errorListener
fatalError
e1
return
catch
TransformerException
e2
new
TransformerConfigurationException
e2
throw
e1
public
void
error
TransformerException
e
throws
TransformerException
Throwable
wrapped
e
getException
if
wrapped
System
err
println
new
ErrorMsg
ErrorMsg
ERROR_PLUS_WRAPPED_MSG
e
getMessageAndLocation
wrapped
getMessage
else
System
err
println
new
ErrorMsg
ErrorMsg
ERROR_MSG
e
getMessageAndLocation
throw
e
public
void
fatalError
TransformerException
e
throws
TransformerException
Throwable
wrapped
e
getException
if
wrapped
System
err
println
new
ErrorMsg
ErrorMsg
FATAL_ERR_PLUS_WRAPPED_MSG
e
getMessageAndLocation
wrapped
getMessage
else
System
err
println
new
ErrorMsg
ErrorMsg
FATAL_ERR_MSG
e
getMessageAndLocation
throw
e
public
void
warning
TransformerException
e
throws
TransformerException
Throwable
wrapped
e
getException
if
wrapped
System
err
println
new
ErrorMsg
ErrorMsg
WARNING_PLUS_WRAPPED_MSG
e
getMessageAndLocation
wrapped
getMessage
else
System
err
println
new
ErrorMsg
ErrorMsg
WARNING_MSG
e
getMessageAndLocation
public
InputSource
loadSource
String
href
String
context
XSLTC
xsltc
try
if
_uriResolver
final
Source
source
_uriResolver
resolve
href
context
if
source
return
Util
getInputSource
xsltc
source
catch
TransformerException
e
return
private
void
resetTransientAttributes
_transletName
DEFAULT_TRANSLET_NAME
_destinationDirectory
_packageName
_jarFileName
private
byte
getBytecodesFromClasses
Source
source
String
fullClassName
if
fullClassName
return
String
xslFileName
getStylesheetFileName
source
File
xslFile
if
xslFileName
xslFile
new
File
xslFileName
final
String
transletName
int
lastDotIndex
fullClassName
lastIndexOf
if
lastDotIndex
transletName
fullClassName
substring
lastDotIndex
else
transletName
fullClassName
String
transletPath
fullClassName
replace
if
_destinationDirectory
transletPath
_destinationDirectory
transletPath
else
if
xslFile
xslFile
getParent
transletPath
xslFile
getParent
transletPath
else
transletPath
transletPath
File
transletFile
new
File
transletPath
if
transletFile
exists
return
if
xslFile
xslFile
exists
long
xslTimestamp
xslFile
lastModified
long
transletTimestamp
transletFile
lastModified
if
transletTimestamp
xslTimestamp
return
Vector
bytecodes
new
Vector
int
fileLength
int
transletFile
length
if
fileLength
FileInputStream
input
try
input
new
FileInputStream
transletFile
catch
FileNotFoundException
e
return
byte
bytes
new
byte
fileLength
try
readFromInputStream
bytes
input
fileLength
input
close
catch
IOException
e
return
bytecodes
addElement
bytes
else
return
String
transletParentDir
transletFile
getParent
if
transletParentDir
transletParentDir
System
getProperty
File
transletParentFile
new
File
transletParentDir
final
String
transletAuxPrefix
transletName
File
auxfiles
transletParentFile
listFiles
new
FilenameFilter
public
boolean
accept
File
dir
String
name
return
name
endsWith
name
startsWith
transletAuxPrefix
for
int
i
i
auxfiles
length
i
File
auxfile
auxfiles
i
int
auxlength
int
auxfile
length
if
auxlength
FileInputStream
auxinput
try
auxinput
new
FileInputStream
auxfile
catch
FileNotFoundException
e
continue
byte
bytes
new
byte
auxlength
try
readFromInputStream
bytes
auxinput
auxlength
auxinput
close
catch
IOException
e
continue
bytecodes
addElement
bytes
final
int
count
bytecodes
size
if
count
final
byte
result
new
byte
count
for
int
i
i
count
i
result
i
byte
bytecodes
elementAt
i
return
result
else
return
private
byte
getBytecodesFromJar
Source
source
String
fullClassName
String
xslFileName
getStylesheetFileName
source
File
xslFile
if
xslFileName
xslFile
new
File
xslFileName
String
jarPath
if
_destinationDirectory
jarPath
_destinationDirectory
_jarFileName
else
if
xslFile
xslFile
getParent
jarPath
xslFile
getParent
_jarFileName
else
jarPath
_jarFileName
File
file
new
File
jarPath
if
file
exists
return
if
xslFile
xslFile
exists
long
xslTimestamp
xslFile
lastModified
long
transletTimestamp
file
lastModified
if
transletTimestamp
xslTimestamp
return
ZipFile
jarFile
try
jarFile
new
ZipFile
file
catch
IOException
e
return
String
transletPath
fullClassName
replace
String
transletAuxPrefix
transletPath
String
transletFullName
transletPath
Vector
bytecodes
new
Vector
Enumeration
entries
jarFile
entries
while
entries
hasMoreElements
ZipEntry
entry
ZipEntry
entries
nextElement
String
entryName
entry
getName
if
entry
getSize
entryName
equals
transletFullName
entryName
endsWith
entryName
startsWith
transletAuxPrefix
try
InputStream
input
jarFile
getInputStream
entry
int
size
int
entry
getSize
byte
bytes
new
byte
size
readFromInputStream
bytes
input
size
input
close
bytecodes
addElement
bytes
catch
IOException
e
return
final
int
count
bytecodes
size
if
count
final
byte
result
new
byte
count
for
int
i
i
count
i
result
i
byte
bytecodes
elementAt
i
return
result
else
return
private
void
readFromInputStream
byte
bytes
InputStream
input
int
size
throws
IOException
int
n
int
offset
int
length
size
while
length
n
input
read
bytes
offset
length
offset
offset
n
length
length
n
private
String
getTransletBaseName
Source
source
String
transletBaseName
if
_transletName
equals
DEFAULT_TRANSLET_NAME
return
_transletName
else
String
systemId
source
getSystemId
if
systemId
String
baseName
Util
baseName
systemId
if
baseName
baseName
Util
noExtName
baseName
transletBaseName
Util
toJavaName
baseName
return
transletBaseName
transletBaseName
DEFAULT_TRANSLET_NAME
private
String
getStylesheetFileName
Source
source
String
systemId
source
getSystemId
if
systemId
File
file
new
File
systemId
if
file
exists
return
systemId
else
URL
url
try
url
new
URL
systemId
catch
MalformedURLException
e
return
if
equals
url
getProtocol
return
url
getFile
else
return
else
return
protected
Class
getDTMManagerClass
return
m_DTMManagerClass
