package
org
apache
xalan
xsltc
compiler
import
java
io
OutputStreamWriter
import
java
util
Properties
import
java
util
StringTokenizer
import
javax
xml
transform
OutputKeys
import
org
apache
bcel
generic
ConstantPoolGen
import
org
apache
bcel
generic
INVOKEVIRTUAL
import
org
apache
bcel
generic
InstructionList
import
org
apache
bcel
generic
PUSH
import
org
apache
bcel
generic
PUTFIELD
import
org
apache
xalan
xsltc
compiler
util
ClassGenerator
import
org
apache
xalan
xsltc
compiler
util
ErrorMsg
import
org
apache
xalan
xsltc
compiler
util
MethodGenerator
import
org
apache
xalan
xsltc
compiler
util
Util
import
org
apache
xml
serializer
Encodings
import
org
apache
xml
utils
XMLChar
final
class
Output
extends
TopLevelElement
private
String
_version
private
String
_method
private
String
_encoding
private
boolean
_omitHeader
private
String
_standalone
private
String
_doctypePublic
private
String
_doctypeSystem
private
String
_cdata
private
boolean
_indent
private
String
_mediaType
private
String
_cdataToMerge
private
boolean
_disabled
private
final
static
String
STRING_SIG
private
final
static
String
XML_VERSION
private
final
static
String
HTML_VERSION
public
void
display
int
indent
indent
indent
Util
println
_method
public
void
disable
_disabled
public
boolean
enabled
return
_disabled
public
String
getCdata
return
_cdata
public
String
getOutputMethod
return
_method
public
void
mergeCdata
String
cdata
_cdataToMerge
cdata
public
void
parseContents
Parser
parser
final
Properties
outputProperties
new
Properties
parser
setOutput
this
if
_disabled
return
String
attrib
_version
getAttribute
if
_version
_version
equals
Constants
EMPTYSTRING
_version
else
outputProperties
setProperty
OutputKeys
VERSION
_version
_method
getAttribute
if
_method
equals
Constants
EMPTYSTRING
_method
if
_method
_method
_method
toLowerCase
if
_method
equals
_method
equals
_method
equals
XMLChar
isValidQName
_method
_method
indexOf
outputProperties
setProperty
OutputKeys
METHOD
_method
else
reportError
this
parser
ErrorMsg
INVALID_METHOD_IN_OUTPUT
_method
_encoding
getAttribute
if
_encoding
equals
Constants
EMPTYSTRING
_encoding
else
try
String
canonicalEncoding
canonicalEncoding
Encodings
convertMime2JavaEncoding
_encoding
OutputStreamWriter
writer
new
OutputStreamWriter
System
out
canonicalEncoding
catch
java
io
UnsupportedEncodingException
e
ErrorMsg
msg
new
ErrorMsg
ErrorMsg
UNSUPPORTED_ENCODING
_encoding
this
parser
reportError
Constants
WARNING
msg
outputProperties
setProperty
OutputKeys
ENCODING
_encoding
attrib
getAttribute
if
attrib
attrib
equals
Constants
EMPTYSTRING
if
attrib
equals
_omitHeader
outputProperties
setProperty
OutputKeys
OMIT_XML_DECLARATION
attrib
_standalone
getAttribute
if
_standalone
equals
Constants
EMPTYSTRING
_standalone
else
outputProperties
setProperty
OutputKeys
STANDALONE
_standalone
_doctypeSystem
getAttribute
if
_doctypeSystem
equals
Constants
EMPTYSTRING
_doctypeSystem
else
outputProperties
setProperty
OutputKeys
DOCTYPE_SYSTEM
_doctypeSystem
_doctypePublic
getAttribute
if
_doctypePublic
equals
Constants
EMPTYSTRING
_doctypePublic
else
outputProperties
setProperty
OutputKeys
DOCTYPE_PUBLIC
_doctypePublic
_cdata
getAttribute
if
_cdata
_cdata
equals
Constants
EMPTYSTRING
_cdata
else
StringBuffer
expandedNames
new
StringBuffer
StringTokenizer
tokens
new
StringTokenizer
_cdata
while
tokens
hasMoreTokens
String
qname
tokens
nextToken
if
XMLChar
isValidQName
qname
ErrorMsg
err
new
ErrorMsg
ErrorMsg
INVALID_QNAME_ERR
qname
this
parser
reportError
Constants
ERROR
err
expandedNames
append
parser
getQName
qname
toString
append
_cdata
expandedNames
toString
if
_cdataToMerge
_cdata
_cdata
_cdataToMerge
outputProperties
setProperty
OutputKeys
CDATA_SECTION_ELEMENTS
_cdata
attrib
getAttribute
if
attrib
attrib
equals
EMPTYSTRING
if
attrib
equals
_indent
outputProperties
setProperty
OutputKeys
INDENT
attrib
else
if
_method
_method
equals
_indent
_mediaType
getAttribute
if
_mediaType
equals
Constants
EMPTYSTRING
_mediaType
else
outputProperties
setProperty
OutputKeys
MEDIA_TYPE
_mediaType
if
_method
if
_method
equals
if
_version
_version
HTML_VERSION
if
_mediaType
_mediaType
else
if
_method
equals
if
_mediaType
_mediaType
parser
getCurrentStylesheet
setOutputProperties
outputProperties
public
void
translate
ClassGenerator
classGen
MethodGenerator
methodGen
if
_disabled
return
ConstantPoolGen
cpg
classGen
getConstantPool
InstructionList
il
methodGen
getInstructionList
int
field
il
append
classGen
loadTranslet
if
_version
_version
equals
XML_VERSION
field
cpg
addFieldref
TRANSLET_CLASS
STRING_SIG
il
append
DUP
il
append
new
PUSH
cpg
_version
il
append
new
PUTFIELD
field
if
_method
field
cpg
addFieldref
TRANSLET_CLASS
STRING_SIG
il
append
DUP
il
append
new
PUSH
cpg
_method
il
append
new
PUTFIELD
field
if
_encoding
field
cpg
addFieldref
TRANSLET_CLASS
STRING_SIG
il
append
DUP
il
append
new
PUSH
cpg
_encoding
il
append
new
PUTFIELD
field
if
_omitHeader
field
cpg
addFieldref
TRANSLET_CLASS
il
append
DUP
il
append
new
PUSH
cpg
_omitHeader
il
append
new
PUTFIELD
field
if
_standalone
field
cpg
addFieldref
TRANSLET_CLASS
STRING_SIG
il
append
DUP
il
append
new
PUSH
cpg
_standalone
il
append
new
PUTFIELD
field
field
cpg
addFieldref
TRANSLET_CLASS
STRING_SIG
il
append
DUP
il
append
new
PUSH
cpg
_doctypeSystem
il
append
new
PUTFIELD
field
field
cpg
addFieldref
TRANSLET_CLASS
STRING_SIG
il
append
DUP
il
append
new
PUSH
cpg
_doctypePublic
il
append
new
PUTFIELD
field
if
_mediaType
field
cpg
addFieldref
TRANSLET_CLASS
STRING_SIG
il
append
DUP
il
append
new
PUSH
cpg
_mediaType
il
append
new
PUTFIELD
field
if
_indent
field
cpg
addFieldref
TRANSLET_CLASS
il
append
DUP
il
append
new
PUSH
cpg
_indent
il
append
new
PUTFIELD
field
if
_cdata
int
index
cpg
addMethodref
TRANSLET_CLASS
StringTokenizer
tokens
new
StringTokenizer
_cdata
while
tokens
hasMoreTokens
il
append
DUP
il
append
new
PUSH
cpg
tokens
nextToken
il
append
new
INVOKEVIRTUAL
index
il
append
POP
