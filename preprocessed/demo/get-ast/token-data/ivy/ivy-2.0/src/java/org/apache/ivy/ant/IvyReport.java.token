package
org
apache
ivy
ant
import
java
io
BufferedInputStream
import
java
io
BufferedOutputStream
import
java
io
File
import
java
io
FileInputStream
import
java
io
FileOutputStream
import
java
io
IOException
import
java
io
InputStream
import
java
io
OutputStream
import
java
text
ParseException
import
java
util
ArrayList
import
java
util
Iterator
import
java
util
List
import
javax
xml
transform
Source
import
javax
xml
transform
Transformer
import
javax
xml
transform
TransformerConfigurationException
import
javax
xml
transform
TransformerException
import
javax
xml
transform
TransformerFactory
import
javax
xml
transform
stream
StreamResult
import
javax
xml
transform
stream
StreamSource
import
org
apache
ivy
Ivy
import
org
apache
ivy
core
IvyPatternHelper
import
org
apache
ivy
core
cache
ResolutionCacheManager
import
org
apache
ivy
core
module
id
ModuleId
import
org
apache
ivy
core
module
id
ModuleRevisionId
import
org
apache
ivy
core
resolve
ResolveOptions
import
org
apache
ivy
core
settings
IvySettings
import
org
apache
ivy
plugins
report
XmlReportOutputter
import
org
apache
ivy
plugins
report
XmlReportParser
import
org
apache
ivy
util
FileUtil
import
org
apache
ivy
util
Message
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
taskdefs
XSLTProcess
import
org
apache
tools
ant
util
JAXPUtils
public
class
IvyReport
extends
IvyTask
private
File
todir
private
String
organisation
private
String
module
private
String
conf
private
boolean
graph
private
boolean
dot
private
boolean
xml
private
boolean
xsl
private
File
xslFile
private
String
outputpattern
private
String
xslext
private
List
params
new
ArrayList
private
String
resolveId
private
ModuleRevisionId
mRevId
public
File
getTodir
return
todir
public
void
setTodir
File
todir
this
todir
todir
public
void
setCache
File
cache
cacheAttributeNotSupported
public
String
getConf
return
conf
public
void
setConf
String
conf
this
conf
conf
public
String
getModule
return
module
public
void
setModule
String
module
this
module
module
public
String
getOrganisation
return
organisation
public
void
setOrganisation
String
organisation
this
organisation
organisation
public
boolean
isGraph
return
graph
public
void
setGraph
boolean
graph
this
graph
graph
public
File
getXslfile
return
xslFile
public
void
setXslfile
File
xslFile
this
xslFile
xslFile
public
String
getOutputpattern
return
outputpattern
public
void
setOutputpattern
String
outputpattern
this
outputpattern
outputpattern
public
String
getResolveId
return
resolveId
public
void
setResolveId
String
resolveId
this
resolveId
resolveId
public
void
doExecute
throws
BuildException
Ivy
ivy
getIvyInstance
IvySettings
settings
ivy
getSettings
conf
getProperty
conf
settings
resolveId
if
equals
conf
conf
getProperty
settings
resolveId
if
conf
throw
new
BuildException
if
todir
String
t
getProperty
settings
if
t
todir
getProject
resolveFile
t
if
todir
todir
exists
todir
mkdirs
outputpattern
getProperty
outputpattern
settings
if
outputpattern
outputpattern
if
todir
todir
exists
todir
isDirectory
throw
new
BuildException
if
resolveId
organisation
getProperty
organisation
settings
resolveId
module
getProperty
module
settings
resolveId
if
organisation
throw
new
BuildException
if
module
throw
new
BuildException
resolveId
ResolveOptions
getDefaultResolveId
new
ModuleId
organisation
module
try
String
confs
splitConfs
conf
if
xsl
genreport
confs
if
xml
genxml
confs
if
graph
genStyled
confs
getStylePath
if
dot
genStyled
confs
getStylePath
catch
IOException
e
throw
new
BuildException
e
e
private
void
genxml
String
confs
throws
IOException
ResolutionCacheManager
cacheMgr
getIvyInstance
getResolutionCacheManager
for
int
i
i
confs
length
i
File
xml
cacheMgr
getConfigurationResolveReportInCache
resolveId
confs
i
File
out
if
todir
out
new
File
todir
getOutputPattern
confs
i
else
out
getProject
resolveFile
getOutputPattern
confs
i
FileUtil
copy
xml
out
private
void
genreport
String
confs
throws
IOException
genStyled
confs
getReportStylePath
xslext
if
xslFile
File
css
if
todir
css
new
File
todir
else
css
getProject
resolveFile
if
css
exists
Message
debug
css
getAbsolutePath
FileUtil
copy
XmlReportOutputter
class
getResourceAsStream
css
private
File
getReportStylePath
throws
IOException
if
xslFile
return
xslFile
ResolutionCacheManager
cacheMgr
getIvyInstance
getResolutionCacheManager
File
style
new
File
cacheMgr
getResolutionCacheRoot
FileUtil
copy
XmlReportOutputter
class
getResourceAsStream
style
return
style
private
String
getOutputPattern
String
conf
String
ext
if
mRevId
ResolutionCacheManager
cacheMgr
getIvyInstance
getResolutionCacheManager
XmlReportParser
parser
new
XmlReportParser
File
reportFile
cacheMgr
getConfigurationResolveReportInCache
resolveId
conf
try
parser
parse
reportFile
catch
ParseException
e
throw
new
BuildException
reportFile
getAbsolutePath
e
mRevId
parser
getResolvedModule
return
IvyPatternHelper
substitute
outputpattern
mRevId
getOrganisation
mRevId
getName
mRevId
getRevision
ext
conf
mRevId
getAttributes
private
void
genStyled
String
confs
File
style
String
ext
throws
IOException
ResolutionCacheManager
cacheMgr
getIvyInstance
getResolutionCacheManager
File
out
if
todir
out
todir
else
out
getProject
getBaseDir
InputStream
xsltStream
try
xsltStream
new
BufferedInputStream
new
FileInputStream
style
Source
xsltSource
new
StreamSource
xsltStream
JAXPUtils
getSystemId
style
TransformerFactory
tFactory
TransformerFactory
newInstance
Transformer
transformer
tFactory
newTransformer
xsltSource
transformer
setParameter
conf
transformer
setParameter
xslext
for
Iterator
it
params
iterator
it
hasNext
XSLTProcess
Param
param
XSLTProcess
Param
it
next
transformer
setParameter
param
getName
param
getExpression
for
int
i
i
confs
length
i
File
reportFile
cacheMgr
getConfigurationResolveReportInCache
resolveId
confs
i
File
outFile
new
File
out
getOutputPattern
confs
i
ext
log
reportFile
outFile
File
outFileDir
outFile
getParentFile
if
outFileDir
exists
if
outFileDir
mkdirs
throw
new
BuildException
outFileDir
getAbsolutePath
InputStream
inStream
OutputStream
outStream
try
inStream
new
BufferedInputStream
new
FileInputStream
reportFile
outStream
new
BufferedOutputStream
new
FileOutputStream
outFile
StreamResult
res
new
StreamResult
outStream
Source
src
new
StreamSource
inStream
JAXPUtils
getSystemId
style
transformer
transform
src
res
catch
TransformerException
e
throw
new
BuildException
e
finally
if
inStream
try
inStream
close
catch
IOException
e
if
outStream
try
outStream
close
catch
IOException
e
catch
TransformerConfigurationException
e
throw
new
BuildException
e
finally
if
xsltStream
try
xsltStream
close
catch
IOException
e
private
File
getStylePath
String
styleResourceName
throws
IOException
ResolutionCacheManager
cacheMgr
getIvyInstance
getResolutionCacheManager
File
style
new
File
cacheMgr
getResolutionCacheRoot
styleResourceName
FileUtil
copy
XmlReportOutputter
class
getResourceAsStream
styleResourceName
style
return
style
public
boolean
isXml
return
xml
public
void
setXml
boolean
xml
this
xml
xml
public
boolean
isXsl
return
xsl
public
void
setXsl
boolean
xsl
this
xsl
xsl
public
String
getXslext
return
xslext
public
void
setXslext
String
xslext
this
xslext
xslext
public
XSLTProcess
Param
createParam
XSLTProcess
Param
result
new
XSLTProcess
Param
params
add
result
return
result
public
boolean
isDot
return
dot
public
void
setDot
boolean
dot
this
dot
dot
