package
org
apache
ivy
plugins
parser
import
java
io
IOException
import
java
net
URL
import
java
text
ParseException
import
java
util
ArrayList
import
java
util
Date
import
java
util
HashSet
import
java
util
List
import
java
util
Set
import
org
apache
ivy
core
module
descriptor
Artifact
import
org
apache
ivy
core
module
descriptor
Configuration
import
org
apache
ivy
core
module
descriptor
DefaultArtifact
import
org
apache
ivy
core
module
descriptor
DefaultDependencyDescriptor
import
org
apache
ivy
core
module
descriptor
DefaultModuleDescriptor
import
org
apache
ivy
core
module
descriptor
DependencyDescriptor
import
org
apache
ivy
core
module
descriptor
ModuleDescriptor
import
org
apache
ivy
core
module
id
ModuleRevisionId
import
org
apache
ivy
plugins
repository
Resource
import
org
apache
ivy
plugins
repository
ResourceHelper
import
org
apache
ivy
plugins
repository
url
URLResource
import
org
apache
ivy
util
Message
import
org
xml
sax
SAXException
import
org
xml
sax
SAXParseException
import
org
xml
sax
helpers
DefaultHandler
public
abstract
class
AbstractModuleDescriptorParser
implements
ModuleDescriptorParser
public
ModuleDescriptor
parseDescriptor
ParserSettings
ivySettings
URL
descriptorURL
boolean
validate
throws
ParseException
IOException
return
parseDescriptor
ivySettings
descriptorURL
new
URLResource
descriptorURL
validate
public
String
getType
return
public
Artifact
getMetadataArtifact
ModuleRevisionId
mrid
Resource
res
return
DefaultArtifact
newIvyArtifact
mrid
new
Date
res
getLastModified
protected
abstract
static
class
AbstractParser
extends
DefaultHandler
private
static
final
String
DEFAULT_CONF_MAPPING
private
String
defaultConf
private
String
defaultConfMapping
private
DefaultDependencyDescriptor
defaultConfMappingDescriptor
private
Resource
res
private
List
errors
new
ArrayList
private
DefaultModuleDescriptor
md
private
ModuleDescriptorParser
parser
protected
AbstractParser
ModuleDescriptorParser
parser
this
parser
parser
public
ModuleDescriptorParser
getModuleDescriptorParser
return
parser
protected
void
checkErrors
throws
ParseException
if
errors
isEmpty
throw
new
ParseException
errors
toString
public
void
setResource
Resource
res
this
res
res
md
new
DefaultModuleDescriptor
parser
res
md
setLastModified
ResourceHelper
getLastModifiedOrDefault
res
protected
Resource
getResource
return
res
protected
String
getDefaultConfMapping
return
defaultConfMapping
protected
void
setDefaultConfMapping
String
defaultConf
defaultConfMapping
defaultConf
protected
void
parseDepsConfs
String
confs
DefaultDependencyDescriptor
dd
parseDepsConfs
confs
dd
defaultConfMapping
protected
void
parseDepsConfs
String
confs
DefaultDependencyDescriptor
dd
boolean
useDefaultMappingToGuessRightOperande
parseDepsConfs
confs
dd
useDefaultMappingToGuessRightOperande
protected
void
parseDepsConfs
String
confs
DefaultDependencyDescriptor
dd
boolean
useDefaultMappingToGuessRightOperande
boolean
evaluateConditions
if
confs
return
String
conf
confs
split
parseDepsConfs
conf
dd
useDefaultMappingToGuessRightOperande
evaluateConditions
protected
void
parseDepsConfs
String
conf
DefaultDependencyDescriptor
dd
boolean
useDefaultMappingToGuessRightOperande
parseDepsConfs
conf
dd
useDefaultMappingToGuessRightOperande
protected
void
parseDepsConfs
String
conf
DefaultDependencyDescriptor
dd
boolean
useDefaultMappingToGuessRightOperande
boolean
evaluateConditions
replaceConfigurationWildcards
md
for
int
i
i
conf
length
i
String
ops
conf
i
split
if
ops
length
String
modConfs
ops
split
if
useDefaultMappingToGuessRightOperande
for
int
j
j
modConfs
length
j
dd
addDependencyConfiguration
modConfs
j
trim
modConfs
j
trim
else
for
int
j
j
modConfs
length
j
String
depConfs
getDefaultConfMappingDescriptor
getDependencyConfigurations
modConfs
j
if
depConfs
length
for
int
k
k
depConfs
length
k
String
mappedDependency
evaluateConditions
evaluateCondition
depConfs
k
trim
dd
depConfs
k
trim
if
mappedDependency
dd
addDependencyConfiguration
modConfs
j
trim
mappedDependency
else
dd
addDependencyConfiguration
modConfs
j
trim
modConfs
j
trim
else
if
ops
length
String
modConfs
ops
split
String
depConfs
ops
split
for
int
j
j
modConfs
length
j
for
int
k
k
depConfs
length
k
String
mappedDependency
evaluateConditions
evaluateCondition
depConfs
k
trim
dd
depConfs
k
trim
if
mappedDependency
dd
addDependencyConfiguration
modConfs
j
trim
mappedDependency
else
addError
conf
i
dd
if
md
isMappingOverride
addExtendingConfigurations
conf
dd
useDefaultMappingToGuessRightOperande
private
String
evaluateCondition
String
conf
DefaultDependencyDescriptor
dd
if
conf
charAt
return
conf
int
endConditionIndex
conf
indexOf
if
endConditionIndex
addError
conf
dd
return
String
condition
conf
substring
endConditionIndex
int
notEqualIndex
condition
indexOf
if
notEqualIndex
int
equalIndex
condition
indexOf
if
equalIndex
addError
conf
dd
getDependencyRevisionId
return
String
leftOp
condition
substring
equalIndex
trim
String
rightOp
condition
substring
equalIndex
trim
if
leftOp
equals
leftOp
equals
leftOp
String
attrValue
dd
getAttribute
leftOp
if
rightOp
equals
attrValue
return
else
String
leftOp
condition
substring
notEqualIndex
trim
String
rightOp
condition
substring
notEqualIndex
trim
if
leftOp
equals
leftOp
equals
leftOp
String
attrValue
dd
getAttribute
leftOp
if
rightOp
equals
attrValue
return
return
conf
substring
endConditionIndex
private
void
addExtendingConfigurations
String
confs
DefaultDependencyDescriptor
dd
boolean
useDefaultMappingToGuessRightOperande
for
int
i
i
confs
length
i
addExtendingConfigurations
confs
i
dd
useDefaultMappingToGuessRightOperande
private
void
addExtendingConfigurations
String
conf
DefaultDependencyDescriptor
dd
boolean
useDefaultMappingToGuessRightOperande
Set
configsToAdd
new
HashSet
Configuration
configs
md
getConfigurations
for
int
i
i
configs
length
i
String
ext
configs
i
getExtends
for
int
j
j
ext
length
j
if
conf
equals
ext
j
String
configName
configs
i
getName
configsToAdd
add
configName
addExtendingConfigurations
configName
dd
useDefaultMappingToGuessRightOperande
String
confs
String
configsToAdd
toArray
new
String
configsToAdd
size
parseDepsConfs
confs
dd
useDefaultMappingToGuessRightOperande
protected
DependencyDescriptor
getDefaultConfMappingDescriptor
if
defaultConfMappingDescriptor
defaultConfMappingDescriptor
new
DefaultDependencyDescriptor
ModuleRevisionId
newInstance
parseDepsConfs
defaultConfMapping
defaultConfMappingDescriptor
return
defaultConfMappingDescriptor
protected
void
addError
String
msg
if
res
errors
add
msg
res
else
errors
add
msg
public
void
warning
SAXParseException
ex
Message
warn
getLocationString
ex
ex
getMessage
public
void
error
SAXParseException
ex
addError
getLocationString
ex
ex
getMessage
public
void
fatalError
SAXParseException
ex
throws
SAXException
addError
getLocationString
ex
ex
getMessage
private
String
getLocationString
SAXParseException
ex
StringBuffer
str
new
StringBuffer
String
systemId
ex
getSystemId
if
systemId
int
index
systemId
lastIndexOf
if
index
systemId
systemId
substring
index
str
append
systemId
else
if
getResource
str
append
getResource
toString
str
append
str
append
ex
getLineNumber
str
append
str
append
ex
getColumnNumber
return
str
toString
protected
String
getDefaultConf
return
defaultConfMapping
defaultConfMapping
defaultConf
defaultConf
DEFAULT_CONF_MAPPING
protected
void
setDefaultConf
String
defaultConf
this
defaultConf
defaultConf
public
ModuleDescriptor
getModuleDescriptor
throws
ParseException
checkErrors
return
md
protected
Date
getDefaultPubDate
return
new
Date
md
getLastModified
private
void
replaceConfigurationWildcards
ModuleDescriptor
md
Configuration
configs
md
getConfigurations
for
int
i
i
configs
length
i
configs
i
replaceWildcards
md
protected
void
setMd
DefaultModuleDescriptor
md
this
md
md
protected
DefaultModuleDescriptor
getMd
return
md
