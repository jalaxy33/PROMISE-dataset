package
org
apache
ivy
util
url
import
java
io
File
import
java
io
FileInputStream
import
java
io
IOException
import
java
io
InputStream
import
java
net
URL
import
java
net
UnknownHostException
import
java
text
ParseException
import
java
text
SimpleDateFormat
import
java
util
ArrayList
import
java
util
List
import
java
util
Locale
import
org
apache
commons
httpclient
Header
import
org
apache
commons
httpclient
HttpClient
import
org
apache
commons
httpclient
HttpException
import
org
apache
commons
httpclient
HttpMethodBase
import
org
apache
commons
httpclient
HttpStatus
import
org
apache
commons
httpclient
MultiThreadedHttpConnectionManager
import
org
apache
commons
httpclient
UsernamePasswordCredentials
import
org
apache
commons
httpclient
auth
AuthPolicy
import
org
apache
commons
httpclient
methods
GetMethod
import
org
apache
commons
httpclient
methods
HeadMethod
import
org
apache
commons
httpclient
methods
InputStreamRequestEntity
import
org
apache
commons
httpclient
methods
PutMethod
import
org
apache
ivy
Ivy
import
org
apache
ivy
util
CopyProgressListener
import
org
apache
ivy
util
Credentials
import
org
apache
ivy
util
FileUtil
import
org
apache
ivy
util
Message
public
class
HttpClientHandler
extends
AbstractURLHandler
private
static
final
SimpleDateFormat
LAST_MODIFIED_FORMAT
new
SimpleDateFormat
Locale
US
private
int
proxyPort
private
String
proxyRealm
private
String
proxyHost
private
String
proxyUserName
private
String
proxyPasswd
private
HttpClientHelper
httpClientHelper
private
static
HttpClient
httpClient
public
HttpClientHandler
configureProxy
private
void
configureProxy
proxyRealm
proxyHost
System
getProperty
if
useProxy
proxyPort
Integer
parseInt
System
getProperty
proxyUserName
System
getProperty
proxyPasswd
System
getProperty
Message
verbose
proxyHost
proxyPort
proxyUserName
else
Message
verbose
public
InputStream
openStream
URL
url
throws
IOException
GetMethod
get
doGet
url
if
checkStatusCode
url
get
get
releaseConnection
throw
new
IOException
url
return
new
GETInputStream
get
public
void
download
URL
src
File
dest
CopyProgressListener
l
throws
IOException
GetMethod
get
doGet
src
try
if
checkStatusCode
src
get
throw
new
IOException
src
FileUtil
copy
get
getResponseBodyAsStream
dest
l
dest
setLastModified
getLastModified
get
finally
get
releaseConnection
public
void
upload
File
src
URL
dest
CopyProgressListener
l
throws
IOException
HttpClient
client
getClient
dest
PutMethod
put
new
PutMethod
normalizeToString
dest
put
setDoAuthentication
useAuthentication
dest
useProxyAuthentication
FileInputStream
fileStream
try
fileStream
new
FileInputStream
src
put
setRequestEntity
new
InputStreamRequestEntity
fileStream
int
statusCode
client
executeMethod
put
validatePutStatusCode
dest
statusCode
finally
if
fileStream
try
fileStream
close
catch
IOException
e
put
releaseConnection
public
URLInfo
getURLInfo
URL
url
return
getURLInfo
url
public
URLInfo
getURLInfo
URL
url
int
timeout
HttpMethodBase
method
try
if
getRequestMethod
URLHandler
REQUEST_METHOD_HEAD
method
doHead
url
timeout
else
method
doGet
url
timeout
if
checkStatusCode
url
method
return
new
URLInfo
getResponseContentLength
method
getLastModified
method
catch
HttpException
e
Message
error
e
getMessage
e
getReasonCode
e
getReason
url
catch
UnknownHostException
e
Message
warn
e
getMessage
url
Message
info
catch
IOException
e
Message
error
e
getMessage
url
catch
IllegalArgumentException
e
finally
if
method
method
releaseConnection
return
UNAVAILABLE
private
boolean
checkStatusCode
URL
url
HttpMethodBase
method
throws
IOException
int
status
method
getStatusCode
if
status
HttpStatus
SC_OK
return
Message
debug
status
url
if
status
HttpStatus
SC_PROXY_AUTHENTICATION_REQUIRED
Message
warn
else
if
String
valueOf
status
startsWith
Message
verbose
method
getStatusText
url
else
if
String
valueOf
status
startsWith
Message
error
method
getStatusText
url
return
private
long
getLastModified
HttpMethodBase
method
Header
header
method
getResponseHeader
if
header
String
lastModified
header
getValue
try
return
LAST_MODIFIED_FORMAT
parse
lastModified
getTime
catch
ParseException
e
return
System
currentTimeMillis
else
return
System
currentTimeMillis
private
long
getResponseContentLength
HttpMethodBase
head
return
getHttpClientHelper
getResponseContentLength
head
private
HttpClientHelper
getHttpClientHelper
if
httpClientHelper
try
HttpMethodBase
class
getMethod
new
Class
httpClientHelper
new
HttpClientHelper3x
Message
verbose
catch
SecurityException
e
Message
verbose
Message
verbose
e
getMessage
httpClientHelper
new
HttpClientHelper2x
Message
verbose
catch
NoSuchMethodException
e
httpClientHelper
new
HttpClientHelper2x
Message
verbose
return
httpClientHelper
public
int
getHttpClientMajorVersion
HttpClientHelper
helper
getHttpClientHelper
return
helper
getHttpClientMajorVersion
private
GetMethod
doGet
URL
url
int
timeout
throws
IOException
HttpClient
client
getClient
url
client
setTimeout
timeout
GetMethod
get
new
GetMethod
normalizeToString
url
get
setDoAuthentication
useAuthentication
url
useProxyAuthentication
client
executeMethod
get
return
get
private
HeadMethod
doHead
URL
url
int
timeout
throws
IOException
HttpClient
client
getClient
url
client
setTimeout
timeout
HeadMethod
head
new
HeadMethod
normalizeToString
url
head
setDoAuthentication
useAuthentication
url
useProxyAuthentication
client
executeMethod
head
return
head
private
HttpClient
getClient
URL
url
if
httpClient
final
MultiThreadedHttpConnectionManager
connManager
new
MultiThreadedHttpConnectionManager
httpClient
new
HttpClient
connManager
Runtime
getRuntime
addShutdownHook
new
Thread
new
Runnable
public
void
run
connManager
shutdown
List
authPrefs
new
ArrayList
authPrefs
add
AuthPolicy
DIGEST
authPrefs
add
AuthPolicy
BASIC
httpClient
getParams
setParameter
AuthPolicy
AUTH_SCHEME_PRIORITY
authPrefs
if
useProxy
httpClient
getHostConfiguration
setProxy
proxyHost
proxyPort
if
useProxyAuthentication
httpClient
getState
setProxyCredentials
proxyRealm
proxyHost
new
UsernamePasswordCredentials
proxyUserName
proxyPasswd
httpClient
getParams
setParameter
Ivy
getIvyVersion
Credentials
c
getCredentials
url
if
c
Message
debug
url
c
httpClient
getState
setCredentials
c
getRealm
c
getHost
new
UsernamePasswordCredentials
c
getUserName
c
getPasswd
return
httpClient
private
boolean
useProxy
return
proxyHost
proxyHost
trim
length
private
boolean
useAuthentication
URL
url
return
getCredentials
url
private
Credentials
getCredentials
URL
url
return
CredentialsStore
INSTANCE
getCredentials
url
getHost
private
boolean
useProxyAuthentication
return
proxyUserName
proxyUserName
trim
length
private
static
final
class
GETInputStream
extends
InputStream
private
InputStream
is
private
GetMethod
get
private
GETInputStream
GetMethod
get
throws
IOException
this
get
get
is
get
getResponseBodyAsStream
public
int
available
throws
IOException
return
is
available
public
void
close
throws
IOException
is
close
get
releaseConnection
public
boolean
equals
Object
obj
return
is
equals
obj
public
int
hashCode
return
is
hashCode
public
void
mark
int
readlimit
is
mark
readlimit
public
boolean
markSupported
return
is
markSupported
public
int
read
throws
IOException
return
is
read
public
int
read
byte
b
int
off
int
len
throws
IOException
return
is
read
b
off
len
public
int
read
byte
b
throws
IOException
return
is
read
b
public
void
reset
throws
IOException
is
reset
public
long
skip
long
n
throws
IOException
return
is
skip
n
public
String
toString
return
is
toString
private
static
final
class
HttpClientHelper3x
implements
HttpClientHelper
private
static
final
int
VERSION
private
HttpClientHelper3x
public
long
getResponseContentLength
HttpMethodBase
method
return
method
getResponseContentLength
public
int
getHttpClientMajorVersion
return
VERSION
private
static
final
class
HttpClientHelper2x
implements
HttpClientHelper
private
static
final
int
VERSION
private
HttpClientHelper2x
public
long
getResponseContentLength
HttpMethodBase
method
Header
header
method
getResponseHeader
if
header
try
return
Integer
parseInt
header
getValue
catch
NumberFormatException
e
Message
verbose
e
getMessage
return
public
int
getHttpClientMajorVersion
return
VERSION
public
interface
HttpClientHelper
long
getResponseContentLength
HttpMethodBase
method
int
getHttpClientMajorVersion
