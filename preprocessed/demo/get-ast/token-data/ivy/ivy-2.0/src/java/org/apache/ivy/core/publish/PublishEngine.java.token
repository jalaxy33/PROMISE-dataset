package
org
apache
ivy
core
publish
import
java
io
File
import
java
io
IOException
import
java
net
MalformedURLException
import
java
net
URL
import
java
text
ParseException
import
java
util
ArrayList
import
java
util
Arrays
import
java
util
Collection
import
java
util
Date
import
java
util
HashSet
import
java
util
Iterator
import
java
util
LinkedHashMap
import
java
util
LinkedHashSet
import
java
util
Map
import
java
util
Set
import
java
util
Map
Entry
import
org
apache
ivy
core
IvyContext
import
org
apache
ivy
core
IvyPatternHelper
import
org
apache
ivy
core
cache
ResolutionCacheManager
import
org
apache
ivy
core
event
EventManager
import
org
apache
ivy
core
event
publish
EndArtifactPublishEvent
import
org
apache
ivy
core
event
publish
StartArtifactPublishEvent
import
org
apache
ivy
core
module
descriptor
Artifact
import
org
apache
ivy
core
module
descriptor
DefaultArtifact
import
org
apache
ivy
core
module
descriptor
MDArtifact
import
org
apache
ivy
core
module
descriptor
ModuleDescriptor
import
org
apache
ivy
core
module
id
ModuleRevisionId
import
org
apache
ivy
plugins
parser
xml
UpdateOptions
import
org
apache
ivy
plugins
parser
xml
XmlModuleDescriptorParser
import
org
apache
ivy
plugins
parser
xml
XmlModuleDescriptorUpdater
import
org
apache
ivy
plugins
resolver
DependencyResolver
import
org
apache
ivy
util
ConfigurationUtils
import
org
apache
ivy
util
Message
import
org
xml
sax
SAXException
public
class
PublishEngine
private
PublishEngineSettings
settings
private
EventManager
eventManager
public
PublishEngine
PublishEngineSettings
settings
EventManager
eventManager
this
settings
settings
this
eventManager
eventManager
public
Collection
publish
ModuleRevisionId
mrid
Collection
srcArtifactPattern
String
resolverName
PublishOptions
options
throws
IOException
Message
info
mrid
getModuleId
Message
verbose
options
isValidate
long
start
System
currentTimeMillis
options
setSrcIvyPattern
settings
substitute
options
getSrcIvyPattern
if
options
getPubBranch
options
setPubbranch
mrid
getBranch
if
options
getPubrevision
options
setPubrevision
mrid
getRevision
ModuleRevisionId
pubmrid
ModuleRevisionId
newInstance
mrid
options
getPubBranch
options
getPubrevision
File
ivyFile
if
options
getSrcIvyPattern
ivyFile
settings
resolveFile
IvyPatternHelper
substitute
options
getSrcIvyPattern
DefaultArtifact
newIvyArtifact
pubmrid
new
Date
if
ivyFile
exists
throw
new
IllegalArgumentException
mrid
ivyFile
else
ResolutionCacheManager
cacheManager
settings
getResolutionCacheManager
ivyFile
cacheManager
getResolvedIvyFileInCache
mrid
if
ivyFile
exists
throw
new
IllegalStateException
mrid
ivyFile
ModuleDescriptor
md
URL
ivyFileURL
try
ivyFileURL
ivyFile
toURI
toURL
md
XmlModuleDescriptorParser
getInstance
parseDescriptor
settings
ivyFileURL
if
options
getSrcIvyPattern
if
options
isUpdate
File
tmp
File
createTempFile
tmp
deleteOnExit
String
confs
ConfigurationUtils
replaceWildcards
options
getConfs
md
Set
confsToRemove
new
HashSet
Arrays
asList
md
getConfigurationsNames
confsToRemove
removeAll
Arrays
asList
confs
try
XmlModuleDescriptorUpdater
update
ivyFileURL
tmp
new
UpdateOptions
setSettings
settings
setStatus
options
getStatus
md
getStatus
options
getStatus
setRevision
options
getPubrevision
setBranch
options
getPubBranch
setPubdate
options
getPubdate
new
Date
options
getPubdate
setConfsToExclude
String
confsToRemove
toArray
new
String
confsToRemove
size
ivyFile
tmp
md
XmlModuleDescriptorParser
getInstance
parseDescriptor
settings
ivyFile
toURI
toURL
options
setSrcIvyPattern
ivyFile
getAbsolutePath
catch
SAXException
e
throw
new
IllegalStateException
mrid
ivyFile
e
else
if
options
getPubrevision
equals
md
getModuleRevisionId
getRevision
throw
new
IllegalArgumentException
ivyFile
options
getPubrevision
md
getModuleRevisionId
getRevision
else
md
setResolvedModuleRevisionId
pubmrid
catch
MalformedURLException
e
throw
new
RuntimeException
ivyFile
catch
ParseException
e
throw
new
IllegalStateException
mrid
ivyFile
e
DependencyResolver
resolver
settings
getResolver
resolverName
if
resolver
throw
new
IllegalArgumentException
resolverName
Collection
missing
publish
md
srcArtifactPattern
resolver
options
Message
verbose
System
currentTimeMillis
start
return
missing
public
Collection
publish
ModuleDescriptor
md
Collection
srcArtifactPattern
DependencyResolver
resolver
PublishOptions
options
throws
IOException
Collection
missing
new
ArrayList
Set
artifactsSet
new
LinkedHashSet
String
confs
options
getConfs
if
confs
confs
length
equals
confs
confs
md
getConfigurationsNames
for
int
i
i
confs
length
i
Artifact
artifacts
md
getArtifacts
confs
i
for
int
j
j
artifacts
length
j
artifactsSet
add
artifacts
j
Artifact
extraArtifacts
options
getExtraArtifacts
if
extraArtifacts
for
int
i
i
extraArtifacts
length
i
artifactsSet
add
new
MDArtifact
md
extraArtifacts
i
getName
extraArtifacts
i
getType
extraArtifacts
i
getExt
extraArtifacts
i
getUrl
extraArtifacts
i
getQualifiedExtraAttributes
Map
artifactsFiles
new
LinkedHashMap
for
Iterator
iter
artifactsSet
iterator
iter
hasNext
Artifact
artifact
Artifact
iter
next
for
Iterator
iterator
srcArtifactPattern
iterator
iterator
hasNext
String
pattern
String
iterator
next
File
artifactFile
settings
resolveFile
IvyPatternHelper
substitute
settings
substitute
pattern
artifact
if
artifactFile
exists
artifactsFiles
put
artifact
artifactFile
break
if
artifactsFiles
containsKey
artifact
StringBuffer
sb
new
StringBuffer
sb
append
artifact
for
Iterator
iterator
srcArtifactPattern
iterator
iterator
hasNext
String
pattern
String
iterator
next
sb
append
settings
resolveFile
IvyPatternHelper
substitute
pattern
artifact
if
options
isWarnOnMissing
options
isHaltOnMissing
Message
warn
sb
toString
else
Message
verbose
sb
toString
if
options
isHaltOnMissing
throw
new
IOException
artifact
missing
add
artifact
if
options
getSrcIvyPattern
Artifact
artifact
MDArtifact
newIvyArtifact
md
File
artifactFile
settings
resolveFile
IvyPatternHelper
substitute
options
getSrcIvyPattern
artifact
if
artifactFile
exists
String
msg
md
getModuleRevisionId
artifactFile
if
options
isWarnOnMissing
options
isHaltOnMissing
Message
warn
msg
else
Message
verbose
msg
if
options
isHaltOnMissing
throw
new
IOException
artifact
missing
add
artifact
else
artifactsFiles
put
artifact
artifactFile
boolean
successfullyPublished
try
resolver
beginPublishTransaction
md
getModuleRevisionId
options
isOverwrite
for
Iterator
iter
artifactsFiles
entrySet
iterator
iter
hasNext
Map
Entry
entry
Entry
iter
next
Artifact
artifact
Artifact
entry
getKey
File
artifactFile
File
entry
getValue
publish
artifact
artifactFile
resolver
options
isOverwrite
resolver
commitPublishTransaction
successfullyPublished
finally
if
successfullyPublished
resolver
abortPublishTransaction
return
missing
private
void
publish
Artifact
artifact
File
src
DependencyResolver
resolver
boolean
overwrite
throws
IOException
IvyContext
getContext
checkInterrupted
eventManager
fireIvyEvent
new
StartArtifactPublishEvent
resolver
artifact
src
overwrite
boolean
successful
try
if
src
exists
resolver
publish
artifact
src
overwrite
successful
finally
eventManager
fireIvyEvent
new
EndArtifactPublishEvent
resolver
artifact
src
overwrite
successful
