package
org
apache
ivy
ant
import
org
apache
ivy
Ivy
import
org
apache
ivy
core
module
id
ModuleId
import
org
apache
ivy
core
module
id
ModuleRevisionId
import
org
apache
ivy
core
resolve
ResolvedModuleRevision
import
org
apache
ivy
core
settings
IvySettings
import
org
apache
tools
ant
BuildException
public
class
IvyBuildNumber
extends
IvyTask
private
String
organisation
private
String
module
private
String
branch
private
String
revision
private
String
revSep
private
String
prefix
private
String
defaultValue
private
String
defaultBuildNumber
public
String
getModule
return
module
public
void
setModule
String
module
this
module
module
public
String
getOrganisation
return
organisation
public
void
setOrganisation
String
organisation
this
organisation
organisation
public
String
getRevision
return
revision
public
void
setRevision
String
revision
this
revision
revision
public
String
getBranch
return
branch
public
void
setBranch
String
branch
this
branch
branch
public
String
getDefault
return
defaultValue
public
void
setDefault
String
default1
defaultValue
default1
public
String
getPrefix
return
prefix
public
void
setPrefix
String
prefix
this
prefix
prefix
public
void
doExecute
throws
BuildException
if
organisation
throw
new
BuildException
if
module
throw
new
BuildException
if
prefix
throw
new
BuildException
Ivy
ivy
getIvyInstance
IvySettings
settings
ivy
getSettings
if
branch
settings
getDefaultBranch
new
ModuleId
organisation
module
if
revision
revision
length
revision
else
if
revision
endsWith
revision
revision
if
prefix
endsWith
prefix
length
prefix
prefix
ResolvedModuleRevision
rmr
ivy
findModule
ModuleRevisionId
newInstance
organisation
module
branch
revision
String
revision
rmr
rmr
getId
getRevision
NewRevision
newRevision
computeNewRevision
revision
setProperty
newRevision
getRevision
setProperty
newRevision
getNewRevision
setProperty
newRevision
getBuildNumber
setProperty
newRevision
getNewBuildNumber
private
void
setProperty
String
propertyName
String
value
if
value
getProject
setProperty
prefix
propertyName
value
private
NewRevision
computeNewRevision
String
revision
String
revPrefix
equals
this
revision
this
revision
substring
this
revision
length
if
revision
revision
startsWith
revPrefix
throw
new
BuildException
revision
revPrefix
if
revision
if
revPrefix
length
return
new
NewRevision
revision
revPrefix
revPrefix
endsWith
revSep
defaultBuildNumber
revSep
defaultBuildNumber
defaultBuildNumber
else
Range
r
findLastNumber
defaultValue
if
r
return
new
NewRevision
revision
defaultValue
else
long
n
Long
parseLong
defaultValue
substring
r
getStartIndex
r
getEndIndex
return
new
NewRevision
revision
defaultValue
String
valueOf
n
Range
r
if
revPrefix
length
r
findLastNumber
revision
if
r
return
new
NewRevision
revision
revision
revision
endsWith
revSep
revSep
else
r
findFirstNumber
revision
revPrefix
length
if
r
return
new
NewRevision
revision
revPrefix
revPrefix
endsWith
revSep
revSep
long
n
Long
parseLong
revision
substring
r
getStartIndex
r
getEndIndex
return
new
NewRevision
revision
revision
substring
r
getStartIndex
n
String
valueOf
n
String
valueOf
n
private
Range
findFirstNumber
String
str
int
startIndex
int
startNumberIndex
startIndex
while
startNumberIndex
str
length
Character
isDigit
str
charAt
startNumberIndex
startNumberIndex
if
startNumberIndex
str
length
return
int
endNumberIndex
startNumberIndex
while
endNumberIndex
str
length
Character
isDigit
str
charAt
endNumberIndex
endNumberIndex
return
new
Range
startNumberIndex
endNumberIndex
private
Range
findLastNumber
String
str
int
endNumberIndex
str
length
while
endNumberIndex
Character
isDigit
str
charAt
endNumberIndex
endNumberIndex
int
startNumberIndex
endNumberIndex
endNumberIndex
while
startNumberIndex
Character
isDigit
str
charAt
startNumberIndex
startNumberIndex
endNumberIndex
startNumberIndex
if
startNumberIndex
endNumberIndex
return
else
return
new
Range
startNumberIndex
endNumberIndex
private
static
class
Range
private
int
startIndex
private
int
endIndex
public
Range
int
startIndex
int
endIndex
this
startIndex
startIndex
this
endIndex
endIndex
public
int
getStartIndex
return
startIndex
public
int
getEndIndex
return
endIndex
private
static
class
NewRevision
private
String
revision
private
String
newRevision
private
String
buildNumber
private
String
newBuildNumber
public
NewRevision
String
revision
String
newRevision
String
buildNumber
String
newBuildNumber
this
revision
revision
this
newRevision
newRevision
this
buildNumber
buildNumber
this
newBuildNumber
newBuildNumber
public
String
getRevision
return
revision
public
String
getNewRevision
return
newRevision
public
String
getBuildNumber
return
buildNumber
public
String
getNewBuildNumber
return
newBuildNumber
public
String
getRevSep
return
revSep
public
void
setRevSep
String
revSep
this
revSep
revSep
public
String
getDefaultBuildNumber
return
defaultBuildNumber
public
void
setDefaultBuildNumber
String
defaultBuildNumber
this
defaultBuildNumber
defaultBuildNumber
