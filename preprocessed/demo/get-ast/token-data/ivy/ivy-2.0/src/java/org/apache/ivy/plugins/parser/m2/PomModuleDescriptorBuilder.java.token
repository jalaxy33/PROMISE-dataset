package
org
apache
ivy
plugins
parser
m2
import
java
util
ArrayList
import
java
util
Arrays
import
java
util
Collection
import
java
util
Collections
import
java
util
Date
import
java
util
HashMap
import
java
util
Iterator
import
java
util
LinkedHashMap
import
java
util
List
import
java
util
Map
import
java
util
Map
Entry
import
org
apache
ivy
Ivy
import
org
apache
ivy
core
cache
ArtifactOrigin
import
org
apache
ivy
core
module
descriptor
Artifact
import
org
apache
ivy
core
module
descriptor
Configuration
import
org
apache
ivy
core
module
descriptor
DefaultArtifact
import
org
apache
ivy
core
module
descriptor
DefaultDependencyArtifactDescriptor
import
org
apache
ivy
core
module
descriptor
DefaultDependencyDescriptor
import
org
apache
ivy
core
module
descriptor
DefaultExcludeRule
import
org
apache
ivy
core
module
descriptor
DefaultModuleDescriptor
import
org
apache
ivy
core
module
descriptor
DependencyDescriptor
import
org
apache
ivy
core
module
descriptor
License
import
org
apache
ivy
core
module
descriptor
MDArtifact
import
org
apache
ivy
core
module
descriptor
ModuleDescriptor
import
org
apache
ivy
core
module
descriptor
OverrideDependencyDescriptorMediator
import
org
apache
ivy
core
module
descriptor
Configuration
Visibility
import
org
apache
ivy
core
module
id
ArtifactId
import
org
apache
ivy
core
module
id
ModuleId
import
org
apache
ivy
core
module
id
ModuleRevisionId
import
org
apache
ivy
plugins
matcher
ExactPatternMatcher
import
org
apache
ivy
plugins
matcher
PatternMatcher
import
org
apache
ivy
plugins
parser
ModuleDescriptorParser
import
org
apache
ivy
plugins
parser
ParserSettings
import
org
apache
ivy
plugins
parser
m2
PomReader
PomDependencyData
import
org
apache
ivy
plugins
repository
Resource
import
org
apache
ivy
plugins
resolver
DependencyResolver
import
org
apache
ivy
util
Message
public
class
PomModuleDescriptorBuilder
private
static
final
int
DEPENDENCY_MANAGEMENT_KEY_PARTS_COUNT
public
static
final
Configuration
MAVEN2_CONFIGURATIONS
new
Configuration
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PRIVATE
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
static
final
Map
MAVEN2_CONF_MAPPING
new
HashMap
private
static
final
String
DEPENDENCY_MANAGEMENT
private
static
final
String
PROPERTIES
private
static
final
String
EXTRA_INFO_DELIMITER
private
static
final
Collection
JAR_PACKAGINGS
Arrays
asList
new
String
static
interface
ConfMapper
public
void
addMappingConfs
DefaultDependencyDescriptor
dd
boolean
isOptional
static
MAVEN2_CONF_MAPPING
put
new
ConfMapper
public
void
addMappingConfs
DefaultDependencyDescriptor
dd
boolean
isOptional
if
isOptional
dd
addDependencyConfiguration
dd
addDependencyConfiguration
else
dd
addDependencyConfiguration
dd
addDependencyConfiguration
dd
addDependencyConfiguration
MAVEN2_CONF_MAPPING
put
new
ConfMapper
public
void
addMappingConfs
DefaultDependencyDescriptor
dd
boolean
isOptional
if
isOptional
dd
addDependencyConfiguration
dd
addDependencyConfiguration
dd
addDependencyConfiguration
dd
addDependencyConfiguration
else
dd
addDependencyConfiguration
dd
addDependencyConfiguration
dd
addDependencyConfiguration
dd
addDependencyConfiguration
MAVEN2_CONF_MAPPING
put
new
ConfMapper
public
void
addMappingConfs
DefaultDependencyDescriptor
dd
boolean
isOptional
if
isOptional
dd
addDependencyConfiguration
dd
addDependencyConfiguration
dd
addDependencyConfiguration
else
dd
addDependencyConfiguration
dd
addDependencyConfiguration
dd
addDependencyConfiguration
MAVEN2_CONF_MAPPING
put
new
ConfMapper
public
void
addMappingConfs
DefaultDependencyDescriptor
dd
boolean
isOptional
dd
addDependencyConfiguration
dd
addDependencyConfiguration
MAVEN2_CONF_MAPPING
put
new
ConfMapper
public
void
addMappingConfs
DefaultDependencyDescriptor
dd
boolean
isOptional
dd
addDependencyConfiguration
private
final
DefaultModuleDescriptor
ivyModuleDescriptor
private
ModuleRevisionId
mrid
private
DefaultArtifact
mainArtifact
private
ParserSettings
parserSettings
public
PomModuleDescriptorBuilder
ModuleDescriptorParser
parser
Resource
res
ParserSettings
ivySettings
ivyModuleDescriptor
new
DefaultModuleDescriptor
parser
res
ivyModuleDescriptor
setResolvedPublicationDate
new
Date
res
getLastModified
for
int
i
i
MAVEN2_CONFIGURATIONS
length
i
ivyModuleDescriptor
addConfiguration
MAVEN2_CONFIGURATIONS
i
ivyModuleDescriptor
setMappingOverride
ivyModuleDescriptor
addExtraAttributeNamespace
Ivy
getIvyHomeURL
parserSettings
ivySettings
public
ModuleDescriptor
getModuleDescriptor
return
ivyModuleDescriptor
public
void
setModuleRevId
String
groupId
String
artifactId
String
version
mrid
ModuleRevisionId
newInstance
groupId
artifactId
version
ivyModuleDescriptor
setModuleRevisionId
mrid
if
version
version
endsWith
ivyModuleDescriptor
setStatus
else
ivyModuleDescriptor
setStatus
public
void
setHomePage
String
homePage
ivyModuleDescriptor
setHomePage
homePage
public
void
setDescription
String
description
ivyModuleDescriptor
setDescription
description
public
void
setLicenses
License
licenses
for
int
i
i
licenses
length
i
ivyModuleDescriptor
addLicense
licenses
i
public
void
addMainArtifact
String
artifactId
String
packaging
String
ext
if
equals
packaging
DependencyResolver
resolver
parserSettings
getResolver
mrid
if
resolver
DefaultArtifact
artifact
new
DefaultArtifact
mrid
new
Date
artifactId
ArtifactOrigin
artifactOrigin
resolver
locate
artifact
if
ArtifactOrigin
isUnknown
artifactOrigin
mainArtifact
artifact
ivyModuleDescriptor
addArtifact
mainArtifact
return
else
if
JAR_PACKAGINGS
contains
packaging
ext
else
ext
packaging
mainArtifact
new
DefaultArtifact
mrid
new
Date
artifactId
packaging
ext
ivyModuleDescriptor
addArtifact
mainArtifact
public
void
addDependency
Resource
res
PomDependencyData
dep
String
scope
dep
getScope
if
scope
scope
length
MAVEN2_CONF_MAPPING
containsKey
scope
scope
String
version
dep
getVersion
version
version
version
length
getDefaultVersion
dep
version
ModuleRevisionId
moduleRevId
ModuleRevisionId
newInstance
dep
getGroupId
dep
getArtifactId
version
DefaultDependencyDescriptor
dd
new
DefaultDependencyDescriptor
ivyModuleDescriptor
moduleRevId
scope
scope
scope
length
getDefaultScope
dep
scope
ConfMapper
mapping
ConfMapper
MAVEN2_CONF_MAPPING
get
scope
mapping
addMappingConfs
dd
dep
isOptional
Map
extraAtt
new
HashMap
if
dep
getClassifier
dep
getType
String
type
if
dep
getType
type
dep
getType
if
dep
getClassifier
extraAtt
put
dep
getClassifier
DefaultDependencyArtifactDescriptor
depArtifact
new
DefaultDependencyArtifactDescriptor
dd
dd
getDependencyId
getName
type
type
extraAtt
String
optionalizedScope
dep
isOptional
scope
dd
addDependencyArtifact
optionalizedScope
depArtifact
for
Iterator
itExcl
dep
getExcludedModules
iterator
itExcl
hasNext
ModuleId
excludedModule
ModuleId
itExcl
next
String
confs
dd
getModuleConfigurations
for
int
k
k
confs
length
k
dd
addExcludeRule
confs
k
new
DefaultExcludeRule
new
ArtifactId
excludedModule
PatternMatcher
ANY_EXPRESSION
PatternMatcher
ANY_EXPRESSION
PatternMatcher
ANY_EXPRESSION
ExactPatternMatcher
INSTANCE
ivyModuleDescriptor
addDependency
dd
public
void
addDependency
DependencyDescriptor
descriptor
ivyModuleDescriptor
addDependency
descriptor
public
void
addDependencyMgt
PomDependencyMgt
dep
String
key
getDependencyMgtExtraInfoKeyForVersion
dep
getGroupId
dep
getArtifactId
ivyModuleDescriptor
addExtraInfo
key
dep
getVersion
if
dep
getScope
String
scopeKey
getDependencyMgtExtraInfoKeyForScope
dep
getGroupId
dep
getArtifactId
ivyModuleDescriptor
addExtraInfo
scopeKey
dep
getScope
ivyModuleDescriptor
addDependencyDescriptorMediator
ModuleId
newInstance
dep
getGroupId
dep
getArtifactId
ExactPatternMatcher
INSTANCE
new
OverrideDependencyDescriptorMediator
dep
getVersion
public
void
addPlugin
PomDependencyMgt
plugin
String
pluginValue
plugin
getGroupId
EXTRA_INFO_DELIMITER
plugin
getArtifactId
EXTRA_INFO_DELIMITER
plugin
getVersion
String
pluginExtraInfo
String
ivyModuleDescriptor
getExtraInfo
get
if
pluginExtraInfo
pluginExtraInfo
pluginValue
else
pluginExtraInfo
pluginExtraInfo
pluginValue
ivyModuleDescriptor
getExtraInfo
put
pluginExtraInfo
public
static
List
getPlugins
ModuleDescriptor
md
List
result
new
ArrayList
String
plugins
String
md
getExtraInfo
get
if
plugins
return
new
ArrayList
String
pluginsArray
plugins
split
for
int
i
i
pluginsArray
length
i
String
parts
pluginsArray
i
split
EXTRA_INFO_DELIMITER
result
add
new
PomPluginElement
parts
parts
parts
return
result
private
static
class
PomPluginElement
implements
PomDependencyMgt
private
String
groupId
private
String
artifactId
private
String
version
public
PomPluginElement
String
groupId
String
artifactId
String
version
this
groupId
groupId
this
artifactId
artifactId
this
version
version
public
String
getGroupId
return
groupId
public
String
getArtifactId
return
artifactId
public
String
getVersion
return
version
public
String
getScope
return
private
String
getDefaultVersion
PomDependencyData
dep
String
key
getDependencyMgtExtraInfoKeyForVersion
dep
getGroupId
dep
getArtifactId
return
String
ivyModuleDescriptor
getExtraInfo
get
key
private
String
getDefaultScope
PomDependencyData
dep
String
key
getDependencyMgtExtraInfoKeyForScope
dep
getGroupId
dep
getArtifactId
String
result
String
ivyModuleDescriptor
getExtraInfo
get
key
if
result
MAVEN2_CONF_MAPPING
containsKey
result
result
return
result
private
static
String
getDependencyMgtExtraInfoKeyForVersion
String
groupId
String
artifaceId
return
DEPENDENCY_MANAGEMENT
EXTRA_INFO_DELIMITER
groupId
EXTRA_INFO_DELIMITER
artifaceId
EXTRA_INFO_DELIMITER
private
static
String
getDependencyMgtExtraInfoKeyForScope
String
groupId
String
artifaceId
return
DEPENDENCY_MANAGEMENT
EXTRA_INFO_DELIMITER
groupId
EXTRA_INFO_DELIMITER
artifaceId
EXTRA_INFO_DELIMITER
private
static
String
getPropertyExtraInfoKey
String
propertyName
return
PROPERTIES
EXTRA_INFO_DELIMITER
propertyName
public
static
Map
getDependencyManagementMap
ModuleDescriptor
md
Map
ret
new
LinkedHashMap
for
Iterator
iterator
md
getExtraInfo
entrySet
iterator
iterator
hasNext
Map
Entry
entry
Map
Entry
iterator
next
String
key
String
entry
getKey
if
key
startsWith
DEPENDENCY_MANAGEMENT
String
parts
key
split
EXTRA_INFO_DELIMITER
if
parts
length
DEPENDENCY_MANAGEMENT_KEY_PARTS_COUNT
Message
warn
key
else
ret
put
ModuleId
newInstance
parts
parts
entry
getValue
return
ret
public
static
List
getDependencyManagements
ModuleDescriptor
md
List
result
new
ArrayList
for
Iterator
iterator
md
getExtraInfo
entrySet
iterator
iterator
hasNext
Map
Entry
entry
Map
Entry
iterator
next
String
key
String
entry
getKey
if
key
startsWith
DEPENDENCY_MANAGEMENT
String
parts
key
split
EXTRA_INFO_DELIMITER
if
parts
length
DEPENDENCY_MANAGEMENT_KEY_PARTS_COUNT
Message
warn
key
else
String
versionKey
DEPENDENCY_MANAGEMENT
EXTRA_INFO_DELIMITER
parts
EXTRA_INFO_DELIMITER
parts
EXTRA_INFO_DELIMITER
String
scopeKey
DEPENDENCY_MANAGEMENT
EXTRA_INFO_DELIMITER
parts
EXTRA_INFO_DELIMITER
parts
EXTRA_INFO_DELIMITER
String
version
String
md
getExtraInfo
get
versionKey
String
scope
String
md
getExtraInfo
get
scopeKey
result
add
new
DefaultPomDependencyMgt
parts
parts
version
scope
return
result
public
void
addExtraInfos
Map
extraAttributes
for
Iterator
it
extraAttributes
entrySet
iterator
it
hasNext
Map
Entry
entry
Entry
it
next
String
key
String
entry
getKey
String
value
String
entry
getValue
addExtraInfo
key
value
private
void
addExtraInfo
String
key
String
value
if
ivyModuleDescriptor
getExtraInfo
containsKey
key
ivyModuleDescriptor
addExtraInfo
key
value
public
static
Map
extractPomProperties
Map
extraInfo
Map
r
new
HashMap
for
Iterator
it
extraInfo
entrySet
iterator
it
hasNext
Map
Entry
extraInfoEntry
Map
Entry
it
next
if
String
extraInfoEntry
getKey
startsWith
PROPERTIES
String
prop
String
extraInfoEntry
getKey
substring
PROPERTIES
length
EXTRA_INFO_DELIMITER
length
r
put
prop
extraInfoEntry
getValue
return
r
public
void
addProperty
String
propertyName
String
value
addExtraInfo
getPropertyExtraInfoKey
propertyName
value
public
Artifact
getMainArtifact
return
mainArtifact
public
Artifact
getSourceArtifact
return
new
MDArtifact
ivyModuleDescriptor
mrid
getName
Collections
singletonMap
public
Artifact
getJavadocArtifact
return
new
MDArtifact
ivyModuleDescriptor
mrid
getName
Collections
singletonMap
public
void
addSourceArtifact
ivyModuleDescriptor
addArtifact
getSourceArtifact
public
void
addJavadocArtifact
ivyModuleDescriptor
addArtifact
getJavadocArtifact
