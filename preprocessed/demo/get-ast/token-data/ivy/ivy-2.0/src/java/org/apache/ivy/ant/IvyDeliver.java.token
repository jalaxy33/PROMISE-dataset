package
org
apache
ivy
ant
import
java
io
File
import
java
util
Date
import
org
apache
ivy
Ivy
import
org
apache
ivy
core
deliver
DefaultPublishingDRResolver
import
org
apache
ivy
core
deliver
DeliverOptions
import
org
apache
ivy
core
deliver
PublishingDependencyRevisionResolver
import
org
apache
ivy
core
module
descriptor
ModuleDescriptor
import
org
apache
ivy
core
module
id
ModuleRevisionId
import
org
apache
ivy
core
module
status
StatusManager
import
org
apache
ivy
core
settings
IvySettings
import
org
apache
ivy
util
Message
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
taskdefs
CallTarget
import
org
apache
tools
ant
taskdefs
Echo
import
org
apache
tools
ant
taskdefs
Input
import
org
apache
tools
ant
taskdefs
Property
public
class
IvyDeliver
extends
IvyTask
private
final
class
DeliverDRResolver
extends
DefaultPublishingDRResolver
public
String
resolve
ModuleDescriptor
published
String
publishedStatus
ModuleRevisionId
depMrid
String
depStatus
if
StatusManager
getCurrent
isIntegration
publishedStatus
return
super
resolve
published
publishedStatus
depMrid
depStatus
if
StatusManager
getCurrent
isIntegration
depStatus
return
super
resolve
published
publishedStatus
depMrid
depStatus
String
statusProperty
depMrid
getName
depMrid
getRevision
String
versionProperty
depMrid
getName
depMrid
getRevision
String
deliveredProperty
depMrid
getName
depMrid
getRevision
String
version
getProject
getProperty
versionProperty
String
status
getProject
getProperty
statusProperty
String
delivered
getProject
getProperty
deliveredProperty
Message
debug
version
status
delivered
if
version
status
if
equals
delivered
return
version
else
deliverDependency
depMrid
version
status
depStatus
loadDeliveryList
return
version
String
globalStatusProperty
String
globalVersionProperty
version
getProject
getProperty
globalVersionProperty
status
getProject
getProperty
globalStatusProperty
if
version
status
delivered
getProject
getProperty
depMrid
getName
Message
debug
version
status
delivered
if
equals
delivered
return
version
else
getProject
setProperty
statusProperty
status
deliverDependency
depMrid
version
status
depStatus
loadDeliveryList
return
version
Input
input
Input
getProject
createTask
input
setOwningTarget
getOwningTarget
input
init
input
setMessage
depMrid
getName
depMrid
getRevision
input
setValidargs
StatusManager
getCurrent
getDeliveryStatusListString
input
setAddproperty
statusProperty
input
perform
status
getProject
getProperty
statusProperty
appendDeliveryList
statusProperty
status
input
setMessage
depMrid
getName
depMrid
getRevision
input
setValidargs
input
setAddproperty
versionProperty
input
perform
version
getProject
getProperty
versionProperty
appendDeliveryList
versionProperty
version
deliverDependency
depMrid
version
status
depStatus
loadDeliveryList
return
version
public
void
deliverDependency
ModuleRevisionId
depMrid
String
version
String
status
String
depStatus
if
deliverTarget
deliverTarget
trim
length
CallTarget
ct
CallTarget
getProject
createTask
ct
setOwningTarget
getOwningTarget
ct
init
ct
setTarget
deliverTarget
ct
setInheritAll
ct
setInheritRefs
Property
param
ct
createParam
param
setName
param
setValue
depMrid
getName
param
ct
createParam
param
setName
param
setValue
status
param
ct
createParam
param
setName
param
setValue
version
param
ct
createParam
param
setName
param
setValue
depMrid
getRevision
param
ct
createParam
param
setName
param
setValue
depStatus
depStatus
ct
perform
String
deliveredProperty
depMrid
getName
depMrid
getRevision
getProject
setProperty
deliveredProperty
appendDeliveryList
deliveredProperty
getProject
setProperty
depMrid
getName
appendDeliveryList
depMrid
getName
private
String
organisation
private
String
module
private
String
revision
private
String
pubRevision
private
String
deliverpattern
private
String
status
private
String
pubdate
private
String
deliverTarget
private
File
deliveryList
private
boolean
replacedynamicrev
private
String
resolveId
private
String
conf
private
String
pubBranch
public
void
setCache
File
cache
cacheAttributeNotSupported
public
String
getDeliverpattern
return
deliverpattern
public
void
setDeliverpattern
String
destivypattern
this
deliverpattern
destivypattern
public
String
getModule
return
module
public
void
setModule
String
module
this
module
module
public
String
getOrganisation
return
organisation
public
void
setOrganisation
String
organisation
this
organisation
organisation
public
String
getPubdate
return
pubdate
public
void
setPubdate
String
pubdate
this
pubdate
pubdate
public
String
getPubrevision
return
pubRevision
public
void
setPubrevision
String
pubRevision
this
pubRevision
pubRevision
public
String
getPubbranch
return
pubBranch
public
void
setPubbranch
String
pubBranch
this
pubBranch
pubBranch
public
String
getRevision
return
revision
public
void
setRevision
String
revision
this
revision
revision
public
String
getStatus
return
status
public
void
setStatus
String
status
this
status
status
public
void
setDelivertarget
String
deliverTarget
this
deliverTarget
deliverTarget
public
void
setDeliveryList
File
deliveryList
this
deliveryList
deliveryList
public
boolean
isReplacedynamicrev
return
replacedynamicrev
public
void
setReplacedynamicrev
boolean
replacedynamicrev
this
replacedynamicrev
replacedynamicrev
public
String
getResolveId
return
resolveId
public
void
setResolveId
String
resolveId
this
resolveId
resolveId
public
String
getConf
return
conf
public
void
setConf
String
confs
conf
confs
public
void
doExecute
throws
BuildException
Ivy
ivy
getIvyInstance
IvySettings
settings
ivy
getSettings
organisation
getProperty
organisation
settings
resolveId
module
getProperty
module
settings
resolveId
revision
getProperty
revision
settings
resolveId
pubBranch
getProperty
pubBranch
settings
pubRevision
getProperty
pubRevision
settings
deliverpattern
getProperty
deliverpattern
settings
status
getProperty
status
settings
if
deliveryList
String
deliveryListPath
getProperty
settings
if
deliveryListPath
deliveryList
new
File
System
getProperty
else
deliveryList
getProject
resolveFile
settings
substitute
deliveryListPath
if
resolveId
if
organisation
throw
new
BuildException
if
module
throw
new
BuildException
if
revision
revision
Ivy
getWorkingRevision
Date
pubdate
getPubDate
this
pubdate
new
Date
if
pubRevision
if
revision
startsWith
pubRevision
Ivy
DATE_FORMAT
format
pubdate
else
pubRevision
revision
if
deliverpattern
throw
new
BuildException
if
status
throw
new
BuildException
ModuleRevisionId
mrid
if
resolveId
mrid
ModuleRevisionId
newInstance
organisation
module
revision
boolean
isLeading
try
if
deliveryList
exists
isLeading
loadDeliveryList
PublishingDependencyRevisionResolver
drResolver
if
deliverTarget
deliverTarget
trim
length
drResolver
new
DeliverDRResolver
else
drResolver
new
DefaultPublishingDRResolver
DeliverOptions
options
new
DeliverOptions
status
pubdate
drResolver
doValidate
settings
replacedynamicrev
splitConfs
conf
setResolveId
resolveId
setPubBranch
pubBranch
if
mrid
ivy
deliver
pubRevision
deliverpattern
options
else
ivy
deliver
mrid
pubRevision
deliverpattern
options
catch
Exception
e
throw
new
BuildException
mrid
resolveId
mrid
e
e
finally
if
isLeading
if
deliveryList
exists
deliveryList
delete
private
void
loadDeliveryList
Property
property
Property
getProject
createTask
property
setOwningTarget
getOwningTarget
property
init
property
setFile
deliveryList
property
perform
private
void
appendDeliveryList
String
msg
Echo
echo
Echo
getProject
createTask
echo
setOwningTarget
getOwningTarget
echo
init
echo
setFile
deliveryList
echo
setMessage
msg
echo
setAppend
echo
perform
