package
fr
jayasoft
ivy
repository
sftp
import
java
io
File
import
java
io
IOException
import
java
io
InputStream
import
java
util
ArrayList
import
java
util
Collection
import
java
util
Iterator
import
java
util
List
import
com
jcraft
jsch
ChannelSftp
import
com
jcraft
jsch
JSchException
import
com
jcraft
jsch
Session
import
com
jcraft
jsch
SftpATTRS
import
com
jcraft
jsch
SftpException
import
com
jcraft
jsch
SftpProgressMonitor
import
com
jcraft
jsch
ChannelSftp
LsEntry
import
fr
jayasoft
ivy
repository
BasicResource
import
fr
jayasoft
ivy
repository
Resource
import
fr
jayasoft
ivy
repository
TransferEvent
import
fr
jayasoft
ivy
repository
ssh
AbstractSshBasedRepository
import
fr
jayasoft
ivy
repository
ssh
SshCache
import
fr
jayasoft
ivy
util
Message
public
class
SFTPRepository
extends
AbstractSshBasedRepository
private
final
class
MyProgressMonitor
implements
SftpProgressMonitor
private
long
_totalLength
public
void
init
int
op
String
src
String
dest
long
max
_totalLength
max
fireTransferStarted
max
public
void
end
fireTransferCompleted
_totalLength
public
boolean
count
long
count
fireTransferProgress
count
return
public
SFTPRepository
public
Resource
getResource
String
source
return
new
SFTPResource
this
source
public
Resource
resolveResource
String
path
try
ChannelSftp
c
getSftpChannel
path
Collection
r
c
ls
path
if
r
for
Iterator
iter
r
iterator
iter
hasNext
Object
obj
iter
next
if
obj
instanceof
LsEntry
LsEntry
entry
LsEntry
obj
SftpATTRS
attrs
entry
getAttrs
return
new
BasicResource
path
attrs
getSize
attrs
getMTime
catch
Exception
e
Message
debug
e
getMessage
return
new
BasicResource
path
public
InputStream
openStream
SFTPResource
resource
throws
IOException
ChannelSftp
c
getSftpChannel
resource
getName
try
return
c
get
resource
getName
catch
SftpException
e
e
printStackTrace
IOException
ex
new
IOException
resource
getHost
e
getMessage
e
getMessage
ex
initCause
e
throw
ex
public
void
get
String
source
File
destination
throws
IOException
fireTransferInitiated
getResource
source
TransferEvent
REQUEST_GET
ChannelSftp
c
getSftpChannel
source
try
c
get
source
destination
getAbsolutePath
new
MyProgressMonitor
catch
SftpException
e
e
printStackTrace
IOException
ex
new
IOException
source
getHost
e
getMessage
e
getMessage
ex
initCause
e
throw
ex
public
void
put
File
source
String
destination
boolean
overwrite
throws
IOException
fireTransferInitiated
getResource
destination
TransferEvent
REQUEST_PUT
ChannelSftp
c
getSftpChannel
destination
try
if
overwrite
checkExistence
destination
c
throw
new
IOException
if
destination
indexOf
mkdirs
destination
substring
destination
lastIndexOf
c
c
put
source
getAbsolutePath
destination
new
MyProgressMonitor
catch
SftpException
e
IOException
ex
new
IOException
e
getMessage
ex
initCause
e
throw
ex
private
void
mkdirs
String
directory
ChannelSftp
c
throws
IOException
SftpException
try
SftpATTRS
att
c
stat
directory
if
att
if
att
isDir
return
catch
SftpException
ex
if
directory
indexOf
mkdirs
directory
substring
directory
lastIndexOf
c
c
mkdir
directory
public
List
list
String
parent
throws
IOException
try
ChannelSftp
c
getSftpChannel
parent
Collection
r
c
ls
parent
if
r
if
parent
endsWith
parent
parent
List
result
new
ArrayList
for
Iterator
iter
r
iterator
iter
hasNext
Object
obj
iter
next
if
obj
instanceof
LsEntry
LsEntry
entry
LsEntry
obj
if
equals
entry
getFilename
equals
entry
getFilename
continue
result
add
parent
entry
getFilename
return
result
catch
Exception
e
return
private
boolean
checkExistence
String
file
ChannelSftp
channel
throws
IOException
SftpException
try
return
channel
stat
file
catch
SftpException
ex
return
private
ChannelSftp
getSftpChannel
String
pathOrUri
throws
IOException
Session
session
getSession
pathOrUri
String
host
session
getHost
ChannelSftp
channel
SshCache
getInstance
getChannelSftp
session
if
channel
try
channel
ChannelSftp
session
openChannel
channel
connect
Message
verbose
host
SshCache
getInstance
attachChannelSftp
session
channel
catch
JSchException
e
IOException
ex
new
IOException
e
getMessage
ex
initCause
e
throw
ex
return
channel
protected
String
getRepositoryScheme
return
