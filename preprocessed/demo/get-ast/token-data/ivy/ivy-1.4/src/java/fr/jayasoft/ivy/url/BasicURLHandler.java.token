package
fr
jayasoft
ivy
url
import
java
io
ByteArrayInputStream
import
java
io
ByteArrayOutputStream
import
java
io
File
import
java
io
IOException
import
java
io
InputStream
import
java
net
HttpURLConnection
import
java
net
URL
import
java
net
URLConnection
import
java
net
UnknownHostException
import
fr
jayasoft
ivy
util
CopyProgressListener
import
fr
jayasoft
ivy
util
FileUtil
import
fr
jayasoft
ivy
util
Message
public
class
BasicURLHandler
extends
AbstractURLHandler
private
static
interface
HttpStatus
static
final
int
SC_OK
static
final
int
SC_PROXY_AUTHENTICATION_REQUIRED
public
BasicURLHandler
Message
debug
IvyAuthenticator
INSTANCE
getClass
public
URLInfo
getURLInfo
URL
url
return
getURLInfo
url
public
URLInfo
getURLInfo
URL
url
int
timeout
URLConnection
con
try
con
url
openConnection
if
con
instanceof
HttpURLConnection
int
status
HttpURLConnection
con
getResponseCode
if
status
HttpStatus
SC_OK
return
new
URLInfo
HttpURLConnection
con
getContentLength
con
getLastModified
if
status
HttpStatus
SC_PROXY_AUTHENTICATION_REQUIRED
Message
warn
else
if
String
valueOf
status
startsWith
Message
verbose
HttpURLConnection
con
getResponseMessage
url
else
if
String
valueOf
status
startsWith
Message
error
HttpURLConnection
con
getResponseMessage
url
Message
debug
status
url
else
int
contentLength
con
getContentLength
if
contentLength
return
UNAVAILABLE
else
return
new
URLInfo
contentLength
con
getLastModified
catch
UnknownHostException
e
Message
warn
e
getMessage
url
Message
info
catch
IOException
e
Message
error
e
getMessage
url
finally
if
con
instanceof
HttpURLConnection
HttpURLConnection
con
disconnect
return
UNAVAILABLE
public
InputStream
openStream
URL
url
throws
IOException
URLConnection
conn
InputStream
inStream
try
conn
url
openConnection
inStream
conn
getInputStream
ByteArrayOutputStream
outStream
new
ByteArrayOutputStream
byte
buffer
new
byte
int
len
while
len
inStream
read
buffer
outStream
write
buffer
len
return
new
ByteArrayInputStream
outStream
toByteArray
finally
if
inStream
inStream
close
if
conn
if
conn
instanceof
HttpURLConnection
HttpURLConnection
conn
disconnect
public
void
download
URL
src
File
dest
CopyProgressListener
l
throws
IOException
URLConnection
srcConn
try
srcConn
src
openConnection
int
contentLength
srcConn
getContentLength
FileUtil
copy
srcConn
getInputStream
dest
l
if
dest
length
contentLength
contentLength
dest
delete
throw
new
IOException
src
finally
if
srcConn
if
srcConn
instanceof
HttpURLConnection
HttpURLConnection
srcConn
disconnect
