package
fr
jayasoft
ivy
external
m2
import
java
io
File
import
java
io
IOException
import
java
io
InputStream
import
java
net
URL
import
java
text
ParseException
import
java
util
ArrayList
import
java
util
Date
import
java
util
HashMap
import
java
util
Iterator
import
java
util
List
import
java
util
Map
import
java
util
Stack
import
javax
xml
parsers
ParserConfigurationException
import
org
xml
sax
Attributes
import
org
xml
sax
SAXException
import
fr
jayasoft
ivy
ArtifactId
import
fr
jayasoft
ivy
Configuration
import
fr
jayasoft
ivy
DefaultArtifact
import
fr
jayasoft
ivy
DefaultDependencyArtifactDescriptor
import
fr
jayasoft
ivy
DefaultDependencyDescriptor
import
fr
jayasoft
ivy
Ivy
import
fr
jayasoft
ivy
ModuleDescriptor
import
fr
jayasoft
ivy
ModuleId
import
fr
jayasoft
ivy
ModuleRevisionId
import
fr
jayasoft
ivy
Configuration
Visibility
import
fr
jayasoft
ivy
matcher
ExactPatternMatcher
import
fr
jayasoft
ivy
matcher
PatternMatcher
import
fr
jayasoft
ivy
parser
AbstractModuleDescriptorParser
import
fr
jayasoft
ivy
parser
ModuleDescriptorParser
import
fr
jayasoft
ivy
repository
Resource
import
fr
jayasoft
ivy
util
IvyPatternHelper
import
fr
jayasoft
ivy
util
Message
import
fr
jayasoft
ivy
util
XMLHelper
import
fr
jayasoft
ivy
xml
XmlModuleDescriptorWriter
public
class
PomModuleDescriptorParser
extends
AbstractModuleDescriptorParser
public
static
final
Configuration
MAVEN2_CONFIGURATIONS
new
Configuration
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PUBLIC
new
String
new
Configuration
Visibility
PRIVATE
new
String
new
Configuration
Visibility
PUBLIC
new
String
private
static
final
Configuration
OPTIONAL_CONFIGURATION
new
Configuration
Visibility
PUBLIC
new
String
private
static
final
Map
MAVEN2_CONF_MAPPING
new
HashMap
static
MAVEN2_CONF_MAPPING
put
MAVEN2_CONF_MAPPING
put
MAVEN2_CONF_MAPPING
put
MAVEN2_CONF_MAPPING
put
MAVEN2_CONF_MAPPING
put
private
static
final
class
Parser
extends
AbstractParser
private
Ivy
_ivy
private
Stack
_contextStack
new
Stack
private
String
_organisation
private
String
_module
private
String
_revision
private
String
_scope
private
boolean
_optional
private
List
_exclusions
new
ArrayList
private
DefaultDependencyDescriptor
_dd
private
Map
_properties
new
HashMap
public
Parser
ModuleDescriptorParser
parser
Ivy
ivy
Resource
res
super
parser
_ivy
ivy
setResource
res
_md
setResolvedPublicationDate
new
Date
res
getLastModified
for
int
i
i
MAVEN2_CONFIGURATIONS
length
i
_md
addConfiguration
MAVEN2_CONFIGURATIONS
i
public
void
startElement
String
uri
String
localName
String
qName
Attributes
attributes
throws
SAXException
_contextStack
push
qName
if
equals
qName
_optional
else
if
equals
qName
if
_dd
_dd
new
DefaultDependencyDescriptor
_md
ModuleRevisionId
newInstance
_organisation
_module
_revision
_organisation
_module
_revision
else
if
_md
getModuleRevisionId
equals
getContext
fillMrid
private
void
fillMrid
throws
SAXException
if
_organisation
throw
new
SAXException
if
_module
throw
new
SAXException
if
_revision
_revision
ModuleRevisionId
mrid
ModuleRevisionId
newInstance
_organisation
_module
_revision
_properties
put
_revision
_md
setModuleRevisionId
mrid
_md
addArtifact
new
DefaultArtifact
mrid
getDefaultPubDate
_module
_organisation
_module
_revision
public
void
endElement
String
uri
String
localName
String
qName
throws
SAXException
if
_md
getModuleRevisionId
equals
getContext
fillMrid
else
if
_organisation
_module
_revision
_dd
equals
getContext
if
_dd
_dd
new
DefaultDependencyDescriptor
_md
ModuleRevisionId
newInstance
_organisation
_module
_revision
_scope
_scope
_scope
if
_optional
equals
_scope
_scope
String
mapping
String
MAVEN2_CONF_MAPPING
get
_scope
if
mapping
Message
verbose
_scope
getResource
mapping
String
MAVEN2_CONF_MAPPING
get
if
_optional
mapping
mapping
replaceAll
_scope
if
_md
getConfiguration
_md
addConfiguration
OPTIONAL_CONFIGURATION
parseDepsConfs
mapping
_dd
for
Iterator
iter
_exclusions
iterator
iter
hasNext
ModuleId
mid
ModuleId
iter
next
String
confs
_dd
getModuleConfigurations
for
int
i
i
confs
length
i
_dd
addDependencyArtifactExcludes
confs
i
new
DefaultDependencyArtifactDescriptor
_dd
new
ArtifactId
mid
PatternMatcher
ANY_EXPRESSION
PatternMatcher
ANY_EXPRESSION
PatternMatcher
ANY_EXPRESSION
ExactPatternMatcher
getInstance
_md
addDependency
_dd
_dd
else
if
_organisation
_module
equals
getContext
_exclusions
add
new
ModuleId
_organisation
_module
_organisation
_module
if
equals
qName
_organisation
_module
_revision
_scope
_optional
_exclusions
clear
_contextStack
pop
public
void
characters
char
ch
int
start
int
length
throws
SAXException
String
txt
IvyPatternHelper
substituteVariables
new
String
ch
start
length
trim
_properties
if
txt
trim
length
return
String
context
getContext
if
context
equals
_organisation
_organisation
txt
return
if
context
startsWith
return
if
_md
getModuleRevisionId
context
startsWith
if
context
equals
_organisation
txt
else
if
_organisation
context
endsWith
_organisation
txt
else
if
_module
context
endsWith
_module
txt
else
if
_revision
context
endsWith
_revision
txt
else
if
_scope
context
endsWith
_scope
txt
private
String
getContext
StringBuffer
buf
new
StringBuffer
for
Iterator
iter
_contextStack
iterator
iter
hasNext
String
ctx
String
iter
next
buf
append
ctx
append
if
buf
length
buf
setLength
buf
length
return
buf
toString
public
ModuleDescriptor
getDescriptor
if
_md
getModuleRevisionId
return
return
_md
private
static
PomModuleDescriptorParser
INSTANCE
new
PomModuleDescriptorParser
public
static
PomModuleDescriptorParser
getInstance
return
INSTANCE
private
PomModuleDescriptorParser
public
ModuleDescriptor
parseDescriptor
Ivy
ivy
URL
descriptorURL
Resource
res
boolean
validate
throws
ParseException
IOException
Parser
parser
new
Parser
this
ivy
res
try
XMLHelper
parse
descriptorURL
parser
catch
SAXException
ex
ParseException
pe
new
ParseException
ex
getMessage
descriptorURL
pe
initCause
ex
throw
pe
catch
ParserConfigurationException
ex
IllegalStateException
ise
new
IllegalStateException
ex
getMessage
descriptorURL
ise
initCause
ex
throw
ise
return
parser
getDescriptor
public
void
toIvyFile
InputStream
is
Resource
res
File
destFile
ModuleDescriptor
md
throws
ParseException
IOException
try
XmlModuleDescriptorWriter
write
md
destFile
finally
if
is
is
close
public
boolean
accept
Resource
res
return
res
getName
endsWith
res
getName
endsWith
res
getName
endsWith
public
String
toString
return
