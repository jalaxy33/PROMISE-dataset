package
fr
jayasoft
ivy
repository
vfs
import
java
io
IOException
import
java
io
InputStream
import
org
apache
commons
httpclient
HostConfiguration
import
org
apache
commons
httpclient
HttpConnection
import
org
apache
commons
httpclient
HttpConnectionManager
import
org
apache
commons
httpclient
params
HttpConnectionManagerParams
class
IvyWebdavConnectionManager
implements
HttpConnectionManager
static
void
finishLastResponse
HttpConnection
conn
InputStream
lastResponse
conn
getLastResponseInputStream
if
lastResponse
conn
setLastResponseInputStream
try
lastResponse
close
catch
IOException
ioe
conn
close
protected
ThreadLocal
localHttpConnection
new
ThreadLocal
protected
Object
initialValue
return
new
Entry
private
HttpConnectionManagerParams
params
new
HttpConnectionManagerParams
public
void
releaseLocalConnection
if
getLocalHttpConnection
releaseConnection
getLocalHttpConnection
private
static
class
Entry
private
HttpConnection
conn
private
long
idleStartTime
Long
MAX_VALUE
public
IvyWebdavConnectionManager
protected
HttpConnection
getLocalHttpConnection
return
Entry
localHttpConnection
get
conn
protected
void
setLocalHttpConnection
HttpConnection
conn
Entry
localHttpConnection
get
conn
conn
protected
long
getIdleStartTime
return
Entry
localHttpConnection
get
idleStartTime
protected
void
setIdleStartTime
long
idleStartTime
Entry
localHttpConnection
get
idleStartTime
idleStartTime
public
HttpConnection
getConnection
HostConfiguration
hostConfiguration
return
getConnection
hostConfiguration
public
boolean
isConnectionStaleCheckingEnabled
return
this
params
isStaleCheckingEnabled
public
void
setConnectionStaleCheckingEnabled
boolean
connectionStaleCheckingEnabled
this
params
setStaleCheckingEnabled
connectionStaleCheckingEnabled
public
HttpConnection
getConnectionWithTimeout
HostConfiguration
hostConfiguration
long
timeout
HttpConnection
httpConnection
getLocalHttpConnection
if
httpConnection
httpConnection
new
HttpConnection
hostConfiguration
setLocalHttpConnection
httpConnection
httpConnection
setHttpConnectionManager
this
httpConnection
getParams
setDefaults
this
params
else
if
hostConfiguration
hostEquals
httpConnection
hostConfiguration
proxyEquals
httpConnection
if
httpConnection
isOpen
httpConnection
close
httpConnection
setHost
hostConfiguration
getHost
httpConnection
setPort
hostConfiguration
getPort
httpConnection
setProtocol
hostConfiguration
getProtocol
httpConnection
setLocalAddress
hostConfiguration
getLocalAddress
httpConnection
setProxyHost
hostConfiguration
getProxyHost
httpConnection
setProxyPort
hostConfiguration
getProxyPort
else
finishLastResponse
httpConnection
setIdleStartTime
Long
MAX_VALUE
return
httpConnection
public
HttpConnection
getConnection
HostConfiguration
hostConfiguration
long
timeout
return
getConnectionWithTimeout
hostConfiguration
timeout
public
void
releaseConnection
HttpConnection
conn
if
conn
getLocalHttpConnection
throw
new
IllegalStateException
finishLastResponse
getLocalHttpConnection
setIdleStartTime
System
currentTimeMillis
public
void
closeIdleConnections
long
idleTimeout
long
maxIdleTime
System
currentTimeMillis
idleTimeout
if
getIdleStartTime
maxIdleTime
getLocalHttpConnection
close
public
HttpConnectionManagerParams
getParams
return
params
public
void
setParams
HttpConnectionManagerParams
params
this
params
params
