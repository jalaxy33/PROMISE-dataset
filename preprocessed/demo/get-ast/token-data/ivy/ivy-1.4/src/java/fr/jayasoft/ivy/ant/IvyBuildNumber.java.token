package
fr
jayasoft
ivy
ant
import
org
apache
tools
ant
BuildException
import
fr
jayasoft
ivy
Ivy
import
fr
jayasoft
ivy
ModuleId
import
fr
jayasoft
ivy
ModuleRevisionId
import
fr
jayasoft
ivy
ResolvedModuleRevision
public
class
IvyBuildNumber
extends
IvyTask
private
String
_organisation
private
String
_module
private
String
_branch
private
String
_revision
private
String
_revSep
private
String
_prefix
private
String
_default
private
String
_defaultBuildNumber
public
String
getModule
return
_module
public
void
setModule
String
module
_module
module
public
String
getOrganisation
return
_organisation
public
void
setOrganisation
String
organisation
_organisation
organisation
public
String
getRevision
return
_revision
public
void
setRevision
String
revision
_revision
revision
public
String
getBranch
return
_branch
public
void
setBranch
String
branch
_branch
branch
public
String
getDefault
return
_default
public
void
setDefault
String
default1
_default
default1
public
String
getPrefix
return
_prefix
public
void
setPrefix
String
prefix
_prefix
prefix
public
void
execute
throws
BuildException
if
_organisation
throw
new
BuildException
if
_module
throw
new
BuildException
if
_prefix
throw
new
BuildException
Ivy
ivy
getIvyInstance
if
_branch
ivy
getDefaultBranch
new
ModuleId
_organisation
_module
if
_revision
_revision
length
_revision
else
if
_revision
endsWith
_revision
_revision
if
_prefix
endsWith
_prefix
length
_prefix
_prefix
ResolvedModuleRevision
rmr
ivy
findModule
ModuleRevisionId
newInstance
_organisation
_module
_branch
_revision
String
revision
rmr
rmr
getId
getRevision
NewRevision
newRevision
computeNewRevision
revision
setProperty
newRevision
revision
setProperty
newRevision
newRevision
setProperty
newRevision
buildNumber
setProperty
newRevision
newBuildNumber
private
void
setProperty
String
propertyName
String
value
if
value
getProject
setProperty
_prefix
propertyName
value
private
NewRevision
computeNewRevision
String
revision
String
revPrefix
equals
_revision
_revision
substring
_revision
length
if
revision
revision
startsWith
revPrefix
throw
new
BuildException
revision
revPrefix
if
revision
if
revPrefix
length
return
new
NewRevision
revision
revPrefix
revPrefix
endsWith
_revSep
_defaultBuildNumber
_revSep
_defaultBuildNumber
_defaultBuildNumber
else
Range
r
findLastNumber
_default
if
r
return
new
NewRevision
revision
_default
else
long
n
Long
parseLong
_default
substring
r
startIndex
r
endIndex
return
new
NewRevision
revision
_default
String
valueOf
n
Range
r
if
revPrefix
length
r
findLastNumber
revision
if
r
return
new
NewRevision
revision
revision
revision
endsWith
_revSep
_revSep
else
r
findFirstNumber
revision
revPrefix
length
if
r
return
new
NewRevision
revision
revPrefix
revPrefix
endsWith
_revSep
_revSep
long
n
Long
parseLong
revision
substring
r
startIndex
r
endIndex
return
new
NewRevision
revision
revision
substring
r
startIndex
n
String
valueOf
n
String
valueOf
n
private
Range
findFirstNumber
String
str
int
startIndex
int
startNumberIndex
startIndex
while
startNumberIndex
str
length
Character
isDigit
str
charAt
startNumberIndex
startNumberIndex
if
startNumberIndex
str
length
return
int
endNumberIndex
startNumberIndex
while
endNumberIndex
str
length
Character
isDigit
str
charAt
endNumberIndex
endNumberIndex
return
new
Range
startNumberIndex
endNumberIndex
private
Range
findLastNumber
String
str
int
endNumberIndex
str
length
while
endNumberIndex
Character
isDigit
str
charAt
endNumberIndex
endNumberIndex
int
startNumberIndex
endNumberIndex
endNumberIndex
while
startNumberIndex
Character
isDigit
str
charAt
startNumberIndex
startNumberIndex
endNumberIndex
startNumberIndex
if
startNumberIndex
endNumberIndex
return
else
return
new
Range
startNumberIndex
endNumberIndex
private
static
class
Range
private
int
startIndex
private
int
endIndex
public
Range
int
startIndex
int
endIndex
this
startIndex
startIndex
this
endIndex
endIndex
private
static
class
NewRevision
private
String
revision
private
String
newRevision
private
String
buildNumber
private
String
newBuildNumber
public
NewRevision
String
revision
String
newRevision
String
buildNumber
String
newBuildNumber
this
revision
revision
this
newRevision
newRevision
this
buildNumber
buildNumber
this
newBuildNumber
newBuildNumber
public
String
getRevSep
return
_revSep
public
void
setRevSep
String
revSep
_revSep
revSep
public
String
getDefaultBuildNumber
return
_defaultBuildNumber
public
void
setDefaultBuildNumber
String
defaultBuildNumber
_defaultBuildNumber
defaultBuildNumber
