package
fr
jayasoft
ivy
ant
import
java
io
File
import
java
util
Date
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
taskdefs
CallTarget
import
org
apache
tools
ant
taskdefs
Echo
import
org
apache
tools
ant
taskdefs
Input
import
org
apache
tools
ant
taskdefs
Property
import
fr
jayasoft
ivy
DefaultPublishingDRResolver
import
fr
jayasoft
ivy
Ivy
import
fr
jayasoft
ivy
IvyContext
import
fr
jayasoft
ivy
ModuleDescriptor
import
fr
jayasoft
ivy
ModuleRevisionId
import
fr
jayasoft
ivy
PublishingDependencyRevisionResolver
import
fr
jayasoft
ivy
status
StatusManager
import
fr
jayasoft
ivy
util
Message
import
fr
jayasoft
ivy
util
MessageImpl
public
class
IvyDeliver
extends
IvyTask
private
final
class
DeliverDRResolver
extends
DefaultPublishingDRResolver
public
String
resolve
ModuleDescriptor
published
String
publishedStatus
ModuleRevisionId
depMrid
String
depStatus
if
StatusManager
getCurrent
isIntegration
publishedStatus
return
super
resolve
published
publishedStatus
depMrid
depStatus
if
StatusManager
getCurrent
isIntegration
depStatus
return
super
resolve
published
publishedStatus
depMrid
depStatus
String
statusProperty
depMrid
getName
depMrid
getRevision
String
versionProperty
depMrid
getName
depMrid
getRevision
String
deliveredProperty
depMrid
getName
depMrid
getRevision
String
version
getProject
getProperty
versionProperty
String
status
getProject
getProperty
statusProperty
String
delivered
getProject
getProperty
deliveredProperty
Message
debug
version
status
delivered
if
version
status
if
equals
delivered
return
version
else
deliverDependency
depMrid
version
status
depStatus
loadDeliveryList
return
version
String
globalStatusProperty
String
globalVersionProperty
version
getProject
getProperty
globalVersionProperty
status
getProject
getProperty
globalStatusProperty
if
version
status
delivered
getProject
getProperty
depMrid
getName
Message
debug
version
status
delivered
if
equals
delivered
return
version
else
getProject
setProperty
statusProperty
status
deliverDependency
depMrid
version
status
depStatus
loadDeliveryList
return
version
Input
input
Input
getProject
createTask
input
setOwningTarget
getOwningTarget
input
init
input
setMessage
depMrid
getName
depMrid
getRevision
input
setValidargs
StatusManager
getCurrent
getDeliveryStatusListString
input
setAddproperty
statusProperty
input
perform
status
getProject
getProperty
statusProperty
appendDeliveryList
statusProperty
status
input
setMessage
depMrid
getName
depMrid
getRevision
input
setValidargs
input
setAddproperty
versionProperty
input
perform
version
getProject
getProperty
versionProperty
appendDeliveryList
versionProperty
version
deliverDependency
depMrid
version
status
depStatus
loadDeliveryList
return
version
public
void
deliverDependency
ModuleRevisionId
depMrid
String
version
String
status
String
depStatus
if
_deliverTarget
_deliverTarget
trim
length
CallTarget
ct
CallTarget
getProject
createTask
ct
setOwningTarget
getOwningTarget
ct
init
ct
setTarget
_deliverTarget
ct
setInheritAll
ct
setInheritRefs
Property
param
ct
createParam
param
setName
param
setValue
depMrid
getName
param
ct
createParam
param
setName
param
setValue
status
param
ct
createParam
param
setName
param
setValue
version
param
ct
createParam
param
setName
param
setValue
depMrid
getRevision
param
ct
createParam
param
setName
param
setValue
depStatus
depStatus
MessageImpl
impl
IvyContext
getContext
getMessageImpl
try
IvyContext
getContext
setMessageImpl
ct
perform
finally
IvyContext
getContext
setMessageImpl
impl
String
deliveredProperty
depMrid
getName
depMrid
getRevision
getProject
setProperty
deliveredProperty
appendDeliveryList
deliveredProperty
getProject
setProperty
depMrid
getName
appendDeliveryList
depMrid
getName
private
String
_organisation
private
String
_module
private
String
_revision
private
String
_pubRevision
private
File
_cache
private
String
_deliverpattern
private
String
_status
private
String
_pubdate
private
String
_deliverTarget
private
File
_deliveryList
private
boolean
_replacedynamicrev
public
File
getCache
return
_cache
public
void
setCache
File
cache
_cache
cache
public
String
getDeliverpattern
return
_deliverpattern
public
void
setDeliverpattern
String
destivypattern
_deliverpattern
destivypattern
public
String
getModule
return
_module
public
void
setModule
String
module
_module
module
public
String
getOrganisation
return
_organisation
public
void
setOrganisation
String
organisation
_organisation
organisation
public
String
getPubdate
return
_pubdate
public
void
setPubdate
String
pubdate
_pubdate
pubdate
public
String
getPubrevision
return
_pubRevision
public
void
setPubrevision
String
pubRevision
_pubRevision
pubRevision
public
String
getRevision
return
_revision
public
void
setRevision
String
revision
_revision
revision
public
String
getStatus
return
_status
public
void
setStatus
String
status
_status
status
public
void
setDelivertarget
String
deliverTarget
_deliverTarget
deliverTarget
public
void
setDeliveryList
File
deliveryList
_deliveryList
deliveryList
public
boolean
isReplacedynamicrev
return
_replacedynamicrev
public
void
setReplacedynamicrev
boolean
replacedynamicrev
_replacedynamicrev
replacedynamicrev
public
void
execute
throws
BuildException
Ivy
ivy
getIvyInstance
_organisation
getProperty
_organisation
ivy
_module
getProperty
_module
ivy
_revision
getProperty
_revision
ivy
_pubRevision
getProperty
_pubRevision
ivy
if
_cache
_cache
ivy
getDefaultCache
_deliverpattern
getProperty
_deliverpattern
ivy
_status
getProperty
_status
ivy
if
_deliveryList
String
deliveryListPath
getProperty
ivy
if
deliveryListPath
_deliveryList
new
File
System
getProperty
else
_deliveryList
getProject
resolveFile
ivy
substitute
deliveryListPath
if
_organisation
throw
new
BuildException
if
_module
throw
new
BuildException
if
_revision
_revision
Ivy
getLocalHostName
Date
pubdate
getPubDate
_pubdate
new
Date
if
_pubRevision
if
_revision
startsWith
_pubRevision
Ivy
DATE_FORMAT
format
pubdate
else
_pubRevision
_revision
if
_deliverpattern
throw
new
BuildException
if
_status
throw
new
BuildException
ModuleRevisionId
mrid
ModuleRevisionId
newInstance
_organisation
_module
_revision
boolean
isLeading
try
if
_deliveryList
exists
isLeading
loadDeliveryList
PublishingDependencyRevisionResolver
drResolver
if
_deliverTarget
_deliverTarget
trim
length
drResolver
new
DeliverDRResolver
else
drResolver
new
DefaultPublishingDRResolver
ivy
deliver
mrid
_pubRevision
_cache
_deliverpattern
_status
pubdate
drResolver
doValidate
ivy
_replacedynamicrev
catch
Exception
e
throw
new
BuildException
mrid
e
e
finally
if
isLeading
if
_deliveryList
exists
_deliveryList
delete
private
void
loadDeliveryList
Property
property
Property
getProject
createTask
property
setOwningTarget
getOwningTarget
property
init
property
setFile
_deliveryList
property
perform
private
void
appendDeliveryList
String
msg
Echo
echo
Echo
getProject
createTask
echo
setOwningTarget
getOwningTarget
echo
init
echo
setFile
_deliveryList
echo
setMessage
msg
echo
setAppend
echo
perform
