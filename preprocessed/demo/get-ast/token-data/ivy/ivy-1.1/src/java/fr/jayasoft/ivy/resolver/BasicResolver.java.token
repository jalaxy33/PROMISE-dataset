package
fr
jayasoft
ivy
resolver
import
java
io
File
import
java
io
IOException
import
java
net
MalformedURLException
import
java
net
URL
import
java
text
ParseException
import
java
text
SimpleDateFormat
import
java
util
ArrayList
import
java
util
Collection
import
java
util
Collections
import
java
util
Date
import
java
util
HashMap
import
java
util
Iterator
import
java
util
List
import
java
util
ListIterator
import
java
util
Map
import
fr
jayasoft
ivy
Artifact
import
fr
jayasoft
ivy
DefaultArtifact
import
fr
jayasoft
ivy
DefaultModuleDescriptor
import
fr
jayasoft
ivy
DefaultModuleRevision
import
fr
jayasoft
ivy
DependencyDescriptor
import
fr
jayasoft
ivy
DependencyResolver
import
fr
jayasoft
ivy
Ivy
import
fr
jayasoft
ivy
IvyNode
import
fr
jayasoft
ivy
LatestStrategy
import
fr
jayasoft
ivy
ModuleDescriptor
import
fr
jayasoft
ivy
ModuleRevisionId
import
fr
jayasoft
ivy
ResolveData
import
fr
jayasoft
ivy
ResolvedModuleRevision
import
fr
jayasoft
ivy
Status
import
fr
jayasoft
ivy
report
ArtifactDownloadReport
import
fr
jayasoft
ivy
report
DownloadReport
import
fr
jayasoft
ivy
report
DownloadStatus
import
fr
jayasoft
ivy
repository
Resource
import
fr
jayasoft
ivy
util
IvyPatternHelper
import
fr
jayasoft
ivy
util
Message
import
fr
jayasoft
ivy
xml
XmlModuleDescriptorParser
import
fr
jayasoft
ivy
xml
XmlModuleDescriptorUpdater
import
fr
jayasoft
ivy
xml
XmlModuleDescriptorWriter
public
abstract
class
BasicResolver
extends
AbstractResolver
public
static
final
SimpleDateFormat
DATE_FORMAT
new
SimpleDateFormat
protected
String
_workspaceName
private
boolean
_envDependent
private
LatestStrategy
_latestStrategy
private
String
_latestStrategyName
private
List
_ivyattempts
new
ArrayList
private
Map
_artattempts
new
HashMap
private
Boolean
_checkmodified
public
BasicResolver
_workspaceName
Ivy
getLocalHostName
public
String
getWorkspaceName
return
_workspaceName
public
void
setWorkspaceName
String
workspaceName
_workspaceName
workspaceName
public
boolean
isEnvDependent
return
_envDependent
public
void
setEnvDependent
boolean
envDependent
_envDependent
envDependent
public
boolean
isCheckmodified
if
_checkmodified
if
getIvy
String
check
getIvy
getVariable
return
check
Boolean
valueOf
check
booleanValue
else
return
else
return
_checkmodified
booleanValue
public
void
setCheckmodified
boolean
check
_checkmodified
Boolean
valueOf
check
public
LatestStrategy
getLatestStrategy
if
_latestStrategy
if
getIvy
if
_latestStrategyName
_latestStrategy
getIvy
getLatestStrategy
_latestStrategyName
if
_latestStrategy
Message
error
_latestStrategyName
_latestStrategy
getIvy
getDefaultLatestStrategy
else
_latestStrategy
getIvy
getDefaultLatestStrategy
Message
debug
getName
else
throw
new
IllegalStateException
return
_latestStrategy
public
void
setLatestStrategy
LatestStrategy
latestStrategy
_latestStrategy
latestStrategy
public
void
setLatest
String
strategyName
_latestStrategyName
strategyName
public
ResolvedModuleRevision
getDependency
DependencyDescriptor
dd
ResolveData
data
throws
ParseException
_ivyattempts
clear
boolean
downloaded
boolean
searched
ModuleRevisionId
mrid
dd
getDependencyRevisionId
int
index
mrid
getRevision
indexOf
if
index
mrid
getRevision
substring
index
equals
_workspaceName
Message
verbose
getName
mrid
getRevision
return
if
mrid
isExactRevision
acceptLatest
Message
error
getClass
getName
mrid
return
if
mrid
isExactRevision
isCheckmodified
ResolvedModuleRevision
rmr
data
getIvy
findModuleInCache
mrid
data
getCache
doValidate
data
if
rmr
Message
verbose
getName
mrid
return
rmr
URL
cachedIvyURL
ResolvedResource
ivyRef
findIvyFileRef
dd
data
searched
ModuleDescriptor
md
if
ivyRef
md
DefaultModuleDescriptor
newDefaultInstance
mrid
dd
getAllDependencyArtifactsIncludes
ResolvedResource
artifactRef
findFirstArtifactRef
md
dd
data
if
artifactRef
Message
verbose
getName
mrid
logIvyNotFound
mrid
String
conf
md
getConfigurationsNames
for
int
i
i
conf
length
i
Artifact
artifacts
md
getArtifacts
conf
i
for
int
j
j
artifacts
length
j
logArtifactNotFound
artifacts
j
return
else
Message
verbose
getName
mrid
logIvyNotFound
mrid
if
mrid
isExactRevision
md
setResolvedModuleRevisionId
new
ModuleRevisionId
mrid
getModuleId
artifactRef
getRevision
else
Message
verbose
getName
mrid
Message
verbose
ivyRef
ModuleRevisionId
resolvedMrid
mrid
if
mrid
isExactRevision
resolvedMrid
new
ModuleRevisionId
mrid
getModuleId
ivyRef
getRevision
IvyNode
node
data
getNode
resolvedMrid
if
node
node
getModuleRevision
Message
verbose
getName
resolvedMrid
return
searchedRmr
node
getModuleRevision
ResolvedModuleRevision
rmr
data
getIvy
findModuleInCache
resolvedMrid
data
getCache
doValidate
data
if
rmr
if
isCheckmodified
Message
verbose
getName
resolvedMrid
return
searchedRmr
rmr
long
repLastModified
ivyRef
getLastModified
long
cacheLastModified
rmr
getDescriptor
getLastModified
if
rmr
getDescriptor
isDefault
repLastModified
cacheLastModified
Message
verbose
getName
resolvedMrid
return
searchedRmr
rmr
else
Message
verbose
getName
resolvedMrid
try
File
ivyTempFile
File
createTempFile
ivyTempFile
deleteOnExit
Message
debug
getName
ivyRef
getResource
get
ivyRef
getResource
ivyTempFile
downloaded
try
cachedIvyURL
ivyTempFile
toURL
catch
MalformedURLException
ex
Message
warn
ivyTempFile
ex
getMessage
return
catch
IOException
ex
Message
warn
ivyRef
getResource
ex
getMessage
return
try
md
XmlModuleDescriptorParser
parseDescriptor
data
getIvy
cachedIvyURL
ivyRef
getResource
doValidate
data
Message
debug
getName
mrid
md
getModuleRevisionId
catch
IOException
ex
Message
warn
ivyRef
getResource
ex
getMessage
return
md
setResolverName
getName
if
mrid
getRevision
startsWith
String
askedStatus
mrid
getRevision
substring
length
if
Status
getPriority
askedStatus
Status
getPriority
md
getStatus
Message
info
getName
md
getStatus
askedStatus
return
else
if
mrid
acceptRevision
md
getModuleRevisionId
getRevision
Message
info
getName
md
getModuleRevisionId
getRevision
mrid
getRevision
return
ModuleRevisionId
resolvedMrid
mrid
if
resolvedMrid
isExactRevision
resolvedMrid
md
getResolvedModuleRevisionId
if
resolvedMrid
getRevision
resolvedMrid
getRevision
length
if
ivyRef
getRevision
ivyRef
getRevision
length
resolvedMrid
new
ModuleRevisionId
resolvedMrid
getModuleId
_envDependent
DATE_FORMAT
format
data
getDate
_workspaceName
else
resolvedMrid
new
ModuleRevisionId
resolvedMrid
getModuleId
ivyRef
getRevision
Message
verbose
resolvedMrid
getRevision
mrid
getModuleId
md
setResolvedModuleRevisionId
resolvedMrid
if
data
getDate
long
pubDate
getPublicationDate
md
dd
data
if
pubDate
data
getDate
getTime
Message
info
getName
new
Date
pubDate
data
getDate
return
else
if
pubDate
Message
info
getName
mrid
return
md
setResolvedPublicationDate
new
Date
pubDate
try
File
ivyFile
data
getIvy
getIvyFileInCache
data
getCache
md
getResolvedModuleRevisionId
if
ivyRef
XmlModuleDescriptorWriter
write
md
ivyFile
else
XmlModuleDescriptorUpdater
update
cachedIvyURL
ivyFile
Collections
EMPTY_MAP
md
getStatus
md
getResolvedModuleRevisionId
getRevision
md
getResolvedPublicationDate
getName
long
repLastModified
ivyRef
getLastModified
if
repLastModified
ivyFile
setLastModified
repLastModified
catch
Exception
e
Message
warn
ivyRef
getResource
return
new
DefaultModuleRevision
this
md
searched
downloaded
private
ResolvedModuleRevision
searchedRmr
final
ResolvedModuleRevision
rmr
return
new
ResolvedModuleRevision
public
boolean
isSearched
return
public
boolean
isDownloaded
return
rmr
isDownloaded
public
ModuleDescriptor
getDescriptor
return
rmr
getDescriptor
public
Date
getPublicationDate
return
rmr
getPublicationDate
public
ModuleRevisionId
getId
return
rmr
getId
public
DependencyResolver
getResolver
return
rmr
getResolver
protected
void
logIvyAttempt
String
attempt
_ivyattempts
add
attempt
Message
verbose
attempt
protected
void
logArtifactAttempt
Artifact
art
String
attempt
List
attempts
List
_artattempts
get
art
if
attempts
attempts
new
ArrayList
_artattempts
put
art
attempts
attempts
add
attempt
Message
verbose
attempt
public
void
reportFailure
for
ListIterator
iter
_ivyattempts
listIterator
iter
hasNext
String
m
String
iter
next
Message
warn
getName
m
for
Iterator
iter
_artattempts
keySet
iterator
iter
hasNext
Artifact
art
Artifact
iter
next
List
attempts
List
_artattempts
get
art
if
attempts
Message
warn
getName
art
for
ListIterator
iterator
attempts
listIterator
iterator
hasNext
String
m
String
iterator
next
Message
warn
m
public
void
reportFailure
Artifact
art
List
attempts
List
_artattempts
get
art
if
attempts
for
ListIterator
iter
attempts
listIterator
iter
hasNext
String
m
String
iter
next
Message
warn
getName
m
protected
boolean
acceptLatest
return
public
DownloadReport
download
Artifact
artifacts
Ivy
ivy
File
cache
_artattempts
clear
DownloadReport
dr
new
DownloadReport
for
int
i
i
artifacts
length
i
final
ArtifactDownloadReport
adr
new
ArtifactDownloadReport
artifacts
i
dr
addArtifactReport
adr
File
archiveFile
ivy
getArchiveFileInCache
cache
artifacts
i
if
archiveFile
exists
Message
verbose
artifacts
i
adr
setDownloadStatus
DownloadStatus
NO
adr
setSize
archiveFile
length
else
ResolvedResource
artifactRef
findArtifactRef
artifacts
i
if
artifactRef
long
start
System
currentTimeMillis
try
Message
info
artifactRef
getResource
File
tmp
ivy
getArchiveFileInCache
cache
new
DefaultArtifact
artifacts
i
getModuleRevisionId
artifacts
i
getPublicationDate
artifacts
i
getName
artifacts
i
getType
artifacts
i
getExt
adr
setSize
get
artifactRef
getResource
tmp
tmp
renameTo
archiveFile
Message
info
artifacts
i
System
currentTimeMillis
start
adr
setDownloadStatus
DownloadStatus
SUCCESSFUL
catch
Exception
ex
Message
warn
artifacts
i
System
currentTimeMillis
start
adr
setDownloadStatus
DownloadStatus
FAILED
else
logArtifactNotFound
artifacts
i
adr
setDownloadStatus
DownloadStatus
FAILED
return
dr
public
boolean
exists
Artifact
artifact
ResolvedResource
artifactRef
findArtifactRef
artifact
if
artifactRef
return
artifactRef
getResource
exists
return
protected
long
getPublicationDate
ModuleDescriptor
md
DependencyDescriptor
dd
ResolveData
data
if
md
getPublicationDate
return
md
getPublicationDate
getTime
ResolvedResource
artifactRef
findFirstArtifactRef
md
dd
data
if
artifactRef
return
artifactRef
getLastModified
return
public
String
toString
return
getName
public
OrganisationEntry
listOrganisations
Collection
names
findNames
Collections
EMPTY_MAP
IvyPatternHelper
ORGANISATION_KEY
OrganisationEntry
ret
new
OrganisationEntry
names
size
int
i
for
Iterator
iter
names
iterator
iter
hasNext
i
String
org
String
iter
next
ret
i
new
OrganisationEntry
this
org
return
ret
public
ModuleEntry
listModules
OrganisationEntry
org
Map
tokenValues
new
HashMap
tokenValues
put
IvyPatternHelper
ORGANISATION_KEY
org
getOrganisation
Collection
names
findNames
tokenValues
IvyPatternHelper
MODULE_KEY
ModuleEntry
ret
new
ModuleEntry
names
size
int
i
for
Iterator
iter
names
iterator
iter
hasNext
i
String
name
String
iter
next
ret
i
new
ModuleEntry
org
name
return
ret
public
RevisionEntry
listRevisions
ModuleEntry
mod
Map
tokenValues
new
HashMap
tokenValues
put
IvyPatternHelper
ORGANISATION_KEY
mod
getOrganisation
tokenValues
put
IvyPatternHelper
MODULE_KEY
mod
getModule
Collection
names
findNames
tokenValues
IvyPatternHelper
REVISION_KEY
RevisionEntry
ret
new
RevisionEntry
names
size
int
i
for
Iterator
iter
names
iterator
iter
hasNext
i
String
name
String
iter
next
ret
i
new
RevisionEntry
mod
name
return
ret
protected
abstract
Collection
findNames
Map
tokenValues
String
token
protected
abstract
ResolvedResource
findIvyFileRef
DependencyDescriptor
dd
ResolveData
data
protected
abstract
ResolvedResource
findFirstArtifactRef
ModuleDescriptor
md
DependencyDescriptor
dd
ResolveData
data
protected
abstract
ResolvedResource
findArtifactRef
Artifact
artifact
protected
abstract
long
get
Resource
resource
File
ivyTempFile
throws
IOException
protected
abstract
void
logIvyNotFound
ModuleRevisionId
mrid
protected
abstract
void
logArtifactNotFound
Artifact
artifact
