package
fr
jayasoft
ivy
ant
import
java
io
File
import
java
util
Date
import
org
apache
tools
ant
BuildException
import
org
apache
tools
ant
taskdefs
CallTarget
import
org
apache
tools
ant
taskdefs
Echo
import
org
apache
tools
ant
taskdefs
Input
import
org
apache
tools
ant
taskdefs
Property
import
fr
jayasoft
ivy
DefaultPublishingDRResolver
import
fr
jayasoft
ivy
Ivy
import
fr
jayasoft
ivy
ModuleDescriptor
import
fr
jayasoft
ivy
ModuleRevisionId
import
fr
jayasoft
ivy
PublishingDependencyRevisionResolver
import
fr
jayasoft
ivy
Status
public
class
IvyDeliver
extends
IvyTask
private
final
class
DeliverDRResolver
implements
PublishingDependencyRevisionResolver
public
String
resolve
ModuleDescriptor
published
String
publishedStatus
ModuleDescriptor
dependency
if
Status
isIntegration
publishedStatus
return
dependency
getResolvedModuleRevisionId
getRevision
if
Status
isIntegration
dependency
getStatus
return
dependency
getResolvedModuleRevisionId
getRevision
String
statusProperty
dependency
getModuleRevisionId
getName
dependency
getModuleRevisionId
getRevision
String
versionProperty
dependency
getModuleRevisionId
getName
dependency
getModuleRevisionId
getRevision
String
version
getProject
getProperty
versionProperty
String
status
getProject
getProperty
statusProperty
log
version
status
if
version
status
return
version
Input
input
Input
getProject
createTask
input
setOwningTarget
getOwningTarget
input
init
input
setMessage
dependency
getModuleRevisionId
getName
dependency
getModuleRevisionId
getRevision
input
setValidargs
Status
getDeliveryStatusListString
input
setAddproperty
statusProperty
input
perform
appendDeliveryList
statusProperty
getProject
getProperty
statusProperty
input
setMessage
dependency
getModuleRevisionId
getName
dependency
getModuleRevisionId
getRevision
input
setValidargs
input
setAddproperty
versionProperty
input
perform
appendDeliveryList
versionProperty
getProject
getProperty
versionProperty
version
getProject
getProperty
versionProperty
deliverDependency
dependency
version
loadDeliveryList
return
version
public
void
deliverDependency
ModuleDescriptor
dependency
String
version
if
_deliverTarget
String
statusProperty
dependency
getModuleRevisionId
getName
dependency
getModuleRevisionId
getRevision
String
status
getProject
getProperty
statusProperty
CallTarget
ct
CallTarget
getProject
createTask
ct
setOwningTarget
getOwningTarget
ct
init
ct
setTarget
_deliverTarget
ct
setInheritAll
ct
setInheritRefs
Property
param
ct
createParam
param
setName
param
setValue
dependency
getModuleRevisionId
getName
param
ct
createParam
param
setName
param
setValue
status
param
ct
createParam
param
setName
param
setValue
version
param
ct
createParam
param
setName
param
setValue
dependency
getModuleRevisionId
getRevision
ct
perform
private
String
_organisation
private
String
_module
private
String
_revision
private
String
_pubRevision
private
File
_cache
private
String
_deliverpattern
private
String
_status
private
String
_pubdate
private
String
_deliverTarget
private
File
_deliveryList
public
File
getCache
return
_cache
public
void
setCache
File
cache
_cache
cache
public
String
getDeliverpattern
return
_deliverpattern
public
void
setDeliverpattern
String
destivypattern
_deliverpattern
destivypattern
public
String
getModule
return
_module
public
void
setModule
String
module
_module
module
public
String
getOrganisation
return
_organisation
public
void
setOrganisation
String
organisation
_organisation
organisation
public
String
getPubdate
return
_pubdate
public
void
setPubdate
String
pubdate
_pubdate
pubdate
public
String
getPubrevision
return
_pubRevision
public
void
setPubrevision
String
pubRevision
_pubRevision
pubRevision
public
String
getRevision
return
_revision
public
void
setRevision
String
revision
_revision
revision
public
String
getStatus
return
_status
public
void
setStatus
String
status
_status
status
public
void
setDelivertarget
String
deliverTarget
_deliverTarget
deliverTarget
public
void
setDeliveryList
File
deliveryList
_deliveryList
deliveryList
public
void
execute
throws
BuildException
Ivy
ivy
getIvyInstance
_organisation
getProperty
_organisation
ivy
_module
getProperty
_module
ivy
_revision
getProperty
_revision
ivy
_pubRevision
getProperty
_pubRevision
ivy
if
_cache
_cache
ivy
getDefaultCache
_deliverpattern
getProperty
_deliverpattern
ivy
_status
getProperty
_status
ivy
if
_deliveryList
String
deliveryListPath
getProperty
ivy
if
deliveryListPath
_deliveryList
new
File
System
getProperty
else
_deliveryList
getProject
resolveFile
ivy
substitute
deliveryListPath
if
_module
_organisation
_revision
throw
new
BuildException
Date
pubdate
getPubDate
_pubdate
new
Date
if
_pubRevision
if
_revision
startsWith
_pubRevision
Ivy
DATE_FORMAT
format
pubdate
else
_pubRevision
_revision
if
_deliverpattern
throw
new
BuildException
if
_status
throw
new
BuildException
ModuleRevisionId
mrid
ModuleRevisionId
newInstance
_organisation
_module
_revision
boolean
isLeading
try
if
_deliveryList
exists
isLeading
loadDeliveryList
PublishingDependencyRevisionResolver
drResolver
if
_deliverTarget
drResolver
new
DeliverDRResolver
else
drResolver
new
DefaultPublishingDRResolver
ivy
deliver
mrid
_pubRevision
_cache
_deliverpattern
_status
pubdate
drResolver
doValidate
ivy
catch
Exception
e
throw
new
BuildException
mrid
e
getMessage
e
finally
if
isLeading
if
_deliveryList
exists
_deliveryList
delete
private
void
loadDeliveryList
Property
property
Property
getProject
createTask
property
setOwningTarget
getOwningTarget
property
init
property
setFile
_deliveryList
property
perform
private
void
appendDeliveryList
String
msg
Echo
echo
Echo
getProject
createTask
echo
setOwningTarget
getOwningTarget
echo
init
echo
setFile
_deliveryList
echo
setMessage
msg
echo
setAppend
echo
perform
